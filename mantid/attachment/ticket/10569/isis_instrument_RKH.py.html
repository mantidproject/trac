<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      isis_instrument_RKH.py on Ticket #10569 – Attachment
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../../../search.html" />
        <link rel="help" href="../../../wiki/TracGuide.html" />
        <link rel="alternate" href="../../../raw-attachment/ticket/10569/isis_instrument_RKH.py" type="text/x-python; charset=iso-8859-15" title="Original Format" />
        <link rel="up" href="../../../ticket/10569.html" title="Ticket #10569" />
        <link rel="start" href="../../../wiki.html" />
        <link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../pygments/trac.css" type="text/css" /><link rel="stylesheet" href="../../../chrome/common/css/code.css" type="text/css" />
        <link rel="shortcut icon" href="../../../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../../../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../../../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript" src="../../../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../../../chrome/common/js/babel.js"></script><script type="text/javascript" src="../../../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../../../chrome/common/js/trac.js"></script><script type="text/javascript" src="../../../chrome/common/js/search.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
      <script type="text/javascript" src="../../../chrome/common/js/folding.js"></script>
      <script type="text/javascript">
        jQuery(document).ready(function($) {
          $('#preview table.code').enableCollapsibleColumns($('#preview table.code thead th.content'));
        });
      </script>
    <link rel="stylesheet" type="text/css" href="../../../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../../../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../../../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../../../prefs.html">Preferences</a></li><li><a href="../../../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../../../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../../../wiki.html">Wiki</a></li><li><a href="../../../timeline.html">Timeline</a></li><li><a href="../../../roadmap.html">Roadmap</a></li><li><a href="../../../report.html">View Tickets</a></li><li class="last"><a href="../../../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="last first"><a href="../../../ticket/10569.html">Back to Ticket #10569</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="attachment">
        <h1><a href="../../../ticket/10569.html">Ticket #10569</a>: isis_instrument_RKH.py</h1>
        <table id="info" summary="Description">
          <tbody>
            <tr>
              <th scope="col">File isis_instrument_RKH.py,
                <span title="54573 bytes">53.3 KB</span>
                (added by Anders Markvardsen, <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-11-18T12%3A02%3A21Z&amp;precision=second" title="2014-11-18T12:02:21Z in Timeline">6 years</a> ago)</th>
            </tr>
            <tr>
              <td class="message searchable">
                
              </td>
            </tr>
          </tbody>
        </table>
        <div id="preview" class="searchable">
          
  <table class="code"><thead><tr><th class="lineno" title="Line numbers">Line</th><th class="content"> </th></tr></thead><tbody><tr><th id="L1"><a href="isis_instrument_RKH.py.html#L1">1</a></th><td><span class="kn">import</span> <span class="nn">datetime</span></td></tr><tr><th id="L2"><a href="isis_instrument_RKH.py.html#L2">2</a></th><td><span class="kn">import</span> <span class="nn">math</span></td></tr><tr><th id="L3"><a href="isis_instrument_RKH.py.html#L3">3</a></th><td><span class="kn">import</span> <span class="nn">os</span></td></tr><tr><th id="L4"><a href="isis_instrument_RKH.py.html#L4">4</a></th><td><span class="kn">import</span> <span class="nn">re</span></td></tr><tr><th id="L5"><a href="isis_instrument_RKH.py.html#L5">5</a></th><td><span class="kn">import</span> <span class="nn">sys</span></td></tr><tr><th id="L6"><a href="isis_instrument_RKH.py.html#L6">6</a></th><td><span class="kn">import</span> <span class="nn">time</span></td></tr><tr><th id="L7"><a href="isis_instrument_RKH.py.html#L7">7</a></th><td><span class="kn">import</span> <span class="nn">xml.dom.minidom</span></td></tr><tr><th id="L8"><a href="isis_instrument_RKH.py.html#L8">8</a></th><td></td></tr><tr><th id="L9"><a href="isis_instrument_RKH.py.html#L9">9</a></th><td><span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span></td></tr><tr><th id="L10"><a href="isis_instrument_RKH.py.html#L10">10</a></th><td><span class="kn">from</span> <span class="nn">mantid.api</span> <span class="kn">import</span> WorkspaceGroup<span class="p">,</span> Workspace<span class="p">,</span> ExperimentInfo</td></tr><tr><th id="L11"><a href="isis_instrument_RKH.py.html#L11">11</a></th><td><span class="kn">from</span> <span class="nn">mantid.kernel</span> <span class="kn">import</span> Logger</td></tr><tr><th id="L12"><a href="isis_instrument_RKH.py.html#L12">12</a></th><td><span class="kn">import</span> <span class="nn">SANSUtility</span> <span class="kn">as</span> <span class="nn">su</span></td></tr><tr><th id="L13"><a href="isis_instrument_RKH.py.html#L13">13</a></th><td></td></tr><tr><th id="L14"><a href="isis_instrument_RKH.py.html#L14">14</a></th><td>sanslog <span class="o">=</span> Logger<span class="p">(</span><span class="s">"SANS"</span><span class="p">)</span></td></tr><tr><th id="L15"><a href="isis_instrument_RKH.py.html#L15">15</a></th><td></td></tr><tr><th id="L16"><a href="isis_instrument_RKH.py.html#L16">16</a></th><td><span class="k">class</span> <span class="nc">BaseInstrument</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></td></tr><tr><th id="L17"><a href="isis_instrument_RKH.py.html#L17">17</a></th><td>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> instr_filen<span class="o">=</span><span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L18"><a href="isis_instrument_RKH.py.html#L18">18</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L19"><a href="isis_instrument_RKH.py.html#L19">19</a></th><td><span class="sd">            Reads the instrument definition xml file</span></td></tr><tr><th id="L20"><a href="isis_instrument_RKH.py.html#L20">20</a></th><td><span class="sd">            @param instr_filen: the name of the instrument definition file to read</span></td></tr><tr><th id="L21"><a href="isis_instrument_RKH.py.html#L21">21</a></th><td><span class="sd">            @raise IndexError: if any parameters (e.g. 'default-incident-monitor-spectrum') aren't in the xml definition</span></td></tr><tr><th id="L22"><a href="isis_instrument_RKH.py.html#L22">22</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L23"><a href="isis_instrument_RKH.py.html#L23">23</a></th><td>        <span class="k">if</span> instr_filen <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L24"><a href="isis_instrument_RKH.py.html#L24">24</a></th><td>            instr_filen <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_NAME<span class="o">+</span><span class="s">'_Definition.xml'</span></td></tr><tr><th id="L25"><a href="isis_instrument_RKH.py.html#L25">25</a></th><td></td></tr><tr><th id="L26"><a href="isis_instrument_RKH.py.html#L26">26</a></th><td>        config <span class="o">=</span> ConfigService<span class="o">.</span>Instance<span class="p">()</span></td></tr><tr><th id="L27"><a href="isis_instrument_RKH.py.html#L27">27</a></th><td>        <span class="bp">self</span><span class="o">.</span>_definition_file <span class="o">=</span> os<span class="o">.</span>path<span class="o">.</span>join<span class="p">(</span>config<span class="p">[</span><span class="s">"instrumentDefinition.directory"</span><span class="p">],</span> instr_filen<span class="p">)</span></td></tr><tr><th id="L28"><a href="isis_instrument_RKH.py.html#L28">28</a></th><td></td></tr><tr><th id="L29"><a href="isis_instrument_RKH.py.html#L29">29</a></th><td>        inst_ws_name <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>load_empty<span class="p">()</span></td></tr><tr><th id="L30"><a href="isis_instrument_RKH.py.html#L30">30</a></th><td>        <span class="bp">self</span><span class="o">.</span>definition <span class="o">=</span> AnalysisDataService<span class="o">.</span>retrieve<span class="p">(</span>inst_ws_name<span class="p">)</span><span class="o">.</span>getInstrument<span class="p">()</span></td></tr><tr><th id="L31"><a href="isis_instrument_RKH.py.html#L31">31</a></th><td></td></tr><tr><th id="L32"><a href="isis_instrument_RKH.py.html#L32">32</a></th><td>    <span class="k">def</span> <span class="nf">get_default_beam_center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L33"><a href="isis_instrument_RKH.py.html#L33">33</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L34"><a href="isis_instrument_RKH.py.html#L34">34</a></th><td><span class="sd">            Returns the default beam center position, or the pixel location</span></td></tr><tr><th id="L35"><a href="isis_instrument_RKH.py.html#L35">35</a></th><td><span class="sd">            of real-space coordinates (0,0).</span></td></tr><tr><th id="L36"><a href="isis_instrument_RKH.py.html#L36">36</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L37"><a href="isis_instrument_RKH.py.html#L37">37</a></th><td>        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span></td></tr><tr><th id="L38"><a href="isis_instrument_RKH.py.html#L38">38</a></th><td></td></tr><tr><th id="L39"><a href="isis_instrument_RKH.py.html#L39">39</a></th><td>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L40"><a href="isis_instrument_RKH.py.html#L40">40</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L41"><a href="isis_instrument_RKH.py.html#L41">41</a></th><td><span class="sd">            Return the name of the instrument</span></td></tr><tr><th id="L42"><a href="isis_instrument_RKH.py.html#L42">42</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L43"><a href="isis_instrument_RKH.py.html#L43">43</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_NAME</td></tr><tr><th id="L44"><a href="isis_instrument_RKH.py.html#L44">44</a></th><td></td></tr><tr><th id="L45"><a href="isis_instrument_RKH.py.html#L45">45</a></th><td>    <span class="k">def</span> <span class="nf">versioned_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L46"><a href="isis_instrument_RKH.py.html#L46">46</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L47"><a href="isis_instrument_RKH.py.html#L47">47</a></th><td><span class="sd">        Hack-workaround so that we may temporarily display "SANS2DTUBES" as</span></td></tr><tr><th id="L48"><a href="isis_instrument_RKH.py.html#L48">48</a></th><td><span class="sd">        an option in the instrument dropdown menu in the interface.  To be removed</span></td></tr><tr><th id="L49"><a href="isis_instrument_RKH.py.html#L49">49</a></th><td><span class="sd">        as part of #9367.</span></td></tr><tr><th id="L50"><a href="isis_instrument_RKH.py.html#L50">50</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L51"><a href="isis_instrument_RKH.py.html#L51">51</a></th><td>        <span class="k">if</span> <span class="s">"SANS2D_Definition_Tubes"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span>idf_path<span class="p">:</span></td></tr><tr><th id="L52"><a href="isis_instrument_RKH.py.html#L52">52</a></th><td>            <span class="k">return</span> <span class="s">"SANS2DTUBES"</span></td></tr><tr><th id="L53"><a href="isis_instrument_RKH.py.html#L53">53</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_NAME</td></tr><tr><th id="L54"><a href="isis_instrument_RKH.py.html#L54">54</a></th><td></td></tr><tr><th id="L55"><a href="isis_instrument_RKH.py.html#L55">55</a></th><td>    <span class="k">def</span> <span class="nf">view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> workspace_name <span class="o">=</span> <span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L56"><a href="isis_instrument_RKH.py.html#L56">56</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L57"><a href="isis_instrument_RKH.py.html#L57">57</a></th><td><span class="sd">            Opens Mantidplot's InstrumentView displaying the current instrument. This</span></td></tr><tr><th id="L58"><a href="isis_instrument_RKH.py.html#L58">58</a></th><td><span class="sd">            empty instrument created contained in the named workspace (a default name</span></td></tr><tr><th id="L59"><a href="isis_instrument_RKH.py.html#L59">59</a></th><td><span class="sd">            is generated if this the argument is left blank) unless the workspace already</span></td></tr><tr><th id="L60"><a href="isis_instrument_RKH.py.html#L60">60</a></th><td><span class="sd">            exists and then it's contents are displayed</span></td></tr><tr><th id="L61"><a href="isis_instrument_RKH.py.html#L61">61</a></th><td><span class="sd">            @param workspace_name: the name of the workspace to create and/or display</span></td></tr><tr><th id="L62"><a href="isis_instrument_RKH.py.html#L62">62</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L63"><a href="isis_instrument_RKH.py.html#L63">63</a></th><td>        <span class="k">if</span> workspace_name <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L64"><a href="isis_instrument_RKH.py.html#L64">64</a></th><td>            workspace_name <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_NAME<span class="o">+</span><span class="s">'_instrument_view'</span></td></tr><tr><th id="L65"><a href="isis_instrument_RKH.py.html#L65">65</a></th><td>            <span class="bp">self</span><span class="o">.</span>load_empty<span class="p">(</span>workspace_name<span class="p">)</span></td></tr><tr><th id="L66"><a href="isis_instrument_RKH.py.html#L66">66</a></th><td>        <span class="k">elif</span> <span class="ow">not</span> AnalysisDataService<span class="o">.</span>doesExist<span class="p">(</span>workspace_name<span class="p">):</span></td></tr><tr><th id="L67"><a href="isis_instrument_RKH.py.html#L67">67</a></th><td>            <span class="bp">self</span><span class="o">.</span>load_empty<span class="p">(</span>workspace_name<span class="p">)</span></td></tr><tr><th id="L68"><a href="isis_instrument_RKH.py.html#L68">68</a></th><td></td></tr><tr><th id="L69"><a href="isis_instrument_RKH.py.html#L69">69</a></th><td>        <span class="kn">import</span> <span class="nn">mantidplot</span></td></tr><tr><th id="L70"><a href="isis_instrument_RKH.py.html#L70">70</a></th><td>        instrument_win <span class="o">=</span> mantidplot<span class="o">.</span>getInstrumentView<span class="p">(</span>workspace_name<span class="p">)</span></td></tr><tr><th id="L71"><a href="isis_instrument_RKH.py.html#L71">71</a></th><td>        instrument_win<span class="o">.</span>show<span class="p">()</span></td></tr><tr><th id="L72"><a href="isis_instrument_RKH.py.html#L72">72</a></th><td></td></tr><tr><th id="L73"><a href="isis_instrument_RKH.py.html#L73">73</a></th><td>        <span class="k">return</span> workspace_name</td></tr><tr><th id="L74"><a href="isis_instrument_RKH.py.html#L74">74</a></th><td></td></tr><tr><th id="L75"><a href="isis_instrument_RKH.py.html#L75">75</a></th><td>    <span class="k">def</span> <span class="nf">load_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> workspace_name <span class="o">=</span> <span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L76"><a href="isis_instrument_RKH.py.html#L76">76</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L77"><a href="isis_instrument_RKH.py.html#L77">77</a></th><td><span class="sd">            Loads the instrument definition file into a workspace with the given name.</span></td></tr><tr><th id="L78"><a href="isis_instrument_RKH.py.html#L78">78</a></th><td><span class="sd">            If no name is given a hidden workspace is used</span></td></tr><tr><th id="L79"><a href="isis_instrument_RKH.py.html#L79">79</a></th><td><span class="sd">            @param workspace_name: the name of the workspace to create and/or display</span></td></tr><tr><th id="L80"><a href="isis_instrument_RKH.py.html#L80">80</a></th><td><span class="sd">            @return the name of the workspace that was created</span></td></tr><tr><th id="L81"><a href="isis_instrument_RKH.py.html#L81">81</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L82"><a href="isis_instrument_RKH.py.html#L82">82</a></th><td>        <span class="k">if</span> workspace_name <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L83"><a href="isis_instrument_RKH.py.html#L83">83</a></th><td>            workspace_name <span class="o">=</span> <span class="s">'__'</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span>_NAME<span class="o">+</span><span class="s">'_empty'</span></td></tr><tr><th id="L84"><a href="isis_instrument_RKH.py.html#L84">84</a></th><td></td></tr><tr><th id="L85"><a href="isis_instrument_RKH.py.html#L85">85</a></th><td>        LoadEmptyInstrument<span class="p">(</span>Filename<span class="o">=</span><span class="bp">self</span><span class="o">.</span>_definition_file<span class="p">,</span> OutputWorkspace<span class="o">=</span>workspace_name<span class="p">)</span></td></tr><tr><th id="L86"><a href="isis_instrument_RKH.py.html#L86">86</a></th><td></td></tr><tr><th id="L87"><a href="isis_instrument_RKH.py.html#L87">87</a></th><td>        <span class="k">return</span> workspace_name</td></tr><tr><th id="L88"><a href="isis_instrument_RKH.py.html#L88">88</a></th><td></td></tr><tr><th id="L89"><a href="isis_instrument_RKH.py.html#L89">89</a></th><td></td></tr><tr><th id="L90"><a href="isis_instrument_RKH.py.html#L90">90</a></th><td><span class="k">class</span> <span class="nc">DetectorBank</span><span class="p">:</span></td></tr><tr><th id="L91"><a href="isis_instrument_RKH.py.html#L91">91</a></th><td>    <span class="k">class</span> <span class="nc">_DectShape</span><span class="p">:</span></td></tr><tr><th id="L92"><a href="isis_instrument_RKH.py.html#L92">92</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L93"><a href="isis_instrument_RKH.py.html#L93">93</a></th><td><span class="sd">            Stores the dimensions of the detector, normally this is a square</span></td></tr><tr><th id="L94"><a href="isis_instrument_RKH.py.html#L94">94</a></th><td><span class="sd">            which is easy, but it can have a hole in it which is harder!</span></td></tr><tr><th id="L95"><a href="isis_instrument_RKH.py.html#L95">95</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L96"><a href="isis_instrument_RKH.py.html#L96">96</a></th><td>        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> width<span class="p">,</span> height<span class="p">,</span> isRect <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> n_pixels <span class="o">=</span> <span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L97"><a href="isis_instrument_RKH.py.html#L97">97</a></th><td>            <span class="sd">"""</span></td></tr><tr><th id="L98"><a href="isis_instrument_RKH.py.html#L98">98</a></th><td><span class="sd">                Sets the dimensions of the detector</span></td></tr><tr><th id="L99"><a href="isis_instrument_RKH.py.html#L99">99</a></th><td><span class="sd">                @param width: the detector's width, spectra numbers along the width should increase in intervals of one</span></td></tr><tr><th id="L100"><a href="isis_instrument_RKH.py.html#L100">100</a></th><td><span class="sd">                @param height: the detector's height, spectra numbers along the down the height should increase in intervals of width</span></td></tr><tr><th id="L101"><a href="isis_instrument_RKH.py.html#L101">101</a></th><td><span class="sd">                @param isRect: true for rectangular or square detectors, i.e. number of pixels = width * height</span></td></tr><tr><th id="L102"><a href="isis_instrument_RKH.py.html#L102">102</a></th><td><span class="sd">                @param n_pixels: optional for rectangular shapes because if it is not given it is calculated from the height and width in that case</span></td></tr><tr><th id="L103"><a href="isis_instrument_RKH.py.html#L103">103</a></th><td><span class="sd">            """</span></td></tr><tr><th id="L104"><a href="isis_instrument_RKH.py.html#L104">104</a></th><td>            <span class="bp">self</span><span class="o">.</span>_width <span class="o">=</span> width</td></tr><tr><th id="L105"><a href="isis_instrument_RKH.py.html#L105">105</a></th><td>            <span class="bp">self</span><span class="o">.</span>_height <span class="o">=</span> height</td></tr><tr><th id="L106"><a href="isis_instrument_RKH.py.html#L106">106</a></th><td>            <span class="bp">self</span><span class="o">.</span>_isRect <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>isRect<span class="p">)</span></td></tr><tr><th id="L107"><a href="isis_instrument_RKH.py.html#L107">107</a></th><td>            <span class="bp">self</span><span class="o">.</span>_n_pixels <span class="o">=</span> n_pixels</td></tr><tr><th id="L108"><a href="isis_instrument_RKH.py.html#L108">108</a></th><td>            <span class="k">if</span> n_pixels <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L109"><a href="isis_instrument_RKH.py.html#L109">109</a></th><td>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>_isRect<span class="p">:</span></td></tr><tr><th id="L110"><a href="isis_instrument_RKH.py.html#L110">110</a></th><td>                    <span class="bp">self</span><span class="o">.</span>_n_pixels <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_width<span class="o">*</span><span class="bp">self</span><span class="o">.</span>_height</td></tr><tr><th id="L111"><a href="isis_instrument_RKH.py.html#L111">111</a></th><td>                <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L112"><a href="isis_instrument_RKH.py.html#L112">112</a></th><td>                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">'Number of pixels in the detector unknown, you must state the number of pixels for non-rectangular detectors'</span><span class="p">)</span></td></tr><tr><th id="L113"><a href="isis_instrument_RKH.py.html#L113">113</a></th><td></td></tr><tr><th id="L114"><a href="isis_instrument_RKH.py.html#L114">114</a></th><td></td></tr><tr><th id="L115"><a href="isis_instrument_RKH.py.html#L115">115</a></th><td>        <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L116"><a href="isis_instrument_RKH.py.html#L116">116</a></th><td>            <span class="sd">"""</span></td></tr><tr><th id="L117"><a href="isis_instrument_RKH.py.html#L117">117</a></th><td><span class="sd">                read-only property getter, this object can't be altered</span></td></tr><tr><th id="L118"><a href="isis_instrument_RKH.py.html#L118">118</a></th><td><span class="sd">            """</span></td></tr><tr><th id="L119"><a href="isis_instrument_RKH.py.html#L119">119</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_width</td></tr><tr><th id="L120"><a href="isis_instrument_RKH.py.html#L120">120</a></th><td></td></tr><tr><th id="L121"><a href="isis_instrument_RKH.py.html#L121">121</a></th><td>        <span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L122"><a href="isis_instrument_RKH.py.html#L122">122</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_height</td></tr><tr><th id="L123"><a href="isis_instrument_RKH.py.html#L123">123</a></th><td></td></tr><tr><th id="L124"><a href="isis_instrument_RKH.py.html#L124">124</a></th><td>        <span class="k">def</span> <span class="nf">isRectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L125"><a href="isis_instrument_RKH.py.html#L125">125</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_isRect</td></tr><tr><th id="L126"><a href="isis_instrument_RKH.py.html#L126">126</a></th><td></td></tr><tr><th id="L127"><a href="isis_instrument_RKH.py.html#L127">127</a></th><td>        <span class="k">def</span> <span class="nf">n_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L128"><a href="isis_instrument_RKH.py.html#L128">128</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_n_pixels</td></tr><tr><th id="L129"><a href="isis_instrument_RKH.py.html#L129">129</a></th><td></td></tr><tr><th id="L130"><a href="isis_instrument_RKH.py.html#L130">130</a></th><td>    <span class="k">class</span> <span class="nc">_RescaleAndShift</span><span class="p">:</span></td></tr><tr><th id="L131"><a href="isis_instrument_RKH.py.html#L131">131</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L132"><a href="isis_instrument_RKH.py.html#L132">132</a></th><td><span class="sd">            Stores property about the detector which is used to rescale and shift</span></td></tr><tr><th id="L133"><a href="isis_instrument_RKH.py.html#L133">133</a></th><td><span class="sd">            data in the bank after data have been reduced. The scale attempts to</span></td></tr><tr><th id="L134"><a href="isis_instrument_RKH.py.html#L134">134</a></th><td><span class="sd">            take into account that the relative efficiency of different banks may not</span></td></tr><tr><th id="L135"><a href="isis_instrument_RKH.py.html#L135">135</a></th><td><span class="sd">            be the same. By default this scale is set to 1.0. The shift is strictly</span></td></tr><tr><th id="L136"><a href="isis_instrument_RKH.py.html#L136">136</a></th><td><span class="sd">            speaking more an effect of the geometry of the sample than the detector</span></td></tr><tr><th id="L137"><a href="isis_instrument_RKH.py.html#L137">137</a></th><td><span class="sd">            but is included here since both these are required to bring the scale+shift of reduced data</span></td></tr><tr><th id="L138"><a href="isis_instrument_RKH.py.html#L138">138</a></th><td><span class="sd">            collected on front and rear bank on the same 'level' before e.g. merging</span></td></tr><tr><th id="L139"><a href="isis_instrument_RKH.py.html#L139">139</a></th><td><span class="sd">            such data</span></td></tr><tr><th id="L140"><a href="isis_instrument_RKH.py.html#L140">140</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L141"><a href="isis_instrument_RKH.py.html#L141">141</a></th><td>        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> scale<span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> shift<span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> fitScale<span class="o">=</span><span class="bp">False</span><span class="p">,</span> fitShift<span class="o">=</span><span class="bp">False</span><span class="p">,</span> qMin<span class="o">=</span><span class="bp">None</span><span class="p">,</span> qMax<span class="o">=</span><span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L142"><a href="isis_instrument_RKH.py.html#L142">142</a></th><td>            <span class="sd">"""</span></td></tr><tr><th id="L143"><a href="isis_instrument_RKH.py.html#L143">143</a></th><td><span class="sd">                @param scale: Default to 1.0. Value to multiply data with</span></td></tr><tr><th id="L144"><a href="isis_instrument_RKH.py.html#L144">144</a></th><td><span class="sd">                @param shift: Default to 0.0. Value to add to data</span></td></tr><tr><th id="L145"><a href="isis_instrument_RKH.py.html#L145">145</a></th><td><span class="sd">                @param fitScale: Default is False. Whether or not to try and fit this param</span></td></tr><tr><th id="L146"><a href="isis_instrument_RKH.py.html#L146">146</a></th><td><span class="sd">                @param fitShift: Default is False. Whether or not to try and fit this param</span></td></tr><tr><th id="L147"><a href="isis_instrument_RKH.py.html#L147">147</a></th><td><span class="sd">                @param qMin: When set to None (default) then for fitting use the overlapping q region of front and rear detectors</span></td></tr><tr><th id="L148"><a href="isis_instrument_RKH.py.html#L148">148</a></th><td><span class="sd">                @param qMax: When set to None (default) then for fitting use the overlapping q region of front and rear detectors</span></td></tr><tr><th id="L149"><a href="isis_instrument_RKH.py.html#L149">149</a></th><td><span class="sd">            """</span></td></tr><tr><th id="L150"><a href="isis_instrument_RKH.py.html#L150">150</a></th><td>            <span class="bp">self</span><span class="o">.</span>scale <span class="o">=</span> scale</td></tr><tr><th id="L151"><a href="isis_instrument_RKH.py.html#L151">151</a></th><td>            <span class="bp">self</span><span class="o">.</span>shift <span class="o">=</span> shift</td></tr><tr><th id="L152"><a href="isis_instrument_RKH.py.html#L152">152</a></th><td>            <span class="bp">self</span><span class="o">.</span>fitScale <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>fitScale<span class="p">)</span></td></tr><tr><th id="L153"><a href="isis_instrument_RKH.py.html#L153">153</a></th><td>            <span class="bp">self</span><span class="o">.</span>fitShift <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>fitShift<span class="p">)</span></td></tr><tr><th id="L154"><a href="isis_instrument_RKH.py.html#L154">154</a></th><td>            <span class="bp">self</span><span class="o">.</span>qMin <span class="o">=</span> qMin</td></tr><tr><th id="L155"><a href="isis_instrument_RKH.py.html#L155">155</a></th><td>            <span class="bp">self</span><span class="o">.</span>qMax <span class="o">=</span> qMax</td></tr><tr><th id="L156"><a href="isis_instrument_RKH.py.html#L156">156</a></th><td></td></tr><tr><th id="L157"><a href="isis_instrument_RKH.py.html#L157">157</a></th><td>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>qMin <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span>qMax <span class="o">==</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L158"><a href="isis_instrument_RKH.py.html#L158">158</a></th><td>                <span class="bp">self</span><span class="o">.</span>qRangeUserSelected <span class="o">=</span> <span class="bp">False</span></td></tr><tr><th id="L159"><a href="isis_instrument_RKH.py.html#L159">159</a></th><td>            <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L160"><a href="isis_instrument_RKH.py.html#L160">160</a></th><td>                <span class="bp">self</span><span class="o">.</span>qRangeUserSelected <span class="o">=</span> <span class="bp">True</span></td></tr><tr><th id="L161"><a href="isis_instrument_RKH.py.html#L161">161</a></th><td></td></tr><tr><th id="L162"><a href="isis_instrument_RKH.py.html#L162">162</a></th><td></td></tr><tr><th id="L163"><a href="isis_instrument_RKH.py.html#L163">163</a></th><td>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> instr<span class="p">,</span> det_type<span class="p">):</span></td></tr><tr><th id="L164"><a href="isis_instrument_RKH.py.html#L164">164</a></th><td>        <span class="c">#detectors are known by many names, the 'uni' name is an instrument independent alias the 'long' name is the instrument view name and 'short' name often used for convenience</span></td></tr><tr><th id="L165"><a href="isis_instrument_RKH.py.html#L165">165</a></th><td>        <span class="bp">self</span><span class="o">.</span>_names <span class="o">=</span> <span class="p">{</span></td></tr><tr><th id="L166"><a href="isis_instrument_RKH.py.html#L166">166</a></th><td>          <span class="s">'uni'</span> <span class="p">:</span> det_type<span class="p">,</span></td></tr><tr><th id="L167"><a href="isis_instrument_RKH.py.html#L167">167</a></th><td>          <span class="s">'long'</span><span class="p">:</span> instr<span class="o">.</span>getStringParameter<span class="p">(</span>det_type<span class="o">+</span><span class="s">'-detector-name'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span></td></tr><tr><th id="L168"><a href="isis_instrument_RKH.py.html#L168">168</a></th><td>          <span class="s">'short'</span><span class="p">:</span> instr<span class="o">.</span>getStringParameter<span class="p">(</span>det_type<span class="o">+</span><span class="s">'-detector-short-name'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]}</span></td></tr><tr><th id="L169"><a href="isis_instrument_RKH.py.html#L169">169</a></th><td>        <span class="c">#the bank is often also referred to by its location, as seen by the sample</span></td></tr><tr><th id="L170"><a href="isis_instrument_RKH.py.html#L170">170</a></th><td>        <span class="k">if</span> det_type<span class="o">.</span>startswith<span class="p">(</span><span class="s">'low'</span><span class="p">):</span></td></tr><tr><th id="L171"><a href="isis_instrument_RKH.py.html#L171">171</a></th><td>            position <span class="o">=</span> <span class="s">'rear'</span></td></tr><tr><th id="L172"><a href="isis_instrument_RKH.py.html#L172">172</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L173"><a href="isis_instrument_RKH.py.html#L173">173</a></th><td>            position <span class="o">=</span> <span class="s">'front'</span></td></tr><tr><th id="L174"><a href="isis_instrument_RKH.py.html#L174">174</a></th><td>        <span class="bp">self</span><span class="o">.</span>_names<span class="p">[</span><span class="s">'position'</span><span class="p">]</span> <span class="o">=</span> position</td></tr><tr><th id="L175"><a href="isis_instrument_RKH.py.html#L175">175</a></th><td></td></tr><tr><th id="L176"><a href="isis_instrument_RKH.py.html#L176">176</a></th><td>        cols_data <span class="o">=</span> instr<span class="o">.</span>getNumberParameter<span class="p">(</span>det_type<span class="o">+</span><span class="s">'-detector-num-columns'</span><span class="p">)</span></td></tr><tr><th id="L177"><a href="isis_instrument_RKH.py.html#L177">177</a></th><td>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>cols_data<span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span></td></tr><tr><th id="L178"><a href="isis_instrument_RKH.py.html#L178">178</a></th><td>            rectanglar_shape <span class="o">=</span> <span class="bp">True</span></td></tr><tr><th id="L179"><a href="isis_instrument_RKH.py.html#L179">179</a></th><td>            width <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>cols_data<span class="p">[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L180"><a href="isis_instrument_RKH.py.html#L180">180</a></th><td>        <span class="k">else</span> <span class="p">:</span></td></tr><tr><th id="L181"><a href="isis_instrument_RKH.py.html#L181">181</a></th><td>            rectanglar_shape <span class="o">=</span> <span class="bp">False</span></td></tr><tr><th id="L182"><a href="isis_instrument_RKH.py.html#L182">182</a></th><td>            width <span class="o">=</span> instr<span class="o">.</span>getNumberParameter<span class="p">(</span>det_type<span class="o">+</span><span class="s">'-detector-non-rectangle-width'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></td></tr><tr><th id="L183"><a href="isis_instrument_RKH.py.html#L183">183</a></th><td></td></tr><tr><th id="L184"><a href="isis_instrument_RKH.py.html#L184">184</a></th><td>        rows_data <span class="o">=</span> instr<span class="o">.</span>getNumberParameter<span class="p">(</span>det_type<span class="o">+</span><span class="s">'-detector-num-rows'</span><span class="p">)</span></td></tr><tr><th id="L185"><a href="isis_instrument_RKH.py.html#L185">185</a></th><td>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>rows_data<span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span></td></tr><tr><th id="L186"><a href="isis_instrument_RKH.py.html#L186">186</a></th><td>            height <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>rows_data<span class="p">[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L187"><a href="isis_instrument_RKH.py.html#L187">187</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L188"><a href="isis_instrument_RKH.py.html#L188">188</a></th><td>            rectanglar_shape <span class="o">=</span> <span class="bp">False</span></td></tr><tr><th id="L189"><a href="isis_instrument_RKH.py.html#L189">189</a></th><td>            height <span class="o">=</span> instr<span class="o">.</span>getNumberParameter<span class="p">(</span>det_type<span class="o">+</span><span class="s">'-detector-non-rectangle-height'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></td></tr><tr><th id="L190"><a href="isis_instrument_RKH.py.html#L190">190</a></th><td></td></tr><tr><th id="L191"><a href="isis_instrument_RKH.py.html#L191">191</a></th><td>        n_pixels <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L192"><a href="isis_instrument_RKH.py.html#L192">192</a></th><td>        n_pixels_override <span class="o">=</span> instr<span class="o">.</span>getNumberParameter<span class="p">(</span>det_type<span class="o">+</span><span class="s">'-detector-num-pixels'</span><span class="p">)</span></td></tr><tr><th id="L193"><a href="isis_instrument_RKH.py.html#L193">193</a></th><td>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>n_pixels_override<span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span></td></tr><tr><th id="L194"><a href="isis_instrument_RKH.py.html#L194">194</a></th><td>            n_pixels <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>n_pixels_override<span class="p">[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L195"><a href="isis_instrument_RKH.py.html#L195">195</a></th><td>        <span class="c">#n_pixels is normally None and calculated by DectShape but LOQ (at least) has a detector with a hole</span></td></tr><tr><th id="L196"><a href="isis_instrument_RKH.py.html#L196">196</a></th><td>        <span class="bp">self</span><span class="o">.</span>_shape <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_DectShape<span class="p">(</span>width<span class="p">,</span> height<span class="p">,</span> rectanglar_shape<span class="p">,</span> n_pixels<span class="p">)</span></td></tr><tr><th id="L197"><a href="isis_instrument_RKH.py.html#L197">197</a></th><td></td></tr><tr><th id="L198"><a href="isis_instrument_RKH.py.html#L198">198</a></th><td>        spec_entry <span class="o">=</span> instr<span class="o">.</span>getNumberParameter<span class="p">(</span><span class="s">'first-low-angle-spec-number'</span><span class="p">)</span></td></tr><tr><th id="L199"><a href="isis_instrument_RKH.py.html#L199">199</a></th><td>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>spec_entry<span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span></td></tr><tr><th id="L200"><a href="isis_instrument_RKH.py.html#L200">200</a></th><td>            <span class="bp">self</span><span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="nb">int</span><span class="p">(</span>spec_entry<span class="p">[</span><span class="mi">0</span><span class="p">]))</span></td></tr><tr><th id="L201"><a href="isis_instrument_RKH.py.html#L201">201</a></th><td>        <span class="k">else</span> <span class="p">:</span></td></tr><tr><th id="L202"><a href="isis_instrument_RKH.py.html#L202">202</a></th><td>            <span class="c">#'first-low-angle-spec-number' is an optimal instrument parameter</span></td></tr><tr><th id="L203"><a href="isis_instrument_RKH.py.html#L203">203</a></th><td>            <span class="bp">self</span><span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">0</span><span class="p">)</span></td></tr><tr><th id="L204"><a href="isis_instrument_RKH.py.html#L204">204</a></th><td></td></tr><tr><th id="L205"><a href="isis_instrument_RKH.py.html#L205">205</a></th><td>        <span class="c">#needed for compatibility with SANSReduction and SANSUtily, remove</span></td></tr><tr><th id="L206"><a href="isis_instrument_RKH.py.html#L206">206</a></th><td>        <span class="bp">self</span><span class="o">.</span>n_columns <span class="o">=</span> width</td></tr><tr><th id="L207"><a href="isis_instrument_RKH.py.html#L207">207</a></th><td></td></tr><tr><th id="L208"><a href="isis_instrument_RKH.py.html#L208">208</a></th><td>        <span class="c">#this can be set to the name of a file with correction factor against wavelength</span></td></tr><tr><th id="L209"><a href="isis_instrument_RKH.py.html#L209">209</a></th><td>        <span class="bp">self</span><span class="o">.</span>correction_file <span class="o">=</span> <span class="s">''</span></td></tr><tr><th id="L210"><a href="isis_instrument_RKH.py.html#L210">210</a></th><td>        <span class="c">#this corrections are set by the mask file</span></td></tr><tr><th id="L211"><a href="isis_instrument_RKH.py.html#L211">211</a></th><td>        <span class="bp">self</span><span class="o">.</span>z_corr <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L212"><a href="isis_instrument_RKH.py.html#L212">212</a></th><td>        <span class="bp">self</span><span class="o">.</span>x_corr <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L213"><a href="isis_instrument_RKH.py.html#L213">213</a></th><td>        <span class="bp">self</span><span class="o">.</span>_y_corr <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L214"><a href="isis_instrument_RKH.py.html#L214">214</a></th><td>        <span class="bp">self</span><span class="o">.</span>_rot_corr <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L215"><a href="isis_instrument_RKH.py.html#L215">215</a></th><td>        <span class="c">#23/3/12 RKH add 2 more variables</span></td></tr><tr><th id="L216"><a href="isis_instrument_RKH.py.html#L216">216</a></th><td>        <span class="bp">self</span><span class="o">.</span>_radius_corr <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L217"><a href="isis_instrument_RKH.py.html#L217">217</a></th><td>        <span class="bp">self</span><span class="o">.</span>_side_corr <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L218"><a href="isis_instrument_RKH.py.html#L218">218</a></th><td>                <span class="c"># 11/11/14 RKH add 2 more, valid for all detectors.  WHY do some of the above have an extra leading underscore?? Seems they are the optional ones sorted below</span></td></tr><tr><th id="L219"><a href="isis_instrument_RKH.py.html#L219">219</a></th><td>        <span class="bp">self</span><span class="o">.</span>x_tilt <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L220"><a href="isis_instrument_RKH.py.html#L220">220</a></th><td>        <span class="bp">self</span><span class="o">.</span>y_tilt <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L221"><a href="isis_instrument_RKH.py.html#L221">221</a></th><td></td></tr><tr><th id="L222"><a href="isis_instrument_RKH.py.html#L222">222</a></th><td>        <span class="c"># hold rescale and shift object _RescaleAndShift</span></td></tr><tr><th id="L223"><a href="isis_instrument_RKH.py.html#L223">223</a></th><td>        <span class="bp">self</span><span class="o">.</span>rescaleAndShift <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_RescaleAndShift<span class="p">()</span></td></tr><tr><th id="L224"><a href="isis_instrument_RKH.py.html#L224">224</a></th><td></td></tr><tr><th id="L225"><a href="isis_instrument_RKH.py.html#L225">225</a></th><td>        <span class="c">#in the empty instrument detectors are laid out as below on loading a run the orientation becomes run dependent</span></td></tr><tr><th id="L226"><a href="isis_instrument_RKH.py.html#L226">226</a></th><td>        <span class="bp">self</span><span class="o">.</span>_orientation <span class="o">=</span> <span class="s">'HorizontalFlipped'</span></td></tr><tr><th id="L227"><a href="isis_instrument_RKH.py.html#L227">227</a></th><td></td></tr><tr><th id="L228"><a href="isis_instrument_RKH.py.html#L228">228</a></th><td>    <span class="k">def</span> <span class="nf">disable_y_and_rot_corrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L229"><a href="isis_instrument_RKH.py.html#L229">229</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L230"><a href="isis_instrument_RKH.py.html#L230">230</a></th><td><span class="sd">            Not all corrections are supported on all detectors</span></td></tr><tr><th id="L231"><a href="isis_instrument_RKH.py.html#L231">231</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L232"><a href="isis_instrument_RKH.py.html#L232">232</a></th><td>        <span class="bp">self</span><span class="o">.</span>_y_corr <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L233"><a href="isis_instrument_RKH.py.html#L233">233</a></th><td>        <span class="bp">self</span><span class="o">.</span>_rot_corr <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L234"><a href="isis_instrument_RKH.py.html#L234">234</a></th><td>        <span class="c">#23/3/12 RKH add 2 more variables</span></td></tr><tr><th id="L235"><a href="isis_instrument_RKH.py.html#L235">235</a></th><td>        <span class="bp">self</span><span class="o">.</span>_radius_corr <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L236"><a href="isis_instrument_RKH.py.html#L236">236</a></th><td>        <span class="bp">self</span><span class="o">.</span>_side_corr <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L237"><a href="isis_instrument_RKH.py.html#L237">237</a></th><td></td></tr><tr><th id="L238"><a href="isis_instrument_RKH.py.html#L238">238</a></th><td>    <span class="k">def</span> <span class="nf">get_y_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L239"><a href="isis_instrument_RKH.py.html#L239">239</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_y_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L240"><a href="isis_instrument_RKH.py.html#L240">240</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_y_corr</td></tr><tr><th id="L241"><a href="isis_instrument_RKH.py.html#L241">241</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L242"><a href="isis_instrument_RKH.py.html#L242">242</a></th><td>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">'y correction is not used for this detector'</span><span class="p">)</span></td></tr><tr><th id="L243"><a href="isis_instrument_RKH.py.html#L243">243</a></th><td></td></tr><tr><th id="L244"><a href="isis_instrument_RKH.py.html#L244">244</a></th><td>    <span class="k">def</span> <span class="nf">set_y_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> value<span class="p">):</span></td></tr><tr><th id="L245"><a href="isis_instrument_RKH.py.html#L245">245</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L246"><a href="isis_instrument_RKH.py.html#L246">246</a></th><td><span class="sd">            Only set the value if it isn't disabled</span></td></tr><tr><th id="L247"><a href="isis_instrument_RKH.py.html#L247">247</a></th><td><span class="sd">            @param value: set y_corr to this value, unless it's disabled</span></td></tr><tr><th id="L248"><a href="isis_instrument_RKH.py.html#L248">248</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L249"><a href="isis_instrument_RKH.py.html#L249">249</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_y_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L250"><a href="isis_instrument_RKH.py.html#L250">250</a></th><td>            <span class="bp">self</span><span class="o">.</span>_y_corr <span class="o">=</span> value</td></tr><tr><th id="L251"><a href="isis_instrument_RKH.py.html#L251">251</a></th><td></td></tr><tr><th id="L252"><a href="isis_instrument_RKH.py.html#L252">252</a></th><td>    <span class="k">def</span> <span class="nf">get_rot_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L253"><a href="isis_instrument_RKH.py.html#L253">253</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_rot_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L254"><a href="isis_instrument_RKH.py.html#L254">254</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_rot_corr</td></tr><tr><th id="L255"><a href="isis_instrument_RKH.py.html#L255">255</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L256"><a href="isis_instrument_RKH.py.html#L256">256</a></th><td>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">'rot correction is not used for this detector'</span><span class="p">)</span></td></tr><tr><th id="L257"><a href="isis_instrument_RKH.py.html#L257">257</a></th><td></td></tr><tr><th id="L258"><a href="isis_instrument_RKH.py.html#L258">258</a></th><td>    <span class="k">def</span> <span class="nf">set_rot_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> value<span class="p">):</span></td></tr><tr><th id="L259"><a href="isis_instrument_RKH.py.html#L259">259</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L260"><a href="isis_instrument_RKH.py.html#L260">260</a></th><td><span class="sd">            Only set the value if it isn't disabled</span></td></tr><tr><th id="L261"><a href="isis_instrument_RKH.py.html#L261">261</a></th><td><span class="sd">            @param value: set rot_corr to this value, unless it's disabled</span></td></tr><tr><th id="L262"><a href="isis_instrument_RKH.py.html#L262">262</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L263"><a href="isis_instrument_RKH.py.html#L263">263</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_rot_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L264"><a href="isis_instrument_RKH.py.html#L264">264</a></th><td>            <span class="bp">self</span><span class="o">.</span>_rot_corr <span class="o">=</span> value</td></tr><tr><th id="L265"><a href="isis_instrument_RKH.py.html#L265">265</a></th><td></td></tr><tr><th id="L266"><a href="isis_instrument_RKH.py.html#L266">266</a></th><td>    <span class="c"># 22/3/12 RKH added two new variables radius_corr, side_corr</span></td></tr><tr><th id="L267"><a href="isis_instrument_RKH.py.html#L267">267</a></th><td>    <span class="k">def</span> <span class="nf">get_radius_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L268"><a href="isis_instrument_RKH.py.html#L268">268</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_radius_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L269"><a href="isis_instrument_RKH.py.html#L269">269</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_radius_corr</td></tr><tr><th id="L270"><a href="isis_instrument_RKH.py.html#L270">270</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L271"><a href="isis_instrument_RKH.py.html#L271">271</a></th><td>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">'radius correction is not used for this detector'</span><span class="p">)</span></td></tr><tr><th id="L272"><a href="isis_instrument_RKH.py.html#L272">272</a></th><td></td></tr><tr><th id="L273"><a href="isis_instrument_RKH.py.html#L273">273</a></th><td>    <span class="k">def</span> <span class="nf">set_radius_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> value<span class="p">):</span></td></tr><tr><th id="L274"><a href="isis_instrument_RKH.py.html#L274">274</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L275"><a href="isis_instrument_RKH.py.html#L275">275</a></th><td><span class="sd">            Only set the value if it isn't disabled</span></td></tr><tr><th id="L276"><a href="isis_instrument_RKH.py.html#L276">276</a></th><td><span class="sd">            @param value: set radius_corr to this value, unless it's disabled</span></td></tr><tr><th id="L277"><a href="isis_instrument_RKH.py.html#L277">277</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L278"><a href="isis_instrument_RKH.py.html#L278">278</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_rot_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L279"><a href="isis_instrument_RKH.py.html#L279">279</a></th><td>            <span class="bp">self</span><span class="o">.</span>_radius_corr <span class="o">=</span> value</td></tr><tr><th id="L280"><a href="isis_instrument_RKH.py.html#L280">280</a></th><td></td></tr><tr><th id="L281"><a href="isis_instrument_RKH.py.html#L281">281</a></th><td>    <span class="k">def</span> <span class="nf">get_side_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L282"><a href="isis_instrument_RKH.py.html#L282">282</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_side_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L283"><a href="isis_instrument_RKH.py.html#L283">283</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_side_corr</td></tr><tr><th id="L284"><a href="isis_instrument_RKH.py.html#L284">284</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L285"><a href="isis_instrument_RKH.py.html#L285">285</a></th><td>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">'side correction is not used for this detector'</span><span class="p">)</span></td></tr><tr><th id="L286"><a href="isis_instrument_RKH.py.html#L286">286</a></th><td></td></tr><tr><th id="L287"><a href="isis_instrument_RKH.py.html#L287">287</a></th><td>    <span class="k">def</span> <span class="nf">set_side_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> value<span class="p">):</span></td></tr><tr><th id="L288"><a href="isis_instrument_RKH.py.html#L288">288</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L289"><a href="isis_instrument_RKH.py.html#L289">289</a></th><td><span class="sd">            Only set the value if it isn't disabled</span></td></tr><tr><th id="L290"><a href="isis_instrument_RKH.py.html#L290">290</a></th><td><span class="sd">            @param value: set side_corr to this value, unless it's disabled</span></td></tr><tr><th id="L291"><a href="isis_instrument_RKH.py.html#L291">291</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L292"><a href="isis_instrument_RKH.py.html#L292">292</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_side_corr <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L293"><a href="isis_instrument_RKH.py.html#L293">293</a></th><td>            <span class="bp">self</span><span class="o">.</span>_side_corr <span class="o">=</span> value</td></tr><tr><th id="L294"><a href="isis_instrument_RKH.py.html#L294">294</a></th><td></td></tr><tr><th id="L295"><a href="isis_instrument_RKH.py.html#L295">295</a></th><td></td></tr><tr><th id="L296"><a href="isis_instrument_RKH.py.html#L296">296</a></th><td>    y_corr <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>get_y_corr<span class="p">,</span> set_y_corr<span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></td></tr><tr><th id="L297"><a href="isis_instrument_RKH.py.html#L297">297</a></th><td>    rot_corr <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>get_rot_corr <span class="p">,</span> set_rot_corr<span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></td></tr><tr><th id="L298"><a href="isis_instrument_RKH.py.html#L298">298</a></th><td>    <span class="c"># 22/3/12 RKH added 2 new variables</span></td></tr><tr><th id="L299"><a href="isis_instrument_RKH.py.html#L299">299</a></th><td>    radius_corr <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>get_radius_corr <span class="p">,</span> set_radius_corr<span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></td></tr><tr><th id="L300"><a href="isis_instrument_RKH.py.html#L300">300</a></th><td>    side_corr <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>get_side_corr <span class="p">,</span> set_side_corr<span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></td></tr><tr><th id="L301"><a href="isis_instrument_RKH.py.html#L301">301</a></th><td></td></tr><tr><th id="L302"><a href="isis_instrument_RKH.py.html#L302">302</a></th><td>    <span class="k">def</span> <span class="nf">get_first_spec_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L303"><a href="isis_instrument_RKH.py.html#L303">303</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_first_spec_num</td></tr><tr><th id="L304"><a href="isis_instrument_RKH.py.html#L304">304</a></th><td></td></tr><tr><th id="L305"><a href="isis_instrument_RKH.py.html#L305">305</a></th><td>    <span class="k">def</span> <span class="nf">set_first_spec_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> value<span class="p">):</span></td></tr><tr><th id="L306"><a href="isis_instrument_RKH.py.html#L306">306</a></th><td>        <span class="bp">self</span><span class="o">.</span>_first_spec_num <span class="o">=</span> value</td></tr><tr><th id="L307"><a href="isis_instrument_RKH.py.html#L307">307</a></th><td>        <span class="bp">self</span><span class="o">.</span>last_spec_num <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_first_spec_num <span class="o">+</span> <span class="bp">self</span><span class="o">.</span>_shape<span class="o">.</span>n_pixels<span class="p">()</span> <span class="o">-</span> <span class="mi">1</span></td></tr><tr><th id="L308"><a href="isis_instrument_RKH.py.html#L308">308</a></th><td></td></tr><tr><th id="L309"><a href="isis_instrument_RKH.py.html#L309">309</a></th><td>    <span class="k">def</span> <span class="nf">place_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> previousDet<span class="p">):</span></td></tr><tr><th id="L310"><a href="isis_instrument_RKH.py.html#L310">310</a></th><td>        <span class="bp">self</span><span class="o">.</span>set_first_spec_num<span class="p">(</span>previousDet<span class="o">.</span>last_spec_num <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></td></tr><tr><th id="L311"><a href="isis_instrument_RKH.py.html#L311">311</a></th><td></td></tr><tr><th id="L312"><a href="isis_instrument_RKH.py.html#L312">312</a></th><td>    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> form <span class="o">=</span> <span class="s">'long'</span><span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L313"><a href="isis_instrument_RKH.py.html#L313">313</a></th><td>        <span class="k">if</span> form<span class="o">.</span>lower<span class="p">()</span> <span class="o">==</span> <span class="s">'inst_view'</span> <span class="p">:</span> form <span class="o">=</span> <span class="s">'long'</span></td></tr><tr><th id="L314"><a href="isis_instrument_RKH.py.html#L314">314</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_names<span class="o">.</span>has_key<span class="p">(</span>form<span class="p">)</span> <span class="p">:</span> form <span class="o">=</span> <span class="s">'long'</span></td></tr><tr><th id="L315"><a href="isis_instrument_RKH.py.html#L315">315</a></th><td></td></tr><tr><th id="L316"><a href="isis_instrument_RKH.py.html#L316">316</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_names<span class="p">[</span>form<span class="p">]</span></td></tr><tr><th id="L317"><a href="isis_instrument_RKH.py.html#L317">317</a></th><td></td></tr><tr><th id="L318"><a href="isis_instrument_RKH.py.html#L318">318</a></th><td>    <span class="k">def</span> <span class="nf">isAlias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> guess<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L319"><a href="isis_instrument_RKH.py.html#L319">319</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L320"><a href="isis_instrument_RKH.py.html#L320">320</a></th><td><span class="sd">            Detectors are often referred to by more than one name, check</span></td></tr><tr><th id="L321"><a href="isis_instrument_RKH.py.html#L321">321</a></th><td><span class="sd">            if the supplied name is in the list</span></td></tr><tr><th id="L322"><a href="isis_instrument_RKH.py.html#L322">322</a></th><td><span class="sd">            @param guess: this name will be searched for in the list</span></td></tr><tr><th id="L323"><a href="isis_instrument_RKH.py.html#L323">323</a></th><td><span class="sd">            @return : True if the name was found, otherwise false</span></td></tr><tr><th id="L324"><a href="isis_instrument_RKH.py.html#L324">324</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L325"><a href="isis_instrument_RKH.py.html#L325">325</a></th><td>        <span class="k">for</span> name <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span>_names<span class="o">.</span>values<span class="p">()</span> <span class="p">:</span></td></tr><tr><th id="L326"><a href="isis_instrument_RKH.py.html#L326">326</a></th><td>            <span class="k">if</span> guess<span class="o">.</span>lower<span class="p">()</span> <span class="o">==</span> name<span class="o">.</span>lower<span class="p">()</span> <span class="p">:</span></td></tr><tr><th id="L327"><a href="isis_instrument_RKH.py.html#L327">327</a></th><td>                <span class="k">return</span> <span class="bp">True</span></td></tr><tr><th id="L328"><a href="isis_instrument_RKH.py.html#L328">328</a></th><td>        <span class="k">return</span> <span class="bp">False</span></td></tr><tr><th id="L329"><a href="isis_instrument_RKH.py.html#L329">329</a></th><td></td></tr><tr><th id="L330"><a href="isis_instrument_RKH.py.html#L330">330</a></th><td>    <span class="k">def</span> <span class="nf">spectrum_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ylow<span class="p">,</span> xlow<span class="p">,</span> ydim<span class="p">,</span> xdim<span class="p">):</span></td></tr><tr><th id="L331"><a href="isis_instrument_RKH.py.html#L331">331</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L332"><a href="isis_instrument_RKH.py.html#L332">332</a></th><td><span class="sd">            Compile a list of spectrum IDs for rectangular block of size xdim by ydim</span></td></tr><tr><th id="L333"><a href="isis_instrument_RKH.py.html#L333">333</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L334"><a href="isis_instrument_RKH.py.html#L334">334</a></th><td>        <span class="k">if</span> ydim <span class="o">==</span> <span class="s">'all'</span><span class="p">:</span></td></tr><tr><th id="L335"><a href="isis_instrument_RKH.py.html#L335">335</a></th><td>            ydim <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_shape<span class="o">.</span>height<span class="p">()</span></td></tr><tr><th id="L336"><a href="isis_instrument_RKH.py.html#L336">336</a></th><td>        <span class="k">if</span> xdim <span class="o">==</span> <span class="s">'all'</span><span class="p">:</span></td></tr><tr><th id="L337"><a href="isis_instrument_RKH.py.html#L337">337</a></th><td>            xdim <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_shape<span class="o">.</span>width<span class="p">()</span></td></tr><tr><th id="L338"><a href="isis_instrument_RKH.py.html#L338">338</a></th><td>        det_dimension <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_shape<span class="o">.</span>width<span class="p">()</span></td></tr><tr><th id="L339"><a href="isis_instrument_RKH.py.html#L339">339</a></th><td>        base <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_first_spec_num</td></tr><tr><th id="L340"><a href="isis_instrument_RKH.py.html#L340">340</a></th><td></td></tr><tr><th id="L341"><a href="isis_instrument_RKH.py.html#L341">341</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_shape<span class="o">.</span>isRectangle<span class="p">():</span></td></tr><tr><th id="L342"><a href="isis_instrument_RKH.py.html#L342">342</a></th><td>            sanslog<span class="o">.</span>warning<span class="p">(</span><span class="s">'Attempting to block rows or columns in a non-rectangular detector, this is likely to give unexpected results!'</span><span class="p">)</span></td></tr><tr><th id="L343"><a href="isis_instrument_RKH.py.html#L343">343</a></th><td></td></tr><tr><th id="L344"><a href="isis_instrument_RKH.py.html#L344">344</a></th><td>        output <span class="o">=</span> <span class="s">''</span></td></tr><tr><th id="L345"><a href="isis_instrument_RKH.py.html#L345">345</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>_orientation <span class="o">==</span> <span class="s">'Horizontal'</span><span class="p">:</span></td></tr><tr><th id="L346"><a href="isis_instrument_RKH.py.html#L346">346</a></th><td>            start_spec <span class="o">=</span> base <span class="o">+</span> ylow<span class="o">*</span>det_dimension <span class="o">+</span> xlow</td></tr><tr><th id="L347"><a href="isis_instrument_RKH.py.html#L347">347</a></th><td>            <span class="k">for</span> y <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> ydim<span class="p">):</span></td></tr><tr><th id="L348"><a href="isis_instrument_RKH.py.html#L348">348</a></th><td>                <span class="k">for</span> x <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> xdim<span class="p">):</span></td></tr><tr><th id="L349"><a href="isis_instrument_RKH.py.html#L349">349</a></th><td>                    output <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span>start_spec <span class="o">+</span> x <span class="o">+</span> <span class="p">(</span>y<span class="o">*</span>det_dimension<span class="p">))</span> <span class="o">+</span> <span class="s">','</span></td></tr><tr><th id="L350"><a href="isis_instrument_RKH.py.html#L350">350</a></th><td>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span>_orientation <span class="o">==</span> <span class="s">'Vertical'</span><span class="p">:</span></td></tr><tr><th id="L351"><a href="isis_instrument_RKH.py.html#L351">351</a></th><td>            start_spec <span class="o">=</span> base <span class="o">+</span> xlow<span class="o">*</span>det_dimension <span class="o">+</span> ylow</td></tr><tr><th id="L352"><a href="isis_instrument_RKH.py.html#L352">352</a></th><td>            <span class="k">for</span> x <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>det_dimension <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> det_dimension <span class="o">-</span> xdim<span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span></td></tr><tr><th id="L353"><a href="isis_instrument_RKH.py.html#L353">353</a></th><td>                <span class="k">for</span> y <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> ydim<span class="p">):</span></td></tr><tr><th id="L354"><a href="isis_instrument_RKH.py.html#L354">354</a></th><td>                    std_i <span class="o">=</span> start_spec <span class="o">+</span> y <span class="o">+</span> <span class="p">((</span>det_dimension<span class="o">-</span>x<span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span>det_dimension<span class="p">)</span></td></tr><tr><th id="L355"><a href="isis_instrument_RKH.py.html#L355">355</a></th><td>                    output <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span>std_i <span class="p">)</span> <span class="o">+</span> <span class="s">','</span></td></tr><tr><th id="L356"><a href="isis_instrument_RKH.py.html#L356">356</a></th><td>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span>_orientation <span class="o">==</span> <span class="s">'Rotated'</span><span class="p">:</span></td></tr><tr><th id="L357"><a href="isis_instrument_RKH.py.html#L357">357</a></th><td>            <span class="c"># This is the horizontal one rotated so need to map the xlow and vlow to their rotated versions</span></td></tr><tr><th id="L358"><a href="isis_instrument_RKH.py.html#L358">358</a></th><td>            start_spec <span class="o">=</span> base <span class="o">+</span> ylow<span class="o">*</span>det_dimension <span class="o">+</span> xlow</td></tr><tr><th id="L359"><a href="isis_instrument_RKH.py.html#L359">359</a></th><td>            max_spec <span class="o">=</span> det_dimension<span class="o">*</span>det_dimension <span class="o">+</span> base <span class="o">-</span> <span class="mi">1</span></td></tr><tr><th id="L360"><a href="isis_instrument_RKH.py.html#L360">360</a></th><td>            <span class="k">for</span> y <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> ydim<span class="p">):</span></td></tr><tr><th id="L361"><a href="isis_instrument_RKH.py.html#L361">361</a></th><td>                <span class="k">for</span> x <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> xdim<span class="p">):</span></td></tr><tr><th id="L362"><a href="isis_instrument_RKH.py.html#L362">362</a></th><td>                    std_i <span class="o">=</span> start_spec <span class="o">+</span> x <span class="o">+</span> <span class="p">(</span>y<span class="o">*</span>det_dimension<span class="p">)</span></td></tr><tr><th id="L363"><a href="isis_instrument_RKH.py.html#L363">363</a></th><td>                    output <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span>max_spec <span class="o">-</span> <span class="p">(</span>std_i <span class="o">-</span> base<span class="p">))</span> <span class="o">+</span> <span class="s">','</span></td></tr><tr><th id="L364"><a href="isis_instrument_RKH.py.html#L364">364</a></th><td>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span>_orientation <span class="o">==</span> <span class="s">'HorizontalFlipped'</span><span class="p">:</span></td></tr><tr><th id="L365"><a href="isis_instrument_RKH.py.html#L365">365</a></th><td>            <span class="k">for</span> y <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>ylow<span class="p">,</span>ylow<span class="o">+</span>ydim<span class="p">):</span></td></tr><tr><th id="L366"><a href="isis_instrument_RKH.py.html#L366">366</a></th><td>                max_row <span class="o">=</span> base <span class="o">+</span> <span class="p">(</span>y<span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span>det_dimension <span class="o">-</span> <span class="mi">1</span></td></tr><tr><th id="L367"><a href="isis_instrument_RKH.py.html#L367">367</a></th><td>                min_row <span class="o">=</span> base <span class="o">+</span> <span class="p">(</span>y<span class="p">)</span><span class="o">*</span>det_dimension</td></tr><tr><th id="L368"><a href="isis_instrument_RKH.py.html#L368">368</a></th><td>                <span class="k">for</span> x <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>xlow<span class="p">,</span>xlow<span class="o">+</span>xdim<span class="p">):</span></td></tr><tr><th id="L369"><a href="isis_instrument_RKH.py.html#L369">369</a></th><td>                    std_i <span class="o">=</span> base <span class="o">+</span> x <span class="o">+</span> <span class="p">(</span>y<span class="o">*</span>det_dimension<span class="p">)</span></td></tr><tr><th id="L370"><a href="isis_instrument_RKH.py.html#L370">370</a></th><td>                    diff_s <span class="o">=</span> std_i <span class="o">-</span> min_row</td></tr><tr><th id="L371"><a href="isis_instrument_RKH.py.html#L371">371</a></th><td>                    output <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span>max_row <span class="o">-</span> diff_s<span class="p">)</span> <span class="o">+</span> <span class="s">','</span></td></tr><tr><th id="L372"><a href="isis_instrument_RKH.py.html#L372">372</a></th><td></td></tr><tr><th id="L373"><a href="isis_instrument_RKH.py.html#L373">373</a></th><td>        <span class="k">return</span> output<span class="o">.</span>rstrip<span class="p">(</span><span class="s">","</span><span class="p">)</span></td></tr><tr><th id="L374"><a href="isis_instrument_RKH.py.html#L374">374</a></th><td></td></tr><tr><th id="L375"><a href="isis_instrument_RKH.py.html#L375">375</a></th><td>    <span class="c"># Used to constrain the possible values of the orientation of the detector bank against the direction that spectrum numbers increase in</span></td></tr><tr><th id="L376"><a href="isis_instrument_RKH.py.html#L376">376</a></th><td>    _ORIENTED <span class="o">=</span> <span class="p">{</span></td></tr><tr><th id="L377"><a href="isis_instrument_RKH.py.html#L377">377</a></th><td>        <span class="s">'Horizontal'</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span>        <span class="c">#most runs have the detectors in this state</span></td></tr><tr><th id="L378"><a href="isis_instrument_RKH.py.html#L378">378</a></th><td>        <span class="s">'Vertical'</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span></td></tr><tr><th id="L379"><a href="isis_instrument_RKH.py.html#L379">379</a></th><td>        <span class="s">'Rotated'</span> <span class="p">:</span> <span class="bp">None</span><span class="p">,</span></td></tr><tr><th id="L380"><a href="isis_instrument_RKH.py.html#L380">380</a></th><td>        <span class="s">'HorizontalFlipped'</span> <span class="p">:</span> <span class="bp">None</span><span class="p">}</span> <span class="c"># This is for the empty instrument</span></td></tr><tr><th id="L381"><a href="isis_instrument_RKH.py.html#L381">381</a></th><td></td></tr><tr><th id="L382"><a href="isis_instrument_RKH.py.html#L382">382</a></th><td>    <span class="k">def</span> <span class="nf">set_orien</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> orien<span class="p">):</span></td></tr><tr><th id="L383"><a href="isis_instrument_RKH.py.html#L383">383</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L384"><a href="isis_instrument_RKH.py.html#L384">384</a></th><td><span class="sd">            Sets to relationship between the detectors and the spectra numbers. The relationship</span></td></tr><tr><th id="L385"><a href="isis_instrument_RKH.py.html#L385">385</a></th><td><span class="sd">            is given by an orientation string and this function throws if the string is not recognised</span></td></tr><tr><th id="L386"><a href="isis_instrument_RKH.py.html#L386">386</a></th><td><span class="sd">            @param orien: the orienation string must be a string contained in the dictionary _ORIENTED</span></td></tr><tr><th id="L387"><a href="isis_instrument_RKH.py.html#L387">387</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L388"><a href="isis_instrument_RKH.py.html#L388">388</a></th><td>        dummy <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_ORIENTED<span class="p">[</span>orien<span class="p">]</span></td></tr><tr><th id="L389"><a href="isis_instrument_RKH.py.html#L389">389</a></th><td>        <span class="bp">self</span><span class="o">.</span>_orientation <span class="o">=</span> orien</td></tr><tr><th id="L390"><a href="isis_instrument_RKH.py.html#L390">390</a></th><td></td></tr><tr><th id="L391"><a href="isis_instrument_RKH.py.html#L391">391</a></th><td>    <span class="k">def</span> <span class="nf">crop_to_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> input_name<span class="p">,</span> output_name<span class="o">=</span><span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L392"><a href="isis_instrument_RKH.py.html#L392">392</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L393"><a href="isis_instrument_RKH.py.html#L393">393</a></th><td><span class="sd">            Crops the workspace that is passed so that it only contains the spectra that correspond</span></td></tr><tr><th id="L394"><a href="isis_instrument_RKH.py.html#L394">394</a></th><td><span class="sd">            to this detector</span></td></tr><tr><th id="L395"><a href="isis_instrument_RKH.py.html#L395">395</a></th><td><span class="sd">            @param input_name: name of the workspace to crop</span></td></tr><tr><th id="L396"><a href="isis_instrument_RKH.py.html#L396">396</a></th><td><span class="sd">            @param output_name: name the workspace will take (default is the input name)</span></td></tr><tr><th id="L397"><a href="isis_instrument_RKH.py.html#L397">397</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L398"><a href="isis_instrument_RKH.py.html#L398">398</a></th><td>        <span class="k">if</span> <span class="ow">not</span> output_name<span class="p">:</span></td></tr><tr><th id="L399"><a href="isis_instrument_RKH.py.html#L399">399</a></th><td>            output_name <span class="o">=</span> input_name</td></tr><tr><th id="L400"><a href="isis_instrument_RKH.py.html#L400">400</a></th><td></td></tr><tr><th id="L401"><a href="isis_instrument_RKH.py.html#L401">401</a></th><td>        <span class="k">try</span><span class="p">:</span></td></tr><tr><th id="L402"><a href="isis_instrument_RKH.py.html#L402">402</a></th><td>            wki <span class="o">=</span> mtd<span class="p">[</span>input_name<span class="p">]</span></td></tr><tr><th id="L403"><a href="isis_instrument_RKH.py.html#L403">403</a></th><td>            <span class="c">#Is it really necessary to crop?</span></td></tr><tr><th id="L404"><a href="isis_instrument_RKH.py.html#L404">404</a></th><td>            <span class="k">if</span> <span class="p">(</span>wki<span class="o">.</span>getNumberHistograms<span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span>last_spec_num <span class="o">-</span> <span class="bp">self</span><span class="o">.</span>get_first_spec_num<span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span></td></tr><tr><th id="L405"><a href="isis_instrument_RKH.py.html#L405">405</a></th><td>                CropWorkspace<span class="p">(</span>InputWorkspace<span class="o">=</span>input_name<span class="p">,</span>OutputWorkspace<span class="o">=</span> output_name<span class="p">,</span></td></tr><tr><th id="L406"><a href="isis_instrument_RKH.py.html#L406">406</a></th><td>                              StartWorkspaceIndex <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>get_first_spec_num<span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span></td></tr><tr><th id="L407"><a href="isis_instrument_RKH.py.html#L407">407</a></th><td>                              EndWorkspaceIndex <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>last_spec_num <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></td></tr><tr><th id="L408"><a href="isis_instrument_RKH.py.html#L408">408</a></th><td>        <span class="k">except</span> <span class="p">:</span></td></tr><tr><th id="L409"><a href="isis_instrument_RKH.py.html#L409">409</a></th><td>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">'Can not find spectra for </span><span class="si">%s</span><span class="s"> in the workspace </span><span class="si">%s</span><span class="s"> [</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">]</span><span class="se">\n</span><span class="s">Exception:'</span></td></tr><tr><th id="L410"><a href="isis_instrument_RKH.py.html#L410">410</a></th><td>                             <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span>name<span class="p">(),</span> input_name<span class="p">,</span><span class="bp">self</span><span class="o">.</span>get_first_spec_num<span class="p">(),</span><span class="bp">self</span><span class="o">.</span>last_spec_num<span class="p">)</span></td></tr><tr><th id="L411"><a href="isis_instrument_RKH.py.html#L411">411</a></th><td>                             <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>sys<span class="o">.</span>exc_info<span class="p">()))</span></td></tr><tr><th id="L412"><a href="isis_instrument_RKH.py.html#L412">412</a></th><td></td></tr><tr><th id="L413"><a href="isis_instrument_RKH.py.html#L413">413</a></th><td><span class="k">class</span> <span class="nc">ISISInstrument</span><span class="p">(</span>BaseInstrument<span class="p">):</span></td></tr><tr><th id="L414"><a href="isis_instrument_RKH.py.html#L414">414</a></th><td>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> filename<span class="o">=</span><span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L415"><a href="isis_instrument_RKH.py.html#L415">415</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L416"><a href="isis_instrument_RKH.py.html#L416">416</a></th><td><span class="sd">            Reads the instrument definition xml file</span></td></tr><tr><th id="L417"><a href="isis_instrument_RKH.py.html#L417">417</a></th><td><span class="sd">            @param filename: the name of the instrument definition file to read</span></td></tr><tr><th id="L418"><a href="isis_instrument_RKH.py.html#L418">418</a></th><td><span class="sd">            @raise IndexError: if any parameters (e.g. 'default-incident-monitor-spectrum') aren't in the xml definition</span></td></tr><tr><th id="L419"><a href="isis_instrument_RKH.py.html#L419">419</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L420"><a href="isis_instrument_RKH.py.html#L420">420</a></th><td>        <span class="nb">super</span><span class="p">(</span>ISISInstrument<span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span>__init__<span class="p">(</span>instr_filen<span class="o">=</span>filename<span class="p">)</span></td></tr><tr><th id="L421"><a href="isis_instrument_RKH.py.html#L421">421</a></th><td></td></tr><tr><th id="L422"><a href="isis_instrument_RKH.py.html#L422">422</a></th><td>        <span class="bp">self</span><span class="o">.</span>idf_path <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_definition_file</td></tr><tr><th id="L423"><a href="isis_instrument_RKH.py.html#L423">423</a></th><td></td></tr><tr><th id="L424"><a href="isis_instrument_RKH.py.html#L424">424</a></th><td>        <span class="c">#the spectrum with this number is used to normalize the workspace data</span></td></tr><tr><th id="L425"><a href="isis_instrument_RKH.py.html#L425">425</a></th><td>        <span class="bp">self</span><span class="o">.</span>_incid_monitor <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span>definition<span class="o">.</span>getNumberParameter<span class="p">(</span></td></tr><tr><th id="L426"><a href="isis_instrument_RKH.py.html#L426">426</a></th><td>            <span class="s">'default-incident-monitor-spectrum'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L427"><a href="isis_instrument_RKH.py.html#L427">427</a></th><td>        <span class="bp">self</span><span class="o">.</span>cen_find_step <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span>definition<span class="o">.</span>getNumberParameter<span class="p">(</span></td></tr><tr><th id="L428"><a href="isis_instrument_RKH.py.html#L428">428</a></th><td>            <span class="s">'centre-finder-step-size'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L429"><a href="isis_instrument_RKH.py.html#L429">429</a></th><td></td></tr><tr><th id="L430"><a href="isis_instrument_RKH.py.html#L430">430</a></th><td>        firstDetect <span class="o">=</span> DetectorBank<span class="p">(</span><span class="bp">self</span><span class="o">.</span>definition<span class="p">,</span> <span class="s">'low-angle'</span><span class="p">)</span></td></tr><tr><th id="L431"><a href="isis_instrument_RKH.py.html#L431">431</a></th><td>        <span class="c">#firstDetect.disable_y_and_rot_corrs()</span></td></tr><tr><th id="L432"><a href="isis_instrument_RKH.py.html#L432">432</a></th><td>        secondDetect <span class="o">=</span> DetectorBank<span class="p">(</span><span class="bp">self</span><span class="o">.</span>definition<span class="p">,</span> <span class="s">'high-angle'</span><span class="p">)</span></td></tr><tr><th id="L433"><a href="isis_instrument_RKH.py.html#L433">433</a></th><td>        secondDetect<span class="o">.</span>place_after<span class="p">(</span>firstDetect<span class="p">)</span></td></tr><tr><th id="L434"><a href="isis_instrument_RKH.py.html#L434">434</a></th><td>        <span class="c">#add det_selection variable that will receive the DET/ REAR/FRONT/BOTH/MERGED</span></td></tr><tr><th id="L435"><a href="isis_instrument_RKH.py.html#L435">435</a></th><td>        <span class="bp">self</span><span class="o">.</span>det_selection <span class="o">=</span> <span class="s">'REAR'</span></td></tr><tr><th id="L436"><a href="isis_instrument_RKH.py.html#L436">436</a></th><td>        <span class="bp">self</span><span class="o">.</span>DETECTORS <span class="o">=</span> <span class="p">{</span><span class="s">'low-angle'</span> <span class="p">:</span> firstDetect<span class="p">}</span></td></tr><tr><th id="L437"><a href="isis_instrument_RKH.py.html#L437">437</a></th><td>        <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span> <span class="o">=</span> secondDetect</td></tr><tr><th id="L438"><a href="isis_instrument_RKH.py.html#L438">438</a></th><td></td></tr><tr><th id="L439"><a href="isis_instrument_RKH.py.html#L439">439</a></th><td>        <span class="bp">self</span><span class="o">.</span>setDefaultDetector<span class="p">()</span></td></tr><tr><th id="L440"><a href="isis_instrument_RKH.py.html#L440">440</a></th><td>        <span class="c"># if this is set InterpolationRebin will be used on the monitor spectrum used to normalize the sample, useful because wavelength resolution in the monitor spectrum can be course in the range of interest</span></td></tr><tr><th id="L441"><a href="isis_instrument_RKH.py.html#L441">441</a></th><td>        <span class="bp">self</span><span class="o">.</span>_use_interpol_norm <span class="o">=</span> <span class="bp">False</span></td></tr><tr><th id="L442"><a href="isis_instrument_RKH.py.html#L442">442</a></th><td>        <span class="c">#remove use_interpol_trans_calc once the beam centre finder has been converted</span></td></tr><tr><th id="L443"><a href="isis_instrument_RKH.py.html#L443">443</a></th><td>        <span class="bp">self</span><span class="o">.</span>use_interpol_trans_calc <span class="o">=</span> <span class="bp">False</span></td></tr><tr><th id="L444"><a href="isis_instrument_RKH.py.html#L444">444</a></th><td></td></tr><tr><th id="L445"><a href="isis_instrument_RKH.py.html#L445">445</a></th><td>        <span class="c"># the sample will be moved this distance a long the beam axis</span></td></tr><tr><th id="L446"><a href="isis_instrument_RKH.py.html#L446">446</a></th><td>        <span class="bp">self</span><span class="o">.</span>SAMPLE_Z_CORR <span class="o">=</span> <span class="mi">0</span></td></tr><tr><th id="L447"><a href="isis_instrument_RKH.py.html#L447">447</a></th><td></td></tr><tr><th id="L448"><a href="isis_instrument_RKH.py.html#L448">448</a></th><td>        <span class="c"># Detector position information for SANS2D</span></td></tr><tr><th id="L449"><a href="isis_instrument_RKH.py.html#L449">449</a></th><td>        <span class="c"># why are these not defined in SANS2D</span></td></tr><tr><th id="L450"><a href="isis_instrument_RKH.py.html#L450">450</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_RADIUS <span class="o">=</span> <span class="mf">306.0</span></td></tr><tr><th id="L451"><a href="isis_instrument_RKH.py.html#L451">451</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_DEFAULT_SD_M <span class="o">=</span> <span class="mf">4.0</span></td></tr><tr><th id="L452"><a href="isis_instrument_RKH.py.html#L452">452</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_DEFAULT_X_M <span class="o">=</span> <span class="mf">1.1</span></td></tr><tr><th id="L453"><a href="isis_instrument_RKH.py.html#L453">453</a></th><td>        <span class="bp">self</span><span class="o">.</span>REAR_DET_DEFAULT_SD_M <span class="o">=</span> <span class="mf">4.0</span></td></tr><tr><th id="L454"><a href="isis_instrument_RKH.py.html#L454">454</a></th><td></td></tr><tr><th id="L455"><a href="isis_instrument_RKH.py.html#L455">455</a></th><td>        <span class="c"># LOG files for SANS2D will have these encoder readings</span></td></tr><tr><th id="L456"><a href="isis_instrument_RKH.py.html#L456">456</a></th><td>        <span class="c"># why are these not defined in SANS2D</span></td></tr><tr><th id="L457"><a href="isis_instrument_RKH.py.html#L457">457</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_X <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L458"><a href="isis_instrument_RKH.py.html#L458">458</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_Z <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L459"><a href="isis_instrument_RKH.py.html#L459">459</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_ROT <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L460"><a href="isis_instrument_RKH.py.html#L460">460</a></th><td>        <span class="bp">self</span><span class="o">.</span>REAR_DET_Z <span class="o">=</span> <span class="mf">0.0</span></td></tr><tr><th id="L461"><a href="isis_instrument_RKH.py.html#L461">461</a></th><td>        <span class="bp">self</span><span class="o">.</span>REAR_DET_X <span class="o">=</span> <span class="mi">0</span></td></tr><tr><th id="L462"><a href="isis_instrument_RKH.py.html#L462">462</a></th><td></td></tr><tr><th id="L463"><a href="isis_instrument_RKH.py.html#L463">463</a></th><td>        <span class="c">#spectrum number of the monitor used to as the incidient in the transmission calculations</span></td></tr><tr><th id="L464"><a href="isis_instrument_RKH.py.html#L464">464</a></th><td>        <span class="bp">self</span><span class="o">.</span>default_trans_spec <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span>definition<span class="o">.</span>getNumberParameter<span class="p">(</span></td></tr><tr><th id="L465"><a href="isis_instrument_RKH.py.html#L465">465</a></th><td>            <span class="s">'default-transmission-monitor-spectrum'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L466"><a href="isis_instrument_RKH.py.html#L466">466</a></th><td>        <span class="bp">self</span><span class="o">.</span>incid_mon_4_trans_calc <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_incid_monitor</td></tr><tr><th id="L467"><a href="isis_instrument_RKH.py.html#L467">467</a></th><td></td></tr><tr><th id="L468"><a href="isis_instrument_RKH.py.html#L468">468</a></th><td>        isis <span class="o">=</span> config<span class="o">.</span>getFacility<span class="p">(</span><span class="s">'ISIS'</span><span class="p">)</span></td></tr><tr><th id="L469"><a href="isis_instrument_RKH.py.html#L469">469</a></th><td>        <span class="c"># Number of digits in standard file name</span></td></tr><tr><th id="L470"><a href="isis_instrument_RKH.py.html#L470">470</a></th><td>        <span class="bp">self</span><span class="o">.</span>run_number_width <span class="o">=</span> isis<span class="o">.</span>instrument<span class="p">(</span><span class="bp">self</span><span class="o">.</span>_NAME<span class="p">)</span><span class="o">.</span>zeroPadding<span class="p">(</span><span class="mi">0</span><span class="p">)</span></td></tr><tr><th id="L471"><a href="isis_instrument_RKH.py.html#L471">471</a></th><td></td></tr><tr><th id="L472"><a href="isis_instrument_RKH.py.html#L472">472</a></th><td>        <span class="c">#this variable isn't used again and stops the instrument from being deep copied if this instance is deep copied</span></td></tr><tr><th id="L473"><a href="isis_instrument_RKH.py.html#L473">473</a></th><td>        <span class="bp">self</span><span class="o">.</span>definition <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L474"><a href="isis_instrument_RKH.py.html#L474">474</a></th><td></td></tr><tr><th id="L475"><a href="isis_instrument_RKH.py.html#L475">475</a></th><td>        <span class="c">#remove this function</span></td></tr><tr><th id="L476"><a href="isis_instrument_RKH.py.html#L476">476</a></th><td>        <span class="bp">self</span><span class="o">.</span>_del_incidient_set <span class="o">=</span> <span class="bp">False</span></td></tr><tr><th id="L477"><a href="isis_instrument_RKH.py.html#L477">477</a></th><td></td></tr><tr><th id="L478"><a href="isis_instrument_RKH.py.html#L478">478</a></th><td>        <span class="c">#it is possible to set the TOF regions that is assumed to be background for each monitors</span></td></tr><tr><th id="L479"><a href="isis_instrument_RKH.py.html#L479">479</a></th><td>        <span class="bp">self</span><span class="o">.</span>_back_ground <span class="o">=</span> <span class="p">{}</span></td></tr><tr><th id="L480"><a href="isis_instrument_RKH.py.html#L480">480</a></th><td>        <span class="c"># the default start region, used for any monitors that a specific one wasn't set for</span></td></tr><tr><th id="L481"><a href="isis_instrument_RKH.py.html#L481">481</a></th><td>        <span class="bp">self</span><span class="o">.</span>_back_start <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L482"><a href="isis_instrument_RKH.py.html#L482">482</a></th><td>        <span class="c"># default end region</span></td></tr><tr><th id="L483"><a href="isis_instrument_RKH.py.html#L483">483</a></th><td>        <span class="bp">self</span><span class="o">.</span>_back_end <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L484"><a href="isis_instrument_RKH.py.html#L484">484</a></th><td>        <span class="c">#if the user moves a monitor to this z coordinate (with MON/LENGTH ...) this will be recorded here. These are overridden lines like TRANS/TRANSPEC=4/SHIFT=-100</span></td></tr><tr><th id="L485"><a href="isis_instrument_RKH.py.html#L485">485</a></th><td>        <span class="bp">self</span><span class="o">.</span>monitor_zs <span class="o">=</span> <span class="p">{}</span></td></tr><tr><th id="L486"><a href="isis_instrument_RKH.py.html#L486">486</a></th><td>        <span class="c"># Used when new calibration required.</span></td></tr><tr><th id="L487"><a href="isis_instrument_RKH.py.html#L487">487</a></th><td>        <span class="bp">self</span><span class="o">.</span>_newCalibrationWS <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L488"><a href="isis_instrument_RKH.py.html#L488">488</a></th><td></td></tr><tr><th id="L489"><a href="isis_instrument_RKH.py.html#L489">489</a></th><td>    <span class="k">def</span> <span class="nf">get_incident_mon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L490"><a href="isis_instrument_RKH.py.html#L490">490</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L491"><a href="isis_instrument_RKH.py.html#L491">491</a></th><td><span class="sd">            @return: the spectrum number of the incident scattering monitor</span></td></tr><tr><th id="L492"><a href="isis_instrument_RKH.py.html#L492">492</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L493"><a href="isis_instrument_RKH.py.html#L493">493</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_incid_monitor</td></tr><tr><th id="L494"><a href="isis_instrument_RKH.py.html#L494">494</a></th><td></td></tr><tr><th id="L495"><a href="isis_instrument_RKH.py.html#L495">495</a></th><td>    <span class="k">def</span> <span class="nf">set_incident_mon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> spectrum_number<span class="p">):</span></td></tr><tr><th id="L496"><a href="isis_instrument_RKH.py.html#L496">496</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L497"><a href="isis_instrument_RKH.py.html#L497">497</a></th><td><span class="sd">            set the incident scattering monitor spectrum number regardless of</span></td></tr><tr><th id="L498"><a href="isis_instrument_RKH.py.html#L498">498</a></th><td><span class="sd">            lock</span></td></tr><tr><th id="L499"><a href="isis_instrument_RKH.py.html#L499">499</a></th><td><span class="sd">            @param spectrum_number: monitor's sectrum number</span></td></tr><tr><th id="L500"><a href="isis_instrument_RKH.py.html#L500">500</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L501"><a href="isis_instrument_RKH.py.html#L501">501</a></th><td>        <span class="bp">self</span><span class="o">.</span>_incid_monitor <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>spectrum_number<span class="p">)</span></td></tr><tr><th id="L502"><a href="isis_instrument_RKH.py.html#L502">502</a></th><td>        <span class="bp">self</span><span class="o">.</span>_del_incidient_set <span class="o">=</span> <span class="bp">True</span></td></tr><tr><th id="L503"><a href="isis_instrument_RKH.py.html#L503">503</a></th><td></td></tr><tr><th id="L504"><a href="isis_instrument_RKH.py.html#L504">504</a></th><td>    <span class="k">def</span> <span class="nf">suggest_incident_mntr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> spectrum_number<span class="p">):</span></td></tr><tr><th id="L505"><a href="isis_instrument_RKH.py.html#L505">505</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L506"><a href="isis_instrument_RKH.py.html#L506">506</a></th><td><span class="sd">            remove this function and the data memember it uses</span></td></tr><tr><th id="L507"><a href="isis_instrument_RKH.py.html#L507">507</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L508"><a href="isis_instrument_RKH.py.html#L508">508</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>_del_incidient_set<span class="p">:</span></td></tr><tr><th id="L509"><a href="isis_instrument_RKH.py.html#L509">509</a></th><td>            <span class="bp">self</span><span class="o">.</span>set_incident_mon<span class="p">(</span>spectrum_number<span class="p">)</span></td></tr><tr><th id="L510"><a href="isis_instrument_RKH.py.html#L510">510</a></th><td></td></tr><tr><th id="L511"><a href="isis_instrument_RKH.py.html#L511">511</a></th><td>    <span class="k">def</span> <span class="nf">set_sample_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> value<span class="p">):</span></td></tr><tr><th id="L512"><a href="isis_instrument_RKH.py.html#L512">512</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L513"><a href="isis_instrument_RKH.py.html#L513">513</a></th><td><span class="sd">            @param value: sample value offset</span></td></tr><tr><th id="L514"><a href="isis_instrument_RKH.py.html#L514">514</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L515"><a href="isis_instrument_RKH.py.html#L515">515</a></th><td>        <span class="bp">self</span><span class="o">.</span>SAMPLE_Z_CORR <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>value<span class="p">)</span><span class="o">/</span><span class="mf">1000.</span></td></tr><tr><th id="L516"><a href="isis_instrument_RKH.py.html#L516">516</a></th><td></td></tr><tr><th id="L517"><a href="isis_instrument_RKH.py.html#L517">517</a></th><td>    <span class="k">def</span> <span class="nf">is_interpolating_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L518"><a href="isis_instrument_RKH.py.html#L518">518</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_use_interpol_norm</td></tr><tr><th id="L519"><a href="isis_instrument_RKH.py.html#L519">519</a></th><td></td></tr><tr><th id="L520"><a href="isis_instrument_RKH.py.html#L520">520</a></th><td>    <span class="k">def</span> <span class="nf">set_interpolating_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> on<span class="o">=</span><span class="bp">True</span><span class="p">):</span></td></tr><tr><th id="L521"><a href="isis_instrument_RKH.py.html#L521">521</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L522"><a href="isis_instrument_RKH.py.html#L522">522</a></th><td><span class="sd">            This method sets that the monitor spectrum should be interpolated before</span></td></tr><tr><th id="L523"><a href="isis_instrument_RKH.py.html#L523">523</a></th><td><span class="sd">            normalisation</span></td></tr><tr><th id="L524"><a href="isis_instrument_RKH.py.html#L524">524</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L525"><a href="isis_instrument_RKH.py.html#L525">525</a></th><td>        <span class="bp">self</span><span class="o">.</span>_use_interpol_norm <span class="o">=</span> on</td></tr><tr><th id="L526"><a href="isis_instrument_RKH.py.html#L526">526</a></th><td></td></tr><tr><th id="L527"><a href="isis_instrument_RKH.py.html#L527">527</a></th><td>    <span class="k">def</span> <span class="nf">cur_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L528"><a href="isis_instrument_RKH.py.html#L528">528</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>lowAngDetSet <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'low-angle'</span><span class="p">]</span></td></tr><tr><th id="L529"><a href="isis_instrument_RKH.py.html#L529">529</a></th><td>        <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span></td></tr><tr><th id="L530"><a href="isis_instrument_RKH.py.html#L530">530</a></th><td></td></tr><tr><th id="L531"><a href="isis_instrument_RKH.py.html#L531">531</a></th><td>    <span class="k">def</span> <span class="nf">get_low_angle_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L532"><a href="isis_instrument_RKH.py.html#L532">532</a></th><td>        <span class="sd">""" Provide a direct way to get the low bank detector.</span></td></tr><tr><th id="L533"><a href="isis_instrument_RKH.py.html#L533">533</a></th><td><span class="sd">        This method does not require to pass the name of the detector bank.</span></td></tr><tr><th id="L534"><a href="isis_instrument_RKH.py.html#L534">534</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L535"><a href="isis_instrument_RKH.py.html#L535">535</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'low-angle'</span><span class="p">]</span></td></tr><tr><th id="L536"><a href="isis_instrument_RKH.py.html#L536">536</a></th><td></td></tr><tr><th id="L537"><a href="isis_instrument_RKH.py.html#L537">537</a></th><td>    <span class="k">def</span> <span class="nf">get_high_angle_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L538"><a href="isis_instrument_RKH.py.html#L538">538</a></th><td>        <span class="sd">""" Provide a direct way to get the high bank detector</span></td></tr><tr><th id="L539"><a href="isis_instrument_RKH.py.html#L539">539</a></th><td><span class="sd">        This method does not require to pass the name of the detector bank.</span></td></tr><tr><th id="L540"><a href="isis_instrument_RKH.py.html#L540">540</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L541"><a href="isis_instrument_RKH.py.html#L541">541</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span></td></tr><tr><th id="L542"><a href="isis_instrument_RKH.py.html#L542">542</a></th><td></td></tr><tr><th id="L543"><a href="isis_instrument_RKH.py.html#L543">543</a></th><td>    <span class="k">def</span> <span class="nf">other_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L544"><a href="isis_instrument_RKH.py.html#L544">544</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>lowAngDetSet <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'low-angle'</span><span class="p">]</span></td></tr><tr><th id="L545"><a href="isis_instrument_RKH.py.html#L545">545</a></th><td>        <span class="k">else</span> <span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span></td></tr><tr><th id="L546"><a href="isis_instrument_RKH.py.html#L546">546</a></th><td></td></tr><tr><th id="L547"><a href="isis_instrument_RKH.py.html#L547">547</a></th><td>    <span class="k">def</span> <span class="nf">getDetector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> requested<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L548"><a href="isis_instrument_RKH.py.html#L548">548</a></th><td>        <span class="k">for</span> n<span class="p">,</span> detect <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="o">.</span>iteritems<span class="p">():</span></td></tr><tr><th id="L549"><a href="isis_instrument_RKH.py.html#L549">549</a></th><td>            <span class="k">if</span> detect<span class="o">.</span>isAlias<span class="p">(</span>requested<span class="p">):</span></td></tr><tr><th id="L550"><a href="isis_instrument_RKH.py.html#L550">550</a></th><td>                <span class="k">return</span> detect</td></tr><tr><th id="L551"><a href="isis_instrument_RKH.py.html#L551">551</a></th><td>        sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">"getDetector: Detector "</span> <span class="o">+</span> requested <span class="o">+</span> <span class="s">"not found"</span><span class="p">)</span></td></tr><tr><th id="L552"><a href="isis_instrument_RKH.py.html#L552">552</a></th><td></td></tr><tr><th id="L553"><a href="isis_instrument_RKH.py.html#L553">553</a></th><td>    <span class="k">def</span> <span class="nf">listDetectors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L554"><a href="isis_instrument_RKH.py.html#L554">554</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">(),</span> <span class="bp">self</span><span class="o">.</span>other_detector<span class="p">()</span><span class="o">.</span>name<span class="p">()</span></td></tr><tr><th id="L555"><a href="isis_instrument_RKH.py.html#L555">555</a></th><td></td></tr><tr><th id="L556"><a href="isis_instrument_RKH.py.html#L556">556</a></th><td>    <span class="k">def</span> <span class="nf">isHighAngleDetector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> detName<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L557"><a href="isis_instrument_RKH.py.html#L557">557</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span><span class="o">.</span>isAlias<span class="p">(</span>detName<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L558"><a href="isis_instrument_RKH.py.html#L558">558</a></th><td>            <span class="k">return</span> <span class="bp">True</span></td></tr><tr><th id="L559"><a href="isis_instrument_RKH.py.html#L559">559</a></th><td></td></tr><tr><th id="L560"><a href="isis_instrument_RKH.py.html#L560">560</a></th><td>    <span class="k">def</span> <span class="nf">isDetectorName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> detName<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L561"><a href="isis_instrument_RKH.py.html#L561">561</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>other_detector<span class="p">()</span><span class="o">.</span>isAlias<span class="p">(</span>detName<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L562"><a href="isis_instrument_RKH.py.html#L562">562</a></th><td>            <span class="k">return</span> <span class="bp">True</span></td></tr><tr><th id="L563"><a href="isis_instrument_RKH.py.html#L563">563</a></th><td></td></tr><tr><th id="L564"><a href="isis_instrument_RKH.py.html#L564">564</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>isAlias<span class="p">(</span>detName<span class="p">)</span></td></tr><tr><th id="L565"><a href="isis_instrument_RKH.py.html#L565">565</a></th><td></td></tr><tr><th id="L566"><a href="isis_instrument_RKH.py.html#L566">566</a></th><td>    <span class="k">def</span> <span class="nf">setDetector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> detName<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L567"><a href="isis_instrument_RKH.py.html#L567">567</a></th><td>        <span class="bp">self</span><span class="o">.</span>det_selection <span class="o">=</span> detName</td></tr><tr><th id="L568"><a href="isis_instrument_RKH.py.html#L568">568</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>other_detector<span class="p">()</span><span class="o">.</span>isAlias<span class="p">(</span>detName<span class="p">)</span> <span class="p">:</span></td></tr><tr><th id="L569"><a href="isis_instrument_RKH.py.html#L569">569</a></th><td>            <span class="bp">self</span><span class="o">.</span>lowAngDetSet <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>lowAngDetSet</td></tr><tr><th id="L570"><a href="isis_instrument_RKH.py.html#L570">570</a></th><td>            <span class="k">return</span> <span class="bp">True</span></td></tr><tr><th id="L571"><a href="isis_instrument_RKH.py.html#L571">571</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L572"><a href="isis_instrument_RKH.py.html#L572">572</a></th><td>            <span class="c">#there are only two detectors, they must have selected the current one so no change is need</span></td></tr><tr><th id="L573"><a href="isis_instrument_RKH.py.html#L573">573</a></th><td>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>isAlias<span class="p">(</span>detName<span class="p">):</span></td></tr><tr><th id="L574"><a href="isis_instrument_RKH.py.html#L574">574</a></th><td>                <span class="k">return</span> <span class="bp">True</span></td></tr><tr><th id="L575"><a href="isis_instrument_RKH.py.html#L575">575</a></th><td>            <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L576"><a href="isis_instrument_RKH.py.html#L576">576</a></th><td>                sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">"setDetector: Detector not found"</span><span class="p">)</span></td></tr><tr><th id="L577"><a href="isis_instrument_RKH.py.html#L577">577</a></th><td>                sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">"setDetector: Detector set to "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">()</span> <span class="o">+</span> <span class="s">' in '</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span>name<span class="p">())</span></td></tr><tr><th id="L578"><a href="isis_instrument_RKH.py.html#L578">578</a></th><td></td></tr><tr><th id="L579"><a href="isis_instrument_RKH.py.html#L579">579</a></th><td>    <span class="k">def</span> <span class="nf">setDefaultDetector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L580"><a href="isis_instrument_RKH.py.html#L580">580</a></th><td>        <span class="bp">self</span><span class="o">.</span>lowAngDetSet <span class="o">=</span> <span class="bp">True</span></td></tr><tr><th id="L581"><a href="isis_instrument_RKH.py.html#L581">581</a></th><td></td></tr><tr><th id="L582"><a href="isis_instrument_RKH.py.html#L582">582</a></th><td>    <span class="k">def</span> <span class="nf">copy_correction_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L583"><a href="isis_instrument_RKH.py.html#L583">583</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L584"><a href="isis_instrument_RKH.py.html#L584">584</a></th><td><span class="sd">            Check if one of the efficiency files hasn't been set and assume the other is to be used</span></td></tr><tr><th id="L585"><a href="isis_instrument_RKH.py.html#L585">585</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L586"><a href="isis_instrument_RKH.py.html#L586">586</a></th><td>        a <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span></td></tr><tr><th id="L587"><a href="isis_instrument_RKH.py.html#L587">587</a></th><td>        b <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>other_detector<span class="p">()</span></td></tr><tr><th id="L588"><a href="isis_instrument_RKH.py.html#L588">588</a></th><td>        <span class="k">if</span> a<span class="o">.</span>correction_file <span class="o">==</span> <span class="s">''</span> <span class="ow">and</span> b<span class="o">.</span>correction_file <span class="o">!=</span> <span class="s">''</span><span class="p">:</span></td></tr><tr><th id="L589"><a href="isis_instrument_RKH.py.html#L589">589</a></th><td>            a<span class="o">.</span>correction_file <span class="o">=</span> b<span class="o">.</span>correction_file <span class="o">!=</span> <span class="s">''</span></td></tr><tr><th id="L590"><a href="isis_instrument_RKH.py.html#L590">590</a></th><td>        <span class="k">if</span> b<span class="o">.</span>correction_file <span class="o">==</span> <span class="s">''</span> <span class="ow">and</span> a<span class="o">.</span>correction_file <span class="o">!=</span> <span class="s">''</span><span class="p">:</span></td></tr><tr><th id="L591"><a href="isis_instrument_RKH.py.html#L591">591</a></th><td>            b<span class="o">.</span>correction_file <span class="o">=</span> a<span class="o">.</span>correction_file <span class="o">!=</span> <span class="s">''</span></td></tr><tr><th id="L592"><a href="isis_instrument_RKH.py.html#L592">592</a></th><td></td></tr><tr><th id="L593"><a href="isis_instrument_RKH.py.html#L593">593</a></th><td>    <span class="k">def</span> <span class="nf">detector_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> det_name<span class="p">):</span></td></tr><tr><th id="L594"><a href="isis_instrument_RKH.py.html#L594">594</a></th><td>        det <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span>det_name<span class="p">)</span></td></tr><tr><th id="L595"><a href="isis_instrument_RKH.py.html#L595">595</a></th><td>        <span class="k">return</span> det<span class="o">.</span>correction_file</td></tr><tr><th id="L596"><a href="isis_instrument_RKH.py.html#L596">596</a></th><td></td></tr><tr><th id="L597"><a href="isis_instrument_RKH.py.html#L597">597</a></th><td>    <span class="k">def</span> <span class="nf">get_TOFs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> monitor<span class="p">):</span></td></tr><tr><th id="L598"><a href="isis_instrument_RKH.py.html#L598">598</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L599"><a href="isis_instrument_RKH.py.html#L599">599</a></th><td><span class="sd">            Gets the start and end time of flights for the region assumed to contain</span></td></tr><tr><th id="L600"><a href="isis_instrument_RKH.py.html#L600">600</a></th><td><span class="sd">            only background counts for this instrument</span></td></tr><tr><th id="L601"><a href="isis_instrument_RKH.py.html#L601">601</a></th><td><span class="sd">            @param monitor: spectrum number of the monitor's spectrum</span></td></tr><tr><th id="L602"><a href="isis_instrument_RKH.py.html#L602">602</a></th><td><span class="sd">            @return: the start time, the end time</span></td></tr><tr><th id="L603"><a href="isis_instrument_RKH.py.html#L603">603</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L604"><a href="isis_instrument_RKH.py.html#L604">604</a></th><td>        monitor <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>monitor<span class="p">)</span></td></tr><tr><th id="L605"><a href="isis_instrument_RKH.py.html#L605">605</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>_back_ground<span class="o">.</span>has_key<span class="p">(</span>monitor<span class="p">):</span></td></tr><tr><th id="L606"><a href="isis_instrument_RKH.py.html#L606">606</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_back_ground<span class="p">[</span><span class="nb">int</span><span class="p">(</span>monitor<span class="p">)][</span><span class="s">'start'</span><span class="p">],</span> \</td></tr><tr><th id="L607"><a href="isis_instrument_RKH.py.html#L607">607</a></th><td>                <span class="bp">self</span><span class="o">.</span>_back_ground<span class="p">[</span><span class="nb">int</span><span class="p">(</span>monitor<span class="p">)][</span><span class="s">'end'</span><span class="p">]</span></td></tr><tr><th id="L608"><a href="isis_instrument_RKH.py.html#L608">608</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L609"><a href="isis_instrument_RKH.py.html#L609">609</a></th><td>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_back_start<span class="p">,</span> <span class="bp">self</span><span class="o">.</span>_back_end</td></tr><tr><th id="L610"><a href="isis_instrument_RKH.py.html#L610">610</a></th><td></td></tr><tr><th id="L611"><a href="isis_instrument_RKH.py.html#L611">611</a></th><td>    <span class="k">def</span> <span class="nf">set_TOFs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> start<span class="p">,</span> end<span class="p">,</span> monitor<span class="o">=</span><span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L612"><a href="isis_instrument_RKH.py.html#L612">612</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L613"><a href="isis_instrument_RKH.py.html#L613">613</a></th><td><span class="sd">            Defines the start and end time of flights for the assumed background region</span></td></tr><tr><th id="L614"><a href="isis_instrument_RKH.py.html#L614">614</a></th><td><span class="sd">            for this instrument</span></td></tr><tr><th id="L615"><a href="isis_instrument_RKH.py.html#L615">615</a></th><td><span class="sd">            @param: start defines the start of the background region</span></td></tr><tr><th id="L616"><a href="isis_instrument_RKH.py.html#L616">616</a></th><td><span class="sd">            @param: end defines the end</span></td></tr><tr><th id="L617"><a href="isis_instrument_RKH.py.html#L617">617</a></th><td><span class="sd">            @param monitor: spectrum number of the monitor's spectrum, if none given affect the default</span></td></tr><tr><th id="L618"><a href="isis_instrument_RKH.py.html#L618">618</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L619"><a href="isis_instrument_RKH.py.html#L619">619</a></th><td>        <span class="k">if</span> start <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L620"><a href="isis_instrument_RKH.py.html#L620">620</a></th><td>            start <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>start<span class="p">)</span></td></tr><tr><th id="L621"><a href="isis_instrument_RKH.py.html#L621">621</a></th><td>        <span class="k">if</span> end <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span></td></tr><tr><th id="L622"><a href="isis_instrument_RKH.py.html#L622">622</a></th><td>            end <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>end<span class="p">)</span></td></tr><tr><th id="L623"><a href="isis_instrument_RKH.py.html#L623">623</a></th><td></td></tr><tr><th id="L624"><a href="isis_instrument_RKH.py.html#L624">624</a></th><td>        <span class="k">if</span> monitor<span class="p">:</span></td></tr><tr><th id="L625"><a href="isis_instrument_RKH.py.html#L625">625</a></th><td>            <span class="bp">self</span><span class="o">.</span>_back_ground<span class="p">[</span><span class="nb">int</span><span class="p">(</span>monitor<span class="p">)]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">'start'</span> <span class="p">:</span> start<span class="p">,</span> <span class="s">'end'</span> <span class="p">:</span> end <span class="p">}</span></td></tr><tr><th id="L626"><a href="isis_instrument_RKH.py.html#L626">626</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L627"><a href="isis_instrument_RKH.py.html#L627">627</a></th><td>            <span class="bp">self</span><span class="o">.</span>_back_start <span class="o">=</span> start</td></tr><tr><th id="L628"><a href="isis_instrument_RKH.py.html#L628">628</a></th><td>            <span class="bp">self</span><span class="o">.</span>_back_end <span class="o">=</span> end</td></tr><tr><th id="L629"><a href="isis_instrument_RKH.py.html#L629">629</a></th><td></td></tr><tr><th id="L630"><a href="isis_instrument_RKH.py.html#L630">630</a></th><td>    <span class="k">def</span> <span class="nf">reset_TOFs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> monitor<span class="o">=</span><span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L631"><a href="isis_instrument_RKH.py.html#L631">631</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L632"><a href="isis_instrument_RKH.py.html#L632">632</a></th><td><span class="sd">            Reset background region set by set_TOFs</span></td></tr><tr><th id="L633"><a href="isis_instrument_RKH.py.html#L633">633</a></th><td><span class="sd">            @param monitor: spectrum number of the monitor's spectrum, if none given affect the default</span></td></tr><tr><th id="L634"><a href="isis_instrument_RKH.py.html#L634">634</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L635"><a href="isis_instrument_RKH.py.html#L635">635</a></th><td>        <span class="k">if</span> monitor<span class="p">:</span></td></tr><tr><th id="L636"><a href="isis_instrument_RKH.py.html#L636">636</a></th><td>            monitor <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>monitor<span class="p">)</span></td></tr><tr><th id="L637"><a href="isis_instrument_RKH.py.html#L637">637</a></th><td>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>_back_ground<span class="o">.</span>has_key<span class="p">(</span>monitor<span class="p">):</span></td></tr><tr><th id="L638"><a href="isis_instrument_RKH.py.html#L638">638</a></th><td>                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span>_back_ground<span class="p">[</span><span class="nb">int</span><span class="p">(</span>monitor<span class="p">)]</span></td></tr><tr><th id="L639"><a href="isis_instrument_RKH.py.html#L639">639</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L640"><a href="isis_instrument_RKH.py.html#L640">640</a></th><td>            <span class="bp">self</span><span class="o">.</span>_back_ground <span class="o">=</span> <span class="p">{}</span></td></tr><tr><th id="L641"><a href="isis_instrument_RKH.py.html#L641">641</a></th><td>            <span class="bp">self</span><span class="o">.</span>_back_start <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L642"><a href="isis_instrument_RKH.py.html#L642">642</a></th><td>            <span class="bp">self</span><span class="o">.</span>_back_end <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L643"><a href="isis_instrument_RKH.py.html#L643">643</a></th><td></td></tr><tr><th id="L644"><a href="isis_instrument_RKH.py.html#L644">644</a></th><td>    <span class="k">def</span> <span class="nf">move_all_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws<span class="p">):</span></td></tr><tr><th id="L645"><a href="isis_instrument_RKH.py.html#L645">645</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L646"><a href="isis_instrument_RKH.py.html#L646">646</a></th><td><span class="sd">            Move the sample object to the location set in the logs or user settings file</span></td></tr><tr><th id="L647"><a href="isis_instrument_RKH.py.html#L647">647</a></th><td><span class="sd">            @param ws: the workspace containing the sample to move</span></td></tr><tr><th id="L648"><a href="isis_instrument_RKH.py.html#L648">648</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L649"><a href="isis_instrument_RKH.py.html#L649">649</a></th><td>        MoveInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> <span class="s">'some-sample-holder'</span><span class="p">,</span> Z <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>SAMPLE_Z_CORR<span class="p">,</span> RelativePosition<span class="o">=</span><span class="bp">True</span><span class="p">)</span></td></tr><tr><th id="L650"><a href="isis_instrument_RKH.py.html#L650">650</a></th><td></td></tr><tr><th id="L651"><a href="isis_instrument_RKH.py.html#L651">651</a></th><td>        <span class="k">for</span> i <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span>monitor_zs<span class="o">.</span>keys<span class="p">():</span></td></tr><tr><th id="L652"><a href="isis_instrument_RKH.py.html#L652">652</a></th><td>            <span class="c">#get the current location</span></td></tr><tr><th id="L653"><a href="isis_instrument_RKH.py.html#L653">653</a></th><td>            component <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>monitor_names<span class="p">[</span>i<span class="p">]</span></td></tr><tr><th id="L654"><a href="isis_instrument_RKH.py.html#L654">654</a></th><td>            ws <span class="o">=</span> mtd<span class="p">[</span><span class="nb">str</span><span class="p">(</span>ws<span class="p">)]</span></td></tr><tr><th id="L655"><a href="isis_instrument_RKH.py.html#L655">655</a></th><td>            mon <span class="o">=</span> ws<span class="o">.</span>getInstrument<span class="p">()</span><span class="o">.</span>getComponentByName<span class="p">(</span>component<span class="p">)</span></td></tr><tr><th id="L656"><a href="isis_instrument_RKH.py.html#L656">656</a></th><td>            z_loc <span class="o">=</span> mon<span class="o">.</span>getPos<span class="p">()</span><span class="o">.</span>getZ<span class="p">()</span></td></tr><tr><th id="L657"><a href="isis_instrument_RKH.py.html#L657">657</a></th><td>            <span class="c">#now the relative move</span></td></tr><tr><th id="L658"><a href="isis_instrument_RKH.py.html#L658">658</a></th><td>            offset <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span>monitor_zs<span class="p">[</span>i<span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span> <span class="o">-</span> z_loc</td></tr><tr><th id="L659"><a href="isis_instrument_RKH.py.html#L659">659</a></th><td>            MoveInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> component<span class="p">,</span> Z <span class="o">=</span> offset<span class="p">,</span></td></tr><tr><th id="L660"><a href="isis_instrument_RKH.py.html#L660">660</a></th><td>                                    RelativePosition<span class="o">=</span><span class="bp">True</span><span class="p">)</span></td></tr><tr><th id="L661"><a href="isis_instrument_RKH.py.html#L661">661</a></th><td></td></tr><tr><th id="L662"><a href="isis_instrument_RKH.py.html#L662">662</a></th><td>    <span class="k">def</span> <span class="nf">move_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws<span class="p">,</span> beamX<span class="p">,</span> beamY<span class="p">):</span></td></tr><tr><th id="L663"><a href="isis_instrument_RKH.py.html#L663">663</a></th><td>        <span class="sd">"""Define how to move the bank to position beamX and beamY must be implemented"""</span></td></tr><tr><th id="L664"><a href="isis_instrument_RKH.py.html#L664">664</a></th><td>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">"Not Implemented"</span><span class="p">)</span></td></tr><tr><th id="L665"><a href="isis_instrument_RKH.py.html#L665">665</a></th><td></td></tr><tr><th id="L666"><a href="isis_instrument_RKH.py.html#L666">666</a></th><td>    <span class="k">def</span> <span class="nf">cur_detector_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">):</span></td></tr><tr><th id="L667"><a href="isis_instrument_RKH.py.html#L667">667</a></th><td>        <span class="sd">"""Return the position of the center of the detector bank"""</span></td></tr><tr><th id="L668"><a href="isis_instrument_RKH.py.html#L668">668</a></th><td>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">"Not Implemented"</span><span class="p">)</span></td></tr><tr><th id="L669"><a href="isis_instrument_RKH.py.html#L669">669</a></th><td></td></tr><tr><th id="L670"><a href="isis_instrument_RKH.py.html#L670">670</a></th><td>    <span class="k">def</span> <span class="nf">on_load_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">,</span> beamcentre<span class="p">,</span> isSample<span class="p">):</span></td></tr><tr><th id="L671"><a href="isis_instrument_RKH.py.html#L671">671</a></th><td>        <span class="sd">"""It will be called just after loading the workspace for sample and can</span></td></tr><tr><th id="L672"><a href="isis_instrument_RKH.py.html#L672">672</a></th><td><span class="sd"></span></td></tr><tr><th id="L673"><a href="isis_instrument_RKH.py.html#L673">673</a></th><td><span class="sd">        It configures the instrument for the specific run of the workspace for handle historical changes in the instrument.</span></td></tr><tr><th id="L674"><a href="isis_instrument_RKH.py.html#L674">674</a></th><td><span class="sd"></span></td></tr><tr><th id="L675"><a href="isis_instrument_RKH.py.html#L675">675</a></th><td><span class="sd">        It centralizes the detector bank to teh beamcentre (tuple of two values)</span></td></tr><tr><th id="L676"><a href="isis_instrument_RKH.py.html#L676">676</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L677"><a href="isis_instrument_RKH.py.html#L677">677</a></th><td>        ws_ref <span class="o">=</span> mtd<span class="p">[</span><span class="nb">str</span><span class="p">(</span>ws_name<span class="p">)]</span></td></tr><tr><th id="L678"><a href="isis_instrument_RKH.py.html#L678">678</a></th><td>        <span class="k">try</span><span class="p">:</span></td></tr><tr><th id="L679"><a href="isis_instrument_RKH.py.html#L679">679</a></th><td>            run_num <span class="o">=</span> ws_ref<span class="o">.</span>getRun<span class="p">()</span><span class="o">.</span>getLogData<span class="p">(</span><span class="s">'run_number'</span><span class="p">)</span><span class="o">.</span>value</td></tr><tr><th id="L680"><a href="isis_instrument_RKH.py.html#L680">680</a></th><td>        <span class="k">except</span><span class="p">:</span></td></tr><tr><th id="L681"><a href="isis_instrument_RKH.py.html#L681">681</a></th><td>            run_num <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>re<span class="o">.</span>findall<span class="p">(</span><span class="s">r'\d+'</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span>ws_name<span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></td></tr><tr><th id="L682"><a href="isis_instrument_RKH.py.html#L682">682</a></th><td></td></tr><tr><th id="L683"><a href="isis_instrument_RKH.py.html#L683">683</a></th><td>        <span class="k">if</span> isSample<span class="p">:</span></td></tr><tr><th id="L684"><a href="isis_instrument_RKH.py.html#L684">684</a></th><td>            <span class="bp">self</span><span class="o">.</span>set_up_for_run<span class="p">(</span>run_num<span class="p">)</span></td></tr><tr><th id="L685"><a href="isis_instrument_RKH.py.html#L685">685</a></th><td></td></tr><tr><th id="L686"><a href="isis_instrument_RKH.py.html#L686">686</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>_newCalibrationWS<span class="p">:</span></td></tr><tr><th id="L687"><a href="isis_instrument_RKH.py.html#L687">687</a></th><td>            <span class="bp">self</span><span class="o">.</span>changeCalibration<span class="p">(</span>ws_name<span class="p">)</span></td></tr><tr><th id="L688"><a href="isis_instrument_RKH.py.html#L688">688</a></th><td></td></tr><tr><th id="L689"><a href="isis_instrument_RKH.py.html#L689">689</a></th><td>        <span class="c"># centralize the bank to the centre</span></td></tr><tr><th id="L690"><a href="isis_instrument_RKH.py.html#L690">690</a></th><td>        <span class="bp">self</span><span class="o">.</span>move_components<span class="p">(</span>ws_name<span class="p">,</span> beamcentre<span class="p">[</span><span class="mi">0</span><span class="p">],</span> beamcentre<span class="p">[</span><span class="mi">1</span><span class="p">])</span></td></tr><tr><th id="L691"><a href="isis_instrument_RKH.py.html#L691">691</a></th><td></td></tr><tr><th id="L692"><a href="isis_instrument_RKH.py.html#L692">692</a></th><td>    <span class="k">def</span> <span class="nf">load_transmission_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_trans<span class="p">,</span> ws_direct<span class="p">,</span> beamcentre<span class="p">):</span></td></tr><tr><th id="L693"><a href="isis_instrument_RKH.py.html#L693">693</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L694"><a href="isis_instrument_RKH.py.html#L694">694</a></th><td><span class="sd">        Called on loading of transmissions</span></td></tr><tr><th id="L695"><a href="isis_instrument_RKH.py.html#L695">695</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L696"><a href="isis_instrument_RKH.py.html#L696">696</a></th><td>        <span class="k">pass</span></td></tr><tr><th id="L697"><a href="isis_instrument_RKH.py.html#L697">697</a></th><td></td></tr><tr><th id="L698"><a href="isis_instrument_RKH.py.html#L698">698</a></th><td>    <span class="k">def</span> <span class="nf">changeCalibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">):</span></td></tr><tr><th id="L699"><a href="isis_instrument_RKH.py.html#L699">699</a></th><td>        calib <span class="o">=</span> mtd<span class="p">[</span><span class="bp">self</span><span class="o">.</span>_newCalibrationWS<span class="p">]</span></td></tr><tr><th id="L700"><a href="isis_instrument_RKH.py.html#L700">700</a></th><td>        sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">"Applying new calibration for the detectors from "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>calib<span class="o">.</span>name<span class="p">()))</span></td></tr><tr><th id="L701"><a href="isis_instrument_RKH.py.html#L701">701</a></th><td>        CopyInstrumentParameters<span class="p">(</span>calib<span class="p">,</span> ws_name<span class="p">)</span></td></tr><tr><th id="L702"><a href="isis_instrument_RKH.py.html#L702">702</a></th><td></td></tr><tr><th id="L703"><a href="isis_instrument_RKH.py.html#L703">703</a></th><td>    <span class="k">def</span> <span class="nf">setCalibrationWorkspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_reference<span class="p">):</span></td></tr><tr><th id="L704"><a href="isis_instrument_RKH.py.html#L704">704</a></th><td>        <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span>ws_reference<span class="p">,</span> Workspace<span class="p">))</span></td></tr><tr><th id="L705"><a href="isis_instrument_RKH.py.html#L705">705</a></th><td>        <span class="c"># we do deep copy of singleton - to be removed in 8470</span></td></tr><tr><th id="L706"><a href="isis_instrument_RKH.py.html#L706">706</a></th><td>        <span class="c"># this forces us to have 'copyable' objects.</span></td></tr><tr><th id="L707"><a href="isis_instrument_RKH.py.html#L707">707</a></th><td>        <span class="bp">self</span><span class="o">.</span>_newCalibrationWS <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>ws_reference<span class="p">)</span></td></tr><tr><th id="L708"><a href="isis_instrument_RKH.py.html#L708">708</a></th><td></td></tr><tr><th id="L709"><a href="isis_instrument_RKH.py.html#L709">709</a></th><td></td></tr><tr><th id="L710"><a href="isis_instrument_RKH.py.html#L710">710</a></th><td></td></tr><tr><th id="L711"><a href="isis_instrument_RKH.py.html#L711">711</a></th><td><span class="k">class</span> <span class="nc">LOQ</span><span class="p">(</span>ISISInstrument<span class="p">):</span></td></tr><tr><th id="L712"><a href="isis_instrument_RKH.py.html#L712">712</a></th><td>    <span class="sd">"""</span></td></tr><tr><th id="L713"><a href="isis_instrument_RKH.py.html#L713">713</a></th><td><span class="sd">        Contains all the LOQ specific data and functions</span></td></tr><tr><th id="L714"><a href="isis_instrument_RKH.py.html#L714">714</a></th><td><span class="sd">    """</span></td></tr><tr><th id="L715"><a href="isis_instrument_RKH.py.html#L715">715</a></th><td>    _NAME <span class="o">=</span> <span class="s">'LOQ'</span></td></tr><tr><th id="L716"><a href="isis_instrument_RKH.py.html#L716">716</a></th><td>    <span class="c">#minimum wavelength of neutrons assumed to be measurable by this instrument</span></td></tr><tr><th id="L717"><a href="isis_instrument_RKH.py.html#L717">717</a></th><td>    WAV_RANGE_MIN <span class="o">=</span> <span class="mf">2.2</span></td></tr><tr><th id="L718"><a href="isis_instrument_RKH.py.html#L718">718</a></th><td>    <span class="c">#maximum wavelength of neutrons assumed to be measurable by this instrument</span></td></tr><tr><th id="L719"><a href="isis_instrument_RKH.py.html#L719">719</a></th><td>    WAV_RANGE_MAX <span class="o">=</span> <span class="mf">10.0</span></td></tr><tr><th id="L720"><a href="isis_instrument_RKH.py.html#L720">720</a></th><td></td></tr><tr><th id="L721"><a href="isis_instrument_RKH.py.html#L721">721</a></th><td>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L722"><a href="isis_instrument_RKH.py.html#L722">722</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L723"><a href="isis_instrument_RKH.py.html#L723">723</a></th><td><span class="sd">            Reads LOQ's instrument definition xml file</span></td></tr><tr><th id="L724"><a href="isis_instrument_RKH.py.html#L724">724</a></th><td><span class="sd">            @raise IndexError: if any parameters (e.g. 'default-incident-monitor-spectrum') aren't in the xml definition</span></td></tr><tr><th id="L725"><a href="isis_instrument_RKH.py.html#L725">725</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L726"><a href="isis_instrument_RKH.py.html#L726">726</a></th><td>        <span class="nb">super</span><span class="p">(</span>LOQ<span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span>__init__<span class="p">(</span><span class="s">'LOQ_Definition_20020226-.xml'</span><span class="p">)</span></td></tr><tr><th id="L727"><a href="isis_instrument_RKH.py.html#L727">727</a></th><td>        <span class="c">#relates the numbers of the monitors to their names in the instrument definition file</span></td></tr><tr><th id="L728"><a href="isis_instrument_RKH.py.html#L728">728</a></th><td>        <span class="bp">self</span><span class="o">.</span>monitor_names <span class="o">=</span> <span class="p">{</span><span class="mi">1</span> <span class="p">:</span> <span class="s">'monitor1'</span><span class="p">,</span></td></tr><tr><th id="L729"><a href="isis_instrument_RKH.py.html#L729">729</a></th><td>                              <span class="mi">2</span> <span class="p">:</span> <span class="s">'monitor2'</span><span class="p">}</span></td></tr><tr><th id="L730"><a href="isis_instrument_RKH.py.html#L730">730</a></th><td></td></tr><tr><th id="L731"><a href="isis_instrument_RKH.py.html#L731">731</a></th><td>    <span class="k">def</span> <span class="nf">move_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws<span class="p">,</span> xbeam<span class="p">,</span> ybeam<span class="p">):</span></td></tr><tr><th id="L732"><a href="isis_instrument_RKH.py.html#L732">732</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L733"><a href="isis_instrument_RKH.py.html#L733">733</a></th><td><span class="sd">            Move the locations of the sample and detector bank based on the passed beam center</span></td></tr><tr><th id="L734"><a href="isis_instrument_RKH.py.html#L734">734</a></th><td><span class="sd">            and information from the sample workspace logs</span></td></tr><tr><th id="L735"><a href="isis_instrument_RKH.py.html#L735">735</a></th><td><span class="sd">            @param ws: workspace containing the instrument information</span></td></tr><tr><th id="L736"><a href="isis_instrument_RKH.py.html#L736">736</a></th><td><span class="sd">            @param xbeam: x-position of the beam</span></td></tr><tr><th id="L737"><a href="isis_instrument_RKH.py.html#L737">737</a></th><td><span class="sd">            @param ybeam: y-position of the beam</span></td></tr><tr><th id="L738"><a href="isis_instrument_RKH.py.html#L738">738</a></th><td><span class="sd">            @return: the locations of (in the new coordinates) beam center, center of detector bank</span></td></tr><tr><th id="L739"><a href="isis_instrument_RKH.py.html#L739">739</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L740"><a href="isis_instrument_RKH.py.html#L740">740</a></th><td>        <span class="bp">self</span><span class="o">.</span>move_all_components<span class="p">(</span>ws<span class="p">)</span></td></tr><tr><th id="L741"><a href="isis_instrument_RKH.py.html#L741">741</a></th><td></td></tr><tr><th id="L742"><a href="isis_instrument_RKH.py.html#L742">742</a></th><td>        xshift <span class="o">=</span> <span class="p">(</span><span class="mf">317.5</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span> <span class="o">-</span> xbeam</td></tr><tr><th id="L743"><a href="isis_instrument_RKH.py.html#L743">743</a></th><td>        yshift <span class="o">=</span> <span class="p">(</span><span class="mf">317.5</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span> <span class="o">-</span> ybeam</td></tr><tr><th id="L744"><a href="isis_instrument_RKH.py.html#L744">744</a></th><td>        MoveInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> xshift<span class="p">,</span> Y <span class="o">=</span> yshift<span class="p">,</span> RelativePosition<span class="o">=</span><span class="s">"1"</span><span class="p">)</span></td></tr><tr><th id="L745"><a href="isis_instrument_RKH.py.html#L745">745</a></th><td></td></tr><tr><th id="L746"><a href="isis_instrument_RKH.py.html#L746">746</a></th><td>        <span class="c"># Have a separate move for x_corr, y_coor and z_coor just to make it more obvious in the</span></td></tr><tr><th id="L747"><a href="isis_instrument_RKH.py.html#L747">747</a></th><td>        <span class="c"># history, and to expert users what is going on</span></td></tr><tr><th id="L748"><a href="isis_instrument_RKH.py.html#L748">748</a></th><td>        det <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span></td></tr><tr><th id="L749"><a href="isis_instrument_RKH.py.html#L749">749</a></th><td>        <span class="k">if</span> det<span class="o">.</span>x_corr <span class="o">!=</span> <span class="mf">0.0</span> <span class="ow">or</span> det<span class="o">.</span>y_corr <span class="o">!=</span> <span class="mf">0.0</span> <span class="ow">or</span> det<span class="o">.</span>z_corr <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span></td></tr><tr><th id="L750"><a href="isis_instrument_RKH.py.html#L750">750</a></th><td>            MoveInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> det<span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> det<span class="o">.</span>x_corr<span class="o">/</span><span class="mf">1000.0</span><span class="p">,</span> Y <span class="o">=</span> det<span class="o">.</span>y_corr<span class="o">/</span><span class="mf">1000.0</span><span class="p">,</span> Z <span class="o">=</span> det<span class="o">.</span>z_corr<span class="o">/</span><span class="mf">1000.0</span><span class="p">,</span> RelativePosition<span class="o">=</span><span class="s">"1"</span><span class="p">)</span></td></tr><tr><th id="L751"><a href="isis_instrument_RKH.py.html#L751">751</a></th><td>            xshift <span class="o">=</span> xshift <span class="o">+</span> det<span class="o">.</span>x_corr<span class="o">/</span><span class="mf">1000.0</span></td></tr><tr><th id="L752"><a href="isis_instrument_RKH.py.html#L752">752</a></th><td>            yshift <span class="o">=</span> yshift <span class="o">+</span> det<span class="o">.</span>y_corr<span class="o">/</span><span class="mf">1000.0</span></td></tr><tr><th id="L753"><a href="isis_instrument_RKH.py.html#L753">753</a></th><td></td></tr><tr><th id="L754"><a href="isis_instrument_RKH.py.html#L754">754</a></th><td>        <span class="k">return</span> <span class="p">[</span>xshift<span class="p">,</span> yshift<span class="p">],</span> <span class="p">[</span>xshift<span class="p">,</span> yshift<span class="p">]</span></td></tr><tr><th id="L755"><a href="isis_instrument_RKH.py.html#L755">755</a></th><td></td></tr><tr><th id="L756"><a href="isis_instrument_RKH.py.html#L756">756</a></th><td>    <span class="k">def</span> <span class="nf">get_marked_dets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L757"><a href="isis_instrument_RKH.py.html#L757">757</a></th><td>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">'The marked detector list isn</span><span class="se">\'</span><span class="s">t stored for instrument '</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span>_NAME<span class="p">)</span></td></tr><tr><th id="L758"><a href="isis_instrument_RKH.py.html#L758">758</a></th><td></td></tr><tr><th id="L759"><a href="isis_instrument_RKH.py.html#L759">759</a></th><td>    <span class="k">def</span> <span class="nf">set_up_for_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> base_runno<span class="p">):</span></td></tr><tr><th id="L760"><a href="isis_instrument_RKH.py.html#L760">760</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L761"><a href="isis_instrument_RKH.py.html#L761">761</a></th><td><span class="sd">            Needs to run whenever a sample is loaded</span></td></tr><tr><th id="L762"><a href="isis_instrument_RKH.py.html#L762">762</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L763"><a href="isis_instrument_RKH.py.html#L763">763</a></th><td>        first <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'low-angle'</span><span class="p">]</span></td></tr><tr><th id="L764"><a href="isis_instrument_RKH.py.html#L764">764</a></th><td>        second <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span></td></tr><tr><th id="L765"><a href="isis_instrument_RKH.py.html#L765">765</a></th><td></td></tr><tr><th id="L766"><a href="isis_instrument_RKH.py.html#L766">766</a></th><td>        first<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L767"><a href="isis_instrument_RKH.py.html#L767">767</a></th><td>        <span class="c">#probably _first_spec_num was already set to this when the instrument parameter file was loaded</span></td></tr><tr><th id="L768"><a href="isis_instrument_RKH.py.html#L768">768</a></th><td>        first<span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">3</span><span class="p">)</span></td></tr><tr><th id="L769"><a href="isis_instrument_RKH.py.html#L769">769</a></th><td>        second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L770"><a href="isis_instrument_RKH.py.html#L770">770</a></th><td>        second<span class="o">.</span>place_after<span class="p">(</span>first<span class="p">)</span></td></tr><tr><th id="L771"><a href="isis_instrument_RKH.py.html#L771">771</a></th><td></td></tr><tr><th id="L772"><a href="isis_instrument_RKH.py.html#L772">772</a></th><td>    <span class="k">def</span> <span class="nf">load_transmission_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_trans<span class="p">,</span> ws_direct<span class="p">,</span> beamcentre<span class="p">):</span></td></tr><tr><th id="L773"><a href="isis_instrument_RKH.py.html#L773">773</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L774"><a href="isis_instrument_RKH.py.html#L774">774</a></th><td><span class="sd">            Loads information about the setup used for LOQ transmission runs</span></td></tr><tr><th id="L775"><a href="isis_instrument_RKH.py.html#L775">775</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L776"><a href="isis_instrument_RKH.py.html#L776">776</a></th><td>        trans_definition_file <span class="o">=</span> os<span class="o">.</span>path<span class="o">.</span>join<span class="p">(</span>config<span class="o">.</span>getString<span class="p">(</span><span class="s">'instrumentDefinition.directory'</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span>_NAME<span class="o">+</span><span class="s">'_trans_Definition.xml'</span><span class="p">)</span></td></tr><tr><th id="L777"><a href="isis_instrument_RKH.py.html#L777">777</a></th><td>        LoadInstrument<span class="p">(</span>Workspace<span class="o">=</span>ws_trans<span class="p">,</span>Filename<span class="o">=</span> trans_definition_file<span class="p">,</span> RewriteSpectraMap<span class="o">=</span><span class="bp">False</span><span class="p">)</span></td></tr><tr><th id="L778"><a href="isis_instrument_RKH.py.html#L778">778</a></th><td>        LoadInstrument<span class="p">(</span>Workspace<span class="o">=</span>ws_direct<span class="p">,</span> Filename <span class="o">=</span> trans_definition_file<span class="p">,</span> RewriteSpectraMap<span class="o">=</span><span class="bp">False</span><span class="p">)</span></td></tr><tr><th id="L779"><a href="isis_instrument_RKH.py.html#L779">779</a></th><td></td></tr><tr><th id="L780"><a href="isis_instrument_RKH.py.html#L780">780</a></th><td>    <span class="k">def</span> <span class="nf">cur_detector_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">):</span></td></tr><tr><th id="L781"><a href="isis_instrument_RKH.py.html#L781">781</a></th><td>        <span class="sd">"""Return the position of the center of the detector bank"""</span></td></tr><tr><th id="L782"><a href="isis_instrument_RKH.py.html#L782">782</a></th><td>        ws <span class="o">=</span> mtd<span class="p">[</span>ws_name<span class="p">]</span></td></tr><tr><th id="L783"><a href="isis_instrument_RKH.py.html#L783">783</a></th><td>        pos <span class="o">=</span> ws<span class="o">.</span>getInstrument<span class="p">()</span><span class="o">.</span>getComponentByName<span class="p">(</span><span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">())</span><span class="o">.</span>getPos<span class="p">()</span></td></tr><tr><th id="L784"><a href="isis_instrument_RKH.py.html#L784">784</a></th><td>        cent_pos <span class="o">=</span> <span class="mf">317.5</span><span class="o">/</span><span class="mf">1000.0</span></td></tr><tr><th id="L785"><a href="isis_instrument_RKH.py.html#L785">785</a></th><td>        <span class="k">return</span> <span class="p">[</span>cent_pos <span class="o">-</span> pos<span class="o">.</span>getX<span class="p">(),</span> cent_pos <span class="o">-</span> pos<span class="o">.</span>getY<span class="p">()]</span></td></tr><tr><th id="L786"><a href="isis_instrument_RKH.py.html#L786">786</a></th><td></td></tr><tr><th id="L787"><a href="isis_instrument_RKH.py.html#L787">787</a></th><td><span class="k">class</span> <span class="nc">SANS2D</span><span class="p">(</span>ISISInstrument<span class="p">):</span></td></tr><tr><th id="L788"><a href="isis_instrument_RKH.py.html#L788">788</a></th><td>    <span class="sd">"""</span></td></tr><tr><th id="L789"><a href="isis_instrument_RKH.py.html#L789">789</a></th><td><span class="sd">        The SANS2D instrument has movable detectors whose locations have to</span></td></tr><tr><th id="L790"><a href="isis_instrument_RKH.py.html#L790">790</a></th><td><span class="sd">        be read in from the workspace logs (Run object)</span></td></tr><tr><th id="L791"><a href="isis_instrument_RKH.py.html#L791">791</a></th><td><span class="sd">    """</span></td></tr><tr><th id="L792"><a href="isis_instrument_RKH.py.html#L792">792</a></th><td>    _NAME <span class="o">=</span> <span class="s">'SANS2D'</span></td></tr><tr><th id="L793"><a href="isis_instrument_RKH.py.html#L793">793</a></th><td>    WAV_RANGE_MIN <span class="o">=</span> <span class="mf">2.0</span></td></tr><tr><th id="L794"><a href="isis_instrument_RKH.py.html#L794">794</a></th><td>    WAV_RANGE_MAX <span class="o">=</span> <span class="mf">14.0</span></td></tr><tr><th id="L795"><a href="isis_instrument_RKH.py.html#L795">795</a></th><td></td></tr><tr><th id="L796"><a href="isis_instrument_RKH.py.html#L796">796</a></th><td>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> idf_path<span class="o">=</span><span class="bp">None</span><span class="p">):</span></td></tr><tr><th id="L797"><a href="isis_instrument_RKH.py.html#L797">797</a></th><td>        <span class="nb">super</span><span class="p">(</span>SANS2D<span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span>__init__<span class="p">(</span>idf_path<span class="p">)</span></td></tr><tr><th id="L798"><a href="isis_instrument_RKH.py.html#L798">798</a></th><td></td></tr><tr><th id="L799"><a href="isis_instrument_RKH.py.html#L799">799</a></th><td>        <span class="bp">self</span><span class="o">.</span>_marked_dets <span class="o">=</span> <span class="p">[]</span></td></tr><tr><th id="L800"><a href="isis_instrument_RKH.py.html#L800">800</a></th><td>        <span class="c"># set to true once the detector positions have been moved to the locations given in the sample logs</span></td></tr><tr><th id="L801"><a href="isis_instrument_RKH.py.html#L801">801</a></th><td>        <span class="bp">self</span><span class="o">.</span>corrections_applied <span class="o">=</span> <span class="bp">False</span></td></tr><tr><th id="L802"><a href="isis_instrument_RKH.py.html#L802">802</a></th><td>        <span class="c"># a warning is issued if the can logs are not the same as the sample</span></td></tr><tr><th id="L803"><a href="isis_instrument_RKH.py.html#L803">803</a></th><td>        <span class="bp">self</span><span class="o">.</span>_can_logs <span class="o">=</span> <span class="p">{}</span></td></tr><tr><th id="L804"><a href="isis_instrument_RKH.py.html#L804">804</a></th><td>        <span class="c">#The user can set the distance between monitor 4 and the rear detector in millimetres, should be negative</span></td></tr><tr><th id="L805"><a href="isis_instrument_RKH.py.html#L805">805</a></th><td>        <span class="bp">self</span><span class="o">.</span>monitor_4_offset <span class="o">=</span> <span class="bp">None</span></td></tr><tr><th id="L806"><a href="isis_instrument_RKH.py.html#L806">806</a></th><td>        <span class="c">#relates the numbers of the monitors to their names in the instrument definition file</span></td></tr><tr><th id="L807"><a href="isis_instrument_RKH.py.html#L807">807</a></th><td>        <span class="bp">self</span><span class="o">.</span>monitor_names <span class="o">=</span> <span class="p">{</span><span class="mi">1</span> <span class="p">:</span> <span class="s">'monitor1'</span><span class="p">,</span></td></tr><tr><th id="L808"><a href="isis_instrument_RKH.py.html#L808">808</a></th><td>                              <span class="mi">2</span> <span class="p">:</span> <span class="s">'monitor2'</span><span class="p">,</span></td></tr><tr><th id="L809"><a href="isis_instrument_RKH.py.html#L809">809</a></th><td>                              <span class="mi">3</span> <span class="p">:</span> <span class="s">'monitor3'</span><span class="p">,</span></td></tr><tr><th id="L810"><a href="isis_instrument_RKH.py.html#L810">810</a></th><td>                              <span class="mi">4</span> <span class="p">:</span> <span class="s">'monitor4'</span><span class="p">}</span></td></tr><tr><th id="L811"><a href="isis_instrument_RKH.py.html#L811">811</a></th><td></td></tr><tr><th id="L812"><a href="isis_instrument_RKH.py.html#L812">812</a></th><td>    <span class="k">def</span> <span class="nf">set_up_for_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> base_runno<span class="p">):</span></td></tr><tr><th id="L813"><a href="isis_instrument_RKH.py.html#L813">813</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L814"><a href="isis_instrument_RKH.py.html#L814">814</a></th><td><span class="sd">            Handles changes required when a sample is loaded, both generic</span></td></tr><tr><th id="L815"><a href="isis_instrument_RKH.py.html#L815">815</a></th><td><span class="sd">            and run specific</span></td></tr><tr><th id="L816"><a href="isis_instrument_RKH.py.html#L816">816</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L817"><a href="isis_instrument_RKH.py.html#L817">817</a></th><td>        first <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'low-angle'</span><span class="p">]</span></td></tr><tr><th id="L818"><a href="isis_instrument_RKH.py.html#L818">818</a></th><td>        second <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span></td></tr><tr><th id="L819"><a href="isis_instrument_RKH.py.html#L819">819</a></th><td></td></tr><tr><th id="L820"><a href="isis_instrument_RKH.py.html#L820">820</a></th><td>        <span class="k">try</span><span class="p">:</span></td></tr><tr><th id="L821"><a href="isis_instrument_RKH.py.html#L821">821</a></th><td>            base_runno <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>base_runno<span class="p">)</span></td></tr><tr><th id="L822"><a href="isis_instrument_RKH.py.html#L822">822</a></th><td>            <span class="c">#first deal with some special cases</span></td></tr><tr><th id="L823"><a href="isis_instrument_RKH.py.html#L823">823</a></th><td>            <span class="k">if</span> base_runno <span class="o">&lt;</span> <span class="mi">568</span><span class="p">:</span></td></tr><tr><th id="L824"><a href="isis_instrument_RKH.py.html#L824">824</a></th><td>                <span class="bp">self</span><span class="o">.</span>set_incident_mon<span class="p">(</span><span class="mi">73730</span><span class="p">)</span></td></tr><tr><th id="L825"><a href="isis_instrument_RKH.py.html#L825">825</a></th><td>                first<span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">1</span><span class="p">)</span></td></tr><tr><th id="L826"><a href="isis_instrument_RKH.py.html#L826">826</a></th><td>                first<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Vertical'</span><span class="p">)</span></td></tr><tr><th id="L827"><a href="isis_instrument_RKH.py.html#L827">827</a></th><td>                second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Vertical'</span><span class="p">)</span></td></tr><tr><th id="L828"><a href="isis_instrument_RKH.py.html#L828">828</a></th><td>            <span class="k">elif</span> <span class="p">(</span>base_runno <span class="o">&gt;=</span> <span class="mi">568</span> <span class="ow">and</span> base_runno <span class="o">&lt;</span> <span class="mi">684</span><span class="p">):</span></td></tr><tr><th id="L829"><a href="isis_instrument_RKH.py.html#L829">829</a></th><td>                first<span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">9</span><span class="p">)</span></td></tr><tr><th id="L830"><a href="isis_instrument_RKH.py.html#L830">830</a></th><td>                first<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Rotated'</span><span class="p">)</span></td></tr><tr><th id="L831"><a href="isis_instrument_RKH.py.html#L831">831</a></th><td>                second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Rotated'</span><span class="p">)</span></td></tr><tr><th id="L832"><a href="isis_instrument_RKH.py.html#L832">832</a></th><td>            <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L833"><a href="isis_instrument_RKH.py.html#L833">833</a></th><td>                <span class="c">#this is the default case</span></td></tr><tr><th id="L834"><a href="isis_instrument_RKH.py.html#L834">834</a></th><td>                first<span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">9</span><span class="p">)</span></td></tr><tr><th id="L835"><a href="isis_instrument_RKH.py.html#L835">835</a></th><td>                first<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L836"><a href="isis_instrument_RKH.py.html#L836">836</a></th><td>                second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L837"><a href="isis_instrument_RKH.py.html#L837">837</a></th><td>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span></td></tr><tr><th id="L838"><a href="isis_instrument_RKH.py.html#L838">838</a></th><td>            <span class="c">#this is the default case</span></td></tr><tr><th id="L839"><a href="isis_instrument_RKH.py.html#L839">839</a></th><td>            first<span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">9</span><span class="p">)</span></td></tr><tr><th id="L840"><a href="isis_instrument_RKH.py.html#L840">840</a></th><td>            first<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L841"><a href="isis_instrument_RKH.py.html#L841">841</a></th><td>            <span class="c"># empty instrument number spectra differently.</span></td></tr><tr><th id="L842"><a href="isis_instrument_RKH.py.html#L842">842</a></th><td>            <span class="k">if</span> base_runno <span class="o">==</span> <span class="s">'emptyInstrument'</span><span class="p">:</span></td></tr><tr><th id="L843"><a href="isis_instrument_RKH.py.html#L843">843</a></th><td>                second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'HorizontalFlipped'</span><span class="p">)</span></td></tr><tr><th id="L844"><a href="isis_instrument_RKH.py.html#L844">844</a></th><td>            <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L845"><a href="isis_instrument_RKH.py.html#L845">845</a></th><td>                second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L846"><a href="isis_instrument_RKH.py.html#L846">846</a></th><td></td></tr><tr><th id="L847"><a href="isis_instrument_RKH.py.html#L847">847</a></th><td>        <span class="c">#as spectrum numbers of the first detector have changed we'll move those in the second too</span></td></tr><tr><th id="L848"><a href="isis_instrument_RKH.py.html#L848">848</a></th><td>        second<span class="o">.</span>place_after<span class="p">(</span>first<span class="p">)</span></td></tr><tr><th id="L849"><a href="isis_instrument_RKH.py.html#L849">849</a></th><td></td></tr><tr><th id="L850"><a href="isis_instrument_RKH.py.html#L850">850</a></th><td>    <span class="k">def</span> <span class="nf">getDetValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">):</span></td></tr><tr><th id="L851"><a href="isis_instrument_RKH.py.html#L851">851</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L852"><a href="isis_instrument_RKH.py.html#L852">852</a></th><td><span class="sd">        Retrive the values of Front_Det_Z, Front_Det_X, Front_Det_Rot, Rear_Det_Z and Rear_Det_X from</span></td></tr><tr><th id="L853"><a href="isis_instrument_RKH.py.html#L853">853</a></th><td><span class="sd">        the workspace. If it does not find the value at the run info, it takes as default value the</span></td></tr><tr><th id="L854"><a href="isis_instrument_RKH.py.html#L854">854</a></th><td><span class="sd">        self.FRONT_DET_Z, self... which are extracted from the sample workspace at apply_detector_log.</span></td></tr><tr><th id="L855"><a href="isis_instrument_RKH.py.html#L855">855</a></th><td><span class="sd"></span></td></tr><tr><th id="L856"><a href="isis_instrument_RKH.py.html#L856">856</a></th><td><span class="sd">        This is done to allow the function move_components to use the correct values and not to use</span></td></tr><tr><th id="L857"><a href="isis_instrument_RKH.py.html#L857">857</a></th><td><span class="sd">        all the values for TRANS ans SAMPLE the same, as sometimes, this assumption is not valid.</span></td></tr><tr><th id="L858"><a href="isis_instrument_RKH.py.html#L858">858</a></th><td><span class="sd"></span></td></tr><tr><th id="L859"><a href="isis_instrument_RKH.py.html#L859">859</a></th><td><span class="sd">        The reason for this method is explained at the ticket http://trac.mantidproject.org/mantid/ticket/7314.</span></td></tr><tr><th id="L860"><a href="isis_instrument_RKH.py.html#L860">860</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L861"><a href="isis_instrument_RKH.py.html#L861">861</a></th><td>        <span class="c"># set the default value for these variables</span></td></tr><tr><th id="L862"><a href="isis_instrument_RKH.py.html#L862">862</a></th><td>        values <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span>FRONT_DET_Z<span class="p">,</span> <span class="bp">self</span><span class="o">.</span>FRONT_DET_X<span class="p">,</span> <span class="bp">self</span><span class="o">.</span>FRONT_DET_ROT<span class="p">,</span> <span class="bp">self</span><span class="o">.</span>REAR_DET_Z<span class="p">,</span> <span class="bp">self</span><span class="o">.</span>REAR_DET_X<span class="p">]</span></td></tr><tr><th id="L863"><a href="isis_instrument_RKH.py.html#L863">863</a></th><td>        <span class="c"># get these variables from the workspace run</span></td></tr><tr><th id="L864"><a href="isis_instrument_RKH.py.html#L864">864</a></th><td>        run_info <span class="o">=</span> mtd<span class="p">[</span><span class="nb">str</span><span class="p">(</span>ws_name<span class="p">)]</span><span class="o">.</span>run<span class="p">()</span></td></tr><tr><th id="L865"><a href="isis_instrument_RKH.py.html#L865">865</a></th><td>        ind <span class="o">=</span> <span class="mi">0</span></td></tr><tr><th id="L866"><a href="isis_instrument_RKH.py.html#L866">866</a></th><td>        <span class="k">for</span> name <span class="ow">in</span> <span class="p">(</span><span class="s">'Front_Det_Z'</span><span class="p">,</span> <span class="s">'Front_Det_X'</span><span class="p">,</span> <span class="s">'Front_Det_Rot'</span><span class="p">,</span></td></tr><tr><th id="L867"><a href="isis_instrument_RKH.py.html#L867">867</a></th><td>                     <span class="s">'Rear_Det_Z'</span><span class="p">,</span><span class="s">'Rear_Det_X'</span><span class="p">):</span></td></tr><tr><th id="L868"><a href="isis_instrument_RKH.py.html#L868">868</a></th><td>            <span class="k">try</span><span class="p">:</span></td></tr><tr><th id="L869"><a href="isis_instrument_RKH.py.html#L869">869</a></th><td>                var <span class="o">=</span> run_info<span class="o">.</span>get<span class="p">(</span>name<span class="p">)</span><span class="o">.</span>value</td></tr><tr><th id="L870"><a href="isis_instrument_RKH.py.html#L870">870</a></th><td>                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span>var<span class="p">,</span> <span class="s">'__iter__'</span><span class="p">):</span></td></tr><tr><th id="L871"><a href="isis_instrument_RKH.py.html#L871">871</a></th><td>                    var <span class="o">=</span> var<span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></td></tr><tr><th id="L872"><a href="isis_instrument_RKH.py.html#L872">872</a></th><td>                values<span class="p">[</span>ind<span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>var<span class="p">)</span></td></tr><tr><th id="L873"><a href="isis_instrument_RKH.py.html#L873">873</a></th><td>            <span class="k">except</span><span class="p">:</span></td></tr><tr><th id="L874"><a href="isis_instrument_RKH.py.html#L874">874</a></th><td>                <span class="k">pass</span> <span class="c"># ignore, because we do have a default value</span></td></tr><tr><th id="L875"><a href="isis_instrument_RKH.py.html#L875">875</a></th><td>            ind<span class="o">+=</span><span class="mi">1</span></td></tr><tr><th id="L876"><a href="isis_instrument_RKH.py.html#L876">876</a></th><td>        <span class="c">#return these variables</span></td></tr><tr><th id="L877"><a href="isis_instrument_RKH.py.html#L877">877</a></th><td>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>values<span class="p">)</span></td></tr><tr><th id="L878"><a href="isis_instrument_RKH.py.html#L878">878</a></th><td></td></tr><tr><th id="L879"><a href="isis_instrument_RKH.py.html#L879">879</a></th><td></td></tr><tr><th id="L880"><a href="isis_instrument_RKH.py.html#L880">880</a></th><td>    <span class="k">def</span>  <span class="nf">move_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws<span class="p">,</span> xbeam<span class="p">,</span> ybeam<span class="p">):</span></td></tr><tr><th id="L881"><a href="isis_instrument_RKH.py.html#L881">881</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L882"><a href="isis_instrument_RKH.py.html#L882">882</a></th><td><span class="sd">            Move the locations of the sample and detector bank based on the passed beam center</span></td></tr><tr><th id="L883"><a href="isis_instrument_RKH.py.html#L883">883</a></th><td><span class="sd">            and information from the sample workspace logs. If the location of the monitor was</span></td></tr><tr><th id="L884"><a href="isis_instrument_RKH.py.html#L884">884</a></th><td><span class="sd">            set with TRANS/TRANSPEC=4/SHIFT=... this function does the move instrument</span></td></tr><tr><th id="L885"><a href="isis_instrument_RKH.py.html#L885">885</a></th><td><span class="sd">            @param ws: workspace containing the instrument information</span></td></tr><tr><th id="L886"><a href="isis_instrument_RKH.py.html#L886">886</a></th><td><span class="sd">            @param xbeam: x-position of the beam in meters</span></td></tr><tr><th id="L887"><a href="isis_instrument_RKH.py.html#L887">887</a></th><td><span class="sd">            @param ybeam: y-position of the beam in meters</span></td></tr><tr><th id="L888"><a href="isis_instrument_RKH.py.html#L888">888</a></th><td><span class="sd">            @return: the locations of (in the new coordinates) beam center, center of detector bank</span></td></tr><tr><th id="L889"><a href="isis_instrument_RKH.py.html#L889">889</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L890"><a href="isis_instrument_RKH.py.html#L890">890</a></th><td>        frontDet <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'front'</span><span class="p">)</span></td></tr><tr><th id="L891"><a href="isis_instrument_RKH.py.html#L891">891</a></th><td>        rearDet <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'rear'</span><span class="p">)</span></td></tr><tr><th id="L892"><a href="isis_instrument_RKH.py.html#L892">892</a></th><td></td></tr><tr><th id="L893"><a href="isis_instrument_RKH.py.html#L893">893</a></th><td>        FRONT_DET_Z<span class="p">,</span> FRONT_DET_X<span class="p">,</span> FRONT_DET_ROT<span class="p">,</span> REAR_DET_Z<span class="p">,</span> REAR_DET_X <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetValues<span class="p">(</span>ws<span class="p">)</span></td></tr><tr><th id="L894"><a href="isis_instrument_RKH.py.html#L894">894</a></th><td></td></tr><tr><th id="L895"><a href="isis_instrument_RKH.py.html#L895">895</a></th><td>        <span class="c"># Deal with front detector</span></td></tr><tr><th id="L896"><a href="isis_instrument_RKH.py.html#L896">896</a></th><td></td></tr><tr><th id="L897"><a href="isis_instrument_RKH.py.html#L897">897</a></th><td>        <span class="c"># 11/11/14 RKH need to add tilt of detector, in degrees, with respect to the horizontal or vertical of the detector plane </span></td></tr><tr><th id="L898"><a href="isis_instrument_RKH.py.html#L898">898</a></th><td>        <span class="c"># this time we can rotate about the detector's own axis so can use RotateInstrumentComponent, ytilt rotates about x axis, xtilt rotates about z axis</span></td></tr><tr><th id="L899"><a href="isis_instrument_RKH.py.html#L899">899</a></th><td>        <span class="c">#</span></td></tr><tr><th id="L900"><a href="isis_instrument_RKH.py.html#L900">900</a></th><td>        RotateInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'front'</span><span class="p">)</span><span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> <span class="s">"1."</span><span class="p">,</span> Y <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Z <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Angle <span class="o">=</span> frontDet<span class="o">.</span>y_tilt<span class="p">)</span></td></tr><tr><th id="L901"><a href="isis_instrument_RKH.py.html#L901">901</a></th><td>        RotateInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'front'</span><span class="p">)</span><span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Y <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Z <span class="o">=</span> <span class="s">"1."</span><span class="p">,</span> Angle <span class="o">=</span> frontDet<span class="o">.</span>x_tilt<span class="p">)</span></td></tr><tr><th id="L902"><a href="isis_instrument_RKH.py.html#L902">902</a></th><td>        </td></tr><tr><th id="L903"><a href="isis_instrument_RKH.py.html#L903">903</a></th><td>        <span class="c"># 9/1/2  this all dates to Richard Heenan &amp; Russell Taylor's original python development for SANS2d</span></td></tr><tr><th id="L904"><a href="isis_instrument_RKH.py.html#L904">904</a></th><td>        <span class="c"># the rotation axis on the SANS2d front detector is actually set front_det_radius = 306mm behind the detector.</span></td></tr><tr><th id="L905"><a href="isis_instrument_RKH.py.html#L905">905</a></th><td>        <span class="c"># Since RotateInstrumentComponent will only rotate about the centre of the detector, we have to to the rest here.</span></td></tr><tr><th id="L906"><a href="isis_instrument_RKH.py.html#L906">906</a></th><td>        <span class="c"># rotate front detector according to value in log file and correction value provided in user file</span></td></tr><tr><th id="L907"><a href="isis_instrument_RKH.py.html#L907">907</a></th><td>        rotateDet <span class="o">=</span> <span class="p">(</span><span class="o">-</span>FRONT_DET_ROT <span class="o">-</span> frontDet<span class="o">.</span>rot_corr<span class="p">)</span></td></tr><tr><th id="L908"><a href="isis_instrument_RKH.py.html#L908">908</a></th><td>        RotateInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'front'</span><span class="p">)</span><span class="o">.</span>name<span class="p">(),</span> X<span class="o">=</span><span class="s">"0."</span><span class="p">,</span> Y<span class="o">=</span><span class="s">"1.0"</span><span class="p">,</span> Z<span class="o">=</span><span class="s">"0."</span><span class="p">,</span> Angle<span class="o">=</span>rotateDet<span class="p">)</span></td></tr><tr><th id="L909"><a href="isis_instrument_RKH.py.html#L909">909</a></th><td>        RotRadians <span class="o">=</span> math<span class="o">.</span>pi<span class="o">*</span><span class="p">(</span>FRONT_DET_ROT <span class="o">+</span> frontDet<span class="o">.</span>rot_corr<span class="p">)</span><span class="o">/</span><span class="mf">180.</span></td></tr><tr><th id="L910"><a href="isis_instrument_RKH.py.html#L910">910</a></th><td>        <span class="c"># The rear detector is translated to the beam position using the beam centre coordinates in the user file.</span></td></tr><tr><th id="L911"><a href="isis_instrument_RKH.py.html#L911">911</a></th><td>        <span class="c"># (Note that the X encoder values in NOT used for the rear detector.)</span></td></tr><tr><th id="L912"><a href="isis_instrument_RKH.py.html#L912">912</a></th><td>        <span class="c"># The front detector is translated using the difference in X encoder values, with a correction from the user file.</span></td></tr><tr><th id="L913"><a href="isis_instrument_RKH.py.html#L913">913</a></th><td>        <span class="c"># 21/3/12 RKH [In reality only the DIFFERENCE in X encoders is used, having separate X corrections for both detectors is unnecessary,</span></td></tr><tr><th id="L914"><a href="isis_instrument_RKH.py.html#L914">914</a></th><td>        <span class="c"># but we will continue with this as it makes the mask file smore logical and avoids a retrospective change.]</span></td></tr><tr><th id="L915"><a href="isis_instrument_RKH.py.html#L915">915</a></th><td>        <span class="c"># 21/3/12 RKH add .side_corr    allows rotation axis of the front detector being offset from the detector X=0</span></td></tr><tr><th id="L916"><a href="isis_instrument_RKH.py.html#L916">916</a></th><td>        <span class="c"># this inserts *(1.0-math.cos(RotRadians)) into xshift, and</span></td></tr><tr><th id="L917"><a href="isis_instrument_RKH.py.html#L917">917</a></th><td>        <span class="c"># - frontDet.side_corr*math.sin(RotRadians) into zshift.</span></td></tr><tr><th id="L918"><a href="isis_instrument_RKH.py.html#L918">918</a></th><td>        <span class="c"># (Note we may yet need to introduce further corrections for parallax errors in the detectors, which may be wavelength dependent!)</span></td></tr><tr><th id="L919"><a href="isis_instrument_RKH.py.html#L919">919</a></th><td>        xshift <span class="o">=</span> <span class="p">(</span>REAR_DET_X <span class="o">+</span> rearDet<span class="o">.</span>x_corr <span class="o">-</span>frontDet<span class="o">.</span>x_corr <span class="o">-</span> FRONT_DET_X  <span class="o">-</span>frontDet<span class="o">.</span>side_corr<span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span>math<span class="o">.</span>cos<span class="p">(</span>RotRadians<span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span>FRONT_DET_RADIUS <span class="o">+</span>frontDet<span class="o">.</span>radius_corr<span class="p">)</span><span class="o">*</span>math<span class="o">.</span>sin<span class="p">(</span>RotRadians<span class="p">)</span> <span class="p">)</span><span class="o">/</span><span class="mf">1000.</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span>FRONT_DET_DEFAULT_X_M <span class="o">-</span> xbeam</td></tr><tr><th id="L920"><a href="isis_instrument_RKH.py.html#L920">920</a></th><td>        yshift <span class="o">=</span> <span class="p">(</span>frontDet<span class="o">.</span>y_corr<span class="o">/</span><span class="mf">1000.</span>  <span class="o">-</span> ybeam<span class="p">)</span></td></tr><tr><th id="L921"><a href="isis_instrument_RKH.py.html#L921">921</a></th><td>        <span class="c"># Note don't understand the comment below (9/1/12 these are comments from the original python code, you may remove them if you like!)</span></td></tr><tr><th id="L922"><a href="isis_instrument_RKH.py.html#L922">922</a></th><td>        <span class="c"># default in instrument description is 23.281m - 4.000m from sample at 19,281m !</span></td></tr><tr><th id="L923"><a href="isis_instrument_RKH.py.html#L923">923</a></th><td>        <span class="c"># need to add ~58mm to det1 to get to centre of detector, before it is rotated.</span></td></tr><tr><th id="L924"><a href="isis_instrument_RKH.py.html#L924">924</a></th><td>        <span class="c"># 21/3/12 RKH add .radius_corr        </span></td></tr><tr><th id="L925"><a href="isis_instrument_RKH.py.html#L925">925</a></th><td>        zshift <span class="o">=</span> <span class="p">(</span>FRONT_DET_Z <span class="o">+</span> frontDet<span class="o">.</span>z_corr <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span>FRONT_DET_RADIUS <span class="o">+</span>frontDet<span class="o">.</span>radius_corr<span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> math<span class="o">.</span>cos<span class="p">(</span>RotRadians<span class="p">))</span> <span class="o">-</span> frontDet<span class="o">.</span>side_corr<span class="o">*</span>math<span class="o">.</span>sin<span class="p">(</span>RotRadians<span class="p">))</span><span class="o">/</span><span class="mf">1000.</span></td></tr><tr><th id="L926"><a href="isis_instrument_RKH.py.html#L926">926</a></th><td>        zshift <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span>FRONT_DET_DEFAULT_SD_M</td></tr><tr><th id="L927"><a href="isis_instrument_RKH.py.html#L927">927</a></th><td>        MoveInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'front'</span><span class="p">)</span><span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> xshift<span class="p">,</span> Y <span class="o">=</span> yshift<span class="p">,</span> Z <span class="o">=</span> zshift<span class="p">,</span> RelativePosition<span class="o">=</span><span class="s">"1"</span><span class="p">)</span></td></tr><tr><th id="L928"><a href="isis_instrument_RKH.py.html#L928">928</a></th><td>                </td></tr><tr><th id="L929"><a href="isis_instrument_RKH.py.html#L929">929</a></th><td>                </td></tr><tr><th id="L930"><a href="isis_instrument_RKH.py.html#L930">930</a></th><td>        <span class="c"># deal with rear detector</span></td></tr><tr><th id="L931"><a href="isis_instrument_RKH.py.html#L931">931</a></th><td></td></tr><tr><th id="L932"><a href="isis_instrument_RKH.py.html#L932">932</a></th><td>        <span class="c"># 11/11/14 RKH need to add tilt of detector, in degrees, with respect to the horizontal or vertical of the detector plane </span></td></tr><tr><th id="L933"><a href="isis_instrument_RKH.py.html#L933">933</a></th><td>        <span class="c"># Best to do the tilts first, while the detector is still centred on the z axis, ytilt rotates about x axis, xtilt rotates about z axis</span></td></tr><tr><th id="L934"><a href="isis_instrument_RKH.py.html#L934">934</a></th><td>        <span class="c"># NOTE the beam centre coordinates may change</span></td></tr><tr><th id="L935"><a href="isis_instrument_RKH.py.html#L935">935</a></th><td>        RotateInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> rearDet<span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> <span class="s">"1."</span><span class="p">,</span> Y <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Z <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Angle <span class="o">=</span> rearDet<span class="o">.</span>y_tilt<span class="p">)</span></td></tr><tr><th id="L936"><a href="isis_instrument_RKH.py.html#L936">936</a></th><td>        RotateInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> rearDet<span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Y <span class="o">=</span> <span class="s">"0."</span><span class="p">,</span> Z <span class="o">=</span> <span class="s">"1."</span><span class="p">,</span> Angle <span class="o">=</span> rearDet<span class="o">.</span>x_tilt<span class="p">)</span></td></tr><tr><th id="L937"><a href="isis_instrument_RKH.py.html#L937">937</a></th><td>        </td></tr><tr><th id="L938"><a href="isis_instrument_RKH.py.html#L938">938</a></th><td>        xshift <span class="o">=</span> <span class="o">-</span>xbeam</td></tr><tr><th id="L939"><a href="isis_instrument_RKH.py.html#L939">939</a></th><td>        yshift <span class="o">=</span> <span class="o">-</span>ybeam</td></tr><tr><th id="L940"><a href="isis_instrument_RKH.py.html#L940">940</a></th><td>        zshift <span class="o">=</span> <span class="p">(</span>REAR_DET_Z <span class="o">+</span> rearDet<span class="o">.</span>z_corr<span class="p">)</span><span class="o">/</span><span class="mf">1000.</span></td></tr><tr><th id="L941"><a href="isis_instrument_RKH.py.html#L941">941</a></th><td>        zshift <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span>REAR_DET_DEFAULT_SD_M</td></tr><tr><th id="L942"><a href="isis_instrument_RKH.py.html#L942">942</a></th><td>        sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">"Setup move "</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>xshift<span class="o">*</span><span class="mf">1000.</span><span class="p">)</span><span class="o">+</span><span class="s">" "</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>yshift<span class="o">*</span><span class="mf">1000.</span><span class="p">)</span><span class="o">+</span><span class="s">" "</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>zshift<span class="o">*</span><span class="mf">1000.</span><span class="p">))</span></td></tr><tr><th id="L943"><a href="isis_instrument_RKH.py.html#L943">943</a></th><td>        MoveInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> rearDet<span class="o">.</span>name<span class="p">(),</span> X <span class="o">=</span> xshift<span class="p">,</span> Y <span class="o">=</span> yshift<span class="p">,</span> Z <span class="o">=</span> zshift<span class="p">,</span> RelativePosition<span class="o">=</span><span class="s">"1"</span><span class="p">)</span></td></tr><tr><th id="L944"><a href="isis_instrument_RKH.py.html#L944">944</a></th><td></td></tr><tr><th id="L945"><a href="isis_instrument_RKH.py.html#L945">945</a></th><td></td></tr><tr><th id="L946"><a href="isis_instrument_RKH.py.html#L946">946</a></th><td>        <span class="bp">self</span><span class="o">.</span>move_all_components<span class="p">(</span>ws<span class="p">)</span></td></tr><tr><th id="L947"><a href="isis_instrument_RKH.py.html#L947">947</a></th><td></td></tr><tr><th id="L948"><a href="isis_instrument_RKH.py.html#L948">948</a></th><td>        <span class="c">#this implements the TRANS/TRANSPEC=4/SHIFT=... line, this overrides any other monitor move</span></td></tr><tr><th id="L949"><a href="isis_instrument_RKH.py.html#L949">949</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>monitor_4_offset<span class="p">:</span></td></tr><tr><th id="L950"><a href="isis_instrument_RKH.py.html#L950">950</a></th><td>            <span class="c">#get the current location of the monitor</span></td></tr><tr><th id="L951"><a href="isis_instrument_RKH.py.html#L951">951</a></th><td>            component <span class="o">=</span> <span class="s">'monitor4'</span></td></tr><tr><th id="L952"><a href="isis_instrument_RKH.py.html#L952">952</a></th><td>            ws <span class="o">=</span> mtd<span class="p">[</span><span class="nb">str</span><span class="p">(</span>ws<span class="p">)]</span></td></tr><tr><th id="L953"><a href="isis_instrument_RKH.py.html#L953">953</a></th><td>            mon <span class="o">=</span> ws<span class="o">.</span>getInstrument<span class="p">()</span><span class="o">.</span>getComponentByName<span class="p">(</span>component<span class="p">)</span></td></tr><tr><th id="L954"><a href="isis_instrument_RKH.py.html#L954">954</a></th><td>            z_orig <span class="o">=</span> mon<span class="o">.</span>getPos<span class="p">()</span><span class="o">.</span>getZ<span class="p">()</span></td></tr><tr><th id="L955"><a href="isis_instrument_RKH.py.html#L955">955</a></th><td></td></tr><tr><th id="L956"><a href="isis_instrument_RKH.py.html#L956">956</a></th><td>            <span class="c">#the location is relative to the rear-detector, get its location</span></td></tr><tr><th id="L957"><a href="isis_instrument_RKH.py.html#L957">957</a></th><td>            det <span class="o">=</span> ws<span class="o">.</span>getInstrument<span class="p">()</span><span class="o">.</span>getComponentByName<span class="p">(</span><span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">())</span></td></tr><tr><th id="L958"><a href="isis_instrument_RKH.py.html#L958">958</a></th><td>            det_z <span class="o">=</span> det<span class="o">.</span>getPos<span class="p">()</span><span class="o">.</span>getZ<span class="p">()</span></td></tr><tr><th id="L959"><a href="isis_instrument_RKH.py.html#L959">959</a></th><td></td></tr><tr><th id="L960"><a href="isis_instrument_RKH.py.html#L960">960</a></th><td>            monitor_4_offset <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>monitor_4_offset<span class="o">/</span><span class="mf">1000.</span></td></tr><tr><th id="L961"><a href="isis_instrument_RKH.py.html#L961">961</a></th><td>            z_new <span class="o">=</span> det_z <span class="o">+</span> monitor_4_offset</td></tr><tr><th id="L962"><a href="isis_instrument_RKH.py.html#L962">962</a></th><td>            z_move <span class="o">=</span> z_new <span class="o">-</span> z_orig</td></tr><tr><th id="L963"><a href="isis_instrument_RKH.py.html#L963">963</a></th><td>            MoveInstrumentComponent<span class="p">(</span>Workspace<span class="o">=</span>ws<span class="p">,</span>ComponentName<span class="o">=</span> component<span class="p">,</span> Z<span class="o">=</span>z_move<span class="p">,</span></td></tr><tr><th id="L964"><a href="isis_instrument_RKH.py.html#L964">964</a></th><td>                                    RelativePosition<span class="o">=</span><span class="bp">True</span><span class="p">)</span></td></tr><tr><th id="L965"><a href="isis_instrument_RKH.py.html#L965">965</a></th><td>            sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">'Monitor 4 is at z = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>z_new<span class="p">)</span> <span class="p">)</span></td></tr><tr><th id="L966"><a href="isis_instrument_RKH.py.html#L966">966</a></th><td></td></tr><tr><th id="L967"><a href="isis_instrument_RKH.py.html#L967">967</a></th><td>        <span class="c"># Are these returned values used anywhere?</span></td></tr><tr><th id="L968"><a href="isis_instrument_RKH.py.html#L968">968</a></th><td>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">()</span> <span class="o">==</span> <span class="s">'front-detector'</span><span class="p">:</span></td></tr><tr><th id="L969"><a href="isis_instrument_RKH.py.html#L969">969</a></th><td>            beam_cen <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span></td></tr><tr><th id="L970"><a href="isis_instrument_RKH.py.html#L970">970</a></th><td>            det_cen <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span></td></tr><tr><th id="L971"><a href="isis_instrument_RKH.py.html#L971">971</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L972"><a href="isis_instrument_RKH.py.html#L972">972</a></th><td>            beam_cen <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span></td></tr><tr><th id="L973"><a href="isis_instrument_RKH.py.html#L973">973</a></th><td>            det_cen <span class="o">=</span> <span class="p">[</span><span class="o">-</span>xbeam<span class="p">,</span> <span class="o">-</span>ybeam<span class="p">]</span></td></tr><tr><th id="L974"><a href="isis_instrument_RKH.py.html#L974">974</a></th><td></td></tr><tr><th id="L975"><a href="isis_instrument_RKH.py.html#L975">975</a></th><td>        <span class="k">return</span> beam_cen<span class="p">,</span> det_cen</td></tr><tr><th id="L976"><a href="isis_instrument_RKH.py.html#L976">976</a></th><td></td></tr><tr><th id="L977"><a href="isis_instrument_RKH.py.html#L977">977</a></th><td>    <span class="k">def</span> <span class="nf">get_detector_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> wksp<span class="p">):</span></td></tr><tr><th id="L978"><a href="isis_instrument_RKH.py.html#L978">978</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L979"><a href="isis_instrument_RKH.py.html#L979">979</a></th><td><span class="sd">            Reads information about the state of the instrument on the information</span></td></tr><tr><th id="L980"><a href="isis_instrument_RKH.py.html#L980">980</a></th><td><span class="sd">            stored in the sample</span></td></tr><tr><th id="L981"><a href="isis_instrument_RKH.py.html#L981">981</a></th><td><span class="sd">            @param logs: a workspace pointer</span></td></tr><tr><th id="L982"><a href="isis_instrument_RKH.py.html#L982">982</a></th><td><span class="sd">            @return the values that were read as a dictionary</span></td></tr><tr><th id="L983"><a href="isis_instrument_RKH.py.html#L983">983</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L984"><a href="isis_instrument_RKH.py.html#L984">984</a></th><td>        <span class="bp">self</span><span class="o">.</span>_marked_dets <span class="o">=</span> <span class="p">[]</span></td></tr><tr><th id="L985"><a href="isis_instrument_RKH.py.html#L985">985</a></th><td>        wksp <span class="o">=</span> su<span class="o">.</span>getWorkspaceReference<span class="p">(</span>wksp<span class="p">)</span></td></tr><tr><th id="L986"><a href="isis_instrument_RKH.py.html#L986">986</a></th><td>        <span class="c">#assume complete log information is stored in the first entry, it isn't stored in the group workspace itself</span></td></tr><tr><th id="L987"><a href="isis_instrument_RKH.py.html#L987">987</a></th><td>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>wksp<span class="p">,</span> WorkspaceGroup<span class="p">):</span></td></tr><tr><th id="L988"><a href="isis_instrument_RKH.py.html#L988">988</a></th><td>            wksp <span class="o">=</span> wksp<span class="p">[</span><span class="mi">0</span><span class="p">]</span></td></tr><tr><th id="L989"><a href="isis_instrument_RKH.py.html#L989">989</a></th><td></td></tr><tr><th id="L990"><a href="isis_instrument_RKH.py.html#L990">990</a></th><td>        samp <span class="o">=</span> wksp<span class="o">.</span>getRun<span class="p">()</span></td></tr><tr><th id="L991"><a href="isis_instrument_RKH.py.html#L991">991</a></th><td></td></tr><tr><th id="L992"><a href="isis_instrument_RKH.py.html#L992">992</a></th><td>        logvalues <span class="o">=</span> <span class="p">{}</span></td></tr><tr><th id="L993"><a href="isis_instrument_RKH.py.html#L993">993</a></th><td>        logvalues<span class="p">[</span><span class="s">'Front_Det_Z'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_get_const_num<span class="p">(</span>samp<span class="p">,</span> <span class="s">'Front_Det_Z'</span><span class="p">)</span></td></tr><tr><th id="L994"><a href="isis_instrument_RKH.py.html#L994">994</a></th><td>        logvalues<span class="p">[</span><span class="s">'Front_Det_X'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_get_const_num<span class="p">(</span>samp<span class="p">,</span> <span class="s">'Front_Det_X'</span><span class="p">)</span></td></tr><tr><th id="L995"><a href="isis_instrument_RKH.py.html#L995">995</a></th><td>        logvalues<span class="p">[</span><span class="s">'Front_Det_Rot'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_get_const_num<span class="p">(</span>samp<span class="p">,</span> <span class="s">'Front_Det_Rot'</span><span class="p">)</span></td></tr><tr><th id="L996"><a href="isis_instrument_RKH.py.html#L996">996</a></th><td>        logvalues<span class="p">[</span><span class="s">'Rear_Det_Z'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_get_const_num<span class="p">(</span>samp<span class="p">,</span> <span class="s">'Rear_Det_Z'</span><span class="p">)</span></td></tr><tr><th id="L997"><a href="isis_instrument_RKH.py.html#L997">997</a></th><td>        logvalues<span class="p">[</span><span class="s">'Rear_Det_X'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>_get_const_num<span class="p">(</span>samp<span class="p">,</span> <span class="s">'Rear_Det_X'</span><span class="p">)</span></td></tr><tr><th id="L998"><a href="isis_instrument_RKH.py.html#L998">998</a></th><td></td></tr><tr><th id="L999"><a href="isis_instrument_RKH.py.html#L999">999</a></th><td>        <span class="k">return</span> logvalues</td></tr><tr><th id="L1000"><a href="isis_instrument_RKH.py.html#L1000">1000</a></th><td></td></tr><tr><th id="L1001"><a href="isis_instrument_RKH.py.html#L1001">1001</a></th><td>    <span class="k">def</span> <span class="nf">_get_const_num</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> log_data<span class="p">,</span> log_name<span class="p">):</span></td></tr><tr><th id="L1002"><a href="isis_instrument_RKH.py.html#L1002">1002</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L1003"><a href="isis_instrument_RKH.py.html#L1003">1003</a></th><td><span class="sd">            Get a the named entry from the log object. If the entry is a</span></td></tr><tr><th id="L1004"><a href="isis_instrument_RKH.py.html#L1004">1004</a></th><td><span class="sd">            time series it's assumed to contain unchanging data and the first</span></td></tr><tr><th id="L1005"><a href="isis_instrument_RKH.py.html#L1005">1005</a></th><td><span class="sd">            value is used. The answer must be convertible to float otherwise</span></td></tr><tr><th id="L1006"><a href="isis_instrument_RKH.py.html#L1006">1006</a></th><td><span class="sd">            this throws.</span></td></tr><tr><th id="L1007"><a href="isis_instrument_RKH.py.html#L1007">1007</a></th><td><span class="sd">            @param log_data: the sample object from a workspace</span></td></tr><tr><th id="L1008"><a href="isis_instrument_RKH.py.html#L1008">1008</a></th><td><span class="sd">            @param log_name: a string with the name of the individual entry to load</span></td></tr><tr><th id="L1009"><a href="isis_instrument_RKH.py.html#L1009">1009</a></th><td><span class="sd">            @return: the floating point number</span></td></tr><tr><th id="L1010"><a href="isis_instrument_RKH.py.html#L1010">1010</a></th><td><span class="sd">            @raise TypeError: if that log entry can't be converted to a float</span></td></tr><tr><th id="L1011"><a href="isis_instrument_RKH.py.html#L1011">1011</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L1012"><a href="isis_instrument_RKH.py.html#L1012">1012</a></th><td>        <span class="k">try</span><span class="p">:</span></td></tr><tr><th id="L1013"><a href="isis_instrument_RKH.py.html#L1013">1013</a></th><td>            <span class="c"># return the log value if it stored as a single number</span></td></tr><tr><th id="L1014"><a href="isis_instrument_RKH.py.html#L1014">1014</a></th><td>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>log_data<span class="o">.</span>getLogData<span class="p">(</span>log_name<span class="p">)</span><span class="o">.</span>value<span class="p">)</span></td></tr><tr><th id="L1015"><a href="isis_instrument_RKH.py.html#L1015">1015</a></th><td>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span></td></tr><tr><th id="L1016"><a href="isis_instrument_RKH.py.html#L1016">1016</a></th><td>            <span class="c"># Python 2.4 doesn't have datetime.strptime...</span></td></tr><tr><th id="L1017"><a href="isis_instrument_RKH.py.html#L1017">1017</a></th><td>            <span class="k">def</span> <span class="nf">format_date</span><span class="p">(</span>date_string<span class="p">,</span> format<span class="p">,</span> date_str_len<span class="p">):</span></td></tr><tr><th id="L1018"><a href="isis_instrument_RKH.py.html#L1018">1018</a></th><td>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>date_string<span class="p">)</span><span class="o">&gt;</span>date_str_len<span class="p">:</span></td></tr><tr><th id="L1019"><a href="isis_instrument_RKH.py.html#L1019">1019</a></th><td>                    date_string <span class="o">=</span> date_string<span class="p">[:</span>date_str_len<span class="p">]</span></td></tr><tr><th id="L1020"><a href="isis_instrument_RKH.py.html#L1020">1020</a></th><td>                <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> datetime</td></tr><tr><th id="L1021"><a href="isis_instrument_RKH.py.html#L1021">1021</a></th><td>                <span class="k">if</span> sys<span class="o">.</span>version_info<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> sys<span class="o">.</span>version_info<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span>  <span class="mi">5</span><span class="p">:</span></td></tr><tr><th id="L1022"><a href="isis_instrument_RKH.py.html#L1022">1022</a></th><td>                    <span class="kn">import</span> <span class="nn">time</span></td></tr><tr><th id="L1023"><a href="isis_instrument_RKH.py.html#L1023">1023</a></th><td>                    <span class="k">return</span> datetime<span class="p">(</span><span class="o">*</span><span class="p">(</span>time<span class="o">.</span>strptime<span class="p">(</span>date_string<span class="p">,</span> format<span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span></td></tr><tr><th id="L1024"><a href="isis_instrument_RKH.py.html#L1024">1024</a></th><td>                <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L1025"><a href="isis_instrument_RKH.py.html#L1025">1025</a></th><td>                    <span class="k">return</span> datetime<span class="o">.</span>strptime<span class="p">(</span>date_string<span class="p">,</span> format<span class="p">)</span></td></tr><tr><th id="L1026"><a href="isis_instrument_RKH.py.html#L1026">1026</a></th><td></td></tr><tr><th id="L1027"><a href="isis_instrument_RKH.py.html#L1027">1027</a></th><td>            <span class="c"># if the value was stored as a time series we have an array here</span></td></tr><tr><th id="L1028"><a href="isis_instrument_RKH.py.html#L1028">1028</a></th><td>            <span class="nb">property</span> <span class="o">=</span> log_data<span class="o">.</span>getLogData<span class="p">(</span>log_name<span class="p">)</span></td></tr><tr><th id="L1029"><a href="isis_instrument_RKH.py.html#L1029">1029</a></th><td></td></tr><tr><th id="L1030"><a href="isis_instrument_RKH.py.html#L1030">1030</a></th><td>            size <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span>value<span class="p">)</span></td></tr><tr><th id="L1031"><a href="isis_instrument_RKH.py.html#L1031">1031</a></th><td>            <span class="k">if</span> size <span class="o">==</span> <span class="mi">1</span><span class="p">:</span></td></tr><tr><th id="L1032"><a href="isis_instrument_RKH.py.html#L1032">1032</a></th><td>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>log_data<span class="o">.</span>getLogData<span class="p">(</span>log_name<span class="p">)</span><span class="o">.</span>value<span class="p">[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L1033"><a href="isis_instrument_RKH.py.html#L1033">1033</a></th><td></td></tr><tr><th id="L1034"><a href="isis_instrument_RKH.py.html#L1034">1034</a></th><td>            start <span class="o">=</span> log_data<span class="o">.</span>getLogData<span class="p">(</span><span class="s">'run_start'</span><span class="p">)</span></td></tr><tr><th id="L1035"><a href="isis_instrument_RKH.py.html#L1035">1035</a></th><td>            dt_0 <span class="o">=</span> format_date<span class="p">(</span>start<span class="o">.</span>value<span class="p">,</span><span class="s">"%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S"</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span></td></tr><tr><th id="L1036"><a href="isis_instrument_RKH.py.html#L1036">1036</a></th><td>            <span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> size<span class="p">):</span></td></tr><tr><th id="L1037"><a href="isis_instrument_RKH.py.html#L1037">1037</a></th><td>                dt <span class="o">=</span> format_date<span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">property</span><span class="o">.</span>times<span class="p">[</span>i<span class="p">]),</span><span class="s">"%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S"</span><span class="p">,</span><span class="mi">19</span><span class="p">)</span></td></tr><tr><th id="L1038"><a href="isis_instrument_RKH.py.html#L1038">1038</a></th><td>                <span class="k">if</span> dt <span class="o">&gt;</span> dt_0<span class="p">:</span></td></tr><tr><th id="L1039"><a href="isis_instrument_RKH.py.html#L1039">1039</a></th><td>                    <span class="k">if</span> i <span class="o">==</span> <span class="mi">0</span><span class="p">:</span></td></tr><tr><th id="L1040"><a href="isis_instrument_RKH.py.html#L1040">1040</a></th><td>                        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>log_data<span class="o">.</span>getLogData<span class="p">(</span>log_name<span class="p">)</span><span class="o">.</span>value<span class="p">[</span><span class="mi">0</span><span class="p">])</span></td></tr><tr><th id="L1041"><a href="isis_instrument_RKH.py.html#L1041">1041</a></th><td>                    <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L1042"><a href="isis_instrument_RKH.py.html#L1042">1042</a></th><td>                        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>log_data<span class="o">.</span>getLogData<span class="p">(</span>log_name<span class="p">)</span><span class="o">.</span>value<span class="p">[</span>i<span class="o">-</span><span class="mi">1</span><span class="p">])</span></td></tr><tr><th id="L1043"><a href="isis_instrument_RKH.py.html#L1043">1043</a></th><td></td></tr><tr><th id="L1044"><a href="isis_instrument_RKH.py.html#L1044">1044</a></th><td>            <span class="c"># this gets executed if all entries is before the start-time</span></td></tr><tr><th id="L1045"><a href="isis_instrument_RKH.py.html#L1045">1045</a></th><td>            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span>log_data<span class="o">.</span>getLogData<span class="p">(</span>log_name<span class="p">)</span><span class="o">.</span>value<span class="p">[</span>size<span class="o">-</span><span class="mi">1</span><span class="p">])</span></td></tr><tr><th id="L1046"><a href="isis_instrument_RKH.py.html#L1046">1046</a></th><td></td></tr><tr><th id="L1047"><a href="isis_instrument_RKH.py.html#L1047">1047</a></th><td>    <span class="k">def</span> <span class="nf">apply_detector_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> logvalues<span class="p">):</span></td></tr><tr><th id="L1048"><a href="isis_instrument_RKH.py.html#L1048">1048</a></th><td>        <span class="c">#apply the corrections that came from the logs</span></td></tr><tr><th id="L1049"><a href="isis_instrument_RKH.py.html#L1049">1049</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_Z <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>logvalues<span class="p">[</span><span class="s">'Front_Det_Z'</span><span class="p">])</span></td></tr><tr><th id="L1050"><a href="isis_instrument_RKH.py.html#L1050">1050</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_X <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>logvalues<span class="p">[</span><span class="s">'Front_Det_X'</span><span class="p">])</span></td></tr><tr><th id="L1051"><a href="isis_instrument_RKH.py.html#L1051">1051</a></th><td>        <span class="bp">self</span><span class="o">.</span>FRONT_DET_ROT <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>logvalues<span class="p">[</span><span class="s">'Front_Det_Rot'</span><span class="p">])</span></td></tr><tr><th id="L1052"><a href="isis_instrument_RKH.py.html#L1052">1052</a></th><td>        <span class="bp">self</span><span class="o">.</span>REAR_DET_Z <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>logvalues<span class="p">[</span><span class="s">'Rear_Det_Z'</span><span class="p">])</span></td></tr><tr><th id="L1053"><a href="isis_instrument_RKH.py.html#L1053">1053</a></th><td>        <span class="bp">self</span><span class="o">.</span>REAR_DET_X <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>logvalues<span class="p">[</span><span class="s">'Rear_Det_X'</span><span class="p">])</span></td></tr><tr><th id="L1054"><a href="isis_instrument_RKH.py.html#L1054">1054</a></th><td>        <span class="bp">self</span><span class="o">.</span>corrections_applied <span class="o">=</span> <span class="bp">True</span></td></tr><tr><th id="L1055"><a href="isis_instrument_RKH.py.html#L1055">1055</a></th><td>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span>_can_logs<span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span></td></tr><tr><th id="L1056"><a href="isis_instrument_RKH.py.html#L1056">1056</a></th><td>            <span class="bp">self</span><span class="o">.</span>check_can_logs<span class="p">(</span><span class="bp">self</span><span class="o">.</span>_can_logs<span class="p">)</span></td></tr><tr><th id="L1057"><a href="isis_instrument_RKH.py.html#L1057">1057</a></th><td></td></tr><tr><th id="L1058"><a href="isis_instrument_RKH.py.html#L1058">1058</a></th><td>    <span class="k">def</span> <span class="nf">check_can_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> new_logs<span class="p">):</span></td></tr><tr><th id="L1059"><a href="isis_instrument_RKH.py.html#L1059">1059</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L1060"><a href="isis_instrument_RKH.py.html#L1060">1060</a></th><td><span class="sd">            Tests if applying the corrections from the passed logvalues</span></td></tr><tr><th id="L1061"><a href="isis_instrument_RKH.py.html#L1061">1061</a></th><td><span class="sd">            would give the same result as the corrections that were</span></td></tr><tr><th id="L1062"><a href="isis_instrument_RKH.py.html#L1062">1062</a></th><td><span class="sd">            already made</span></td></tr><tr><th id="L1063"><a href="isis_instrument_RKH.py.html#L1063">1063</a></th><td><span class="sd">            @param new_logs: the new values to check are equivalent</span></td></tr><tr><th id="L1064"><a href="isis_instrument_RKH.py.html#L1064">1064</a></th><td><span class="sd">            @return: True if the are the same False if not</span></td></tr><tr><th id="L1065"><a href="isis_instrument_RKH.py.html#L1065">1065</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L1066"><a href="isis_instrument_RKH.py.html#L1066">1066</a></th><td>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span>corrections_applied<span class="p">:</span></td></tr><tr><th id="L1067"><a href="isis_instrument_RKH.py.html#L1067">1067</a></th><td>            <span class="c">#the check needs to wait until there's something to compare against</span></td></tr><tr><th id="L1068"><a href="isis_instrument_RKH.py.html#L1068">1068</a></th><td>            <span class="bp">self</span><span class="o">.</span>_can_logs <span class="o">=</span> new_logs</td></tr><tr><th id="L1069"><a href="isis_instrument_RKH.py.html#L1069">1069</a></th><td></td></tr><tr><th id="L1070"><a href="isis_instrument_RKH.py.html#L1070">1070</a></th><td>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>new_logs<span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span></td></tr><tr><th id="L1071"><a href="isis_instrument_RKH.py.html#L1071">1071</a></th><td>            <span class="k">return</span> <span class="bp">False</span></td></tr><tr><th id="L1072"><a href="isis_instrument_RKH.py.html#L1072">1072</a></th><td></td></tr><tr><th id="L1073"><a href="isis_instrument_RKH.py.html#L1073">1073</a></th><td>        existing_values <span class="o">=</span> <span class="p">[]</span></td></tr><tr><th id="L1074"><a href="isis_instrument_RKH.py.html#L1074">1074</a></th><td>        existing_values<span class="o">.</span>append<span class="p">(</span><span class="bp">self</span><span class="o">.</span>FRONT_DET_Z<span class="p">)</span></td></tr><tr><th id="L1075"><a href="isis_instrument_RKH.py.html#L1075">1075</a></th><td>        existing_values<span class="o">.</span>append<span class="p">(</span><span class="bp">self</span><span class="o">.</span>FRONT_DET_X<span class="p">)</span></td></tr><tr><th id="L1076"><a href="isis_instrument_RKH.py.html#L1076">1076</a></th><td>        existing_values<span class="o">.</span>append<span class="p">(</span><span class="bp">self</span><span class="o">.</span>FRONT_DET_ROT<span class="p">)</span></td></tr><tr><th id="L1077"><a href="isis_instrument_RKH.py.html#L1077">1077</a></th><td>        existing_values<span class="o">.</span>append<span class="p">(</span><span class="bp">self</span><span class="o">.</span>REAR_DET_Z<span class="p">)</span></td></tr><tr><th id="L1078"><a href="isis_instrument_RKH.py.html#L1078">1078</a></th><td>        existing_values<span class="o">.</span>append<span class="p">(</span><span class="bp">self</span><span class="o">.</span>REAR_DET_X<span class="p">)</span></td></tr><tr><th id="L1079"><a href="isis_instrument_RKH.py.html#L1079">1079</a></th><td></td></tr><tr><th id="L1080"><a href="isis_instrument_RKH.py.html#L1080">1080</a></th><td>        new_values <span class="o">=</span> <span class="p">[]</span></td></tr><tr><th id="L1081"><a href="isis_instrument_RKH.py.html#L1081">1081</a></th><td>        new_values<span class="o">.</span>append<span class="p">(</span><span class="nb">float</span><span class="p">(</span>new_logs<span class="p">[</span><span class="s">'Front_Det_Z'</span><span class="p">]))</span></td></tr><tr><th id="L1082"><a href="isis_instrument_RKH.py.html#L1082">1082</a></th><td>        new_values<span class="o">.</span>append<span class="p">(</span><span class="nb">float</span><span class="p">(</span>new_logs<span class="p">[</span><span class="s">'Front_Det_X'</span><span class="p">]))</span></td></tr><tr><th id="L1083"><a href="isis_instrument_RKH.py.html#L1083">1083</a></th><td>        new_values<span class="o">.</span>append<span class="p">(</span><span class="nb">float</span><span class="p">(</span>new_logs<span class="p">[</span><span class="s">'Front_Det_Rot'</span><span class="p">]))</span></td></tr><tr><th id="L1084"><a href="isis_instrument_RKH.py.html#L1084">1084</a></th><td>        new_values<span class="o">.</span>append<span class="p">(</span><span class="nb">float</span><span class="p">(</span>new_logs<span class="p">[</span><span class="s">'Rear_Det_Z'</span><span class="p">]))</span></td></tr><tr><th id="L1085"><a href="isis_instrument_RKH.py.html#L1085">1085</a></th><td>        new_values<span class="o">.</span>append<span class="p">(</span><span class="nb">float</span><span class="p">(</span>new_logs<span class="p">[</span><span class="s">'Rear_Det_X'</span><span class="p">]))</span></td></tr><tr><th id="L1086"><a href="isis_instrument_RKH.py.html#L1086">1086</a></th><td></td></tr><tr><th id="L1087"><a href="isis_instrument_RKH.py.html#L1087">1087</a></th><td>        errors <span class="o">=</span> <span class="mi">0</span></td></tr><tr><th id="L1088"><a href="isis_instrument_RKH.py.html#L1088">1088</a></th><td>        corr_names <span class="o">=</span> <span class="p">[</span><span class="s">'Front_Det_Z'</span><span class="p">,</span> <span class="s">'Front_Det_X'</span><span class="p">,</span><span class="s">'Front_Det_Rot'</span><span class="p">,</span> <span class="s">'Rear_Det_Z'</span><span class="p">,</span> <span class="s">'Rear_Det_X'</span><span class="p">]</span></td></tr><tr><th id="L1089"><a href="isis_instrument_RKH.py.html#L1089">1089</a></th><td>        <span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span>existing_values<span class="p">)):</span></td></tr><tr><th id="L1090"><a href="isis_instrument_RKH.py.html#L1090">1090</a></th><td>            <span class="k">if</span> math<span class="o">.</span>fabs<span class="p">(</span>existing_values<span class="p">[</span>i<span class="p">]</span> <span class="o">-</span> new_values<span class="p">[</span>i<span class="p">])</span> <span class="o">&gt;</span> <span class="mf">5e-04</span><span class="p">:</span></td></tr><tr><th id="L1091"><a href="isis_instrument_RKH.py.html#L1091">1091</a></th><td>                sanslog<span class="o">.</span>warning<span class="p">(</span><span class="s">'values differ between sample and can runs: Sample '</span> <span class="o">+</span> corr_names<span class="p">[</span>i<span class="p">]</span> <span class="o">+</span> <span class="s">' = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>existing_values<span class="p">[</span>i<span class="p">])</span> <span class="o">+</span> \</td></tr><tr><th id="L1092"><a href="isis_instrument_RKH.py.html#L1092">1092</a></th><td>                    <span class="s">', can value is '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>new_values<span class="p">[</span>i<span class="p">]))</span></td></tr><tr><th id="L1093"><a href="isis_instrument_RKH.py.html#L1093">1093</a></th><td>                errors <span class="o">+=</span> <span class="mi">1</span></td></tr><tr><th id="L1094"><a href="isis_instrument_RKH.py.html#L1094">1094</a></th><td></td></tr><tr><th id="L1095"><a href="isis_instrument_RKH.py.html#L1095">1095</a></th><td>                <span class="bp">self</span><span class="o">.</span>append_marked<span class="p">(</span>corr_names<span class="p">[</span>i<span class="p">])</span></td></tr><tr><th id="L1096"><a href="isis_instrument_RKH.py.html#L1096">1096</a></th><td></td></tr><tr><th id="L1097"><a href="isis_instrument_RKH.py.html#L1097">1097</a></th><td>        <span class="c">#the check has been done clear up</span></td></tr><tr><th id="L1098"><a href="isis_instrument_RKH.py.html#L1098">1098</a></th><td>        <span class="bp">self</span><span class="o">.</span>_can_logs <span class="o">=</span> <span class="p">{}</span></td></tr><tr><th id="L1099"><a href="isis_instrument_RKH.py.html#L1099">1099</a></th><td></td></tr><tr><th id="L1100"><a href="isis_instrument_RKH.py.html#L1100">1100</a></th><td>        <span class="k">return</span> errors <span class="o">==</span> <span class="mi">0</span></td></tr><tr><th id="L1101"><a href="isis_instrument_RKH.py.html#L1101">1101</a></th><td></td></tr><tr><th id="L1102"><a href="isis_instrument_RKH.py.html#L1102">1102</a></th><td>    <span class="k">def</span> <span class="nf">append_marked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> detNames<span class="p">):</span></td></tr><tr><th id="L1103"><a href="isis_instrument_RKH.py.html#L1103">1103</a></th><td>        <span class="bp">self</span><span class="o">.</span>_marked_dets<span class="o">.</span>append<span class="p">(</span>detNames<span class="p">)</span></td></tr><tr><th id="L1104"><a href="isis_instrument_RKH.py.html#L1104">1104</a></th><td></td></tr><tr><th id="L1105"><a href="isis_instrument_RKH.py.html#L1105">1105</a></th><td>    <span class="k">def</span> <span class="nf">get_marked_dets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L1106"><a href="isis_instrument_RKH.py.html#L1106">1106</a></th><td>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span>_marked_dets</td></tr><tr><th id="L1107"><a href="isis_instrument_RKH.py.html#L1107">1107</a></th><td></td></tr><tr><th id="L1108"><a href="isis_instrument_RKH.py.html#L1108">1108</a></th><td>    <span class="k">def</span> <span class="nf">load_transmission_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_trans<span class="p">,</span> ws_direct<span class="p">,</span> beamcentre<span class="p">):</span></td></tr><tr><th id="L1109"><a href="isis_instrument_RKH.py.html#L1109">1109</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L1110"><a href="isis_instrument_RKH.py.html#L1110">1110</a></th><td><span class="sd">        SANS2D requires the centralize the detectors of the transmission</span></td></tr><tr><th id="L1111"><a href="isis_instrument_RKH.py.html#L1111">1111</a></th><td><span class="sd">        as well as the sample and can.</span></td></tr><tr><th id="L1112"><a href="isis_instrument_RKH.py.html#L1112">1112</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L1113"><a href="isis_instrument_RKH.py.html#L1113">1113</a></th><td>        <span class="bp">self</span><span class="o">.</span>move_components<span class="p">(</span>ws_trans<span class="p">,</span> beamcentre<span class="p">[</span><span class="mi">0</span><span class="p">],</span> beamcentre<span class="p">[</span><span class="mi">1</span><span class="p">])</span></td></tr><tr><th id="L1114"><a href="isis_instrument_RKH.py.html#L1114">1114</a></th><td>        <span class="k">if</span> ws_trans <span class="o">!=</span> ws_direct<span class="p">:</span></td></tr><tr><th id="L1115"><a href="isis_instrument_RKH.py.html#L1115">1115</a></th><td>            <span class="bp">self</span><span class="o">.</span>move_components<span class="p">(</span>ws_direct<span class="p">,</span> beamcentre<span class="p">[</span><span class="mi">0</span><span class="p">],</span> beamcentre<span class="p">[</span><span class="mi">1</span><span class="p">])</span></td></tr><tr><th id="L1116"><a href="isis_instrument_RKH.py.html#L1116">1116</a></th><td></td></tr><tr><th id="L1117"><a href="isis_instrument_RKH.py.html#L1117">1117</a></th><td></td></tr><tr><th id="L1118"><a href="isis_instrument_RKH.py.html#L1118">1118</a></th><td>    <span class="k">def</span> <span class="nf">cur_detector_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">):</span></td></tr><tr><th id="L1119"><a href="isis_instrument_RKH.py.html#L1119">1119</a></th><td>        <span class="sd">"""Return the position of the center of the detector bank"""</span></td></tr><tr><th id="L1120"><a href="isis_instrument_RKH.py.html#L1120">1120</a></th><td>        ws <span class="o">=</span> mtd<span class="p">[</span>ws_name<span class="p">]</span></td></tr><tr><th id="L1121"><a href="isis_instrument_RKH.py.html#L1121">1121</a></th><td>        pos <span class="o">=</span> ws<span class="o">.</span>getInstrument<span class="p">()</span><span class="o">.</span>getComponentByName<span class="p">(</span><span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">())</span><span class="o">.</span>getPos<span class="p">()</span></td></tr><tr><th id="L1122"><a href="isis_instrument_RKH.py.html#L1122">1122</a></th><td></td></tr><tr><th id="L1123"><a href="isis_instrument_RKH.py.html#L1123">1123</a></th><td>        <span class="k">return</span> <span class="p">[</span><span class="o">-</span>pos<span class="o">.</span>getX<span class="p">(),</span> <span class="o">-</span>pos<span class="o">.</span>getY<span class="p">()]</span></td></tr><tr><th id="L1124"><a href="isis_instrument_RKH.py.html#L1124">1124</a></th><td></td></tr><tr><th id="L1125"><a href="isis_instrument_RKH.py.html#L1125">1125</a></th><td>    <span class="k">def</span> <span class="nf">on_load_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">,</span> beamcentre<span class="p">,</span> isSample<span class="p">):</span></td></tr><tr><th id="L1126"><a href="isis_instrument_RKH.py.html#L1126">1126</a></th><td>        <span class="sd">"""For SANS2D in addition of the operations defines in on_load_sample of ISISInstrument</span></td></tr><tr><th id="L1127"><a href="isis_instrument_RKH.py.html#L1127">1127</a></th><td><span class="sd">        it has to deal with the log, which defines some offsets for the movement of the</span></td></tr><tr><th id="L1128"><a href="isis_instrument_RKH.py.html#L1128">1128</a></th><td><span class="sd">        detector bank.</span></td></tr><tr><th id="L1129"><a href="isis_instrument_RKH.py.html#L1129">1129</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L1130"><a href="isis_instrument_RKH.py.html#L1130">1130</a></th><td>        ws_ref <span class="o">=</span> mtd<span class="p">[</span><span class="nb">str</span><span class="p">(</span>ws_name<span class="p">)]</span></td></tr><tr><th id="L1131"><a href="isis_instrument_RKH.py.html#L1131">1131</a></th><td>        <span class="k">try</span><span class="p">:</span></td></tr><tr><th id="L1132"><a href="isis_instrument_RKH.py.html#L1132">1132</a></th><td>            log <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>get_detector_log<span class="p">(</span>ws_ref<span class="p">)</span></td></tr><tr><th id="L1133"><a href="isis_instrument_RKH.py.html#L1133">1133</a></th><td>            <span class="k">if</span> log <span class="o">==</span> <span class="s">""</span><span class="p">:</span></td></tr><tr><th id="L1134"><a href="isis_instrument_RKH.py.html#L1134">1134</a></th><td>                <span class="k">raise</span> <span class="s">"Invalid log"</span></td></tr><tr><th id="L1135"><a href="isis_instrument_RKH.py.html#L1135">1135</a></th><td>        <span class="k">except</span><span class="p">:</span></td></tr><tr><th id="L1136"><a href="isis_instrument_RKH.py.html#L1136">1136</a></th><td>            <span class="k">if</span> isSample<span class="p">:</span></td></tr><tr><th id="L1137"><a href="isis_instrument_RKH.py.html#L1137">1137</a></th><td>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">'Sample logs cannot be loaded, cannot continue'</span><span class="p">)</span></td></tr><tr><th id="L1138"><a href="isis_instrument_RKH.py.html#L1138">1138</a></th><td>            <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L1139"><a href="isis_instrument_RKH.py.html#L1139">1139</a></th><td>                logger<span class="o">.</span>warning<span class="p">(</span><span class="s">"Can logs could not be loaded, using sample values."</span><span class="p">)</span></td></tr><tr><th id="L1140"><a href="isis_instrument_RKH.py.html#L1140">1140</a></th><td></td></tr><tr><th id="L1141"><a href="isis_instrument_RKH.py.html#L1141">1141</a></th><td></td></tr><tr><th id="L1142"><a href="isis_instrument_RKH.py.html#L1142">1142</a></th><td>        <span class="k">if</span> isSample<span class="p">:</span></td></tr><tr><th id="L1143"><a href="isis_instrument_RKH.py.html#L1143">1143</a></th><td>            <span class="bp">self</span><span class="o">.</span>apply_detector_logs<span class="p">(</span>log<span class="p">)</span></td></tr><tr><th id="L1144"><a href="isis_instrument_RKH.py.html#L1144">1144</a></th><td>        <span class="k">else</span><span class="p">:</span></td></tr><tr><th id="L1145"><a href="isis_instrument_RKH.py.html#L1145">1145</a></th><td>            <span class="bp">self</span><span class="o">.</span>check_can_logs<span class="p">(</span>log<span class="p">)</span></td></tr><tr><th id="L1146"><a href="isis_instrument_RKH.py.html#L1146">1146</a></th><td></td></tr><tr><th id="L1147"><a href="isis_instrument_RKH.py.html#L1147">1147</a></th><td></td></tr><tr><th id="L1148"><a href="isis_instrument_RKH.py.html#L1148">1148</a></th><td>        ISISInstrument<span class="o">.</span>on_load_sample<span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">,</span> beamcentre<span class="p">,</span>  isSample<span class="p">)</span></td></tr><tr><th id="L1149"><a href="isis_instrument_RKH.py.html#L1149">1149</a></th><td></td></tr><tr><th id="L1150"><a href="isis_instrument_RKH.py.html#L1150">1150</a></th><td></td></tr><tr><th id="L1151"><a href="isis_instrument_RKH.py.html#L1151">1151</a></th><td><span class="k">class</span> <span class="nc">LARMOR</span><span class="p">(</span>ISISInstrument<span class="p">):</span></td></tr><tr><th id="L1152"><a href="isis_instrument_RKH.py.html#L1152">1152</a></th><td>    _NAME <span class="o">=</span> <span class="s">'LARMOR'</span></td></tr><tr><th id="L1153"><a href="isis_instrument_RKH.py.html#L1153">1153</a></th><td>    WAV_RANGE_MIN <span class="o">=</span> <span class="mf">2.2</span></td></tr><tr><th id="L1154"><a href="isis_instrument_RKH.py.html#L1154">1154</a></th><td>    WAV_RANGE_MAX <span class="o">=</span> <span class="mf">10.0</span></td></tr><tr><th id="L1155"><a href="isis_instrument_RKH.py.html#L1155">1155</a></th><td>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L1156"><a href="isis_instrument_RKH.py.html#L1156">1156</a></th><td>        <span class="nb">super</span><span class="p">(</span>LARMOR<span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span>__init__<span class="p">(</span><span class="s">'LARMOR_Definition.xml'</span><span class="p">)</span></td></tr><tr><th id="L1157"><a href="isis_instrument_RKH.py.html#L1157">1157</a></th><td>        <span class="bp">self</span><span class="o">.</span>monitor_names <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></td></tr><tr><th id="L1158"><a href="isis_instrument_RKH.py.html#L1158">1158</a></th><td></td></tr><tr><th id="L1159"><a href="isis_instrument_RKH.py.html#L1159">1159</a></th><td>        <span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span></td></tr><tr><th id="L1160"><a href="isis_instrument_RKH.py.html#L1160">1160</a></th><td>            <span class="bp">self</span><span class="o">.</span>monitor_names<span class="p">[</span>i<span class="p">]</span> <span class="o">=</span> <span class="s">'monitor'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>i<span class="p">)</span></td></tr><tr><th id="L1161"><a href="isis_instrument_RKH.py.html#L1161">1161</a></th><td></td></tr><tr><th id="L1162"><a href="isis_instrument_RKH.py.html#L1162">1162</a></th><td>    <span class="k">def</span> <span class="nf">set_up_for_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> base_runno<span class="p">):</span></td></tr><tr><th id="L1163"><a href="isis_instrument_RKH.py.html#L1163">1163</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L1164"><a href="isis_instrument_RKH.py.html#L1164">1164</a></th><td><span class="sd">            Needs to run whenever a sample is loaded</span></td></tr><tr><th id="L1165"><a href="isis_instrument_RKH.py.html#L1165">1165</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L1166"><a href="isis_instrument_RKH.py.html#L1166">1166</a></th><td>        first <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'low-angle'</span><span class="p">]</span></td></tr><tr><th id="L1167"><a href="isis_instrument_RKH.py.html#L1167">1167</a></th><td>        second <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span></td></tr><tr><th id="L1168"><a href="isis_instrument_RKH.py.html#L1168">1168</a></th><td></td></tr><tr><th id="L1169"><a href="isis_instrument_RKH.py.html#L1169">1169</a></th><td>        first<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L1170"><a href="isis_instrument_RKH.py.html#L1170">1170</a></th><td>        first<span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">10</span><span class="p">)</span></td></tr><tr><th id="L1171"><a href="isis_instrument_RKH.py.html#L1171">1171</a></th><td>        second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L1172"><a href="isis_instrument_RKH.py.html#L1172">1172</a></th><td>        second<span class="o">.</span>place_after<span class="p">(</span>first<span class="p">)</span></td></tr><tr><th id="L1173"><a href="isis_instrument_RKH.py.html#L1173">1173</a></th><td></td></tr><tr><th id="L1174"><a href="isis_instrument_RKH.py.html#L1174">1174</a></th><td>    <span class="k">def</span> <span class="nf">move_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws<span class="p">,</span> xbeam<span class="p">,</span> ybeam<span class="p">):</span></td></tr><tr><th id="L1175"><a href="isis_instrument_RKH.py.html#L1175">1175</a></th><td>        <span class="bp">self</span><span class="o">.</span>move_all_components<span class="p">(</span>ws<span class="p">)</span></td></tr><tr><th id="L1176"><a href="isis_instrument_RKH.py.html#L1176">1176</a></th><td></td></tr><tr><th id="L1177"><a href="isis_instrument_RKH.py.html#L1177">1177</a></th><td>        detBanch <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'rear'</span><span class="p">)</span></td></tr><tr><th id="L1178"><a href="isis_instrument_RKH.py.html#L1178">1178</a></th><td></td></tr><tr><th id="L1179"><a href="isis_instrument_RKH.py.html#L1179">1179</a></th><td>        xshift <span class="o">=</span> <span class="o">-</span>xbeam</td></tr><tr><th id="L1180"><a href="isis_instrument_RKH.py.html#L1180">1180</a></th><td>        yshift <span class="o">=</span> <span class="o">-</span>ybeam</td></tr><tr><th id="L1181"><a href="isis_instrument_RKH.py.html#L1181">1181</a></th><td>        <span class="c">#zshift = ( detBanch.z_corr)/1000.</span></td></tr><tr><th id="L1182"><a href="isis_instrument_RKH.py.html#L1182">1182</a></th><td>        <span class="c">#zshift -= self.REAR_DET_DEFAULT_SD_M</span></td></tr><tr><th id="L1183"><a href="isis_instrument_RKH.py.html#L1183">1183</a></th><td>        zshift <span class="o">=</span> <span class="mi">0</span></td></tr><tr><th id="L1184"><a href="isis_instrument_RKH.py.html#L1184">1184</a></th><td>        sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">"Setup move "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>xshift<span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>yshift<span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>zshift<span class="o">*</span><span class="mi">1000</span><span class="p">))</span></td></tr><tr><th id="L1185"><a href="isis_instrument_RKH.py.html#L1185">1185</a></th><td>        MoveInstrumentComponent<span class="p">(</span>ws<span class="p">,</span> ComponentName<span class="o">=</span>detBanch<span class="o">.</span>name<span class="p">(),</span> X<span class="o">=</span>xshift<span class="p">,</span></td></tr><tr><th id="L1186"><a href="isis_instrument_RKH.py.html#L1186">1186</a></th><td>                                Y<span class="o">=</span>yshift<span class="p">,</span> Z<span class="o">=</span>zshift<span class="p">)</span></td></tr><tr><th id="L1187"><a href="isis_instrument_RKH.py.html#L1187">1187</a></th><td>        <span class="c"># beam centre, translation</span></td></tr><tr><th id="L1188"><a href="isis_instrument_RKH.py.html#L1188">1188</a></th><td>        <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span>xbeam<span class="p">,</span> <span class="o">-</span>ybeam<span class="p">]</span></td></tr><tr><th id="L1189"><a href="isis_instrument_RKH.py.html#L1189">1189</a></th><td></td></tr><tr><th id="L1190"><a href="isis_instrument_RKH.py.html#L1190">1190</a></th><td>    <span class="k">def</span> <span class="nf">cur_detector_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">):</span></td></tr><tr><th id="L1191"><a href="isis_instrument_RKH.py.html#L1191">1191</a></th><td>        <span class="sd">"""Return the position of the center of the detector bank"""</span></td></tr><tr><th id="L1192"><a href="isis_instrument_RKH.py.html#L1192">1192</a></th><td>        ws <span class="o">=</span> mtd<span class="p">[</span>ws_name<span class="p">]</span></td></tr><tr><th id="L1193"><a href="isis_instrument_RKH.py.html#L1193">1193</a></th><td>        pos <span class="o">=</span> ws<span class="o">.</span>getInstrument<span class="p">()</span><span class="o">.</span>getComponentByName<span class="p">(</span><span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">())</span><span class="o">.</span>getPos<span class="p">()</span></td></tr><tr><th id="L1194"><a href="isis_instrument_RKH.py.html#L1194">1194</a></th><td></td></tr><tr><th id="L1195"><a href="isis_instrument_RKH.py.html#L1195">1195</a></th><td>        <span class="k">return</span> <span class="p">[</span><span class="o">-</span>pos<span class="o">.</span>getX<span class="p">(),</span> <span class="o">-</span>pos<span class="o">.</span>getY<span class="p">()]</span></td></tr><tr><th id="L1196"><a href="isis_instrument_RKH.py.html#L1196">1196</a></th><td></td></tr><tr><th id="L1197"><a href="isis_instrument_RKH.py.html#L1197">1197</a></th><td><span class="k">class</span> <span class="nc">LARMOR</span><span class="p">(</span>ISISInstrument<span class="p">):</span></td></tr><tr><th id="L1198"><a href="isis_instrument_RKH.py.html#L1198">1198</a></th><td>    _NAME <span class="o">=</span> <span class="s">'LARMOR'</span></td></tr><tr><th id="L1199"><a href="isis_instrument_RKH.py.html#L1199">1199</a></th><td>    WAV_RANGE_MIN <span class="o">=</span> <span class="mf">2.2</span></td></tr><tr><th id="L1200"><a href="isis_instrument_RKH.py.html#L1200">1200</a></th><td>    WAV_RANGE_MAX <span class="o">=</span> <span class="mf">10.0</span></td></tr><tr><th id="L1201"><a href="isis_instrument_RKH.py.html#L1201">1201</a></th><td>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></td></tr><tr><th id="L1202"><a href="isis_instrument_RKH.py.html#L1202">1202</a></th><td>        <span class="nb">super</span><span class="p">(</span>LARMOR<span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span>__init__<span class="p">(</span><span class="s">'LARMOR_Definition.xml'</span><span class="p">)</span></td></tr><tr><th id="L1203"><a href="isis_instrument_RKH.py.html#L1203">1203</a></th><td>        <span class="bp">self</span><span class="o">.</span>monitor_names <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span></td></tr><tr><th id="L1204"><a href="isis_instrument_RKH.py.html#L1204">1204</a></th><td></td></tr><tr><th id="L1205"><a href="isis_instrument_RKH.py.html#L1205">1205</a></th><td>        <span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span></td></tr><tr><th id="L1206"><a href="isis_instrument_RKH.py.html#L1206">1206</a></th><td>            <span class="bp">self</span><span class="o">.</span>monitor_names<span class="p">[</span>i<span class="p">]</span> <span class="o">=</span> <span class="s">'monitor'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>i<span class="p">)</span></td></tr><tr><th id="L1207"><a href="isis_instrument_RKH.py.html#L1207">1207</a></th><td></td></tr><tr><th id="L1208"><a href="isis_instrument_RKH.py.html#L1208">1208</a></th><td>    <span class="k">def</span> <span class="nf">set_up_for_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> base_runno<span class="p">):</span></td></tr><tr><th id="L1209"><a href="isis_instrument_RKH.py.html#L1209">1209</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L1210"><a href="isis_instrument_RKH.py.html#L1210">1210</a></th><td><span class="sd">            Needs to run whenever a sample is loaded</span></td></tr><tr><th id="L1211"><a href="isis_instrument_RKH.py.html#L1211">1211</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L1212"><a href="isis_instrument_RKH.py.html#L1212">1212</a></th><td>        first <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'low-angle'</span><span class="p">]</span></td></tr><tr><th id="L1213"><a href="isis_instrument_RKH.py.html#L1213">1213</a></th><td>        second <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>DETECTORS<span class="p">[</span><span class="s">'high-angle'</span><span class="p">]</span></td></tr><tr><th id="L1214"><a href="isis_instrument_RKH.py.html#L1214">1214</a></th><td></td></tr><tr><th id="L1215"><a href="isis_instrument_RKH.py.html#L1215">1215</a></th><td>        first<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L1216"><a href="isis_instrument_RKH.py.html#L1216">1216</a></th><td>        first<span class="o">.</span>set_first_spec_num<span class="p">(</span><span class="mi">10</span><span class="p">)</span></td></tr><tr><th id="L1217"><a href="isis_instrument_RKH.py.html#L1217">1217</a></th><td>        second<span class="o">.</span>set_orien<span class="p">(</span><span class="s">'Horizontal'</span><span class="p">)</span></td></tr><tr><th id="L1218"><a href="isis_instrument_RKH.py.html#L1218">1218</a></th><td>        second<span class="o">.</span>place_after<span class="p">(</span>first<span class="p">)</span></td></tr><tr><th id="L1219"><a href="isis_instrument_RKH.py.html#L1219">1219</a></th><td></td></tr><tr><th id="L1220"><a href="isis_instrument_RKH.py.html#L1220">1220</a></th><td>    <span class="k">def</span> <span class="nf">move_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws<span class="p">,</span> xbeam<span class="p">,</span> ybeam<span class="p">):</span></td></tr><tr><th id="L1221"><a href="isis_instrument_RKH.py.html#L1221">1221</a></th><td>        <span class="bp">self</span><span class="o">.</span>move_all_components<span class="p">(</span>ws<span class="p">)</span></td></tr><tr><th id="L1222"><a href="isis_instrument_RKH.py.html#L1222">1222</a></th><td></td></tr><tr><th id="L1223"><a href="isis_instrument_RKH.py.html#L1223">1223</a></th><td>        detBanch <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>getDetector<span class="p">(</span><span class="s">'rear'</span><span class="p">)</span></td></tr><tr><th id="L1224"><a href="isis_instrument_RKH.py.html#L1224">1224</a></th><td></td></tr><tr><th id="L1225"><a href="isis_instrument_RKH.py.html#L1225">1225</a></th><td>        xshift <span class="o">=</span> <span class="o">-</span>xbeam</td></tr><tr><th id="L1226"><a href="isis_instrument_RKH.py.html#L1226">1226</a></th><td>        yshift <span class="o">=</span> <span class="o">-</span>ybeam</td></tr><tr><th id="L1227"><a href="isis_instrument_RKH.py.html#L1227">1227</a></th><td>        <span class="c">#zshift = ( detBanch.z_corr)/1000.</span></td></tr><tr><th id="L1228"><a href="isis_instrument_RKH.py.html#L1228">1228</a></th><td>        <span class="c">#zshift -= self.REAR_DET_DEFAULT_SD_M</span></td></tr><tr><th id="L1229"><a href="isis_instrument_RKH.py.html#L1229">1229</a></th><td>        zshift <span class="o">=</span> <span class="mi">0</span></td></tr><tr><th id="L1230"><a href="isis_instrument_RKH.py.html#L1230">1230</a></th><td>        sanslog<span class="o">.</span>notice<span class="p">(</span><span class="s">"Setup move "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>xshift<span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>yshift<span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>zshift<span class="o">*</span><span class="mi">1000</span><span class="p">))</span></td></tr><tr><th id="L1231"><a href="isis_instrument_RKH.py.html#L1231">1231</a></th><td>        MoveInstrumentComponent<span class="p">(</span>ws<span class="p">,</span> ComponentName<span class="o">=</span>detBanch<span class="o">.</span>name<span class="p">(),</span> X<span class="o">=</span>xshift<span class="p">,</span></td></tr><tr><th id="L1232"><a href="isis_instrument_RKH.py.html#L1232">1232</a></th><td>                                Y<span class="o">=</span>yshift<span class="p">,</span> Z<span class="o">=</span>zshift<span class="p">)</span></td></tr><tr><th id="L1233"><a href="isis_instrument_RKH.py.html#L1233">1233</a></th><td>        <span class="c"># beam centre, translation</span></td></tr><tr><th id="L1234"><a href="isis_instrument_RKH.py.html#L1234">1234</a></th><td>        <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span>xbeam<span class="p">,</span> <span class="o">-</span>ybeam<span class="p">]</span></td></tr><tr><th id="L1235"><a href="isis_instrument_RKH.py.html#L1235">1235</a></th><td></td></tr><tr><th id="L1236"><a href="isis_instrument_RKH.py.html#L1236">1236</a></th><td>    <span class="k">def</span> <span class="nf">load_transmission_inst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_trans<span class="p">,</span> ws_direct<span class="p">,</span> beamcentre<span class="p">):</span></td></tr><tr><th id="L1237"><a href="isis_instrument_RKH.py.html#L1237">1237</a></th><td>        <span class="sd">"""</span></td></tr><tr><th id="L1238"><a href="isis_instrument_RKH.py.html#L1238">1238</a></th><td><span class="sd">            Not required for SANS2D</span></td></tr><tr><th id="L1239"><a href="isis_instrument_RKH.py.html#L1239">1239</a></th><td><span class="sd">        """</span></td></tr><tr><th id="L1240"><a href="isis_instrument_RKH.py.html#L1240">1240</a></th><td>        <span class="k">pass</span></td></tr><tr><th id="L1241"><a href="isis_instrument_RKH.py.html#L1241">1241</a></th><td></td></tr><tr><th id="L1242"><a href="isis_instrument_RKH.py.html#L1242">1242</a></th><td>    <span class="k">def</span> <span class="nf">cur_detector_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> ws_name<span class="p">):</span></td></tr><tr><th id="L1243"><a href="isis_instrument_RKH.py.html#L1243">1243</a></th><td>        <span class="sd">"""Return the position of the center of the detector bank"""</span></td></tr><tr><th id="L1244"><a href="isis_instrument_RKH.py.html#L1244">1244</a></th><td>        ws <span class="o">=</span> mtd<span class="p">[</span>ws_name<span class="p">]</span></td></tr><tr><th id="L1245"><a href="isis_instrument_RKH.py.html#L1245">1245</a></th><td>        pos <span class="o">=</span> ws<span class="o">.</span>getInstrument<span class="p">()</span><span class="o">.</span>getComponentByName<span class="p">(</span><span class="bp">self</span><span class="o">.</span>cur_detector<span class="p">()</span><span class="o">.</span>name<span class="p">())</span><span class="o">.</span>getPos<span class="p">()</span></td></tr><tr><th id="L1246"><a href="isis_instrument_RKH.py.html#L1246">1246</a></th><td></td></tr><tr><th id="L1247"><a href="isis_instrument_RKH.py.html#L1247">1247</a></th><td>        <span class="k">return</span> <span class="p">[</span><span class="o">-</span>pos<span class="o">.</span>getX<span class="p">(),</span> <span class="o">-</span>pos<span class="o">.</span>getY<span class="p">()]</span></td></tr><tr><th id="L1248"><a href="isis_instrument_RKH.py.html#L1248">1248</a></th><td></td></tr><tr><th id="L1249"><a href="isis_instrument_RKH.py.html#L1249">1249</a></th><td></td></tr><tr><th id="L1250"><a href="isis_instrument_RKH.py.html#L1250">1250</a></th><td></td></tr><tr><th id="L1251"><a href="isis_instrument_RKH.py.html#L1251">1251</a></th><td><span class="k">if</span> __name__ <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span></td></tr><tr><th id="L1252"><a href="isis_instrument_RKH.py.html#L1252">1252</a></th><td>    <span class="k">pass</span></td></tr></tbody></table>

        </div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="../../../raw-attachment/ticket/10569/isis_instrument_RKH.py">Original Format</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../../../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>