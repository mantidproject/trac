<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #7785 (Improve SNS live listener behaviour when asking for start of run when we are not in a run)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="7784.html" title="Ticket #7784" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7785?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7785?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7785?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="7786.html" title="Ticket #7786" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 7785, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="7784.html" title="Ticket #7784">Previous Ticket</a></span></li><li><span><a class="next" href="7786.html" title="Ticket #7786">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/7785.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="7785.html">Ticket #7785</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-20T20%3A24%3A24%2B01%3A00&amp;precision=second" title="2013-08-20T20:24:24+01:00 in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A09%3A39%2B01%3A00&amp;precision=second" title="2015-06-04T02:09:39+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Improve SNS live listener behaviour when asking for start of run when we are not in a run</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Russell+Taylor">Russell Taylor</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Russell+Taylor">Russell Taylor</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.0.html">Release 3.0</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;keywords=~LiveData">LiveData</a>
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span><a class="closed ticket" href="7843.html" title="The Step Scan GUI needs to run algorithms asynchronously">#7843</a></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Alex Buts
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
In <a class="closed ticket" href="6661.html" title="enhancement: Enable Live Listener to request data from the start of the run (closed: fixed)">#6661</a>, we decided that if you ask for data from the start of the run when the instrument is not in a run, then the listener would just throw an exception, causing StartLiveData to fail. This is actually pretty unpleasant, especially when using the listener behind some interface other than the StartLiveData one. What would be better is if the listener just waited until a run did start, and then start passing back the events. The reason we didn't do this before is that we didn't want things to just lock up, potentially indefinitely, for the start of a run that never came - since the listener isn't able to check for a cancellation signal.
</p>
<p>
It has occurred to me that we could do this by creating a specific exception type and having the listener throw that in this situation (instead of throwing a general exception type, which just stops the algorithm). LoadLiveData could catch this exception, log it, check for cancellation and then call <tt>extractData()</tt> once again a few seconds later.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="7785.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-29T15%3A22%3A50%2B01%3A00&amp;precision=second" title="2013-08-29T15:22:50+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7785.html" title="enhancement: Improve SNS live listener behaviour when asking for start of run when we ... (closed: fixed)">#7785</a>. A new exception type for use by live listeners.
</p>
<p>
This will allow listeners to pass control back to LoadLiveData rather
than blocking if not ready to return a workspace. This will allow things
like algorithm cancellation. Unlike other exceptions it will not stop
the algorithm.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/303193062a6857ed75c7dfa08fcadc2a5900a796" title="303193062a6857ed75c7dfa08fcadc2a5900a796">303193062a6857ed75c7dfa08fcadc2a5900a796</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="7785.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-29T15%3A22%3A50%2B01%3A00&amp;precision=second" title="2013-08-29T15:22:50+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7785.html" title="enhancement: Improve SNS live listener behaviour when asking for start of run when we ... (closed: fixed)">#7785</a>. The algorithm side of waiting for a run to start.
</p>
<p>
LoadLiveData catches the NotYet exception, logs it and waits 10 seconds
before calling extractData() again. While waiting it listens for user
cancellation of the algorithm.
Listeners can throw this exception to 'pause' things - any other
exception type will stop the algorithm.
LoadLiveData had to be made a 'proper' child of StartLiveData for the
cancellation signal to get through.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/b6566768c52455504592d0d7c03cc6717bd7fff8" title="b6566768c52455504592d0d7c03cc6717bd7fff8">b6566768c52455504592d0d7c03cc6717bd7fff8</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="7785.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-29T15%3A22%3A50%2B01%3A00&amp;precision=second" title="2013-08-29T15:22:50+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7785.html" title="enhancement: Improve SNS live listener behaviour when asking for start of run when we ... (closed: fixed)">#7785</a>. Hooks for testing the use of the NotYet exception.
</p>
<p>
Add a property to have the FakeEventDataListener throw the NotYet
exception a given number of times. This allows testing of the
behaviour on the algorithm side of this work.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/105bd3a7d2b8b01b52cbeec27b81eab2158238ac" title="105bd3a7d2b8b01b52cbeec27b81eab2158238ac">105bd3a7d2b8b01b52cbeec27b81eab2158238ac</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="7785.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-29T15%3A22%3A50%2B01%3A00&amp;precision=second" title="2013-08-29T15:22:50+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7785.html" title="enhancement: Improve SNS live listener behaviour when asking for start of run when we ... (closed: fixed)">#7785</a>. SNS listener throws a NotYet exception when appropriate.
</p>
<p>
In particular, it throws it if data was requested from the start of the
run but the instrument is not in a run. This allows the user to cancel
the algorithm or wait until a run starts, at which point the data will
flow.
It will also throw if the workspace has not been initialized, though
not immediately as experience shows that it can sometimes (SEQUOIA for
example) take some time for the instrument to be loaded.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/11430e0ef79768249f11387ad4a6585359463809" title="11430e0ef79768249f11387ad4a6585359463809">11430e0ef79768249f11387ad4a6585359463809</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="7785.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-29T15%3A26%3A30%2B01%3A00&amp;precision=second" title="2013-08-29T15:26:30+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>7843</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="7785.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-09-09T19%3A21%3A53%2B01%3A00&amp;precision=second" title="2013-09-09T19:21:53+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Tester: The branch is feature/7785_snslistener_out_of_run_behaviour
</p>
<p>
Test by going to Load -&gt; Live Data and choosing 'Start of Run' as the starting time.
</p>
<p>
Real-world functional testing on this could be tricky as it relies on HYSPEC or SEQUOIA not being in a run (look for 'Stopped' as the status at <a class="ext-link" href="https://monitor.sns.gov/dasmon/"><span class="icon">​</span>https://monitor.sns.gov/dasmon/</a>). The other way to test is to use the FakeEventDataListener, adding a property 'fakeeventdatalistener.notyettimes = N' to your Mantid.user.properties, where N is the number of times the listener should say that it's not ready to return data. Make sure that you can cancel the algorithm when you see the message about being 'not ready to return data'. Also make sure data collection does start after the specified number of these messages (or when a real instrument actually does start a run).
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="7785.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-09-13T14%3A50%3A29%2B01%3A00&amp;precision=second" title="2013-09-13T14:50:29+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
It would probably also be wise to check things for ISIS. The steps would be:
</p>
<ul><li>Change default facility to ISIS
</li><li>Start the FakeISISHistoDAE algorithm
</li><li>Start live data collection, using the ISISHistoDataListener
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="7785.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-09-13T16%3A14%3A17%2B01%3A00&amp;precision=second" title="2013-09-13T16:14:17+01:00 in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Alex Buts</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="7785.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-09-16T11%3A27%3A15%2B01%3A00&amp;precision=second" title="2013-09-16T11:27:15+01:00 in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Fake data listener with fakeeventdatalistener.notyettimes works as described. 
</p>
<p>
ISIS histo data listener does not communicate with FakeISISHistoDAE regardless of FakeISISHistoDAE existence failing with error: 
</p>
<p>
Error accessing DAE
DAE is not connected
Error in execution of algorithm LoadLiveData:
DAE is not connected  in 0.0.0.0
Unable to successfully run ChildAlgorithm LoadLiveData
Error in execution of algorithm StartLiveData:
DAE is not connected  in 0.0.0.0
</p>
<p>
As I suspect something wrong in DAE configuration rather then anything else, I am giving this ticket pass. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="7785.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-09-16T11%3A28%3A04%2B01%3A00&amp;precision=second" title="2013-09-16T11:28:04+01:00 in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/feature/7785_snslistener_out_of_run_behaviour'
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="7785.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A09%3A39%2B01%3A00&amp;precision=second" title="2015-06-04T02:09:39+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/8630"><span class="icon">​</span>8630</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7785?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7785?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7785?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>