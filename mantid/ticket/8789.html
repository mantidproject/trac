<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #8789 (Matching Spectra in ReflectometryReductionOne)
     â€“ Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="8788.html" title="Ticket #8788" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8789?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8789?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8789?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="8790.html" title="Ticket #8790" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 8789, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="8788.html" title="Ticket #8788">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="8790.html" title="Ticket #8790">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="8789.html">Ticket #8789</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-30T14%3A02%3A09Z&amp;precision=second" title="2014-01-30T14:02:09Z in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A51%3A16%2B01%3A00&amp;precision=second" title="2015-06-04T02:51:16+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Matching Spectra in ReflectometryReductionOne</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Owen+Arnold">Owen Arnold</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Owen+Arnold">Owen Arnold</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=blocker">blocker</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.1.html">Release 3.1</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Reflectometry">Reflectometry</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Karl Palmen
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
ReflectometryReductionOne has the ability to accept Transmission Workspaces for normalisation. The current behaviour is that the spectrum numbers are taken from the numerator workspace, and used to find and crop the correct spectra out of the denominator (transmission) workspace. If spectrum numbers cannot be found that match up, the algorithm exits without completing.
</p>
<p>
The behaviour requested by Tim Charlton is that we have an optional less-severe penalty for having mismatched spectrum numbers and allow the division to proceed on the basis of workspace index matching. This would be an optional switch, which would be On by default, and would still log a warning message that users could heed.
</p>
<p>
Switch would be something like 'StrictSpectrumChecking'. Users would have to actively disable it.
</p>
<p>
The code this will affect is in ReflectometryReductionOne, where createWorkspaceIndexListFromDetectorWorkspace is used.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="8789.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-30T15%3A35%3A41Z&amp;precision=second" title="2014-01-30T15:35:41Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>inprogress</em>
    </li><li>
      <strong>Priority</strong>
        changed from <em>major</em> to <em>blocker</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="8789.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T11%3A36%3A30Z&amp;precision=second" title="2014-01-31T11:36:30Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="8789.html" title="enhancement: Matching Spectra in ReflectometryReductionOne (closed: fixed)">#8789</a>. New strict spectrum checking option.
</p>
<p>
Warn if turned off. Fail if turned on (default). Unit tests extended and updated for this feature.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/8095434a103f43484ca723e3946c13e45adc6c6a" title="8095434a103f43484ca723e3946c13e45adc6c6a">8095434a103f43484ca723e3946c13e45adc6c6a</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="8789.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T14%3A33%3A42Z&amp;precision=second" title="2014-01-31T14:33:42Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
Tester:
</p>
<p>
The following shows this working. With StrictSpectrumChecking=False, a warning is emitted indicating that the spectrum numbers between the transmission run and the detector run do not match up. 
</p>
<div class="code"><pre>config<span class="p">[</span><span class="s">'default.instrument'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'INTER'</span>
trans1 <span class="o">=</span> LoadISISNexus<span class="p">(</span>Filename<span class="o">=</span><span class="s">'13463'</span><span class="p">,</span> OutputWorkspace<span class="o">=</span><span class="s">'13463'</span><span class="p">)</span>
trans2 <span class="o">=</span> LoadISISNexus<span class="p">(</span>Filename<span class="o">=</span><span class="s">'13464'</span><span class="p">,</span> OutputWorkspace<span class="o">=</span><span class="s">'13464'</span><span class="p">)</span>
run <span class="o">=</span> LoadISISNexus<span class="p">(</span>Filename<span class="o">=</span><span class="s">'13460'</span><span class="p">,</span> OutputWorkspace<span class="o">=</span><span class="s">'13460'</span><span class="p">)</span>
 
incidentAngle <span class="o">=</span> <span class="mf">0.7</span>

 
transmission <span class="o">=</span> CreateTransmissionWorkspaceAuto<span class="p">(</span>Params<span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">17</span><span class="p">],</span>
                                           StartOverlap<span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> 
                                           EndOverlap<span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> 
                                           FirstTransmissionRun<span class="o">=</span>trans1<span class="p">,</span> 
                                           SecondTransmissionRun<span class="o">=</span>trans2<span class="p">,</span>
                                           ProcessingInstructions<span class="o">=</span><span class="s">'1,2'</span> <span class="c"># Deliberately doing someing bad here!</span>
                                           <span class="p">)</span>
                                           
                           
 
qOut<span class="p">,</span> lamOut<span class="p">,</span> thetaOut <span class="o">=</span> ReflectometryReductionOneAuto<span class="p">(</span>InputWorkspace<span class="o">=</span>run<span class="p">,</span> ThetaIn<span class="o">=</span>incidentAngle<span class="p">,</span> FirstTransmissionRun<span class="o">=</span>transmission<span class="p">,</span> StrictSpectrumChecking<span class="o">=</span><span class="bp">False</span><span class="p">)</span>
 
</pre></div><p>
Now run the same script with the StrictSpectrumChecking=True. You should get a runtime error indicating that spectrum numbers do not match up.
</p>
<p>
Now run the same code, but delete the StrictSpectrumChecking option altogether. You should get the same behaviour as having it equal to True.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="8789.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T14%3A45%3A05Z&amp;precision=second" title="2014-01-31T14:45:05Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="8789.html" title="enhancement: Matching Spectra in ReflectometryReductionOne (closed: fixed)">#8789</a>. Improve documentation.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/2d6f6c0ba751da5f34b4e8a4086d54c8eb0beed8" title="2d6f6c0ba751da5f34b4e8a4086d54c8eb0beed8">2d6f6c0ba751da5f34b4e8a4086d54c8eb0beed8</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="8789.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T15%3A04%3A27Z&amp;precision=second" title="2014-01-31T15:04:27Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="8789.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T15%3A27%3A40Z&amp;precision=second" title="2014-01-31T15:27:40Z in Timeline">7 years</a> ago by Karl Palmen
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Karl Palmen</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="8789.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T16%3A25%3A41Z&amp;precision=second" title="2014-01-31T16:25:41Z in Timeline">7 years</a> ago by Karl Palmen
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/feature/8789_spectra_matching_option'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/9f8ac1798b6d4522b19573ed0b2f1ee9beb7b69d"><span class="icon">â€‹</span>9f8ac1798b6d4522b19573ed0b2f1ee9beb7b69d</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="8789.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A51%3A16%2B01%3A00&amp;precision=second" title="2015-06-04T02:51:16+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/9633"><span class="icon">â€‹</span>9633</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8789?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8789?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8789?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>