<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #2215 (Matrix Algebra error)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="2214.html" title="Ticket #2214" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/2215?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/2215?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/2215?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="2216.html" title="Ticket #2216" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 2215, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="2214.html" title="Ticket #2214">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="2216.html" title="Ticket #2216">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="2215.html">Ticket #2215</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2011-01-11T14%3A18%3A50Z&amp;precision=second" title="2011-01-11T14:18:50Z in Timeline">10 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-03T22%3A48%3A56%2B01%3A00&amp;precision=second" title="2015-06-03T22:48:56+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Matrix Algebra error</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Nick+Draper">Nick Draper</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Martyn+Gigg">Martyn Gigg</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Iteration&#32;27.html">Iteration 27</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Mantid">Mantid</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Owen Arnold
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
This script now fails to run on the latest stable 64 bit Mantid (also 32 bit windows).
It breaks on the 
</p>
<pre class="wiki">Io= m2*(Ipp*Iaa - Ipa*Iap)/(Ipp + Iaa - Ipa - Iap)
</pre><p>
Line with following error.
The sizes of the two workspaces are not compatible for algorithm Multiply
Logic Error in execution of algorithm Multiply
The sizes of the two workspaces are not compatible for algorithm Multiply
Unfortunately the multiplication works if you subsequently use the qti interface so presumably there is a bug in the link between python and Mantid
Rob
</p>
<pre class="wiki">LoadRaw(Filename="OFFSPEC00005730.raw",OutputWorkspace="ws",Cache="Always",LoadLogFiles="0")
for i in range(5732,5746,2):
        LoadRaw(Filename="OFFSPEC0000"+str(i)+".raw",OutputWorkspace="wtemp",Cache="Always",LoadLogFiles="0")
        Plus("ws","wtemp","ws")
for i in range(5713,5729,2):
        LoadRaw(Filename="OFFSPEC0000"+str(i)+".raw",OutputWorkspace="wtemp",Cache="Always",LoadLogFiles="0")
        Plus("ws","wtemp","ws")
        
ConvertUnits("ws","ws","Wavelength",AlignBins="1")
Rebin("ws","ws","0.5,0.2,14.5")
CloneWorkspace("ws","wsdet")
CloneWorkspace("ws","wsmon2")
CropWorkspace("wsmon2","wsmon2t",StartWorkspaceIndex="1",EndWorkspaceIndex="1")
mantid.deleteWorkspace("wsmon2")
RenameWorkspace("wsmon2t","wsmon2")
CropWorkspace("wsdet","wsdett",StartWorkspaceIndex="3",EndWorkspaceIndex="3")
mantid.deleteWorkspace("wsdet")
RenameWorkspace("wsdett","wsdet")
        
Divide("wsdet","wsmon2","rs")
Ispp=mtd["rs_1"]
Ispa=mtd["rs_2"]
Isap=mtd["rs_3"]
Isaa=mtd["rs_4"]
LoadRaw(Filename="OFFSPEC00005731.raw",OutputWorkspace="w",Cache="Always",LoadLogFiles="0")
for i in range(5733,5746,2):
        LoadRaw(Filename="OFFSPEC0000"+str(i)+".raw",OutputWorkspace="wtemp",Cache="Always",LoadLogFiles="0")
        Plus("w","wtemp","w")
for i in range(5714,5729,2):
        LoadRaw(Filename="OFFSPEC0000"+str(i)+".raw",OutputWorkspace="wtemp",Cache="Always",LoadLogFiles="0")
        Plus("w","wtemp","w")
        
ConvertUnits("w","w","Wavelength",AlignBins="1")
Rebin("w","w","0.5,0.2,14.5")
CloneWorkspace("w","wdet")
CloneWorkspace("w","wmon2")
CropWorkspace("wmon2","wmon2t",StartWorkspaceIndex="1",EndWorkspaceIndex="1")
mantid.deleteWorkspace("wmon2")
RenameWorkspace("wmon2t","wmon2")
CropWorkspace("wdet","wdett",StartWorkspaceIndex="3",EndWorkspaceIndex="3")
mantid.deleteWorkspace("wdet")
RenameWorkspace("wdett","wdet")
        
Divide("wdet","wmon2","r")
Ipp=mtd["r_1"]
Ipa=mtd["r_2"]
Iap=mtd["r_3"]
Iaa=mtd["r_4"]
rho = (Iaa - Iap)/(Ipp - Ipa)
alpha = (Iaa - Ipa)/(Ipp - Iap)
ppap = (Ipp - Ipa)*(Ipp - Iap)/(Ipp*Iaa - Ipa*Iap)
paaa = rho*alpha*ppap
CreateSingleValuedWorkspace("m2","2.0","0.0")
m2=mtd["m2"]
Io= m2*(Ipp*Iaa - Ipa*Iap)/(Ipp + Iaa - Ipa - Iap)
Pp=(Ispp+Isaa - Ispa-Isap)*(alpha*(Ispp - Isap) - Isaa+Ispa)/((rho*alpha*Ispp+Isaa + rho*Ispa + alpha*Isap)*(rho*  (Ispp - Ispa) - Isaa+Isap))
Ap=(Ispp+Isaa - Ispa-Isap)*(rho*(Ispp - Ispa) - Isaa+Isap)/((rho*alpha*Ispp+Isaa + rho*Ispa + alpha*Isap)*(alpha*  (Ispp - Isap) - Isaa+Ispa)) 
Rs=(alpha*(Ispp - Isap) - Isaa+Ispa)*(rho*(Ispp - Ispa) - Isaa+Isap)/((rho*alpha*Ispp+Isaa + rho*Ispa + alpha*Isap) *(Ispp+Isaa - Ispa - Isap) )
ReplaceSpecialValues(rho,"rho","0.0","0.0","0.0","0.0")
ReplaceSpecialValues(alpha,"alpha","0.0","0.0","0.0","0.0")
ReplaceSpecialValues(Io,"Io","0.0","0.0","0.0","0.0")
ReplaceSpecialValues(Pp,"Pp","0.0","0.0","0.0","0.0")
ReplaceSpecialValues(Ap,"Ap","0.0","0.0","0.0","0.0")
ReplaceSpecialValues(Rs,"Rs","0.0","0.0","0.0","0.0")
Sqrt("Pp")
Sqrt("Ap")
Sqrt("Rs")
ReplaceSpecialValues(Pp,"Pp","0.0","0.0","0.0","0.0")
ReplaceSpecialValues(Ap,"Ap","0.0","0.0","0.0","0.0")
ReplaceSpecialValues(Rs,"Rs","0.0","0.0","0.0","0.0")
p1=plotSpectrum(["rho","alpha","Pp","Ap"],0,0)
l=p1.activeLayer()
l.setAxisScale(Layer.Left,0.5,1.2)
p1=plotSpectrum(["Pp","Ap"],0,1)
l=p1.activeLayer()
l.setAxisScale(Layer.Left,0.5,1.2)
p1=plotSpectrum(["rho","alpha"],0,1)
l=p1.activeLayer()
l.setAxisScale(Layer.Left,0.5,1.2)
</pre>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="2215.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2011-01-12T09%3A20%3A36Z&amp;precision=second" title="2011-01-12T09:20:36Z in Timeline">10 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="2215.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2011-01-12T10%3A22%3A14Z&amp;precision=second" title="2011-01-12T10:22:14Z in Timeline">10 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
The commit message below didn't make it for some reason:<br /><br />
 
(In <a class="missing changeset" title="No default repository defined">[8672]</a>) Ensure that single valued workspaces can be used in binary operations regardless of whether they are lhs or rhs. There was a small bug with multiply that meant they would fail on the lhs. Also ensured that the Python binary overloads provide better information if they fail. Re <a class="closed ticket" href="2215.html" title="enhancement: Matrix Algebra error (closed: fixed)">#2215</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="2215.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2011-01-12T10%3A22%3A59Z&amp;precision=second" title="2011-01-12T10:22:59Z in Timeline">10 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="2215.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2011-02-14T17%3A11%3A57Z&amp;precision=second" title="2011-02-14T17:11:57Z in Timeline">10 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Owen Arnold</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="2215.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2011-02-14T17%3A24%3A59Z&amp;precision=second" title="2011-02-14T17:24:59Z in Timeline">10 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Verify that binary operations work on singlevalued workspaces (lhs and rhs).
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="2215.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-03T22%3A48%3A56%2B01%3A00&amp;precision=second" title="2015-06-03T22:48:56+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/3062"><span class="icon">​</span>3062</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/2215?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/2215?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/2215?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>