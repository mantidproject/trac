<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #10014 (Reduce valgrind errors in setOrientedLattice usage)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="10013.html" title="Ticket #10013" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10014?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10014?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10014?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="10015.html" title="Ticket #10015" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 10014, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="10013.html" title="Ticket #10013">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="10015.html" title="Ticket #10015">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="10014.html">Ticket #10014</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-28T22%3A10%3A04%2B01%3A00&amp;precision=second" title="2014-07-28T22:10:04+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A42%3A05%2B01%3A00&amp;precision=second" title="2015-06-04T03:42:05+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Reduce valgrind errors in setOrientedLattice usage</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Andrei+Savici">Andrei Savici</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Andrei+Savici">Andrei Savici</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.3.html">Release 3.3</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Wenduo Zhou
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2014-07-28 21:10:32.129659+00:00">
        (last modified by Andrei Savici)
        (<a href="https://trac.mantidproject.org/mantid/ticket/10014?action=diff&amp;version=2">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <p>
There are many memory leaks like
</p>
<pre class="wiki">ws-&gt;mutableSample().setOrientedLattice(new OrientedLattice(o));
</pre><p>
setOrientedLattice should copy the OrientedLattice, not use a pointer
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="10014.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-28T22%3A10%3A11%2B01%3A00&amp;precision=second" title="2014-07-28T22:10:11+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="10014.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-28T22%3A10%3A32%2B01%3A00&amp;precision=second" title="2014-07-28T22:10:32+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/10014?action=diff&amp;version=2">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="10014.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-30T04%3A58%3A23%2B01%3A00&amp;precision=second" title="2014-07-30T04:58:23+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Fix usage of setOrientedLattice. Refs <a class="closed ticket" href="10014.html" title="Reduce valgrind errors in setOrientedLattice usage (closed: fixed)">#10014</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/475d6eb41eabee960c1accadc41ece24d79a80c5" title="475d6eb41eabee960c1accadc41ece24d79a80c5">475d6eb41eabee960c1accadc41ece24d79a80c5</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="10014.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-30T06%3A39%3A17%2B01%3A00&amp;precision=second" title="2014-07-30T06:39:17+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
    <div class="comment searchable">
      
      <p>
Fix failing test. Refs <a class="closed ticket" href="10014.html" title="Reduce valgrind errors in setOrientedLattice usage (closed: fixed)">#10014</a>
</p>
<p>
In SampleTest, there was a check if the address of the OrientedLattice
object used to set the OrientedLattice on the sample is the same as the
one pointed by the sample. That is no longer the case.
setOrientedLattice now makes a copy (to reduce memory leaks)
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/57aaa178c9002eae9668457d62c6a2101099b7a0" title="57aaa178c9002eae9668457d62c6a2101099b7a0">57aaa178c9002eae9668457d62c6a2101099b7a0</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="10014.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T09%3A14%3A44%2B01%3A00&amp;precision=second" title="2014-07-31T09:14:44+01:00 in Timeline">6 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
The valgrind job has picked up a memory leak in SampleTest:
</p>
<p>
<a class="ext-link" href="http://builds.mantidproject.org/view/Static%20Analysis/job/valgrind_develop_core_packages/110/valgrindResult/pid=20776,0x743/"><span class="icon">​</span>http://builds.mantidproject.org/view/Static%20Analysis/job/valgrind_develop_core_packages/110/valgrindResult/pid=20776,0x743/</a>
</p>
<p>
I think it is just that <tt>latt</tt> now needs to be explicitly deleted in each test in <tt>SampleTest.h</tt> 
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T09%3A22%3A07%2B01%3A00&amp;precision=second" title="2014-07-31T09:22:07+01:00 in Timeline">6 years</a> ago
                      by Martyn Gigg
                    (<a href="https://trac.mantidproject.org/mantid/ticket/10014?cversion=0&amp;cnum_hist=5#comment:5">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/10014?action=comment-diff&amp;cnum=5&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="10014.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T18%3A45%3A13%2B01%3A00&amp;precision=second" title="2014-07-31T18:45:13+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
    <div class="comment searchable">
      
      <p>
Delete a few pointers. Refs <a class="closed ticket" href="10014.html" title="Reduce valgrind errors in setOrientedLattice usage (closed: fixed)">#10014</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/ad15d6323faf6a1834bdfd7430559bb8d76a1f38" title="ad15d6323faf6a1834bdfd7430559bb8d76a1f38">ad15d6323faf6a1834bdfd7430559bb8d76a1f38</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="10014.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T21%3A34%3A42%2B01%3A00&amp;precision=second" title="2014-07-31T21:34:42+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
    <div class="comment searchable">
      
      <p>
A few more pointers to delete. Refs <a class="closed ticket" href="10014.html" title="Reduce valgrind errors in setOrientedLattice usage (closed: fixed)">#10014</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/41813778f041c08002851290b6cf1293639606ec" title="41813778f041c08002851290b6cf1293639606ec">41813778f041c08002851290b6cf1293639606ec</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="10014.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T23%3A03%3A11%2B01%3A00&amp;precision=second" title="2014-07-31T23:03:11+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
    <div class="comment searchable">
      
      <p>
Try to fix some invalid reads. Refs <a class="closed ticket" href="10014.html" title="Reduce valgrind errors in setOrientedLattice usage (closed: fixed)">#10014</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/82250b826f07317dd2ebdbe4c39f70d2186049f8" title="82250b826f07317dd2ebdbe4c39f70d2186049f8">82250b826f07317dd2ebdbe4c39f70d2186049f8</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="10014.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-01T03%3A50%3A59%2B01%3A00&amp;precision=second" title="2014-08-01T03:50:59+01:00 in Timeline">6 years</a> ago by Andrei Savici
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
To tester: unit tests (system tests) should pass. Valgrind crystal had 297kB leaked in 121 errors (build 18 <a class="ext-link" href="http://builds.mantidproject.org/view/Valgrind/job/valgrind_develop_crystal/18/valgrindResult/"><span class="icon">​</span>http://builds.mantidproject.org/view/Valgrind/job/valgrind_develop_crystal/18/valgrindResult/</a>), now it's 48 Kb leaked, and only 98 errors (build 21 <a class="ext-link" href="http://builds.mantidproject.org/view/Valgrind/job/valgrind_develop_crystal/21/valgrindResult/"><span class="icon">​</span>http://builds.mantidproject.org/view/Valgrind/job/valgrind_develop_crystal/21/valgrindResult/</a>)
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="10014.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-01T13%3A51%3A38%2B01%3A00&amp;precision=second" title="2014-08-01T13:51:38+01:00 in Timeline">6 years</a> ago by Wenduo Zhou
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Wenduo Zhou</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="10014.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-01T15%3A05%3A17%2B01%3A00&amp;precision=second" title="2014-08-01T15:05:17+01:00 in Timeline">6 years</a> ago by Wenduo Zhou
                </h3>
                
    <div class="comment searchable">
      
      <p>
All tests are passed. Ticket is closed as there is no error reported from valgrind. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="10014.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-01T15%3A05%3A28%2B01%3A00&amp;precision=second" title="2014-08-01T15:05:28+01:00 in Timeline">6 years</a> ago by Wenduo Zhou
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/feature/10014_setOrientedLatticePointer'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/9ee68fcbd138e4ba40dd3b748c35ca0a5d9584d0"><span class="icon">​</span>9ee68fcbd138e4ba40dd3b748c35ca0a5d9584d0</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="10014.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A42%3A05%2B01%3A00&amp;precision=second" title="2015-06-04T03:42:05+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10856"><span class="icon">​</span>10856</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10014?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10014?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10014?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>