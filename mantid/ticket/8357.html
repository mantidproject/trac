<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #8357 (Clear memory leaks in the APITest package)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="8356.html" title="Ticket #8356" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8357?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8357?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8357?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="8358.html" title="Ticket #8358" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 8357, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="8356.html" title="Ticket #8356">Previous Ticket</a></span></li><li><span><a class="next" href="8358.html" title="Ticket #8358">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/8357.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="8357.html">Ticket #8357</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-11-04T16%3A49%3A35Z&amp;precision=second" title="2013-11-04T16:49:35Z in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A33%3A25%2B01%3A00&amp;precision=second" title="2015-06-04T02:33:25+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Clear memory leaks in the APITest package</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Russell+Taylor">Russell Taylor</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Russell+Taylor">Russell Taylor</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;keywords=~Maintenance">Maintenance</a>
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span><a class="closed ticket" href="8361.html" title="Clear memory leaks in the API package">#8361</a></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Martyn Gigg
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2013-11-06 15:01:53.477945+00:00">
        (last modified by Russell Taylor)
        (<a href="https://trac.mantidproject.org/mantid/ticket/8357?action=diff&amp;version=2">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <p>
The SNS Jenkins has a <a class="ext-link" href="https://builds.sns.gov/job/ornl_valgrind_develop"><span class="icon">​</span>valgrind job</a> which uses the unit tests as a hook into exercising the Mantid code itself. This of course means that it picks up any leaks in the test code as well.
</p>
<p>
Using this job and/or valgrind runs of your own, eliminate all the leaks/errors that come out of the test code itself. I've created this as an isolated ticket because I'd like to get a clear view of the errors we have in the actual Mantid code. <strong>All changes to this ticket should only be to code in the Framework/API/test/ directory</strong>! 
</p>
<p>
When working on this, don't just add <tt>delete</tt> calls - consider whether the leaking call really needs to be a heap allocation; create the object on the stack if not.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="8357.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-11-04T17%3A10%3A04Z&amp;precision=second" title="2013-11-04T17:10:04Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8361</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="8357.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-11-06T15%3A01%3A53Z&amp;precision=second" title="2013-11-06T15:01:53Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/8357?action=diff&amp;version=2">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="8357.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-02-08T18%3A33%3A54Z&amp;precision=second" title="2014-02-08T18:33:54Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        set to <em>Russell Taylor</em>
    </li><li>
      <strong>Milestone</strong>
        changed from <em>Backlog</em> to <em>Release 3.2</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="8357.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-02-14T10%3A59%3A49Z&amp;precision=second" title="2014-02-14T10:59:49Z in Timeline">7 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Bulk move of tickets out of triage (new) to assigned at the introduction of the triage state
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="8357.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-19T15%3A08%3A30Z&amp;precision=second" title="2014-03-19T15:08:30Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Eliminate valgrind invalid write warning.
</p>
<p>
By making sure to unregister the observer at the end of the test.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/845efec319cf1cd719cee923ad07370e65bf1885" title="845efec319cf1cd719cee923ad07370e65bf1885">845efec319cf1cd719cee923ad07370e65bf1885</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="8357.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-19T15%3A08%3A30Z&amp;precision=second" title="2014-03-19T15:08:30Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Fix leak in test by breaking cyclic reference.
</p>
<p>
The BoxController &amp; BoxControllerDummyIO objects were each holding a
shared_ptr back to the other.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/72fed1a43f3622555347e63395766e3204c62082" title="72fed1a43f3622555347e63395766e3204c62082">72fed1a43f3622555347e63395766e3204c62082</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="8357.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-19T15%3A08%3A31Z&amp;precision=second" title="2014-03-19T15:08:31Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Fix memory leaks in tests.
</p>
<p>
By creating object on the stack instead of unnecessarily on the heap.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/c02e1bdf04ba6eacc4b14bdfbca7da0d932b9570" title="c02e1bdf04ba6eacc4b14bdfbca7da0d932b9570">c02e1bdf04ba6eacc4b14bdfbca7da0d932b9570</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="8357.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-19T15%3A08%3A31Z&amp;precision=second" title="2014-03-19T15:08:31Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Remove leak in test by adding components to instrument.
</p>
<p>
The fact that you have to call two methods in succession to get this
right is probably not great design. Nor is the fact that you can
'mark' something that isn't in the instrument without any error or warning.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/4b45a3284795ff43623134ad4fcfedfe1fb9da0e" title="4b45a3284795ff43623134ad4fcfedfe1fb9da0e">4b45a3284795ff43623134ad4fcfedfe1fb9da0e</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="8357.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-19T15%3A08%3A31Z&amp;precision=second" title="2014-03-19T15:08:31Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Eliminate memory leaks in tests.
</p>
<p>
By calling delete where appropriate.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/a295915fdba69374fbc2a04490c41b80896b1e46" title="a295915fdba69374fbc2a04490c41b80896b1e46">a295915fdba69374fbc2a04490c41b80896b1e46</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="8357.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-19T15%3A08%3A31Z&amp;precision=second" title="2014-03-19T15:08:31Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Eliminate memory leak in test.
</p>
<p>
By removing group from within group to eliminate cyclic shared_ptr
reference. Possibly there's a real potential issue here, but would
anyone really ever put a group within a group?
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/9533f817885addf622af52987b94f1908f386d1c" title="9533f817885addf622af52987b94f1908f386d1c">9533f817885addf622af52987b94f1908f386d1c</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="8357.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-31T17%3A15%3A05%2B01%3A00&amp;precision=second" title="2014-03-31T17:15:05+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Eliminate valgrind invalid write warning.
</p>
<p>
By making sure to unregister the observer at the end of the test.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/80f3695a539a3a67ace1becf8091636ec88ce73d" title="80f3695a539a3a67ace1becf8091636ec88ce73d">80f3695a539a3a67ace1becf8091636ec88ce73d</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="8357.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-31T17%3A15%3A06%2B01%3A00&amp;precision=second" title="2014-03-31T17:15:06+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Fix leak in test by breaking cyclic reference.
</p>
<p>
The BoxController &amp; BoxControllerDummyIO objects were each holding a
shared_ptr back to the other.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/7053b8961e800d64e54c51bc15c89341d0845e94" title="7053b8961e800d64e54c51bc15c89341d0845e94">7053b8961e800d64e54c51bc15c89341d0845e94</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="8357.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-31T17%3A15%3A06%2B01%3A00&amp;precision=second" title="2014-03-31T17:15:06+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Fix memory leaks in tests.
</p>
<p>
By creating object on the stack instead of unnecessarily on the heap.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/d97c3c8c89110d496960c9af431d5f64847693d1" title="d97c3c8c89110d496960c9af431d5f64847693d1">d97c3c8c89110d496960c9af431d5f64847693d1</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="8357.html#comment:14">comment:14</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-31T17%3A15%3A06%2B01%3A00&amp;precision=second" title="2014-03-31T17:15:06+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Remove leak in test by adding components to instrument.
</p>
<p>
The fact that you have to call two methods in succession to get this
right is probably not great design. Nor is the fact that you can
'mark' something that isn't in the instrument without any error or warning.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/da65363bf7f7ab8d0b8789648b5b0ed5b8faa66d" title="da65363bf7f7ab8d0b8789648b5b0ed5b8faa66d">da65363bf7f7ab8d0b8789648b5b0ed5b8faa66d</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="8357.html#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-31T17%3A15%3A06%2B01%3A00&amp;precision=second" title="2014-03-31T17:15:06+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Eliminate memory leaks in tests.
</p>
<p>
By calling delete where appropriate.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/067e4473293d2462a4caa61273494c83ffbd8005" title="067e4473293d2462a4caa61273494c83ffbd8005">067e4473293d2462a4caa61273494c83ffbd8005</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="8357.html#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-31T17%3A15%3A07%2B01%3A00&amp;precision=second" title="2014-03-31T17:15:07+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Eliminate memory leak in test.
</p>
<p>
By removing group from within group to eliminate cyclic shared_ptr
reference. Possibly there's a real potential issue here, but would
anyone really ever put a group within a group?
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/ee89f1bb5030406f4c1859dddbe9b2b05391e74f" title="ee89f1bb5030406f4c1859dddbe9b2b05391e74f">ee89f1bb5030406f4c1859dddbe9b2b05391e74f</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="8357.html#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-31T18%3A08%3A57%2B01%3A00&amp;precision=second" title="2014-03-31T18:08:57+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Update to account for change in TestHelpers class.
</p>
<p>
The BoxControllerDummyIO constructor was changed to accept (and hold
internally) a bare pointer to avoid a cyclic reference.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/981868bdda2c8ae0fdb3e9778f1ce9b0476bb297" title="981868bdda2c8ae0fdb3e9778f1ce9b0476bb297">981868bdda2c8ae0fdb3e9778f1ce9b0476bb297</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-18">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:18" class="cnum">
      <a href="8357.html#comment:18">comment:18</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-01T18%3A47%3A10%2B01%3A00&amp;precision=second" title="2014-04-01T18:47:10+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Add a suppressions file for the API tests.
</p>
<p>
Valgrind is complaining about an OpenMP call in AlgorithmManagerTest.
I don't know whether this is a real leak, but I suppose that there's not
much we can do about it.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/3058ccfae1cb69a4f53664df2cb91053504be900" title="3058ccfae1cb69a4f53664df2cb91053504be900">3058ccfae1cb69a4f53664df2cb91053504be900</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-19">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:19" class="cnum">
      <a href="8357.html#comment:19">comment:19</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-01T19%3A51%3A28%2B01%3A00&amp;precision=second" title="2014-04-01T19:51:28+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Fix memory leaks in test.
</p>
<p>
Ensure Property objects returned by loadProperty are deleted after use.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/0de7d7e83ee1e436cfffc5089a50829e345d00bf" title="0de7d7e83ee1e436cfffc5089a50829e345d00bf">0de7d7e83ee1e436cfffc5089a50829e345d00bf</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="8357.html#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-01T20%3A26%3A19%2B01%3A00&amp;precision=second" title="2014-04-01T20:26:19+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
<strong>To test</strong>: This mainly needs to be tested by inspection. The way I can tell that all leaks in API/test itself are gone is because I run valgrind in Eclipse and observe the absence of a little red cross next to that directory.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-21">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:21" class="cnum">
      <a href="8357.html#comment:21">comment:21</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T11%3A47%3A11%2B01%3A00&amp;precision=second" title="2014-04-02T11:47:11+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Martyn Gigg</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-22">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:22" class="cnum">
      <a href="8357.html#comment:22">comment:22</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T11%3A51%3A48%2B01%3A00&amp;precision=second" title="2014-04-02T11:51:48+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>reopened</em>
    </li><li>
      <strong>Resolution</strong>
        <em>fixed</em> deleted
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
I ran the APITest suite through valgrind in eclipse and I'm showing up an error in MemoryManagerTest.h:37, which uses an openmp loop. The stacktrace is:
</p>
<pre class="wiki">==19901== 2,352 bytes in 7 blocks are possibly lost in loss record 36 of 92
==19901==    at 0x4C29DB4: calloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)
==19901==    by 0x4012074: _dl_allocate_tls (dl-tls.c:297)
==19901==    by 0x7B6BABC: pthread_create@@GLIBC_2.2.5 (allocatestack.c:571)
==19901==    by 0x774731B: ??? (in /usr/lib/x86_64-linux-gnu/libgomp.so.1.0.0)
==19901==    by 0x86299F: _ZN17MemoryManagerTest13test_parallelEv (MemoryManagerTest.h:37)
==19901==    by 0x862CD1: _ZN53TestDescription_suite_MemoryManagerTest_test_parallel7runTestEv (MemoryManagerTest.cpp:38)
==19901==    by 0x9B6AB4: _ZN7CxxTest19RealTestDescription3runEv (RealDescriptions.cpp:96)
==19901==    by 0x9B9FDE: _ZN7CxxTest10TestRunner7runTestERNS_15TestDescriptionE (TestRunner.h:94)
==19901==    by 0x9B9ED0: _ZN7CxxTest10TestRunner8runSuiteERNS_16SuiteDescriptionE (TestRunner.h:79)
==19901==    by 0x9B9D6B: _ZN7CxxTest10TestRunner8runWorldEv (TestRunner.h:63)
==19901==    by 0x9B9B2E: _ZN7CxxTest10TestRunner11runAllTestsERNS_12TestListenerE (TestRunner.h:24)
==19901==    by 0x9BFB6D: _ZN7CxxTest12XUnitPrinter3runEv (XUnitPrinter.h:30)
</pre><p>
It looks like something that just needs a similar suppression to the one already present for AlgorithmManager?
</p>

    </div>

              </div>
              <div class="change" id="trac-change-23">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:23" class="cnum">
      <a href="8357.html#comment:23">comment:23</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T14%3A45%3A25%2B01%3A00&amp;precision=second" title="2014-04-02T14:45:25+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>reopened</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>. Add suppression for another use of OpenMP in a test.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/111f66ab17766b1392a4ac2f6739de9fd18fa325" title="111f66ab17766b1392a4ac2f6739de9fd18fa325">111f66ab17766b1392a4ac2f6739de9fd18fa325</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-24">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:24" class="cnum">
      <a href="8357.html#comment:24">comment:24</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T15%3A22%3A46%2B01%3A00&amp;precision=second" title="2014-04-02T15:22:46+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
That last one didn't show up for me (or in the Jenkins job) when running the entire API suite, though it did when I ran the MemoryManagerTest on its own. Anyhow, it's suppressed now.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-25">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:25" class="cnum">
      <a href="8357.html#comment:25">comment:25</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T15%3A46%3A16%2B01%3A00&amp;precision=second" title="2014-04-02T15:46:16+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-26">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:26" class="cnum">
      <a href="8357.html#comment:26">comment:26</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T15%3A46%3A57%2B01%3A00&amp;precision=second" title="2014-04-02T15:46:57+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
The API test folder is now clear for me too.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-27">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:27" class="cnum">
      <a href="8357.html#comment:27">comment:27</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T15%3A47%3A20%2B01%3A00&amp;precision=second" title="2014-04-02T15:47:20+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/bugfix/8357_api_test_memory_leaks'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/4e89f08a33013f4b0628c312f176d500225ea2a4"><span class="icon">​</span>4e89f08a33013f4b0628c312f176d500225ea2a4</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-28">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:28" class="cnum">
      <a href="8357.html#comment:28">comment:28</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A33%3A25%2B01%3A00&amp;precision=second" title="2015-06-04T02:33:25+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/9202"><span class="icon">​</span>9202</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8357?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8357?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8357?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>