<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #9375 (SliceViewer cluster display)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="9374.html" title="Ticket #9374" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9375?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9375?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9375?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="9376.html" title="Ticket #9376" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script><script type="text/javascript" src="../chrome/mastertickets/disable_resolve.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 9375, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="9374.html" title="Ticket #9374">Previous Ticket</a></span></li><li><span><a class="next" href="9376.html" title="Ticket #9376">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/9375.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="9375.html">Ticket #9375</a>
          <span class="status">(assigned)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-25T11%3A41%3A21%2B01%3A00&amp;precision=second" title="2014-04-25T11:41:21+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A15%3A35%2B01%3A00&amp;precision=second" title="2015-06-04T03:15:35+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">SliceViewer cluster display</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Owen+Arnold">Owen Arnold</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Owen+Arnold">Owen Arnold</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="../milestone/Backlog.html">Backlog</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Diffraction">Diffraction</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span><a class="closed ticket" href="9428.html" title="FindClusterFaces Algorithm">#9428</a>, <a class="assigned ticket" href="9469.html" title="Associate ClusterImage (IMDHistoWorkspace) with a PeaksWorkspace">#9469</a></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span><a class="assigned ticket" href="10647.html" title="SCD Work package">#10647</a></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <ul><li>Take a peaks workspace integrated via IntegratePeaksUsingCluster
</li><li>Display it in the PeaksOverlay of the SliceViewer
</li><li>This should automatically render with an outline (stencil) view of the clusters
</li></ul><p>
To do this, we must mark the PeaksWorkspaces that have been through IntegratePeaksUsingClusters. This could be done by holding a weak pointer to the MDWorkspace image. It could also be done via some kind of naming + using the ADS. We would then need to make a new PeakOverlayView type, that allowed us to render workspaces of this type.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="9375.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-25T11%3A51%3A48%2B01%3A00&amp;precision=second" title="2014-04-25T11:51:48+01:00 in Timeline">6 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="9375.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-25T15%3A26%3A26%2B01%3A00&amp;precision=second" title="2014-04-25T15:26:26+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
This could be done with boolean polygon operations <a class="ext-link" href="http://stackoverflow.com/questions/3501383/find-the-outline-of-a-union-of-grid-aligned-squares"><span class="icon">​</span>http://stackoverflow.com/questions/3501383/find-the-outline-of-a-union-of-grid-aligned-squares</a>. But there is a simpler way where each cluster would iterate over it's labels. 
</p>
<p>
Using the findNeighbours functionality on the neighbours, the cluster could  determine if it was sitting on an edge. Infact, this could be done done via a BackgroundStrategy, and would be easy go get working in parallel in terms of clusters. We could and should reduce the overhead, by only considering clusters over-which a peak exists.
</p>
<p>
For those cells which are on an edge, we would need to record the index in the workspace, as well as the face(s) that make up the edge. Having this work as a separate, algorithm, and perhaps returning a table workspace with the results would be a good option. The SliceViewer code would then need to process the TableWorkspace and build polyhedra corresponding to each cluster.
</p>
<p>
So I think we need:
</p>
<ul><li>An algorithm called FindClusterEdges (returning a table workspace)
</li><li>A new PeakOverlayView suitable for drawing Cluster edges
</li><li>A way of binding a PeaksWorkspace to the ClusterWorkspace so that the right PeakOverlayView can be selected via the PeaksWorkspace.
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="9375.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-25T15%3A30%3A06%2B01%3A00&amp;precision=second" title="2014-04-25T15:30:06+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
Further to above, table workspace would be something like
</p>
<p>
Cluster Id , MDWorkspace index, Dimension Number, Min or Max
1, 2, 0, True
1, 2, 1, False
</p>
<p>
Would define a edge against cluster id 1, at workspace index 2, with two edges against dimension 0 and 1, with min on 0 and max on 1.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="9375.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-25T16%3A38%3A28%2B01%3A00&amp;precision=second" title="2014-04-25T16:38:28+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <ul><li>Take PeaksWorkspace and ClusterImageWorkspace. This is non trivial. We need a way to associate the two using the PeaksWorkspace as the key.
</li><li>Map PeaksWorkspace onto ClusterImageWorkspace and extract labels of interest. Create Map of Label to Cluster. Could use a Multimap here, and also Key it by PeakNumber as well as LabelId. The cluster should also record it's centre position at this time based on the peak.
</li><li>Iterate over ClusterImageWorkspace Skip over labels that are not of interest, otherwise:
<ul><li>Determine the absolute distance to the Cluster centre. Use this to determine an effective radius of the cluster based on it's most remote label
</li><li>In the same iteration as above. Use FindNeighbours as well as a custom BackgroundStrategy to find any unlabelled nearest neighbours. If there are any, mark this in a structure/container(s) local to the Cluster instance.  One thing that would be useful to know the orientation of each face. If they were stored according to the dimension in which they have zero-thickness, then it would be possible to quickly determine which faces interact with a slice point. There are various ways and times to do this, but the PeakTransform would really help here.
</li></ul></li><li>Serialise up all clusters to a single TableWorkspace so that it can be returned from an algorithm.
</li><li>In the SliceViewer code Deserialize the clusters. This will most likely be done via a custom PeakOverlayView and PhysicalClusterPeak type.
</li><li>According to the slice point, call a method on each cluster to return a collection of 2D vertexes that correspond to the SlicePoint position. Something like <em>getVertexesAt(size_t SlicePoint) : Vec&lt;V2D&gt;</em> For this it would be fastest if the clusters had their faces sorted according to the zero-thickness criteria, because those faces parallel to the slice point are not of interest. Only faces perpendicular to the slice point should be considered.
</li><li>In the custom PeakOverlayView, use the vertexes to construct a closed LineSegment to represent in Qt.
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="9375.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T10%3A57%3A24%2B01%3A00&amp;precision=second" title="2014-05-15T10:57:24+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>9428</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="9375.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T11%3A02%3A10%2B01%3A00&amp;precision=second" title="2014-05-15T11:02:10+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>9469</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="9375.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-23T09%3A01%3A12%2B01%3A00&amp;precision=second" title="2014-06-23T09:01:12+01:00 in Timeline">6 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>Release 3.2</em> to <em>Backlog</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Moved to Backlog at the code freeze of release 3.2
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="9375.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-11-27T15%3A16%3A45Z&amp;precision=second" title="2014-11-27T15:16:45Z in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>10647</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="9375.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A15%3A35%2B01%3A00&amp;precision=second" title="2015-06-04T03:15:35+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10218"><span class="icon">​</span>10218</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9375?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9375?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9375?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>