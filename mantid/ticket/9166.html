<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #9166 (CalculateGammaBackground does not copy the errors to the output workspace)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="9165.html" title="Ticket #9165" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9166?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9166?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9166?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="9167.html" title="Ticket #9167" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 9166, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="9165.html" title="Ticket #9165">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="9167.html" title="Ticket #9167">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="9166.html">Ticket #9166</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-12T09%3A33%3A17Z&amp;precision=second" title="2014-03-12T09:33:17Z in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A06%3A57%2B01%3A00&amp;precision=second" title="2015-06-04T03:06:57+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">CalculateGammaBackground does not copy the errors to the output workspace</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Martyn+Gigg">Martyn Gigg</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Martyn+Gigg">Martyn Gigg</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Direct+Inelastic">Direct Inelastic</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Keith Brown
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
The CalculateGammaBackground algorithm implemented for Vesuvio in <a class="closed ticket" href="8378.html" title="enhancement: Implement gamma correction for vesuvio (closed: fixed)">#8378</a> does not copy the errors from the input workspace to the corrected workspace and leaves them at zero. Trying to use the fitting with this then results in lots of divide by zero errors.
</p>
<p>
This test script demonstrates the problem:
</p>
<div class="code"><pre><span class="kn">from</span> <span class="nn">mantid.simpleapi</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c">#</span>
<span class="c"># Load</span>
<span class="c"># </span>
runs <span class="o">=</span> <span class="s">"14188-14195"</span>
spectra <span class="o">=</span> <span class="s">"135-142"</span>
diff_type<span class="o">=</span><span class="s">"SingleDifference"</span> <span class="c"># Allowed values=Single,Double,Thick</span>
ip_file <span class="o">=</span> <span class="s">"IP0004_10.par"</span>

raw_ws <span class="o">=</span> LoadVesuvio<span class="p">(</span>Filename<span class="o">=</span>runs<span class="p">,</span> SpectrumList<span class="o">=</span>spectra<span class="p">,</span>
                     Mode<span class="o">=</span>diff_type<span class="p">,</span>InstrumentParFile<span class="o">=</span>ip_file<span class="p">)</span>
raw_ws <span class="o">=</span> CropWorkspace<span class="p">(</span>raw_ws<span class="p">,</span>XMin<span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>XMax<span class="o">=</span><span class="mf">562.0</span><span class="p">)</span>


<span class="c">#</span>
<span class="c"># Correct - Usually this string would come out of being constructed from Fit</span>
<span class="c">#</span>
mass1_str <span class="o">=</span> <span class="s">"name=GramCharlierComptonProfile,WorkspaceIndex=0,Mass=1.007900,HermiteCoeffs=1 0 0,Width=4.226288,FSECoeff=0.498073,C_0=57.941101"</span>
mass2_str <span class="o">=</span> <span class="s">"name=GaussianComptonProfile,WorkspaceIndex=0,Mass=27.000000,Width=13.000000,Intensity=1.626268"</span>
mass3_str <span class="o">=</span> <span class="s">"name=GaussianComptonProfile,WorkspaceIndex=0,Mass=91.200000,Width=26.000000,Intensity=2.977515"</span>
func_str <span class="o">=</span> <span class="s">"</span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span><span class="p">(</span>mass1_str<span class="p">,</span>mass2_str<span class="p">,</span>mass3_str<span class="p">)</span>

background<span class="p">,</span>corrected <span class="o">=</span> CalculateGammaBackground<span class="p">(</span>InputWorkspace<span class="o">=</span>raw_ws<span class="p">,</span> ComptonFunction<span class="o">=</span>func_str<span class="p">,</span>WorkspaceIndexList<span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c"># Fit corrected</span>
<span class="c"># Convert to seconds</span>
ScaleX<span class="p">(</span>InputWorkspace<span class="o">=</span><span class="s">'corrected '</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">'corrected '</span><span class="p">,</span>Operation<span class="o">=</span><span class="s">'Multiply'</span><span class="p">,</span>Factor<span class="o">=</span><span class="mf">1e-06</span><span class="p">)</span>
ties_str <span class="o">=</span> <span class="s">"f1.Width=10.000000,f2.Width=25.000000"</span>
constraints_str <span class="o">=</span> <span class="s">"2.000000 &lt; f0.Width &lt; 7.000000"</span>

Fit<span class="p">(</span>InputWorkspace<span class="o">=</span><span class="s">'corrected '</span><span class="p">,</span>Function<span class="o">=</span>function_str<span class="p">,</span>Ties<span class="o">=</span>ties_str<span class="p">,</span>Constraints<span class="o">=</span>constraints_str<span class="p">,</span>
        Output<span class="o">=</span><span class="s">'fit'</span><span class="p">,</span> CreateOutput<span class="o">=</span><span class="bp">True</span><span class="p">,</span>OutputCompositeMembers<span class="o">=</span><span class="bp">True</span><span class="p">,</span>MaxIterations<span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
        Minimizer<span class="o">=</span><span class="s">"Levenberg-Marquardt,AbsError=1e-08,RelError=1e-08"</span><span class="p">)</span>
<span class="c"># Convert back to microseconds</span>
ScaleX<span class="p">(</span>InputWorkspace<span class="o">=</span><span class="s">'fit_Workspace'</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">'fit_Workspace'</span><span class="p">,</span>Operation<span class="o">=</span><span class="s">'Multiply'</span><span class="p">,</span>Factor<span class="o">=</span><span class="mf">1e06</span><span class="p">)</span>
ScaleX<span class="p">(</span>InputWorkspace<span class="o">=</span><span class="s">'corrected '</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">'corrected '</span><span class="p">,</span>Operation<span class="o">=</span><span class="s">'Multiply'</span><span class="p">,</span>Factor<span class="o">=</span><span class="mf">1e06</span><span class="p">)</span>
</pre></div>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="9166.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-12T09%3A33%3A27Z&amp;precision=second" title="2014-03-12T09:33:27Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="9166.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-13T15%3A07%3A59Z&amp;precision=second" title="2014-03-13T15:07:59Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Formatting changes to put the methods back in the right order
</p>
<p>
Refs <a class="closed ticket" href="9166.html" title="defect: CalculateGammaBackground does not copy the errors to the output workspace (closed: fixed)">#9166</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/0b44233e6593a3665bbc567f912b404d571775ae" title="0b44233e6593a3665bbc567f912b404d571775ae">0b44233e6593a3665bbc567f912b404d571775ae</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="9166.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-13T15%3A07%3A59Z&amp;precision=second" title="2014-03-13T15:07:59Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Copy errors across to corrected workspace for all cases.
</p>
<p>
Refs <a class="closed ticket" href="9166.html" title="defect: CalculateGammaBackground does not copy the errors to the output workspace (closed: fixed)">#9166</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/72cf3d077c02584227d9a716e83b118801f7eee2" title="72cf3d077c02584227d9a716e83b118801f7eee2">72cf3d077c02584227d9a716e83b118801f7eee2</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="9166.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-13T15%3A11%3A18Z&amp;precision=second" title="2014-03-13T15:11:18Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Branch: <a class="ext-link" href="https://github.com/mantidproject/mantid/compare/feature;9166_errors_on_calculategammabackground"><span class="icon">​</span>feature/9166_errors_on_calculategammabackground</a>
</p>
<p>
Tester: Use the script in the description to run the gamma correction. The location of the required files is described <a class="ext-link" href="8378.html#comment:19"><span class="icon">​</span>here</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="9166.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-21T14%3A59%3A42Z&amp;precision=second" title="2014-03-21T14:59:42Z in Timeline">7 years</a> ago by Keith Brown
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Keith Brown</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="9166.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-21T16%3A18%3A13Z&amp;precision=second" title="2014-03-21T16:18:13Z in Timeline">7 years</a> ago by Keith Brown
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/feature/9166_errors_on_calculategammabackground'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/6ea8f6edc3e054ae8e9b74486b63c3a59b193b9c"><span class="icon">​</span>6ea8f6edc3e054ae8e9b74486b63c3a59b193b9c</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="9166.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A06%3A57%2B01%3A00&amp;precision=second" title="2015-06-04T03:06:57+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10009"><span class="icon">​</span>10009</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9166?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9166?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9166?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>