<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #7218 (MonitorLiveDataTest occasional failures)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="7217.html" title="Ticket #7217" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7218?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7218?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7218?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="7219.html" title="Ticket #7219" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 7218, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="7217.html" title="Ticket #7217">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="7219.html" title="Ticket #7219">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="7218.html">Ticket #7218</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-05-30T22%3A11%3A11%2B01%3A00&amp;precision=second" title="2013-05-30T22:11:11+01:00 in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T01%3A46%3A14%2B01%3A00&amp;precision=second" title="2015-06-04T01:46:14+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">MonitorLiveDataTest occasional failures</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Russell+Taylor">Russell Taylor</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Russell+Taylor">Russell Taylor</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;2.6.html">Release 2.6</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;keywords=~LiveData">LiveData</a>
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Alex Buts
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Even after the fixes in <a class="closed ticket" href="6811.html" title="defect: MonitorLiveData(Test) race conditions (closed: fixed)">#6811</a>, this test still fails sometimes.
</p>
<p>
There are two places:
</p>
<ul><li>test_Allow_AnotherAlgo_IfTheOtherIsFinished: this is almost certainly because the threads don't behave nicely. It would be best to find a way that doesn't involve threads.
</li></ul><ul><li>test_EndRunBehavior_Rename: This one's a bit more worrying - pretty clearly a race condition.
<pre class="wiki">C:/jenkins/workspace/ornl_windows7_develop/Code/Mantid/Framework/DataHandling
/test/MonitorLiveDataTest.h:216: Error: Expected (ws1-&gt;getNumberEvents() ==
4*200), found (1600 != 800)
</pre></li></ul>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="7218.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-03T18%3A48%3A47%2B01%3A00&amp;precision=second" title="2013-06-03T18:48:47+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="7218.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-04T14%3A25%3A34%2B01%3A00&amp;precision=second" title="2013-06-04T14:25:34+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <h2 id="Madesomecommitsagainstthewrongticketnumber:"><em>Made some commits against the wrong ticket number:</em></h2>
<p>
Re <a class="closed ticket" href="7215.html" title="task: Move the MPI example scripts to the v2 python api (closed: fixed)">#7215</a>. Change testing strategy to avoid occasional failures.
</p>
<p>
I think the sporadic failures of this test were because alg2 had not started up even after the sleep. Calling validateInputs() instead accomplishes the same testing goal and avoid having to execute this instance of the algorithm at all.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/489709aecfada06d1e331eda7b4f201dd5818d08" title="489709aecfada06d1e331eda7b4f201dd5818d08">489709aecfada06d1e331eda7b4f201dd5818d08</a>
</p>
<hr />
<p>
Re <a class="closed ticket" href="7215.html" title="task: Move the MPI example scripts to the v2 python api (closed: fixed)">#7215</a>. Use the same simplification in other places.
</p>
<p>
I don't think I've seen these tests fail, but this is a simpler way to test the same thing so use it here as well.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/ba3b5b066e13419afe76e2a8a972c6a195f11ecf" title="ba3b5b066e13419afe76e2a8a972c6a195f11ecf">ba3b5b066e13419afe76e2a8a972c6a195f11ecf</a>
</p>
<hr />
<p>
Re <a class="closed ticket" href="7215.html" title="task: Move the MPI example scripts to the v2 python api (closed: fixed)">#7215</a>. Minor simplification.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/27f76c6c87b80688d0bca3686accbc1868b931ce" title="27f76c6c87b80688d0bca3686accbc1868b931ce">27f76c6c87b80688d0bca3686accbc1868b931ce</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="7218.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-04T16%3A45%3A04%2B01%3A00&amp;precision=second" title="2013-06-04T16:45:04+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7218.html" title="defect: MonitorLiveDataTest occasional failures (closed: fixed)">#7218</a>. Lock the workspace during the clone operation.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/4f65381d336cf2d86c9e5e684433f82448a7fedb" title="4f65381d336cf2d86c9e5e684433f82448a7fedb">4f65381d336cf2d86c9e5e684433f82448a7fedb</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="7218.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-04T20%3A24%3A08%2B01%3A00&amp;precision=second" title="2013-06-04T20:24:08+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7218.html" title="defect: MonitorLiveDataTest occasional failures (closed: fixed)">#7218</a>. Try to make tests more robust to slow thread startup.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/e1f19e71349405b09db4fc0d7667f7489afbefa1" title="e1f19e71349405b09db4fc0d7667f7489afbefa1">e1f19e71349405b09db4fc0d7667f7489afbefa1</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="7218.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-04T20%3A24%3A08%2B01%3A00&amp;precision=second" title="2013-06-04T20:24:08+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7218.html" title="defect: MonitorLiveDataTest occasional failures (closed: fixed)">#7218</a>. Remove a redundant test.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/c0442dbc2930c6179a82bc6ca7f3cf50fb6ce68b" title="c0442dbc2930c6179a82bc6ca7f3cf50fb6ce68b">c0442dbc2930c6179a82bc6ca7f3cf50fb6ce68b</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="7218.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-04T20%3A39%3A07%2B01%3A00&amp;precision=second" title="2013-06-04T20:39:07+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="7218.html" title="defect: MonitorLiveDataTest occasional failures (closed: fixed)">#7218</a>. Use a unique workspace name for this test.
</p>
<p>
Although there's a setUp method that clears the ADS, I think it's possible
for the previous test to still be running and to pop its workspace back
in there, which could possibly be why this test occasionally fails.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/5f97f619ec14d485bd5e63a30cc29bfd588978bf" title="5f97f619ec14d485bd5e63a30cc29bfd588978bf">5f97f619ec14d485bd5e63a30cc29bfd588978bf</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="7218.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-04T20%3A55%3A16%2B01%3A00&amp;precision=second" title="2013-06-04T20:55:16+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>7243</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="7218.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-04T21%3A22%3A48%2B01%3A00&amp;precision=second" title="2013-06-04T21:22:48+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li><li>
      <strong>Blocking</strong>
        <em>7243</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Branch is feature/7218_monitorlivedata_occasional_test_failures
</p>
<p>
Test by checking for any failures of this test after today (4 June) <a class="ext-link" href="https://builds.sns.gov/view/Wall%20display/job/ornl_windows7_develop/lastCompletedBuild/testReport/DataHandlingTest/MonitorLiveDataTest/history/?"><span class="icon">​</span>here</a> and <a class="ext-link" href="http://download.mantidproject.org/jenkins/job/is_inc_win7_develop/lastCompletedBuild/testReport/DataHandlingTest/MonitorLiveDataTest/history/?"><span class="icon">​</span>here</a>.
</p>
<p>
I'm pretty sure I've fixed the first problem in the description, but not so confident on the second one - my best guess is the last commit above. If one is fixed but not the other, please create a new ticket for the still-broken one so that we can get at least one fix into master.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="7218.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-07T17%3A28%3A36%2B01%3A00&amp;precision=second" title="2013-06-07T17:28:36+01:00 in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Alex Buts</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="7218.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-06-07T19%3A12%3A24%2B01%3A00&amp;precision=second" title="2013-06-07T19:12:24+01:00 in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
ORNL windows dead from 4th of June but ISIS works fine without problems with this test. 
Ok -- I can assume it may be considered fixed. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="7218.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-07-24T09%3A53%3A42%2B01%3A00&amp;precision=second" title="2013-07-24T09:53:42+01:00 in Timeline">7 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Component</strong>
        changed from <em>Mantid</em> to <em>Framework</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="7218.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T01%3A46%3A14%2B01%3A00&amp;precision=second" title="2015-06-04T01:46:14+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/8064"><span class="icon">​</span>8064</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7218?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7218?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7218?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>