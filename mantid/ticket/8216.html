<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #8216 (Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="8215.html" title="Ticket #8215" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8216?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8216?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8216?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="8217.html" title="Ticket #8217" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 8216, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="8215.html" title="Ticket #8215">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="8217.html" title="Ticket #8217">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="8216.html">Ticket #8216</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-10-24T16%3A43%3A06%2B01%3A00&amp;precision=second" title="2013-10-24T16:43:06+01:00 in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A27%3A34%2B01%3A00&amp;precision=second" title="2015-06-04T02:27:34+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Martyn+Gigg">Martyn Gigg</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Martyn+Gigg">Martyn Gigg</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              nick.draper@…, alex.buts@…
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Alex Buts
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2013-12-17 09:16:31.912923+00:00">
        (last modified by Martyn Gigg)
        (<a href="https://trac.mantidproject.org/mantid/ticket/8216?action=diff&amp;version=5">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <div class="code"><pre>whitebeamfile<span class="o">=</span><span class="s">"MER06398"</span>
LoadRaw<span class="p">(</span>Filename<span class="o">=</span>whitebeamfile<span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">"wb_wksp"</span><span class="p">,</span>LoadLogFiles<span class="o">=</span><span class="s">"0"</span><span class="p">)</span>
white_ws <span class="o">=</span> ConvertUnits<span class="p">(</span>InputWorkspace<span class="o">=</span><span class="s">"wb_wksp"</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">"wb_wksp"</span><span class="p">,</span> Target<span class="o">=</span> <span class="s">"Energy"</span><span class="p">,</span> AlignBins<span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div><p>
Running the above script on Windows produces a workspace with ~70000 spectra and 2637 bins. The ConvertUnits call causes the X vectors to "unshare" and so that spectrum has a unique X vector. Hitting delete on the workspace locks Mantid while it deletes.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="8216.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-10-24T16%3A48%3A55%2B01%3A00&amp;precision=second" title="2013-10-24T16:48:55+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>Backlog</em> to <em>Release 3.1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="8216.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-10-24T16%3A49%3A02%2B01%3A00&amp;precision=second" title="2013-10-24T16:49:02+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        set to <em>Martyn Gigg</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="8216.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-10-24T17%3A02%3A39%2B01%3A00&amp;precision=second" title="2013-10-24T17:02:39+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Summary</strong>
        changed from <em>Windows: Deleting large Workspace2Ds is very slow</em> to <em>Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="8216.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-10-25T07%3A45%3A45%2B01%3A00&amp;precision=second" title="2013-10-25T07:45:45+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Cc</strong>
        <em>alex.buts@…</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="8216.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-17T09%3A16%3A31Z&amp;precision=second" title="2013-12-17T09:16:31Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/8216?action=diff&amp;version=5">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="8216.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T13%3A34%3A21Z&amp;precision=second" title="2014-01-31T13:34:21Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>Release 3.1</em> to <em>Release 3.2</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="8216.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A12%3A25Z&amp;precision=second" title="2014-03-17T13:12:25Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Put Workspace2D spectra delete in OpenMP loop.
</p>
<p>
On MSVC this improves the time taken to delete large workspaces that have
had their memory allocated on multiple threads, i.e. running ConvertUnits
and breaking the X-data sharing. For example, a workspace
with ~70000 spectra &amp; ~2600 bins (~4.3Gb) takes ~45 seconds to delete
after a ConvertUnits call. This drops to 1-2s if the deallocation of the
memory also happens within a multi-threaded loop.
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/e81d0d89be3d0b5697b5e2937cd30350b3e2f471" title="e81d0d89be3d0b5697b5e2937cd30350b3e2f471">e81d0d89be3d0b5697b5e2937cd30350b3e2f471</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="8216.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A12%3A25Z&amp;precision=second" title="2014-03-17T13:12:25Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Use DeleteWorkspace algorithm behind GUI delete button.
</p>
<p>
This then won't block on the main thread if the deletion takes a bit of
time.
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/63296e3cc9ff4ff04caf4c3d351dac1dc264db3f" title="63296e3cc9ff4ff04caf4c3d351dac1dc264db3f">63296e3cc9ff4ff04caf4c3d351dac1dc264db3f</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="8216.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A12%3A25Z&amp;precision=second" title="2014-03-17T13:12:25Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Define a set of GlobalFixtures for the unittests.
</p>
<p>
Currently these clear the AnalysisDataService &amp; AlgorithmManager when
their tearDownWorld() methods are called, which ensures that all
workspaces placed in these singletons are cleared up before the end of
main.
</p>
<p>
If this it not done then the process hangs on MSVC while trying to
delete a Workspace2D, which contains an OpenMP loop in its destructor and
omp is not allowed to be called on Windows outside of main.
</p>
<p>
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/f564331e9738a97cb113d522c0e665e929abaf7e" title="f564331e9738a97cb113d522c0e665e929abaf7e">f564331e9738a97cb113d522c0e665e929abaf7e</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="8216.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A12%3A25Z&amp;precision=second" title="2014-03-17T13:12:25Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Add comments for Workspace2D destructor &amp; test tearDowns
</p>
<p>
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/015ca434cd7ce2380be5b73c543685c7103dc9d2" title="015ca434cd7ce2380be5b73c543685c7103dc9d2">015ca434cd7ce2380be5b73c543685c7103dc9d2</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="8216.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A12%3A26Z&amp;precision=second" title="2014-03-17T13:12:26Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Add the PropertyManagerDataService to the TearDownWorld test helper.
</p>
<p>
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/f0a3080f0c4261b665a28d180837d0f96def0c6c" title="f0a3080f0c4261b665a28d180837d0f96def0c6c">f0a3080f0c4261b665a28d180837d0f96def0c6c</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="8216.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A12%3A26Z&amp;precision=second" title="2014-03-17T13:12:26Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Formatting only changes to remove tabs.
</p>
<p>
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/69e528aba108598fca2edc11a7fbf8e4c693d677" title="69e528aba108598fca2edc11a7fbf8e4c693d677">69e528aba108598fca2edc11a7fbf8e4c693d677</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="8216.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A12%3A26Z&amp;precision=second" title="2014-03-17T13:12:26Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Empty out the DataService objects before python exits.
</p>
<p>
The instance methods are tracked using a reference count. When the
count reaches zero then it is assumed that the final object is being
deleted and the service is cleared.
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/9ed8f06b0487d886b2832e2431b4c4429ddd4a27" title="9ed8f06b0487d886b2832e2431b4c4429ddd4a27">9ed8f06b0487d886b2832e2431b4c4429ddd4a27</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="8216.html#comment:14">comment:14</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A31%3A14Z&amp;precision=second" title="2014-03-17T13:31:14Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Add required includes for non-precompiled header platforms.
</p>
<p>
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/184995f2a31438030c41245708516c9ee9ae9979" title="184995f2a31438030c41245708516c9ee9ae9979">184995f2a31438030c41245708516c9ee9ae9979</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="8216.html#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A40%3A48Z&amp;precision=second" title="2014-03-17T13:40:48Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Add required namespace using statement.
</p>
<p>
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/041595bfb6172c0a83ebd7545c88541436bfe3f6" title="041595bfb6172c0a83ebd7545c88541436bfe3f6">041595bfb6172c0a83ebd7545c88541436bfe3f6</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="8216.html#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T13%3A48%3A23Z&amp;precision=second" title="2014-03-17T13:48:23Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Remove unecessary typename statement from non-template scope.
</p>
<p>
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/83c16b067ef932455804efec326df8f2ef6fd1da" title="83c16b067ef932455804efec326df8f2ef6fd1da">83c16b067ef932455804efec326df8f2ef6fd1da</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="8216.html#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T14%3A38%3A44Z&amp;precision=second" title="2014-03-17T14:38:44Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-18">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:18" class="cnum">
      <a href="8216.html#comment:18">comment:18</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-18T14%3A26%3A38Z&amp;precision=second" title="2014-03-18T14:26:38Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-19">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:19" class="cnum">
      <a href="8216.html#comment:19">comment:19</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-19T19%3A23%3A02Z&amp;precision=second" title="2014-03-19T19:23:02Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
    <div class="comment searchable">
      
      <p>
Only run the Workspace2D delete in parallel on MSVC.
</p>
<p>
It looks as if some performance tests on Linux have suffered slightly
from the running the delete in parallel there too.
Refs <a class="closed ticket" href="8216.html" title="defect: Windows: Deleting large Workspace2Ds is very slow. Seen on MERLIN, WISH (closed: fixed)">#8216</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/5b5be7ccd1e345274ed72e3a542f37cc181e371a" title="5b5be7ccd1e345274ed72e3a542f37cc181e371a">5b5be7ccd1e345274ed72e3a542f37cc181e371a</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="8216.html#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-20T08%3A54%3A42Z&amp;precision=second" title="2014-03-20T08:54:42Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Branch: feature/8216_slow_ws_del_win
</p>
<p>
Tester: This bug only affected windows so it needs to be tested there. From the <a class="ext-link" href="http://download.mantidproject.org/jenkins/view/Develop%20Clean%20Builds%20and%20Tests/job/is_test_win7_develop/369/testReport/SystemTests/ISISDirectInelastic/"><span class="icon">​</span>system test timings</a> you can now see that the MERLIN reduction takes about 2 minutes, whereas it used to take 11 minutes on the test machine.
</p>
<p>
Run the script defined in the description and delete the workspace. It should now only take moments rather than minutes.
</p>
<p>
The only change actually required to improve the performance was the OpenMP loop in the Workspace2D destructor. The other changes were required so that no workspaces would be deleted after the <tt>main()</tt> function has exited, i.e  in the singleton destruction. 
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-20T08%3A54%3A59Z&amp;precision=second" title="2014-03-20T08:54:59Z in Timeline">7 years</a> ago
                      by Martyn Gigg
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8216?cversion=0&amp;cnum_hist=20#comment:20">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8216?action=comment-diff&amp;cnum=20&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-21">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:21" class="cnum">
      <a href="8216.html#comment:21">comment:21</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-20T19%3A16%3A24Z&amp;precision=second" title="2014-03-20T19:16:24Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Alex Buts</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-22">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:22" class="cnum">
      <a href="8216.html#comment:22">comment:22</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-25T15%3A09%3A09Z&amp;precision=second" title="2014-03-25T15:09:09Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/feature/8216_slow_ws_del_win'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/079e1adf1d2b26cbd3d1206868bddaf0b2451a14"><span class="icon">​</span>079e1adf1d2b26cbd3d1206868bddaf0b2451a14</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-23">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:23" class="cnum">
      <a href="8216.html#comment:23">comment:23</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-25T15%3A15%3A04Z&amp;precision=second" title="2014-03-25T15:15:04Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
Large reduction under win have accelerated ~twofold so its a big gain.
</p>
<blockquote>
<p>
It is still substantially slower then on equivalent Unix machine so there are possibilities for improvement. 
</p>
</blockquote>
<p>
Do not properly understand changes to python interface so have to trust the developer on that. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-24">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:24" class="cnum">
      <a href="8216.html#comment:24">comment:24</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A27%3A34%2B01%3A00&amp;precision=second" title="2015-06-04T02:27:34+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/9061"><span class="icon">​</span>9061</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8216?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8216?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8216?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>