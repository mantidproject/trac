<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #9455 (FilterClusterFaces enhancements)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="9454.html" title="Ticket #9454" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9455?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9455?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9455?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="9456.html" title="Ticket #9456" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 9455, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="9454.html" title="Ticket #9454">Previous Ticket</a></span></li><li><span><a class="next" href="9456.html" title="Ticket #9456">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/9455.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="9455.html">Ticket #9455</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T08%3A24%3A32%2B01%3A00&amp;precision=second" title="2014-05-14T08:24:32+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A18%3A58%2B01%3A00&amp;precision=second" title="2015-06-04T03:18:58+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">FilterClusterFaces enhancements</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Owen+Arnold">Owen Arnold</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Owen+Arnold">Owen Arnold</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Diffraction">Diffraction</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span><a class="closed ticket" href="9428.html" title="FindClusterFaces Algorithm">#9428</a></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Samuel Jackson
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2014-05-15 08:43:46.929183+00:00">
        (last modified by Owen Arnold)
        (<a href="https://trac.mantidproject.org/mantid/ticket/9455?action=diff&amp;version=14">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <ul><li>If FilteringWorkspace is provided, then output an additional column with the radius of the face from the peak centre. This will allow client code to determine an effective radius of each cluster
</li><li>Check that the MDHistoWorkspace provided actually contains labels ids rather than being a generic MDHistoWorkspace. I think the algorithm would probably badly misbehave if the latter case was currently provided. To check. For each signal value perform signal_value%1 == 0.
</li><li>Parallelise the algorithm according to the criteria already defined in the algorithm comments. As an intermediate data structure, TableWorkspaces themselves may work best.
</li><li>Add the ability to limit the number of output rows, and report that truncation has occurred in that eventuality.
</li></ul>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="9455.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T08%3A49%3A58%2B01%3A00&amp;precision=second" title="2014-05-14T08:49:58+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
For the performance side of things - current timings on my Release Windows 7 build are:
</p>
<p>
test_execution_unfiltered = 0.015 seconds
</p>
<p>
test_execution_filtered = 0.018 seconds
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T12%3A02%3A41%2B01%3A00&amp;precision=second" title="2014-05-14T12:02:41+01:00 in Timeline">6 years</a> ago
                      by Owen Arnold
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9455?cversion=0&amp;cnum_hist=1#comment:1">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9455?action=comment-diff&amp;cnum=1&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="9455.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T11%3A14%3A01%2B01%3A00&amp;precision=second" title="2014-05-14T11:14:01+01:00 in Timeline">6 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="9455.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T12%3A01%3A48%2B01%3A00&amp;precision=second" title="2014-05-14T12:01:48+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Create and use intermediate structure
</p>
<p>
This is easy and safe to do, because unit tests will pick up any changes
in the final output TableWorkspace.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/989d5e068e0b67a2f97afd8e95fe41bdec151e95" title="989d5e068e0b67a2f97afd8e95fe41bdec151e95">989d5e068e0b67a2f97afd8e95fe41bdec151e95</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="9455.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T12%3A01%3A48%2B01%3A00&amp;precision=second" title="2014-05-14T12:01:48+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Break jobs into distributed parts.
</p>
<p>
This is not yet executing in the context of an openMP loop, but the
working is now fully separated, and should be thread-safe.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/eb592e4edfd2dc0c512a59791aa5c81d02796b06" title="eb592e4edfd2dc0c512a59791aa5c81d02796b06">eb592e4edfd2dc0c512a59791aa5c81d02796b06</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="9455.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T12%3A01%3A49%2B01%3A00&amp;precision=second" title="2014-05-14T12:01:49+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Run jobs in parallel.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/5ba3891cdb71d7cce2dbff1d90bf5cede6a2734b" title="5ba3891cdb71d7cce2dbff1d90bf5cede6a2734b">5ba3891cdb71d7cce2dbff1d90bf5cede6a2734b</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="9455.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T12%3A06%3A56%2B01%3A00&amp;precision=second" title="2014-05-14T12:06:56+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
The refactoring to distributable execution step did not slow the processing down by any noticeable amount. I expect that it would slow it down given that the rows could not be written until the end. The last stage where the open mp loop was switched on resulted in a good speed improvement. 
</p>
<p>
test_execution_unfiltered = 0.008 seconds
</p>
<p>
test_execution_filtered = 0.009 seconds
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="9455.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T16%3A08%3A28%2B01%3A00&amp;precision=second" title="2014-05-14T16:08:28+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Add progress reporting.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/62486340c7210f7f137ca831a3f8a7f2a0c63fc9" title="62486340c7210f7f137ca831a3f8a7f2a0c63fc9">62486340c7210f7f137ca831a3f8a7f2a0c63fc9</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="9455.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T16%3A08%3A28%2B01%3A00&amp;precision=second" title="2014-05-14T16:08:28+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Add signal value checking.
</p>
<p>
Add tests for this too.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/49a64918a64edc9bbb3241425e1287b62e6a9ebd" title="49a64918a64edc9bbb3241425e1287b62e6a9ebd">49a64918a64edc9bbb3241425e1287b62e6a9ebd</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="9455.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T16%3A08%3A29%2B01%3A00&amp;precision=second" title="2014-05-14T16:08:29+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Add radius calculation.
</p>
<p>
The code is functionally correct, as the tests show, but the
implementation is not good. Needs some refactoring work before this is
complete.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/98a5b8a27b861b6c82db43568bb263f6a2f0111c" title="98a5b8a27b861b6c82db43568bb263f6a2f0111c">98a5b8a27b861b6c82db43568bb263f6a2f0111c</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="9455.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-14T17%3A10%3A53%2B01%3A00&amp;precision=second" title="2014-05-14T17:10:53+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Refactor to separate processing.
</p>
<p>
Refactor to separate out unfiltered from filtered processing. Code
duplication still needs to be addressed.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/927ae6c47c5904aebf86af83ed853a5e283c021e" title="927ae6c47c5904aebf86af83ed853a5e283c021e">927ae6c47c5904aebf86af83ed853a5e283c021e</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="9455.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T08%3A50%3A15%2B01%3A00&amp;precision=second" title="2014-05-15T08:50:15+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Refactoring to achieve better code reuse.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/b0ef8e344b472ab1b2eadc402ae82f30f4ae3f29" title="b0ef8e344b472ab1b2eadc402ae82f30f4ae3f29">b0ef8e344b472ab1b2eadc402ae82f30f4ae3f29</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="9455.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T09%3A33%3A27%2B01%3A00&amp;precision=second" title="2014-05-15T09:33:27+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Add row limit features.
</p>
<p>
Fully tested functionality provided.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/7593279b23fe2b6adfa02ba7a41e7e17200a321b" title="7593279b23fe2b6adfa02ba7a41e7e17200a321b">7593279b23fe2b6adfa02ba7a41e7e17200a321b</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="9455.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T09%3A38%3A53%2B01%3A00&amp;precision=second" title="2014-05-15T09:38:53+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Fix warning.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/bee839acc5e0d774f3d1ebf2c21e4a84261d7348" title="bee839acc5e0d774f3d1ebf2c21e4a84261d7348">bee839acc5e0d774f3d1ebf2c21e4a84261d7348</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="9455.html#comment:14">comment:14</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T09%3A43%3A46%2B01%3A00&amp;precision=second" title="2014-05-15T09:43:46+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/9455?action=diff&amp;version=14">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="9455.html#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T09%3A46%3A35%2B01%3A00&amp;precision=second" title="2014-05-15T09:46:35+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Remove qualifier.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/fe2552e74e9385337e0b1db01b2dae52970f812e" title="fe2552e74e9385337e0b1db01b2dae52970f812e">fe2552e74e9385337e0b1db01b2dae52970f812e</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="9455.html#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T10%3A03%3A08%2B01%3A00&amp;precision=second" title="2014-05-15T10:03:08+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. Fix type conversion warnings.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/6eb03a2453201f32ae176a62e356c89646cf9516" title="6eb03a2453201f32ae176a62e356c89646cf9516">6eb03a2453201f32ae176a62e356c89646cf9516</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="9455.html#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T10%3A40%3A50%2B01%3A00&amp;precision=second" title="2014-05-15T10:40:50+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9455.html" title="enhancement: FilterClusterFaces enhancements (closed: fixed)">#9455</a>. All column names uppercase.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/9901b25fc3709cba3c927a91e209236efcfb70b6" title="9901b25fc3709cba3c927a91e209236efcfb70b6">9901b25fc3709cba3c927a91e209236efcfb70b6</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-18">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:18" class="cnum">
      <a href="9455.html#comment:18">comment:18</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-15T10%3A49%3A21%2B01%3A00&amp;precision=second" title="2014-05-15T10:49:21+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Tester:
</p>
<p>
There are quite a few changes here. All changes are either covered by functional unit tests or performance tests.
</p>
<p>
To test the new radius functionality. Run this script. You should see that the main cluster has the same radius extents (in the SliceViewer) as reported at the end of the script.
</p>
<div class="code"><pre>
ws_name <span class="o">=</span> <span class="s">"TOPAZ_3132"</span>
filename <span class="o">=</span> ws_name <span class="o">+</span><span class="s">"_event.nxs"</span>
ws <span class="o">=</span> LoadEventNexus<span class="p">(</span>Filename<span class="o">=</span>filename<span class="p">,</span>FilterByTofMin<span class="o">=</span><span class="mi">3000</span><span class="p">,</span> FilterByTofMax<span class="o">=</span><span class="mi">16000</span><span class="p">)</span>

<span class="c"># Convert to Q space</span>
LabQ <span class="o">=</span> ConvertToDiffractionMDWorkspace<span class="p">(</span>InputWorkspace<span class="o">=</span>ws<span class="p">,</span> LorentzCorrection<span class="o">=</span><span class="s">'0'</span><span class="p">,</span>
        OutputDimensions<span class="o">=</span><span class="s">'Q (lab frame)'</span><span class="p">,</span> SplitInto<span class="o">=</span><span class="mi">2</span><span class="p">,</span> SplitThreshold<span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        
<span class="c"># Find peaks</span>
PeaksLattice <span class="o">=</span> FindPeaksMD<span class="p">(</span>InputWorkspace<span class="o">=</span>LabQ<span class="p">,</span>MaxPeaks<span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        
<span class="c"># Find the UB matrix using the peaks and known lattice parameters</span>
FindUBUsingLatticeParameters<span class="p">(</span>PeaksWorkspace<span class="o">=</span>PeaksLattice<span class="p">,</span> a<span class="o">=</span><span class="mf">10.3522</span><span class="p">,</span> b<span class="o">=</span><span class="mf">6.0768</span><span class="p">,</span> c<span class="o">=</span><span class="mf">4.7276</span><span class="p">,</span>
                alpha<span class="o">=</span><span class="mi">90</span><span class="p">,</span> beta<span class="o">=</span><span class="mi">90</span><span class="p">,</span> gamma<span class="o">=</span><span class="mi">90</span><span class="p">,</span> NumInitial<span class="o">=</span><span class="mi">20</span><span class="p">,</span> Tolerance<span class="o">=</span><span class="mf">0.12</span><span class="p">)</span>
                
<span class="c"># And index to HKL            </span>
IndexPeaks<span class="p">(</span>PeaksWorkspace<span class="o">=</span>PeaksLattice<span class="p">,</span> Tolerance<span class="o">=</span><span class="mf">0.12</span><span class="p">)</span>

HistoMDQLab <span class="o">=</span> BinMD<span class="p">(</span>InputWorkspace<span class="o">=</span>LabQ<span class="p">,</span>AlignedDim0<span class="o">=</span><span class="s">'Q_lab_x, 2.7, 3, 50'</span><span class="p">,</span>AlignedDim1<span class="o">=</span><span class="s">'Q_lab_y, -0.9, -0.6, 50'</span><span class="p">,</span>AlignedDim2<span class="o">=</span><span class="s">'Q_lab_z, 9.2, 9.5,  50'</span><span class="p">)</span>   
PeaksLattice_Integrated_Clusters<span class="p">,</span> ClusterImage <span class="o">=</span> IntegratePeaksUsingClusters<span class="p">(</span>InputWorkspace<span class="o">=</span>HistoMDQLab<span class="p">,</span> PeaksWorkspace<span class="o">=</span>PeaksLattice<span class="p">,</span> Threshold<span class="o">=</span><span class="mi">100000</span><span class="p">)</span>

<span class="c"># Show Cluster with Peak Overlayed. Only One point where a PeaksWorkspace intersects with a Cluster!</span>
svw <span class="o">=</span> plotSlice<span class="p">(</span>ClusterImage<span class="p">,</span> xydim<span class="o">=</span><span class="p">[</span><span class="s">'Q_lab_x'</span><span class="p">,</span> <span class="s">'Q_lab_z'</span><span class="p">])</span>
sv <span class="o">=</span> svw<span class="o">.</span>getSlicer<span class="p">()</span>
pp_all <span class="o">=</span> sv<span class="o">.</span>setPeaksWorkspaces<span class="p">([</span>PeaksLattice_Integrated_Clusters<span class="p">])</span>
pp <span class="o">=</span> pp_all<span class="o">.</span>getPeaksPresenter<span class="p">(</span>PeaksLattice_Integrated_Clusters<span class="p">)</span>
pp<span class="o">.</span>zoomToPeak<span class="p">(</span><span class="mi">30</span><span class="p">)</span>
svw<span class="o">.</span>zoomBy<span class="p">(</span><span class="mf">0.03</span><span class="p">)</span>

<span class="c"># So finding with the PeaksWorkspace as a filter should yield results that have the SAME value for 'ClusterId 'in all rows!</span>
with_filter<span class="p">,</span> truncated <span class="o">=</span> FindClusterFaces<span class="p">(</span>InputWOrkspace<span class="o">=</span>ClusterImage<span class="p">,</span> FilterWorkspace<span class="o">=</span>PeaksLattice<span class="p">)</span>

<span class="k">def</span> <span class="nf">max_radius</span><span class="p">(</span>t<span class="p">):</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0</span>
        <span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>t<span class="o">.</span>rowCount<span class="p">()):</span>
                _row <span class="o">=</span>  t<span class="o">.</span>row<span class="p">(</span>i<span class="p">)</span>
                current_radius <span class="o">=</span> _row<span class="p">[</span><span class="s">'Radius'</span><span class="p">]</span> 
                <span class="k">if</span>  current_radius <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
                        <span class="nb">max</span> <span class="o">=</span> current_radius
        <span class="k">return</span> <span class="nb">max</span>
        

radius_estimate <span class="o">=</span>  max_radius<span class="p">(</span>with_filter<span class="p">)</span>
<span class="k">print</span> <span class="s">"Radius estimate for the cluster is : "</span><span class="p">,</span> radius_estimate

</pre></div>
    </div>

              </div>
              <div class="change" id="trac-change-19">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:19" class="cnum">
      <a href="9455.html#comment:19">comment:19</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-16T14%3A26%3A22%2B01%3A00&amp;precision=second" title="2014-05-16T14:26:22+01:00 in Timeline">6 years</a> ago by Samuel Jackson
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Samuel Jackson</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="9455.html#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-16T15%3A17%3A55%2B01%3A00&amp;precision=second" title="2014-05-16T15:17:55+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/feature/9455_cluster_faces_enhance'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/4f5df39b581350d6b6f931b15fc60608f621fbd1"><span class="icon">​</span>4f5df39b581350d6b6f931b15fc60608f621fbd1</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-21">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:21" class="cnum">
      <a href="9455.html#comment:21">comment:21</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A18%3A58%2B01%3A00&amp;precision=second" title="2015-06-04T03:18:58+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10298"><span class="icon">​</span>10298</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9455?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9455?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9455?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>