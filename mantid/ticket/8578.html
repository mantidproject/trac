<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #8578 (Python Reduction does not change reduction argiments three times (thread/memory corruption suspected))
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="8577.html" title="Ticket #8577" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8578?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8578?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8578?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="8579.html" title="Ticket #8579" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 8578, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="8577.html" title="Ticket #8577">Previous Ticket</a></span></li><li><span><a class="next" href="8579.html" title="Ticket #8579">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/8578.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="8578.html">Ticket #8578</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T11%3A38%3A54Z&amp;precision=second" title="2013-12-09T11:38:54Z in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A42%3A32%2B01%3A00&amp;precision=second" title="2015-06-04T02:42:32+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Python Reduction does not change reduction argiments three times (thread/memory corruption suspected)</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Alex+Buts">Alex Buts</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Alex+Buts">Alex Buts</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.1.html">Release 3.1</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Direct+Inelastic">Direct Inelastic</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              martyn.gigg@…, nick.draper@…, jon.taylor@…
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span><a class="closed ticket" href="8640.html" title="Restore changes which  apply detector corrections at loading">#8640</a></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Martyn Gigg
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2013-12-09 11:45:58.217044+00:00">
        (last modified by Alex Buts)
        (<a href="https://trac.mantidproject.org/mantid/ticket/8578?action=diff&amp;version=3">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <p>
The description below demonstrates generic problem -- a python script (reduction) does not accept third in a row change to the input parameters. To change parameters for the third time, Mantid restart is needed (which makes it the first change). 
</p>
<p>
If one tries the reduction script found below,
first time you request to run hardmaskPlus, it runs the whole diagnostics:
</p>
<pre class="wiki">==== Diagnostic Test Summary from: start to: end ====
Hard mask:               mar11015.msk  11
First white beam test:   white_masks   2
Second white beam test:  None          None
Background test:         mask_bkgd     2
PSD Bleed test :         None          None
</pre><p>
Second times it runs hadmask only as requested:
</p>
<pre class="wiki">Diag Processed  workspace with 918 spectra and masked 11 bad spectra
</pre><p>
But the third time, which should produce the run, equivalent to the first run it runs diagnostics only again:
</p>
<pre class="wiki">Diag Processed  workspace with 918 spectra and masked 11 bad spectra
</pre><p>
If you run this script again, it newer runs full diagnostics. 
</p>
<pre class="wiki">"""
Script to perform absolute units data reduction for MARI
"""
#from qtiGenie import *
import dgreduce
import time

dgreduce.setup('MAR')
ext='.raw'

# where to save resutls (usually specified in Mantid, data search directories)
save_dir = config.getString('defaultsave.directory')
if len(save_dir) ==0 :
    config['defaultsave.directory']=os.getcwd()
    save_dir = config.getString('defaultsave.directory')
    
print "Data will be saved into: ",save_dir
# map mask and cal file, again the values from Mantid, data search directories can be modified here
config.appendDataSearchDir('/usr/local/mprogs/InstrumentFiles/mari') 
config.appendDataSearchDir(r'c:\mprogs\ISIS\Libisis\InstrumentFiles\mari') 
# data (raw or nxs) run files -- values from data search directories can be modified here
config.appendDataSearchDir('/isisdatar55/NDXMARI/Instrument/data/cycle_05_1') 
config.appendDataSearchDir(r'd:/Data/MantidSystemTests/Data') 


maskfile='mar11015.msk' #'testMask2.msk'#hard mask out the edges of detectors, which tend to be noisy

#map file
mapfile='mari_res.map' # mapping file
#mapfile='/opt/Mantid/instrument/mapfiles/maps/parker_rings' #powder mapping file
mv_mapfile='4to1_mid_lowang'

# latest white beam vanadium file for bad detector diagnosis
wbvan=11060

#Run numbers can be specified as a list:
#runno=[17422,17423, etc]
runno=[11001] #[19399] #,[00004] 19402]

#Incident energy list e.g. ei=[20,30,40]
ei=12

#Sample info
sam_rmm = 435.96
#sam_mass= 2.465
sam_mass = 10
    
rebin_pars=[-11,0.05,11]
monovan=11015
argi = {};
argi['hardmaskPlus']=maskfile 
argi['sample_mass'] = sam_mass   
argi['sample_rmm']   =sam_rmm 


print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
for i in range(len(runno)):
        #w1=iliad_abs(wbvan,runno[i],monovan,wbvan,sam_rmm,sam_mass,ei[i],rebin_pars,mapfile,mv_mapfile,**argi)
        # this does absolute units normalization as far as monovan is not None. Uses default map file, provided in MAPS_Parameters.xml file. Any changes from defaults should be provided here or above as parameters
        w1=dgreduce.arb_units(wbvan,runno[i],ei,rebin_pars,None,monovan,**argi)

	save_file='MAR'+str(runno[i])+'_ei'+str(ei)  
	SaveNXSPE(w1,save_file+'_Abs.nxspe')
	#SaveNexus(w1,save_file+'newDgrd_NewQTG_NewDirectConv.nxs')	
	DeleteWorkspace(w1)


argi['hardmaskOnly']=maskfile 
print 'HARD MASK ONLY ------------------------------------------------------------------------------------------------'
print 'HARD MASK ONLY-----------------------------------------------------------------------------------------------'
print 'HARD MASK ONLY---------------------------------------------------------------------------------------------'


for i in range(len(runno)):
        #w1=iliad_abs(wbvan,runno[i],monovan,wbvan,sam_rmm,sam_mass,ei[i],rebin_pars,mapfile,mv_mapfile,**argi)
        # this does absolute units normalization as far as monovan is not None. Uses default map file, provided in MAPS_Parameters.xml file. Any changes from defaults should be provided here or above as parameters
        w1=dgreduce.arb_units(wbvan,runno[i],ei,rebin_pars,None,monovan,**argi)

	save_file='MAR'+str(runno[i])+'_ei'+str(ei)  
	SaveNXSPE(w1,save_file+'_Abs.nxspe')
	#SaveNexus(w1,save_file+'newDgrd_NewQTG_NewDirectConv.nxs')	
	DeleteWorkspace(w1)

argi['hardmaskPlus']=maskfile 

print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
for i in range(len(runno)):
        #w1=iliad_abs(wbvan,runno[i],monovan,wbvan,sam_rmm,sam_mass,ei[i],rebin_pars,mapfile,mv_mapfile,**argi)
        # this does absolute units normalization as far as monovan is not None. Uses default map file, provided in MAPS_Parameters.xml file. Any changes from defaults should be provided here or above as parameters
        w1=dgreduce.arb_units(wbvan,runno[i],ei,rebin_pars,None,monovan,**argi)

	save_file='MAR'+str(runno[i])+'_ei'+str(ei)  
	SaveNXSPE(w1,save_file+'_Abs.nxspe')
	#SaveNexus(w1,save_file+'newDgrd_NewQTG_NewDirectConv.nxs')	
	DeleteWorkspace(w1)




</pre>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="8578.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T11%3A39%3A36Z&amp;precision=second" title="2013-12-09T11:39:36Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Priority</strong>
        changed from <em>major</em> to <em>critical</em>
    </li><li>
      <strong>type</strong>
        changed from <em>enhancement</em> to <em>defect</em>
    </li><li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/8578?action=diff&amp;version=1">diff</a>)
    </li><li>
      <strong>Milestone</strong>
        changed from <em>Backlog</em> to <em>Release 3.1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="8578.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T11%3A40%3A25Z&amp;precision=second" title="2013-12-09T11:40:25Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/8578?action=diff&amp;version=2">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="8578.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T11%3A45%3A58Z&amp;precision=second" title="2013-12-09T11:45:58Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/8578?action=diff&amp;version=3">diff</a>)
    </li><li>
      <strong>Summary</strong>
        changed from <em>Python Reduction does not change reduction argiments thirt dimes (thread corruption suspected)</em> to <em>Python Reduction does not change reduction argiments three times (thread/memory corruption suspected)</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="8578.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T13%3A03%3A05Z&amp;precision=second" title="2013-12-09T13:03:05Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
The script above is not fully illustrates the problem , as uses once initiated reducer in all subsequent calls to reducers. If I change script to the one below (plus do some other minor change to the reducer committed), wrong behaviour does not happens in the script, run separately in a debugger, but still continues in the script window if one set hardmaskPlus, and then change to harmaskOnly and then hardmaskPlus again. 
</p>
<p>
This can happen if the script window does not re-initiates internal variables (reducer in this case) on each RunAll call.
</p>
<pre class="wiki">"""
Script to perform absolute units data reduction for MARI
"""
#from qtiGenie import *
from mantid import config
from mantid.simpleapi import *
import dgreduce
import time
import os

dgreduce.setup('MAR')
ext='.raw'

# where to save resutls (usually specified in Mantid, data search directories)
save_dir = config.getString('defaultsave.directory')
if len(save_dir) ==0 :
    config['defaultsave.directory']=os.getcwd()
    save_dir = config.getString('defaultsave.directory')
    
print "Data will be saved into: ",save_dir
# map mask and cal file, again the values from Mantid, data search directories can be modified here
config.appendDataSearchDir('/usr/local/mprogs/InstrumentFiles/mari') 
config.appendDataSearchDir(r'c:\mprogs\ISIS\Libisis\InstrumentFiles\mari') 
# data (raw or nxs) run files -- values from data search directories can be modified here
config.appendDataSearchDir('/isisdatar55/NDXMARI/Instrument/data/cycle_05_1') 
config.appendDataSearchDir(r'd:/Data/MantidSystemTests/Data') 


maskfile='mar11015.msk' #'testMask2.msk'#hard mask out the edges of detectors, which tend to be noisy

#map file
mapfile='mari_res.map' # mapping file
#mapfile='/opt/Mantid/instrument/mapfiles/maps/parker_rings' #powder mapping file
mv_mapfile='4to1_mid_lowang'

# latest white beam vanadium file for bad detector diagnosis
wbvan=11060

#Run numbers can be specified as a list:
#runno=[17422,17423, etc]
runno=[11001] #[19399] #,[00004] 19402]

#Incident energy list e.g. ei=[20,30,40]
ei=12

#Sample info
sam_rmm = 435.96
#sam_mass= 2.465
sam_mass = 10
    
rebin_pars=[-11,0.05,11]
monovan=11015
argi = {};
argi['hardmaskPlus']=maskfile 
argi['sample_mass'] = sam_mass   
argi['sample_rmm']   =sam_rmm 


print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
for i in range(len(runno)):
        #w1=iliad_abs(wbvan,runno[i],monovan,wbvan,sam_rmm,sam_mass,ei[i],rebin_pars,mapfile,mv_mapfile,**argi)
        # this does absolute units normalization as far as monovan is not None. Uses default map file, provided in MAPS_Parameters.xml file. Any changes from defaults should be provided here or above as parameters
        w1=dgreduce.arb_units(wbvan,runno[i],ei,rebin_pars,None,monovan,**argi)

        save_file='MAR'+str(runno[i])+'_ei'+str(ei)  
        SaveNXSPE(w1,save_file+'_Abs.nxspe')
        #SaveNexus(w1,save_file+'newDgrd_NewQTG_NewDirectConv.nxs')	
        DeleteWorkspace(w1)

argi1 = {};
argi1['sample_mass'] = sam_mass   
argi1['sample_rmm']   =sam_rmm 
argi1['hardmaskOnly'] =maskfile 
print 'HARD MASK ONLY ------------------------------------------------------------------------------------------------'
print 'HARD MASK ONLY-----------------------------------------------------------------------------------------------'
print 'HARD MASK ONLY---------------------------------------------------------------------------------------------'


for i in range(len(runno)):
        #w1=iliad_abs(wbvan,runno[i],monovan,wbvan,sam_rmm,sam_mass,ei[i],rebin_pars,mapfile,mv_mapfile,**argi)
        # this does absolute units normalization as far as monovan is not None. Uses default map file, provided in MAPS_Parameters.xml file. Any changes from defaults should be provided here or above as parameters
        w1=dgreduce.arb_units(wbvan,runno[i],ei,rebin_pars,None,monovan,**argi1)

        save_file='MAR'+str(runno[i])+'_ei'+str(ei)  
        SaveNXSPE(w1,save_file+'_Abs.nxspe')
        #SaveNexus(w1,save_file+'newDgrd_NewQTG_NewDirectConv.nxs')	
        DeleteWorkspace(w1)


argi2 = {};
argi2['sample_mass'] = sam_mass   
argi2['sample_rmm']   =sam_rmm 
argi2['hardmaskPlus']=maskfile 

print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
print 'HARD MASK PLUS ------------------------------------------------------------------------------------------------'
for i in range(len(runno)): 
        #w1=iliad_abs(wbvan,runno[i],monovan,wbvan,sam_rmm,sam_mass,ei[i],rebin_pars,mapfile,mv_mapfile,**argi)
        # this does absolute units normalization as far as monovan is not None. Uses default map file, provided in MAPS_Parameters.xml file. Any changes from defaults should be provided here or above as parameters
        w1=dgreduce.arb_units(wbvan,runno[i],ei,rebin_pars,None,monovan,**argi)

        save_file='MAR'+str(runno[i])+'_ei'+str(ei)  
        SaveNXSPE(w1,save_file+'_Abs.nxspe')
    #SaveNexus(w1,save_file+'newDgrd_NewQTG_NewDirectConv.nxs')	
        DeleteWorkspace(w1)





</pre>
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="8578.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T13%3A35%3A36Z&amp;precision=second" title="2013-12-09T13:35:36Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
the changes were committed to wrong ticket number. 
They are in the branch:
</p>
<p>
bugfix/8578_storedPythonParams
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="8578.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T14%3A20%3A58Z&amp;precision=second" title="2013-12-09T14:20:58Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>inprogress</em>
    </li><li>
      <strong>Owner</strong>
        set to <em>Alex Buts</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="8578.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T15%3A50%3A18Z&amp;precision=second" title="2013-12-09T15:50:18Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
After fixing issue with legacy parameters I can not reproduce the issue with any other parameters any more
</p>
<p>
Git branch exists at <a class="ext-link" href="https://github.com/mantidproject/mantid/tree/bugfix/8578_storedPythonParams"><span class="icon">​</span>https://github.com/mantidproject/mantid/tree/bugfix/8578_storedPythonParams</a> and shows the changes with presumably fix the changes. 
</p>
<p>
Tester can run the script above and see that no unexpected behaviour with diagnostics occur.  This is trivial change which easy to understand and test. 
</p>
<p>
I am not investigating this any further in anticipation to changes in reduction workflow algorithms. 
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-11T10%3A04%3A08Z&amp;precision=second" title="2013-12-11T10:04:08Z in Timeline">7 years</a> ago
                      by Alex Buts
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8578?cversion=0&amp;cnum_hist=7#comment:7">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8578?action=comment-diff&amp;cnum=7&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="8578.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T15%3A50%3A23Z&amp;precision=second" title="2013-12-09T15:50:23Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="8578.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-09T17%3A27%3A03Z&amp;precision=second" title="2013-12-09T17:27:03Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="8578.html" title="defect: Python Reduction does not change reduction argiments three times ... (closed: fixed)">#8578</a> Fixed unit test DgreduceTest
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/c20e7d76fe9572e141e6f315c44db3bd719fdf19" title="c20e7d76fe9572e141e6f315c44db3bd719fdf19">c20e7d76fe9572e141e6f315c44db3bd719fdf19</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="8578.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-16T09%3A50%3A58Z&amp;precision=second" title="2013-12-16T09:50:58Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>reopened</em>
    </li><li>
      <strong>Resolution</strong>
        <em>fixed</em> deleted
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
This is other script which illustrates the problem which still exists.
</p>
<p>
When script below is run with 
testToRun = <a class="missing wiki">MARIReductionSum?</a>
only, MARIReductionSum passes. 
</p>
<p>
When one runs two tests in the row, e.g.:
testToRun = ['MARIReductionFromFile','MARIReductionSum']
</p>
<p>
MARIReductionSum fails. 
</p>
<pre class="wiki">'''
This is provided for testing purposes. It allows you to run the single system test
within Mantid environent
It can be useful for debugging because the errors do not alway 'get out' of
the sub-process used for running the tests in the regular way
'''
from mantid.simpleapi import *
from mantid import config
import sys
import os


this_dir = sys.path[0]
print "Script resides in : ",this_dir
#python directories
os.chdir(r'd:\Data\MantidSystemTests\SystemTests')
stressmodule_dir = r'd:\Data\MantidSystemTests\StressTestFramework'
tests_dir = r'd:/Data/MantidSystemTests/SystemTests/AnalysisTests'


sys.path.insert(0,tests_dir)
sys.path.append(stressmodule_dir)
sys.path.append(r'd:\Data\Mantid_GIT_test\Code\builds\br_master\bin\Release')



maps_dir = 'd:/Data/MantidSystemTests/Data'
data_dir ='d:/Data/Mantid_Testing/13_12_09'
ref_data_dir = 'd:/Data/MantidSystemTests/SystemTests/AnalysisTests/ReferenceResults' 
config.setDataSearchDirs('{0};{1};{2}'.format(data_dir,maps_dir,ref_data_dir))
config['defaultsave.directory'] = data_dir # folder to save resulting spe/nxspe files. Defaults are in

# data search directories



# Find these first
modlToRun = ['ISISDirectInelastic']

#testToRun = ['MARIReductionSum']
testToRun = ['MARIReductionFromFile','MARIReductionSum']




module = __import__(modlToRun[0])
reload(module)
#reload(sys.modules['isis_reduction_steps'])

for className in testToRun:
    try:
        testClass = getattr(module, className)()
        testClass.execute()
    except:
        raise
        #os.chdir(this_dir)
        #raise

    outcome = testClass.doValidation()
    print 'Test result: ' + str(outcome)

os.chdir(this_dir)

</pre>
    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="8578.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-17T12%3A00%3A06Z&amp;precision=second" title="2013-12-17T12:00:06Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>reopened</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="8578.html" title="defect: Python Reduction does not change reduction argiments three times ... (closed: fixed)">#8578</a> Should fix the issue
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/b03c78598688911d0f0939bf941a6a193b7c3214" title="b03c78598688911d0f0939bf941a6a193b7c3214">b03c78598688911d0f0939bf941a6a193b7c3214</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="8578.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-17T13%3A09%3A05Z&amp;precision=second" title="2013-12-17T13:09:05Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="8578.html" title="defect: Python Reduction does not change reduction argiments three times ... (closed: fixed)">#8578</a> fixing some weird brunching error
</p>
<p>
which cause unit test to fail.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/b630bdd31b8329522748b0cd2470aba0dbb75d30" title="b630bdd31b8329522748b0cd2470aba0dbb75d30">b630bdd31b8329522748b0cd2470aba0dbb75d30</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="8578.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-17T13%3A39%3A43Z&amp;precision=second" title="2013-12-17T13:39:43Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
Should be simple ticket to test. 
</p>
<p>
2 scripts above should pass after the merge and changes to code are small and should be easy to understand. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="8578.html#comment:14">comment:14</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-17T15%3A53%3A55Z&amp;precision=second" title="2013-12-17T15:53:55Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="8578.html" title="defect: Python Reduction does not change reduction argiments three times ... (closed: fixed)">#8578</a> Trivial change allows to define hard mask file in any form
</p>
<p>
imaginable (or rather define that hard mask file is absent)
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/e7fe8921ac26982d0dbb35365133e95ebdedcd51" title="e7fe8921ac26982d0dbb35365133e95ebdedcd51">e7fe8921ac26982d0dbb35365133e95ebdedcd51</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="8578.html#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-23T21%3A51%3A20Z&amp;precision=second" title="2013-12-23T21:51:20Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="8578.html#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-24T10%3A16%3A37Z&amp;precision=second" title="2013-12-24T10:16:37Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8640</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
(In <a class="closed ticket" href="8640.html" title="enhancement: Restore changes which  apply detector corrections at loading (closed: fixed)">#8640</a>) The System tests will fail until <a class="closed ticket" href="8578.html" title="defect: Python Reduction does not change reduction argiments three times ... (closed: fixed)">#8578</a> is applied, so I am merging it to the ticket. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="8578.html#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-14T09%3A58%3A02Z&amp;precision=second" title="2014-01-14T09:58:02Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8640</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-18">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:18" class="cnum">
      <a href="8578.html#comment:18">comment:18</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-14T09%3A58%3A28Z&amp;precision=second" title="2014-01-14T09:58:28Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8640</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-15T10%3A06%3A08Z&amp;precision=second" title="2014-01-15T10:06:08Z in Timeline">7 years</a> ago
                      by Alex Buts
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8578?cversion=0&amp;cnum_hist=18#comment:18">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8578?action=comment-diff&amp;cnum=18&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-19">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:19" class="cnum">
      <a href="8578.html#comment:19">comment:19</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-14T15%3A48%3A40Z&amp;precision=second" title="2014-01-14T15:48:40Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8640</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="8578.html#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-14T15%3A49%3A12Z&amp;precision=second" title="2014-01-14T15:49:12Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8640</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="8578.html#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-14T15%3A49%3A26Z&amp;precision=second" title="2014-01-14T15:49:26Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8578</em> added; <em>8640</em> removed
    </li><li>
      <strong>Blocked By</strong>
        <em>8578</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-21">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:21" class="cnum">
      <a href="8578.html#comment:21">comment:21</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-15T10%3A04%3A25Z&amp;precision=second" title="2014-01-15T10:04:25Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>8640</em> added; <em>8578</em> removed
    </li><li>
      <strong>Blocked By</strong>
        <em>8578</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-22">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:22" class="cnum">
      <a href="8578.html#comment:22">comment:22</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-31T14%3A19%3A36Z&amp;precision=second" title="2014-01-31T14:19:36Z in Timeline">7 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Component</strong>
        changed from <em>Framework</em> to <em>Direct Inelastic</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-23">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:23" class="cnum">
      <a href="8578.html#comment:23">comment:23</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-02-03T10%3A23%3A06Z&amp;precision=second" title="2014-02-03T10:23:06Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Martyn Gigg</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-24">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:24" class="cnum">
      <a href="8578.html#comment:24">comment:24</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-02-03T11%3A06%3A50Z&amp;precision=second" title="2014-02-03T11:06:50Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
The system tests script seems to function correctly now and resetting the IDF parameters seems sensible, especially if the object is going to be global.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-25">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:25" class="cnum">
      <a href="8578.html#comment:25">comment:25</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A42%3A32%2B01%3A00&amp;precision=second" title="2015-06-04T02:42:32+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/9422"><span class="icon">​</span>9422</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8578?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8578?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8578?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>