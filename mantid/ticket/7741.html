<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #7741 (Python fit function attributes cannot be set from fit browser)
     â€“ Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="7740.html" title="Ticket #7740" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7741?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7741?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/7741?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="7742.html" title="Ticket #7742" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 7741, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="7740.html" title="Ticket #7740">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="7742.html" title="Ticket #7742">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="7741.html">Ticket #7741</a>
          <span class="status">(assigned)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-13T07%3A56%3A19%2B01%3A00&amp;precision=second" title="2013-08-13T07:56:19+01:00 in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A07%3A50%2B01%3A00&amp;precision=second" title="2015-06-04T02:07:50+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Python fit function attributes cannot be set from fit browser</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Martyn+Gigg">Martyn Gigg</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="../milestone/Backlog.html">Backlog</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2013-08-13 06:56:31.994698+00:00">
        (last modified by Martyn Gigg)
        (<a href="https://trac.mantidproject.org/mantid/ticket/7741?action=diff&amp;version=1">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <p>
I've written a Python function with Attributes as well as parameters. I can select it in the Fit Function pane and the attributes are listed (first) and initialised to the default values specified in the code. If I then change the numbers in the pane, the function does not vary as expected but keeps the initial values of the attributes. Even Fitting, changing the parameters manually, or removing and adding the Guess curve does not prompt it to look again at the attributes.
</p>
<p>
Instead, if I call Fit(...) from the Python window I can initialise the Attributes to any values I want and it all seems to work OK.
</p>
<p>
James Lord.
(Mantid 2.6)
</p>
<p>
Simplified code below, based on the examples:
</p>
<div class="code"><pre><span class="k">class</span> <span class="nc">AttributeExample</span><span class="p">(</span>IFunction1D<span class="p">):</span>
        <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span>declareParameter<span class="p">(</span><span class="s">"Amplitude"</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span>declareParameter<span class="p">(</span><span class="s">"Baseline"</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span>declareAttribute<span class="p">(</span><span class="s">"Frequency"</span><span class="p">,</span><span class="mf">0.26</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span>declareAttribute<span class="p">(</span><span class="s">"Sine"</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">setAttributeValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>name<span class="p">,</span>value<span class="p">):</span>
                <span class="k">if</span> name <span class="o">==</span> <span class="s">"Frequency"</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span>_freq <span class="o">=</span> value
                <span class="k">if</span> name <span class="o">==</span> <span class="s">"Sine"</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span>_sine <span class="o">=</span> value

        <span class="k">def</span> <span class="nf">function1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>xvals<span class="p">):</span>
                ampl<span class="o">=</span><span class="bp">self</span><span class="o">.</span>getParameterValue<span class="p">(</span><span class="s">"Amplitude"</span><span class="p">)</span>
                base<span class="o">=</span><span class="bp">self</span><span class="o">.</span>getParameterValue<span class="p">(</span><span class="s">"Baseline"</span><span class="p">)</span>

                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span>_sine<span class="p">):</span>
                        ybins<span class="o">=</span>numpy<span class="o">.</span>sin<span class="p">(</span>xvals<span class="o">*</span><span class="bp">self</span><span class="o">.</span>_freq<span class="o">*</span><span class="mf">2.0</span><span class="o">*</span>math<span class="o">.</span>pi<span class="p">)</span><span class="o">*</span>ampl<span class="o">+</span>base
                <span class="k">else</span><span class="p">:</span>
                        ybins<span class="o">=</span>numpy<span class="o">.</span>cos<span class="p">(</span>xvals<span class="o">*</span><span class="bp">self</span><span class="o">.</span>_freq<span class="o">*</span><span class="mf">2.0</span><span class="o">*</span>math<span class="o">.</span>pi<span class="p">)</span><span class="o">*</span>ampl<span class="o">+</span>base
                <span class="k">return</span> ybins

FunctionFactory<span class="o">.</span>subscribe<span class="p">(</span>AttributeExample<span class="p">)</span>
</pre></div>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="7741.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-08-13T07%3A56%3A31%2B01%3A00&amp;precision=second" title="2013-08-13T07:56:31+01:00 in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="https://trac.mantidproject.org/mantid/ticket/7741?action=diff&amp;version=1">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="7741.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-02-14T11%3A05%3A00Z&amp;precision=second" title="2014-02-14T11:05:00Z in Timeline">7 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Bulk move to assigned at the introduction of the triage step
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="7741.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A07%3A50%2B01%3A00&amp;precision=second" title="2015-06-04T02:07:50+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/8586"><span class="icon">â€‹</span>8586</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7741?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7741?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/7741?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>