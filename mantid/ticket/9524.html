<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #9524 (StichingError)
     â€“ Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="9523.html" title="Ticket #9523" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9524?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9524?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9524?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="9525.html" title="Ticket #9525" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 9524, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="9523.html" title="Ticket #9523">Previous Ticket</a></span></li><li><span><a class="next" href="9525.html" title="Ticket #9525">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/9524.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="9524.html">Ticket #9524</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-23T08%3A22%3A50%2B01%3A00&amp;precision=second" title="2014-05-23T08:22:50+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A21%3A50%2B01%3A00&amp;precision=second" title="2015-06-04T03:21:50+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">StichingError</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Owen+Arnold">Owen Arnold</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Owen+Arnold">Owen Arnold</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Reflectometry">Reflectometry</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span><a class="closed ticket" href="9440.html" title="Stitch1DMany Bug Report">#9440</a>, <a class="closed ticket" href="9475.html" title="Stitch1D as C++ Algorithm">#9475</a></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Michael Reuter
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Error reported by Tim Charlton.
</p>
<p>
For one of the spin states, running Stitch1DMany results in magnification of error bars for one of the stitched workspaces. The steps below are the minimum to reproduce the reported issue. Screen shot attached.
</p>
<div class="code"><pre>Load<span class="p">(</span>Filename<span class="o">=</span><span class="s">r'/Users/spu92482/Desktop/Stitching-errors/nIp_DataOut_RcorrectedVsQz_r1q_rr1.nxs'</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">'nIp_DataOut_RcorrectedVsQz_r1q_rr1'</span><span class="p">)</span>
Load<span class="p">(</span>Filename<span class="o">=</span><span class="s">r'/Users/spu92482/Desktop/Stitching-errors/nIp_DataOut_RcorrectedVsQz_r2q_rr2.nxs'</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">'nIp_DataOut_RcorrectedVsQz_r2q_rr2'</span><span class="p">)</span>
Load<span class="p">(</span>Filename<span class="o">=</span><span class="s">r'/Users/spu92482/Desktop/Stitching-errors/nIp_DataOut_RcorrectedVsQz_r3q_rr3.nxs'</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">'nIp_DataOut_RcorrectedVsQz_r3q_rr3'</span><span class="p">)</span>

Stitch1DMany<span class="p">(</span>InputWorkspaces<span class="o">=</span><span class="s">'nIp_DataOut_RcorrectedVsQz_r1q_rr1, nIp_DataOut_RcorrectedVsQz_r2q_rr2 ,nIp_DataOut_RcorrectedVsQz_r3q_rr3'</span><span class="p">,</span>OutputWorkspace<span class="o">=</span><span class="s">'stitchednpl'</span><span class="p">,</span>Params<span class="o">=</span><span class="s">'-0.02'</span><span class="p">)</span>

graph_spec <span class="o">=</span> plotSpectrum<span class="p">(</span><span class="s">'stitchednpl'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> error_bars<span class="o">=</span><span class="bp">True</span><span class="p">)</span>
l <span class="o">=</span> graph_spec<span class="o">.</span>activeLayer<span class="p">()</span>
l<span class="o">.</span>setAxisScale<span class="p">(</span>Layer<span class="o">.</span>Left<span class="p">,</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> Layer<span class="o">.</span>Log10<span class="p">)</span>
</pre></div>
    </div>
  </div>
</div>
          
    <div id="attachments">
        <h2 class="foldable">Attachments</h2>
        <div>
          <dl class="attachments">
              <dt>
    <a href="../attachment/ticket/9524/Screen&#32;Shot&#32;2014-05-23&#32;at&#32;08.30.50.png.html" title="View attachment">Screen Shot 2014-05-23 at 08.30.50.png</a><a href="../raw-attachment/ticket/9524/Screen&#32;Shot&#32;2014-05-23&#32;at&#32;08.30.50.png" class="trac-rawlink" title="Download">â€‹</a>
       (<span title="21464 bytes">21.0 KB</span>) -
      added by <em>Owen Arnold</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-23T08%3A23%3A24%2B01%3A00&amp;precision=second" title="2014-05-23T08:23:24+01:00 in Timeline">6 years</a> ago.
  </dt>
          </dl>
          
        </div>
    </div>

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-23T08%3A23%3A24%2B01%3A00&amp;precision=second" title="2014-05-23T08:23:24+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9524/Screen&#32;Shot&#32;2014-05-23&#32;at&#32;08.30.50.png.html"><em>Screen Shot 2014-05-23 at 08.30.50.png</em></a><a href="../raw-attachment/ticket/9524/Screen&#32;Shot&#32;2014-05-23&#32;at&#32;08.30.50.png" title="Download" class="trac-rawlink">â€‹</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="9524.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-23T08%3A24%3A20%2B01%3A00&amp;precision=second" title="2014-05-23T08:24:20+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        set to <em>Owen Arnold</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="9524.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-23T08%3A25%3A07%2B01%3A00&amp;precision=second" title="2014-05-23T08:25:07+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
Error reproduced on version 20th May 2014
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="9524.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-23T09%3A02%3A30%2B01%3A00&amp;precision=second" title="2014-05-23T09:02:30+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
I can actually reproduce this issue via stitch1D directly by stitching rr2 and rr3 together. So the real problem is not in Stitch1DMany, it is in <strong>Stitch1D</strong> or something lower.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="9524.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-23T11%3A46%3A08%2B01%3A00&amp;precision=second" title="2014-05-23T11:46:08+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
Following some investigation. This was found to be down to some very large error values in the most RHS workspace. In the integration step, errors are squared and sum across all bins. Therefore the ratio multiplication factor ws, had a huge error value that was scaling all the error bars on the corrected, scaled output workspace.
</p>
<p>
Changing the StartOverlap region as follows fixed the issue as it cuts out the overlap regions where errors are very high.
</p>
<div class="code"><pre>Stitch1DMany<span class="p">(</span>InputWorkspaces<span class="o">=</span><span class="s">'nIp_DataOut_RcorrectedVsQz_r1q_rr1, nIp_DataOut_RcorrectedVsQz_r2q_rr2 ,nIp_DataOut_RcorrectedVsQz_r3q_rr3'</span><span class="p">,</span>StartOverlaps<span class="o">=</span><span class="p">[</span><span class="mf">0.0208</span><span class="p">,</span><span class="mf">0.0208</span><span class="p">],</span> EndOverlaps<span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.05</span><span class="p">],</span>OutputWorkspace<span class="o">=</span><span class="s">'stitchednpl'</span><span class="p">,</span>Params<span class="o">=</span><span class="s">'-0.02'</span><span class="p">)</span>
</pre></div><p>
What Tim has now asked for is to have the error scale factor output from Stitch1D and Stitch1DMany. This would allow the end-user to spot this problem.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="9524.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-30T12%3A31%3A16%2B01%3A00&amp;precision=second" title="2014-05-30T12:31:16+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="9524.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-30T12%3A31%3A39%2B01%3A00&amp;precision=second" title="2014-05-30T12:31:39+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>9440</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="9524.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-04T08%3A48%3A41%2B01%3A00&amp;precision=second" title="2014-06-04T08:48:41+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>9475</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="9524.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-30T11%3A59%3A26%2B01%3A00&amp;precision=second" title="2014-06-30T11:59:26+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
comment 4 outlines the real problem, and this has been accepted by the user. There are no code changes.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="9524.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-30T15%3A53%3A49%2B01%3A00&amp;precision=second" title="2014-06-30T15:53:49+01:00 in Timeline">6 years</a> ago by Michael Reuter
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Michael Reuter</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="9524.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-30T15%3A56%3A15%2B01%3A00&amp;precision=second" title="2014-06-30T15:56:15+01:00 in Timeline">6 years</a> ago by Michael Reuter
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Sounds fine to me.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="9524.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A21%3A50%2B01%3A00&amp;precision=second" title="2015-06-04T03:21:50+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10367"><span class="icon">â€‹</span>10367</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9524?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9524?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9524?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>