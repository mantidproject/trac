<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #10044 (Strange over filtering in GenerateEventsFilter)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="10043.html" title="Ticket #10043" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10044?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10044?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10044?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="10045.html" title="Ticket #10045" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 10044, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="10043.html" title="Ticket #10043">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="10045.html" title="Ticket #10045">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="10044.html">Ticket #10044</a>
          <span class="status">(closed: worksforme)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-01T17%3A22%3A10%2B01%3A00&amp;precision=second" title="2014-08-01T17:22:10+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A43%3A19%2B01%3A00&amp;precision=second" title="2015-06-04T03:43:19+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Strange over filtering in GenerateEventsFilter</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Owen+Arnold">Owen Arnold</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Wenduo+Zhou">Wenduo Zhou</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=blocker">blocker</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.3.html">Release 3.3</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Owen Arnold
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
I'm struggling to explain why the number of events filtered + number of events unfiltered is not equal to the number of events in the original. Then I came up with this test case which uses a fake log, and should filter everything. BUT the number of events in the filtered workspace is a lot less than those in the original workspace.
</p>
<p>
Hopefully I'm wrong about this, but if not then there are events disappearing for no reason that I can see.
</p>
<div class="code"><pre>mtd<span class="o">.</span>importAll<span class="p">()</span>

ws <span class="o">=</span> WISH00029057 <span class="c"># Any of the resent wish event workspaces would be fine.</span>
<span class="k">print</span> <span class="s">"Events in original"</span><span class="p">,</span> ws<span class="o">.</span>getNumberEvents<span class="p">()</span> 
start_time<span class="o">=</span>ws<span class="o">.</span>getRun<span class="p">()</span><span class="o">.</span>startTime<span class="p">()</span>
end_time<span class="o">=</span>ws<span class="o">.</span>getRun<span class="p">()</span><span class="o">.</span>endTime<span class="p">()</span> 
duration <span class="o">=</span>  <span class="p">(</span>end_time <span class="o">-</span> start_time<span class="p">)</span><span class="o">.</span>seconds<span class="p">()</span> 
logname<span class="o">=</span> <span class="s">'fake_log'</span>
<span class="k">try</span><span class="p">:</span>
        <span class="c"># delete the log if it already exists</span>
        DeleteLog<span class="p">(</span>ws<span class="p">,</span> logname<span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="c"># Make a fake log that extends for the full duration</span>

<span class="k">for</span> i <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> duration<span class="p">):</span>
        t <span class="o">=</span> start_time <span class="o">+</span> <span class="nb">int</span><span class="p">(</span>i<span class="o">*</span><span class="mf">1e9</span><span class="p">)</span>
        AddTimeSeriesLog<span class="p">(</span>ws<span class="p">,</span>logname<span class="p">,</span> Time<span class="o">=</span><span class="nb">str</span><span class="p">(</span>t<span class="p">)</span><span class="o">.</span>rstrip<span class="p">(),</span> Value<span class="o">=</span>i<span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
generator<span class="p">,</span> info <span class="o">=</span> GenerateEventsFilter<span class="p">(</span>InputWorkspace<span class="o">=</span>ws<span class="p">,</span> FastLog<span class="o">=</span><span class="bp">True</span><span class="p">,</span> LogName<span class="o">=</span>logname<span class="p">,</span> MinimumLogValue<span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> FilterLogValueByChangingDirection<span class="o">=</span><span class="s">'Both'</span><span class="p">)</span>
FilterEvents<span class="p">(</span>InputWorkspace<span class="o">=</span>WISH00029057<span class="p">,</span> SplitterWorkspace<span class="o">=</span>generator<span class="p">,</span> OutputWorkspaceBaseName<span class="o">=</span><span class="s">'filtering'</span><span class="p">,</span> InformationWorkspace<span class="o">=</span>info<span class="p">,</span> CorrectionToSample<span class="o">=</span><span class="s">'Elastic'</span><span class="p">,</span> FilterByPulseTime<span class="o">=</span><span class="bp">False</span><span class="p">)</span>
filtered_ws <span class="o">=</span> mtd<span class="p">[</span><span class="s">'filtering_0'</span><span class="p">]</span>
<span class="k">print</span> <span class="s">"Events in filtered ws"</span><span class="p">,</span> filtered_ws<span class="o">.</span>getNumberEvents<span class="p">()</span>
</pre></div><p>
prints 
</p>
<pre class="wiki">Events in original 928940
Events in filtered ws 886831
</pre>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="10044.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-01T17%3A22%3A21%2B01%3A00&amp;precision=second" title="2014-08-01T17:22:21+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="10044.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-01T17%3A23%3A05%2B01%3A00&amp;precision=second" title="2014-08-01T17:23:05+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
This could be related to <a class="closed ticket" href="10022.html" title="FilterByLogValue drops events if the log entries end (closed: duplicate)">#10022</a>. Not completely sure about that.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="10044.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-05T16%3A50%3A56%2B01%3A00&amp;precision=second" title="2014-08-05T16:50:56+01:00 in Timeline">6 years</a> ago by Wenduo Zhou
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>worksforme</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
There are more than 10K spectra that do not have detectors.  Therefore, those spectra will be ignored by FilterEvents().  The number of events in those spectra will be shown in log.  And it is exactly the difference between the number of events in original workspace and filtered workspace. 
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="10044.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-05T16%3A51%3A50%2B01%3A00&amp;precision=second" title="2014-08-05T16:51:50+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Owen Arnold</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="10044.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-05T17%3A08%3A15%2B01%3A00&amp;precision=second" title="2014-08-05T17:08:15+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
Agreed. I loaded the new WISH IDF via <a class="closed ticket" href="9980.html" title="Add 10 panel WISH instrument definition file. (closed: fixed)">#9980</a> and no events were lost.
</p>
<p>
There is however a strange situation which I don't understand. Modifying the duration in the script above does not change the number of events produced? Even when making the duration very small indeed, I never seem to be able to filter events?
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="10044.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-05T17%3A08%3A22%2B01%3A00&amp;precision=second" title="2014-08-05T17:08:22+01:00 in Timeline">6 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="10044.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A43%3A19%2B01%3A00&amp;precision=second" title="2015-06-04T03:43:19+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10886"><span class="icon">​</span>10886</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10044?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10044?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10044?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>