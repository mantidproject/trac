<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #9628 (Allow LARMOR Files to Work in Add Runs Tab)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="9627.html" title="Ticket #9627" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9628?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9628?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9628?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="9629.html" title="Ticket #9629" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 9628, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="9627.html" title="Ticket #9627">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="9629.html" title="Ticket #9629">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="9628.html">Ticket #9628</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-10T16%3A37%3A58%2B01%3A00&amp;precision=second" title="2014-06-10T16:37:58+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A26%3A09%2B01%3A00&amp;precision=second" title="2015-06-04T03:26:09+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Allow LARMOR Files to Work in Add Runs Tab</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Peter+Parker">Peter Parker</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Peter+Parker">Peter Parker</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=SANS">SANS</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              robert.dalgliesh@…
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Samuel Jackson
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Rob has pointed out that LARMOR files will not go through the "Add Runs" tab of the interface.  This is because we have the following code in SANSadd2.py:
</p>
<div class="code"><pre><span class="k">def</span> <span class="nf">_padZero</span><span class="p">(</span>runNum<span class="p">,</span> inst<span class="o">=</span><span class="s">'SANS2D'</span><span class="p">):</span>
  <span class="k">if</span> inst<span class="o">.</span>upper<span class="p">()</span> <span class="o">==</span> <span class="s">'SANS2D'</span> <span class="p">:</span> numDigits <span class="o">=</span> <span class="mi">8</span>
  <span class="k">elif</span> inst<span class="o">.</span>upper<span class="p">()</span> <span class="o">==</span> <span class="s">'LOQ'</span> <span class="p">:</span> numDigits <span class="o">=</span> <span class="mi">5</span>
  <span class="k">else</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">'The arguement inst must be set to SANS or LOQ'</span><span class="p">)</span>

  run <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>runNum<span class="p">)</span><span class="o">.</span>zfill<span class="p">(</span>numDigits<span class="p">)</span>
  <span class="k">return</span> run
</pre></div><p>
which could easily be made more generic with:
</p>
<div class="code"><pre><span class="k">def</span> <span class="nf">_padZero</span><span class="p">(</span>runNum<span class="p">,</span> inst<span class="p">):</span>
  numDigits <span class="o">=</span> config<span class="o">.</span>getInstrument<span class="p">(</span>inst<span class="p">)</span><span class="o">.</span>zeroPadding<span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  run <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>runNum<span class="p">)</span><span class="o">.</span>zfill<span class="p">(</span>numDigits<span class="p">)</span>
  <span class="k">return</span> run
</pre></div><p>
The real fix would actually be to rely on the zero padding code we have elsewhere rather than have our own version, but I prefer this fix since it is very localised and wont require making larger changes to code that I simply do not trust at the moment.
</p>
<p>
Given that we know a fix and also given that Rob has tested this on his machine by pasting the code manually into his installation, it would make sense to get this in to the 3.2 release.
</p>
<p>
For the purposes of testing, the underlying "Add Runs" code can be called from Python as follows:
</p>
<div class="code"><pre><span class="kn">from</span> <span class="nn">SANSadd2</span> <span class="kn">import</span> add_runs

<span class="k">def</span> <span class="nf">call_add_runs</span><span class="p">(</span>runs<span class="p">,</span> inst<span class="p">,</span> bin_str<span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">"""
        Wrap the actual function in something a bit nicer.
        """</span>
        <span class="c"># The GUI asks LoadRaw for its known "types".  This appears to be necessary</span>
        <span class="c"># for the purposes of loading sample data from raw files as well as loading</span>
        <span class="c"># periods.  I don't claim to fully understand, but we do this in the GUI so</span>
        <span class="c"># I guess we should do it here, too.</span>
        loadraw <span class="o">=</span> AlgorithmManager<span class="o">.</span>createUnmanaged<span class="p">(</span><span class="s">"LoadRaw"</span><span class="p">)</span>
        loadraw<span class="o">.</span>initialize<span class="p">()</span>
        <span class="k">if</span> bin_str <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                bin_str<span class="o">=</span><span class="s">"Monitors"</span>
        add_runs<span class="p">(</span>runs<span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> runs<span class="p">),</span>
                 inst<span class="o">=</span>inst<span class="p">,</span>
                 rawTypes<span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>loadraw<span class="o">.</span>getProperty<span class="p">(</span><span class="s">"Filename"</span><span class="p">)</span><span class="o">.</span>allowedValues<span class="p">),</span>
                 binning<span class="o">=</span>bin_str<span class="p">)</span>

<span class="c"># Change these to taste:</span>
inst <span class="o">=</span> <span class="s">"LARMOR"</span>
runs <span class="o">=</span> <span class="p">[</span><span class="mi">208</span><span class="p">,</span><span class="mi">209</span><span class="p">]</span>
bin_str <span class="o">=</span> <span class="s">"5.5,45.5,50.0, 50.0,1000.0, 500.0,1500.0, 750.0,99750.0, 255.0,100005.0"</span>

<span class="c"># Uses monitor binning: call_add_runs(runs, inst)</span>
<span class="c"># Uses your own binning string: call_add_runs(runs, inst, bin_str)</span>
call_add_runs<span class="p">(</span>runs<span class="p">,</span> inst<span class="p">,</span> bin_str<span class="p">)</span>
</pre></div>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="9628.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-11T10%3A46%3A40%2B01%3A00&amp;precision=second" title="2014-06-11T10:46:40+01:00 in Timeline">6 years</a> ago by Peter Parker
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Cc</strong>
        <em>robert.dalgliesh@…</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="9628.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-12T16%3A59%3A16%2B01%3A00&amp;precision=second" title="2014-06-12T16:59:16+01:00 in Timeline">6 years</a> ago by Peter Parker
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="closed ticket" href="9628.html" title="enhancement: Allow LARMOR Files to Work in Add Runs Tab (closed: fixed)">#9628</a> - Allow adding LARMOR data files.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/fb920e738fbd21a9fa13d708fe35646006b0035d" title="fb920e738fbd21a9fa13d708fe35646006b0035d">fb920e738fbd21a9fa13d708fe35646006b0035d</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="9628.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-13T11%3A16%3A41%2B01%3A00&amp;precision=second" title="2014-06-13T11:16:41+01:00 in Timeline">6 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="9628.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-14T13%3A05%3A55%2B01%3A00&amp;precision=second" title="2014-06-14T13:05:55+01:00 in Timeline">6 years</a> ago by Peter Parker
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="9628.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-16T15%3A39%3A42%2B01%3A00&amp;precision=second" title="2014-06-16T15:39:42+01:00 in Timeline">6 years</a> ago by Peter Parker
                </h3>
                
    <div class="comment searchable">
      
      <p>
To test:
</p>
<p>
Make sure the script in the description runs, where before the changes it wouldn't.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="9628.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-20T12%3A06%3A55%2B01%3A00&amp;precision=second" title="2014-06-20T12:06:55+01:00 in Timeline">6 years</a> ago by Samuel Jackson
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Samuel Jackson</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="9628.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-20T13%3A51%3A30%2B01%3A00&amp;precision=second" title="2014-06-20T13:51:30+01:00 in Timeline">6 years</a> ago by Samuel Jackson
                </h3>
                
    <div class="comment searchable">
      
      <p>
Script seems to work. Code review looks good (I learnt a new python function!).
</p>
<p>
However I get the following warning at the end of the script output:
</p>
<pre class="wiki">Could not find log file /archive/ndxlarmor/Instrument/data/cycle_13_5/LARMOR00000209.log
</pre><p>
Which is because LARMOR doesn't have log files... We should tidy this up at some point.
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-20T13%3A52%3A17%2B01%3A00&amp;precision=second" title="2014-06-20T13:52:17+01:00 in Timeline">6 years</a> ago
                      by Samuel Jackson
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9628?cversion=0&amp;cnum_hist=7#comment:7">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9628?action=comment-diff&amp;cnum=7&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="9628.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-20T13%3A51%3A54%2B01%3A00&amp;precision=second" title="2014-06-20T13:51:54+01:00 in Timeline">6 years</a> ago by Samuel Jackson
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/bugfix/9628_allow_larmor_files_to_work_in_add_runs_tab'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/3607021c3197dcb9e0a887e817ad2362eb173b10"><span class="icon">​</span>3607021c3197dcb9e0a887e817ad2362eb173b10</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="9628.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A26%3A09%2B01%3A00&amp;precision=second" title="2015-06-04T03:26:09+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10471"><span class="icon">​</span>10471</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9628?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9628?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9628?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>