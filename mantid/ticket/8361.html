<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #8361 (Clear memory leaks in the API package)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="8360.html" title="Ticket #8360" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8361?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8361?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8361?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="8362.html" title="Ticket #8362" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 8361, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="8360.html" title="Ticket #8360">Previous Ticket</a></span></li><li><span><a class="next" href="8362.html" title="Ticket #8362">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/8361.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="8361.html">Ticket #8361</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-11-04T17%3A10%3A04Z&amp;precision=second" title="2013-11-04T17:10:04Z in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A33%3A35%2B01%3A00&amp;precision=second" title="2015-06-04T02:33:35+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Clear memory leaks in the API package</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Russell+Taylor">Russell Taylor</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Russell+Taylor">Russell Taylor</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;keywords=~Maintenance">Maintenance</a>
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span><a class="closed ticket" href="8357.html" title="Clear memory leaks in the APITest package">#8357</a></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Wenduo Zhou
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
The SNS Jenkins has a <a class="ext-link" href="https://builds.sns.gov/job/ornl_valgrind_develop"><span class="icon">​</span>valgrind job</a> which checks the API code in so far as it is exercised by the unit tests.
</p>
<p>
Using this job and/or valgrind runs of your own, eliminate all the leaks/errors that result from code in the API package - i.e. under Framework/API/inc/MantidAPI or Framework/API/src.
</p>
<p>
Note that this should be done after leaks coming out of the test code have been addressed (<a class="closed ticket" href="8357.html" title="defect: Clear memory leaks in the APITest package (closed: fixed)">#8357</a>).
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="8361.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-02-08T18%3A33%3A55Z&amp;precision=second" title="2014-02-08T18:33:55Z in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        set to <em>Russell Taylor</em>
    </li><li>
      <strong>Milestone</strong>
        changed from <em>Backlog</em> to <em>Release 3.2</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="8361.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-02-14T10%3A59%3A49Z&amp;precision=second" title="2014-02-14T10:59:49Z in Timeline">7 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Bulk move of tickets out of triage (new) to assigned at the introduction of the triage state
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="8361.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T21%3A01%3A30%2B01%3A00&amp;precision=second" title="2014-04-02T21:01:30+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8361.html" title="defect: Clear memory leaks in the API package (closed: fixed)">#8361</a>. Fix memory leak by ensuring temporary array is deleted.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/edbadfca3a6f9697aa965e1d1b7bdeaf08fb238d" title="edbadfca3a6f9697aa965e1d1b7bdeaf08fb238d">edbadfca3a6f9697aa965e1d1b7bdeaf08fb238d</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="8361.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T21%3A01%3A31%2B01%3A00&amp;precision=second" title="2014-04-02T21:01:31+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8361.html" title="defect: Clear memory leaks in the API package (closed: fixed)">#8361</a>. Ensure temporary heap-allocated object is deleted.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/cd60e936aae51e80b6c78dab8d86c23e4d79d900" title="cd60e936aae51e80b6c78dab8d86c23e4d79d900">cd60e936aae51e80b6c78dab8d86c23e4d79d900</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="8361.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T21%3A01%3A31%2B01%3A00&amp;precision=second" title="2014-04-02T21:01:31+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8361.html" title="defect: Clear memory leaks in the API package (closed: fixed)">#8361</a>. Delete instantiator in case of an exception being thrown.
</p>
<p>
The factory takes ownership of the injected instantiator object so is
responsible for deleting it if an exception is going to be thrown and
the algorithm will not end up being subscribed.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/f689caf7e9cc3807bccd989c75ba62de32e4c22f" title="f689caf7e9cc3807bccd989c75ba62de32e4c22f">f689caf7e9cc3807bccd989c75ba62de32e4c22f</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="8361.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-04-02T21%3A01%3A31%2B01%3A00&amp;precision=second" title="2014-04-02T21:01:31+01:00 in Timeline">7 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8361.html" title="defect: Clear memory leaks in the API package (closed: fixed)">#8361</a>. No need to check for a null pointer before calling delete.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/9ca018c2c8980b51f855e6750dded3decc771e6f" title="9ca018c2c8980b51f855e6750dded3decc771e6f">9ca018c2c8980b51f855e6750dded3decc771e6f</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="8361.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-08T17%3A04%3A14%2B01%3A00&amp;precision=second" title="2014-05-08T17:04:14+01:00 in Timeline">6 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8361.html" title="defect: Clear memory leaks in the API package (closed: fixed)">#8361</a>. Move heap allocation after ParameterReference creation.
</p>
<p>
The ParameterReference constructor can throw, which was leaking the
new'd double.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/dd7e7025640081d749d770347d3b6e8b246e5f17" title="dd7e7025640081d749d770347d3b6e8b246e5f17">dd7e7025640081d749d770347d3b6e8b246e5f17</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="8361.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-08T18%3A30%3A49%2B01%3A00&amp;precision=second" title="2014-05-08T18:30:49+01:00 in Timeline">6 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8361.html" title="defect: Clear memory leaks in the API package (closed: fixed)">#8361</a>. Fix memory leaks seen when calling copying a Sample.
</p>
<p>
The copied Surface objects in the Object were being leaked as it seems
the correct way to fill the surface list is with existing Surface
objects held within the 'TopRule' member.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/4a3c80bab567e8331500d5a35cb381fb61c5c77f" title="4a3c80bab567e8331500d5a35cb381fb61c5c77f">4a3c80bab567e8331500d5a35cb381fb61c5c77f</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="8361.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-08T20%3A31%3A19%2B01%3A00&amp;precision=second" title="2014-05-08T20:31:19+01:00 in Timeline">6 years</a> ago by Russell Taylor
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="closed ticket" href="8361.html" title="defect: Clear memory leaks in the API package (closed: fixed)">#8361</a>. Suppress a leak in Nexus's house.
</p>
<p>
This may be a third-party library we are close to, but it's still a
third-party library so we don't want its problems to obscure our own.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/6624e2cb806536a1fcce26217a822b1a24fb133a" title="6624e2cb806536a1fcce26217a822b1a24fb133a">6624e2cb806536a1fcce26217a822b1a24fb133a</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="8361.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-09T14%3A41%3A09%2B01%3A00&amp;precision=second" title="2014-05-09T14:41:09+01:00 in Timeline">6 years</a> ago by Russell Taylor
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
No memory leaks from API (or Kernel, Geometry &amp; DataObjects) any longer. See <a class="ext-link" href="http://builds.mantidproject.org/view/Valgrind/job/valgrind_develop_core_packages/"><span class="icon">​</span>http://builds.mantidproject.org/view/Valgrind/job/valgrind_develop_core_packages/</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="8361.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-09T22%3A03%3A52%2B01%3A00&amp;precision=second" title="2014-05-09T22:03:52+01:00 in Timeline">6 years</a> ago by Wenduo Zhou
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Wenduo Zhou</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="8361.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-05-16T19%3A03%3A16%2B01%3A00&amp;precision=second" title="2014-05-16T19:03:16+01:00 in Timeline">6 years</a> ago by Wenduo Zhou
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/bugfix/8361_api_memory_leaks'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/7e66eb720f86c4d06cdd0fdc4a89c4cdb6c74c9d"><span class="icon">​</span>7e66eb720f86c4d06cdd0fdc4a89c4cdb6c74c9d</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="8361.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A33%3A35%2B01%3A00&amp;precision=second" title="2015-06-04T02:33:35+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/9206"><span class="icon">​</span>9206</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8361?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8361?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8361?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>