<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #9782 (Add function that uses automatic differentiation to calculate derivatives)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="9781.html" title="Ticket #9781" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9782?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9782?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9782?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="9783.html" title="Ticket #9783" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 9782, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="9781.html" title="Ticket #9781">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="9783.html" title="Ticket #9783">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="9782.html">Ticket #9782</a>
          <span class="status">(inprogress)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-06-30T13%3A05%3A34%2B01%3A00&amp;precision=second" title="2014-06-30T13:05:34+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A32%3A29%2B01%3A00&amp;precision=second" title="2015-06-04T03:32:29+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Add function that uses automatic differentiation to calculate derivatives</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Michael+Wedel">Michael Wedel</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Michael+Wedel">Michael Wedel</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="../milestone/Release&#32;3.5.html">Release 3.5</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Framework">Framework</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
As described in the following document:
</p>
<p>
<a class="ext-link" href="https://github.com/mantidproject/documents/blob/master/Design/Autodiff.md"><span class="icon">​</span>https://github.com/mantidproject/documents/blob/master/Design/Autodiff.md</a>
</p>
<p>
I would like to have a function interface that uses automatic differentiation instead of numerical differentiation, utilizing "adept":
</p>
<p>
<a class="ext-link" href="http://www.met.rdg.ac.uk/clouds/adept/"><span class="icon">​</span>http://www.met.rdg.ac.uk/clouds/adept/</a>
</p>
<p>
Since this new function requires adept as a third party library (and two or three very small source code changes to one of the files in order to make it compile in windows), I would appreciate some advice on the best way to integrate this library.
</p>
<p>
I will use this branch to keep track of my local work, the code will not compile before the "library integration issue" is solved.
</p>
<p>
If you would like to try anyway, I can explain how to build and install adept (a target to make a shared object file has to be added to the makefile, it only builds a static library by default) on Linux and/or supply the changes required to build on windows.
</p>

    </div>
  </div>
</div>
          
    <div id="attachments">
        <h2 class="foldable">Attachments</h2>
        <div>
          <dl class="attachments">
              <dt>
    <a href="../attachment/ticket/9782/WorkspaceData.nxs.html" title="View attachment">WorkspaceData.nxs</a><a href="../raw-attachment/ticket/9782/WorkspaceData.nxs" class="trac-rawlink" title="Download">​</a>
       (<span title="128229 bytes">125.2 KB</span>) -
      added by <em>Michael Wedel</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T07%3A47%3A00%2B01%3A00&amp;precision=second" title="2014-07-03T07:47:00+01:00 in Timeline">6 years</a> ago.
  </dt>
              <dd>
                Example data with 20 Gaussian peaks, 5001 data points.
              </dd>
              <dt>
    <a href="../attachment/ticket/9782/6904_peaks_table_fortran.nxs.html" title="View attachment">6904_peaks_table_fortran.nxs</a><a href="../raw-attachment/ticket/9782/6904_peaks_table_fortran.nxs" class="trac-rawlink" title="Download">​</a>
       (<span title="38376 bytes">37.5 KB</span>) -
      added by <em>Michael Wedel</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T12%3A28%3A18%2B01%3A00&amp;precision=second" title="2014-07-31T12:28:18+01:00 in Timeline">6 years</a> ago.
  </dt>
              <dt>
    <a href="../attachment/ticket/9782/6904_calc_peaks1-4_fortran.nxs.html" title="View attachment">6904_calc_peaks1-4_fortran.nxs</a><a href="../raw-attachment/ticket/9782/6904_calc_peaks1-4_fortran.nxs" class="trac-rawlink" title="Download">​</a>
       (<span title="1803181 bytes">1.7 MB</span>) -
      added by <em>Michael Wedel</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T12%3A28%3A32%2B01%3A00&amp;precision=second" title="2014-07-31T12:28:32+01:00 in Timeline">6 years</a> ago.
  </dt>
              <dt>
    <a href="../attachment/ticket/9782/Gaussian_y_J_053.nxs.html" title="View attachment">Gaussian_y_J_053.nxs</a><a href="../raw-attachment/ticket/9782/Gaussian_y_J_053.nxs" class="trac-rawlink" title="Download">​</a>
       (<span title="100111 bytes">97.8 KB</span>) -
      added by <em>Michael Wedel</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T08%3A10%3A01%2B01%3A00&amp;precision=second" title="2014-08-13T08:10:01+01:00 in Timeline">6 years</a> ago.
  </dt>
              <dt>
    <a href="../attachment/ticket/9782/Lorentzian_y_J_d.nxs.html" title="View attachment">Lorentzian_y_J_d.nxs</a><a href="../raw-attachment/ticket/9782/Lorentzian_y_J_d.nxs" class="trac-rawlink" title="Download">​</a>
       (<span title="74658 bytes">72.9 KB</span>) -
      added by <em>Michael Wedel</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T15%3A35%3A16%2B01%3A00&amp;precision=second" title="2014-08-13T15:35:16+01:00 in Timeline">6 years</a> ago.
  </dt>
              <dt>
    <a href="../attachment/ticket/9782/PearsonVII_y_J_d.nxs.html" title="View attachment">PearsonVII_y_J_d.nxs</a><a href="../raw-attachment/ticket/9782/PearsonVII_y_J_d.nxs" class="trac-rawlink" title="Download">​</a>
       (<span title="80931 bytes">79.0 KB</span>) -
      added by <em>Michael Wedel</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-18T09%3A52%3A38%2B01%3A00&amp;precision=second" title="2014-08-18T09:52:38+01:00 in Timeline">6 years</a> ago.
  </dt>
              <dt>
    <a href="../attachment/ticket/9782/Gaussian_y_J_d.nxs.html" title="View attachment">Gaussian_y_J_d.nxs</a><a href="../raw-attachment/ticket/9782/Gaussian_y_J_d.nxs" class="trac-rawlink" title="Download">​</a>
       (<span title="69035 bytes">67.4 KB</span>) -
      added by <em>Michael Wedel</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-31T15%3A43%3A32Z&amp;precision=second" title="2014-10-31T15:43:32Z in Timeline">6 years</a> ago.
  </dt>
          </dl>
          
        </div>
    </div>

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="9782.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-01T16%3A23%3A28%2B01%3A00&amp;precision=second" title="2014-07-01T16:23:28+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. First rough draft
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/f3703ba7b308265143d77318c18e2b1e25dd630c" title="f3703ba7b308265143d77318c18e2b1e25dd630c">f3703ba7b308265143d77318c18e2b1e25dd630c</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="9782.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-01T16%3A23%3A28%2B01%3A00&amp;precision=second" title="2014-07-01T16:23:28+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Refined first draft, added tests
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/9ca66ea8a89b819402a71e05869541bf87e408c9" title="9ca66ea8a89b819402a71e05869541bf87e408c9">9ca66ea8a89b819402a71e05869541bf87e408c9</a>
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T07%3A47%3A00%2B01%3A00&amp;precision=second" title="2014-07-03T07:47:00+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9782/WorkspaceData.nxs.html"><em>WorkspaceData.nxs</em></a><a href="../raw-attachment/ticket/9782/WorkspaceData.nxs" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Example data with 20 Gaussian peaks, 5001 data points.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="9782.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T07%3A48%3A41%2B01%3A00&amp;precision=second" title="2014-07-03T07:48:41+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Temporarily adding adept to MantidAPI CMakeLists.txt
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/05938a8cf7d5cf934cfc08636aa8fbedea641259" title="05938a8cf7d5cf934cfc08636aa8fbedea641259">05938a8cf7d5cf934cfc08636aa8fbedea641259</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="9782.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T07%3A52%3A21%2B01%3A00&amp;precision=second" title="2014-07-03T07:52:21+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
The testing algorithm can be used with the example data (it's just "proof of concept", so it only really does this one thing) in this way:
</p>
<pre class="wiki">Load(Filename='WorkspaceData.nxs', OutputWorkspace='WorkspaceData')
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace='FitParameters', OutputWorkspacePlot='Plot')
</pre><p>
Note that I will remove the testing algorithm and function before the ticket is finished.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="9782.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T12%3A24%3A51%2B01%3A00&amp;precision=second" title="2014-07-03T12:24:51+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Cleaning up and documentation in IFunction1DAutoDiff
</p>
<p>
Added doxygen comments and some general documentation. Cleaned up the interface of AutoDiffJacobianAdapter and added error handling.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/a94a28bff823fa5258bc30d282ef7184cb1cb254" title="a94a28bff823fa5258bc30d282ef7184cb1cb254">a94a28bff823fa5258bc30d282ef7184cb1cb254</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="9782.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T13%3A51%3A48%2B01%3A00&amp;precision=second" title="2014-07-03T13:51:48+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Re <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Fixing incorrect operator in AutoDiffJacobianAdapter
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/9b6668c0f31f4d5b939f84b61980d12f507b6aa1" title="9b6668c0f31f4d5b939f84b61980d12f507b6aa1">9b6668c0f31f4d5b939f84b61980d12f507b6aa1</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="9782.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T15%3A08%3A48%2B01%3A00&amp;precision=second" title="2014-07-03T15:08:48+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
From my point of view this ticket is more or less done except for the unsolved question of how to integrate adept itself into Mantid.
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-03T15%3A09%3A15%2B01%3A00&amp;precision=second" title="2014-07-03T15:09:15+01:00 in Timeline">6 years</a> ago
                      by Michael Wedel
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?cversion=0&amp;cnum_hist=7#comment:7">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?action=comment-diff&amp;cnum=7&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="9782.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-11T10%3A17%3A02%2B01%3A00&amp;precision=second" title="2014-07-11T10:17:02+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
To sum up my packaging and cross-platform adventures with adept.
</p>
<p>
<strong>Linux</strong>
</p>
<ul><li>Modified the makefiles of the original source archive to build an .so file instead of an .a file, so it can be linked dynamically. I thought this dynamic linking approach would be reasonable for Linux systems.
</li><li>Created .deb and .rpm packages. I'm not doing this too often, so I don't know whether the packages are okay the way I did it. One thing that could possibly be improved is that the .rpm package could be split up into adept and adept-dev, just as the debian package. On the other hand, there are actually only two file that need to be distributed (libadept.so and adept.h).
</li><li>Wrote a small test program and compiled it with -ladept after installing the created package on a clean system and make sure it produces the correct output.
</li></ul><p>
<strong>Windows</strong>
</p>
<ul><li>Found out that dynamic linking is not possible here, because <tt>__declspec(thread)</tt> and <tt>__declspec(dllexport)</tt> are not compatible, so on Windows there is (probably?) no alternative to static linking.
</li><li>Patched adept.h to use correct identifiers (<tt>__declspec(thread)</tt> instead of <tt>__thread</tt>, <tt>__restrict</tt> instead of <tt>__restrict__</tt>).
</li><li>Created a VS solution that builds adept as a static library (adept.lib)
</li><li>Created a VS solution that builds the above mentioned example program, linking adept.lib statically and checked the output.
</li></ul><p>
<strong>Mac OS X</strong>
</p>
<ul><li>Could not test on Mac OS X, since I have no machine with the proper environment around.
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="9782.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-23T10%3A10%3A55%2B01%3A00&amp;precision=second" title="2014-07-23T10:10:55+01:00 in Timeline">6 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="9782.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-24T13%3A04%3A00%2B01%3A00&amp;precision=second" title="2014-07-24T13:04:00+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Another update regarding the build system.
</p>
<p>
<strong>Windows</strong>
</p>
<ul><li>Managed to build a DLL, sacrificing the possibility to make a thread safe build. This is not a problem either OpenMP is disabled or when the body of <tt>IFunction1DAutoDiff::functionWrapper</tt> is put into a PARALLEL_CRITICAL block (tested with a small example program).
</li></ul><p>
<strong>General</strong>
</p>
<ul><li>For easier cross-platform builds I decided to create a CMake based build system for the library and the included tests (only those that don't require other libraries, e.g. benchmarks).
</li><li>The CMake system works in Linux and Windows with Visual Studio.
</li><li>I created a Findadept.cmake file for easy inclusion into the Mantid build system and tested that it actually finds the library (at least on Linux, it does).
</li><li>Since these changes added up, I decided for now to have this as a fork of the library. The library itself is only two files, and by putting this into a github repository, the original author can maybe profit from the changes (already contacted him about this).
</li></ul><p>
<strong>What's left to do</strong>
</p>
<ul><li>Verify that it builds on Mac OS X. I tried building with old gcc versions agains old standard libraries, this worked okay, so I hope it should be okay on Mac OS X.
</li><li>Put readme-files, docs and other additional stuff into the fork repo.
</li><li>Adjust packaging scripts (should be much easier now, as there are no patches required in the packaging process itself).
</li></ul>
    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-24T14%3A44%3A41%2B01%3A00&amp;precision=second" title="2014-07-24T14:44:41+01:00 in Timeline">6 years</a> ago
                      by Michael Wedel
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?cversion=1&amp;cnum_hist=10#comment:10">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?action=comment-diff&amp;cnum=10&amp;version=2">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="9782.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-25T09%3A02%3A08%2B01%3A00&amp;precision=second" title="2014-07-25T09:02:08+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Added CMake find module for adept
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/244715a93a6e65f02e8d425dcd3831507fec34b0" title="244715a93a6e65f02e8d425dcd3831507fec34b0">244715a93a6e65f02e8d425dcd3831507fec34b0</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="9782.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-25T09%3A02%3A08%2B01%3A00&amp;precision=second" title="2014-07-25T09:02:08+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Added PARALLEL_CRITICAL section.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/62cc1e6d344edb95acdd4c49b558f713b4962062" title="62cc1e6d344edb95acdd4c49b558f713b4962062">62cc1e6d344edb95acdd4c49b558f713b4962062</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="9782.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-25T09%3A20%3A12%2B01%3A00&amp;precision=second" title="2014-07-25T09:20:12+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Packaging scripts are adjusted as well. I built packages for Ubuntu 13.10 and Fedora 13 (Don't have RHEL6 available, so I chose an old version - if it builds there, it should work on newer versions as well). CMake build system works on Windows as well.
</p>
<p>
Only Mac OS X left now.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="9782.html#comment:14">comment:14</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-25T09%3A33%3A54%2B01%3A00&amp;precision=second" title="2014-07-25T09:33:54+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>9991</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="9782.html#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-25T09%3A38%3A02%2B01%3A00&amp;precision=second" title="2014-07-25T09:38:02+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>9992</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="9782.html#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T09%3A43%3A24%2B01%3A00&amp;precision=second" title="2014-07-31T09:43:24+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Added Gaussian function with numerical derivatives
</p>
<p>
The same as GaussianAutoDiff, for comparison.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/1fbcda1946c6817c5c7071eb2e907bf54c110c72" title="1fbcda1946c6817c5c7071eb2e907bf54c110c72">1fbcda1946c6817c5c7071eb2e907bf54c110c72</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="9782.html#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T09%3A43%3A24%2B01%3A00&amp;precision=second" title="2014-07-31T09:43:24+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Comparison capability on AutoDiffTestAlg
</p>
<p>
Roman's changes to make a comparison possible between numerical and auto diff.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/80544917d0c9a0233a9443804e1a7a3c15e44c56" title="80544917d0c9a0233a9443804e1a7a3c15e44c56">80544917d0c9a0233a9443804e1a7a3c15e44c56</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-18">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:18" class="cnum">
      <a href="9782.html#comment:18">comment:18</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T09%3A43%3A24%2B01%3A00&amp;precision=second" title="2014-07-31T09:43:24+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Modifying fit to output number of iterations.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/d15ce0559fc1de45452559ad45823640b0d39ade" title="d15ce0559fc1de45452559ad45823640b0d39ade">d15ce0559fc1de45452559ad45823640b0d39ade</a>
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T12%3A28%3A18%2B01%3A00&amp;precision=second" title="2014-07-31T12:28:18+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9782/6904_peaks_table_fortran.nxs.html"><em>6904_peaks_table_fortran.nxs</em></a><a href="../raw-attachment/ticket/9782/6904_peaks_table_fortran.nxs" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-07-31T12%3A28%3A32%2B01%3A00&amp;precision=second" title="2014-07-31T12:28:32+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9782/6904_calc_peaks1-4_fortran.nxs.html"><em>6904_calc_peaks1-4_fortran.nxs</em></a><a href="../raw-attachment/ticket/9782/6904_calc_peaks1-4_fortran.nxs" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-19">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:19" class="cnum">
      <a href="9782.html#comment:19">comment:19</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T08%3A09%3A32%2B01%3A00&amp;precision=second" title="2014-08-13T08:09:32+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Added gaussian with hand-coded derivatives
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/1538ab6ea25a15dc266462d999451d094447ebae" title="1538ab6ea25a15dc266462d999451d094447ebae">1538ab6ea25a15dc266462d999451d094447ebae</a>
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T08%3A10%3A01%2B01%3A00&amp;precision=second" title="2014-08-13T08:10:01+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9782/Gaussian_y_J_053.nxs.html"><em>Gaussian_y_J_053.nxs</em></a><a href="../raw-attachment/ticket/9782/Gaussian_y_J_053.nxs" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="9782.html#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T08%3A17%3A13%2B01%3A00&amp;precision=second" title="2014-08-13T08:17:13+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Removed hard-coded number from AutoDiffTestAlg
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/0acd29456afde9e9439171692ec67e3c1f02e590" title="0acd29456afde9e9439171692ec67e3c1f02e590">0acd29456afde9e9439171692ec67e3c1f02e590</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-21">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:21" class="cnum">
      <a href="9782.html#comment:21">comment:21</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T09%3A03%3A51%2B01%3A00&amp;precision=second" title="2014-08-13T09:03:51+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
<strong>Update</strong>
</p>
<p>
Performance tests conducted by Roman and me showed that (in contrast to my expectation), automatic differentiation is slightly slower for the cases we tested, even with a fair amount of parameters and spectra to fit. I also tested different approaches regarding the integration of adept into the function fitting framework, but none of that lead to significant speedups. Compiling adept with a larger initial stack size helped a bit, since it does not need to grow the stack so often anymore (it involves re-allocation of memory and is rather expensive).
</p>
<p>
Another argument generally made in favor of automatic differentiation is the better precision of the resulting derivatives, so I wanted to test this as well.
</p>
<p>
I modified AutoDiffTestAlg to also include a function with hand-coded derivatives and make it more suitable for systematic testing.
</p>
<p>
The algorithm expects a MatrixWorkspace with 4 spectra, which contain the following data:
</p>
<ol><li>f(x)
</li><li>df/d(centre)
</li><li>df/d(height)
</li><li>df/d(sigma)
</li></ol><p>
It produces an equivalent workspace with the differences (reference - calculated) from calls to IFunction::function and IFunction::functionDeriv, using the specified method (num, adept, handcoded).
</p>
<p>
In <a class="attachment" href="../attachment/ticket/9782/Gaussian_y_J_053.nxs.html" title="Attachment 'Gaussian_y_J_053.nxs' in Ticket #9782">attachment:Gaussian_y_J_053.nxs</a><a class="trac-rawlink" href="../raw-attachment/ticket/9782/Gaussian_y_J_053.nxs" title="Download">​</a> there are data for a Gaussian (Centre: 0.0, Height: 4.0, Sigma: 3.5) on the range [-5,5] (Produced with Matlab symbolic toolbox). Assuming the file is located in the data search path, the following script generates workspaces for all three methods:
</p>
<pre class="wiki">Load(Filename='Gaussian_y_J_053.nxs', OutputWorkspace='WorkspaceData', LoaderName='LoadNexusProcessed', LoaderVersion=1)
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="HandCoded",DerivativeType="handcoded")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="Numerical",DerivativeType="num")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="AutoDiff",DerivativeType="adept")
</pre><p>
For hand-coded and automatic derivatives the differences are all in the range [-5e-16, 5e-16], but not identical. I suspect differences on that level are not significant taking into account floating point precision (the values are on the order of 1e0 or 1e-1, with 15-17 significant digits I would classify these differences as "tolerable").
</p>
<p>
In the numerical case all three derivatives behave differently. For df/d(centre) the differences to the correct value are largest with values on the interval [-0.03, 0.03], where the derivatives themselves are on a scale of ca. [-0.8, 0.8]. df/d(height) looks reasonable, with differences of [-5e-14, 5e-14] with a distribution that seems more or less random. The derivations of df/ds are on the interval of [0, 7e-4], with values [0, 0.9]. Here the differences look very systematic, the difference curve looks very similar to the derivative, just 3 orders of magnitudes smaller.
</p>
<p>
With the script above and the attached data these results should be reproducible.
</p>
<p>
Overall, the hand-coded and automatic derivatives are comparable and do not show significant derivations from the reference results. Numeric derivatives show differences which can become large in some cases. I know that this is expected, because of truncation and rounding of floating point numbers and depends on many factors such as parameter value range, function value range and possibly other factors that I am forgetting now. I tried to choose "reasonable" example parameter ranges, but I am willing to try some more functions/parameter combinations as well.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-22">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:22" class="cnum">
      <a href="9782.html#comment:22">comment:22</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T13%3A55%3A29%2B01%3A00&amp;precision=second" title="2014-08-13T13:55:29+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Changed AutoDiffTestAlg
</p>
<p>
The algorithm now takes function parameters (for calculating values) and measures performance of derivative calculation.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/e1440dbf36023a7af3f042428a05d7ed78b03be8" title="e1440dbf36023a7af3f042428a05d7ed78b03be8">e1440dbf36023a7af3f042428a05d7ed78b03be8</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-23">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:23" class="cnum">
      <a href="9782.html#comment:23">comment:23</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T13%3A55%3A29%2B01%3A00&amp;precision=second" title="2014-08-13T13:55:29+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Changed implementation of Gaussians to not use pow
</p>
<p>
I was not aware how incredibly slow pow() is for squaring a value.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/5e7de3ecd7ac1a7009ed0c9e9abb14c6675d1703" title="5e7de3ecd7ac1a7009ed0c9e9abb14c6675d1703">5e7de3ecd7ac1a7009ed0c9e9abb14c6675d1703</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-24">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:24" class="cnum">
      <a href="9782.html#comment:24">comment:24</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T14%3A07%3A41%2B01%3A00&amp;precision=second" title="2014-08-13T14:07:41+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
I decided to spend some more time on profiling, because it seemed odd that hand-coded derivatives would sometimes be slower than numerical and discovered that using "pow" for squaring is not a good idea, especially with automatic differentiation. This is why numerical derivatives were getting away quite cheaply - the derivatives only called "pow" once, and only the double version, as opposed to the adept-version. Now the relative performance of calculating derivatives directly through IFunction::functionDeriv() is ca. 1 : 2.5 : 2.8 (hand-coded, adept, numerical).
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T15%3A35%3A16%2B01%3A00&amp;precision=second" title="2014-08-13T15:35:16+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9782/Lorentzian_y_J_d.nxs.html"><em>Lorentzian_y_J_d.nxs</em></a><a href="../raw-attachment/ticket/9782/Lorentzian_y_J_d.nxs" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-25">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:25" class="cnum">
      <a href="9782.html#comment:25">comment:25</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T15%3A37%3A13%2B01%3A00&amp;precision=second" title="2014-08-13T15:37:13+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Added Lorentz-profiles
</p>
<p>
They all live in a namespace called "Lorentzians".
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/a20c5fc6e651e9acb5920eea67415927f5f2fb79" title="a20c5fc6e651e9acb5920eea67415927f5f2fb79">a20c5fc6e651e9acb5920eea67415927f5f2fb79</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-26">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:26" class="cnum">
      <a href="9782.html#comment:26">comment:26</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T15%3A37%3A13%2B01%3A00&amp;precision=second" title="2014-08-13T15:37:13+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. AutoDiffTestAlg uses Lorentzians instead of Gaussians
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/8b0f0e58850ecce1e8972f73dafca4b8bb1b6703" title="8b0f0e58850ecce1e8972f73dafca4b8bb1b6703">8b0f0e58850ecce1e8972f73dafca4b8bb1b6703</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-27">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:27" class="cnum">
      <a href="9782.html#comment:27">comment:27</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T15%3A44%3A54%2B01%3A00&amp;precision=second" title="2014-08-13T15:44:54+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
The Lorentzian is an interesting test-case, because there isn't even a call to exp, it's just basic arithmetic operations. In this case the relative performance is 1 : 1.94 : 6.97, so roughly 1 : 2 : 7 (hand-coded, numerical, adept). It's not what I expected though (what I had written previously was caused by wrong ordering of my output...), so I will investigate further
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-13T16%3A10%3A45%2B01%3A00&amp;precision=second" title="2014-08-13T16:10:45+01:00 in Timeline">6 years</a> ago
                      by Michael Wedel
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?cversion=1&amp;cnum_hist=27#comment:27">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?action=comment-diff&amp;cnum=27&amp;version=2">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-28">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:28" class="cnum">
      <a href="9782.html#comment:28">comment:28</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-18T09%3A52%3A03%2B01%3A00&amp;precision=second" title="2014-08-18T09:52:03+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. AutoDiffTestAlg improved
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/f6207463aec71b57903d12ee3a212c65c884d1d3" title="f6207463aec71b57903d12ee3a212c65c884d1d3">f6207463aec71b57903d12ee3a212c65c884d1d3</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-29">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:29" class="cnum">
      <a href="9782.html#comment:29">comment:29</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-18T09%3A52%3A03%2B01%3A00&amp;precision=second" title="2014-08-18T09:52:03+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Adding necessary compile time defines
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/bb5616b1926bcae24bfe84342e958b90eb6ab700" title="bb5616b1926bcae24bfe84342e958b90eb6ab700">bb5616b1926bcae24bfe84342e958b90eb6ab700</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-30">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:30" class="cnum">
      <a href="9782.html#comment:30">comment:30</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-18T09%3A52%3A03%2B01%3A00&amp;precision=second" title="2014-08-18T09:52:03+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Const string reference
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/d96c28279914ec75c7aac93500149f96dfcc4133" title="d96c28279914ec75c7aac93500149f96dfcc4133">d96c28279914ec75c7aac93500149f96dfcc4133</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-31">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:31" class="cnum">
      <a href="9782.html#comment:31">comment:31</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-18T09%3A52%3A03%2B01%3A00&amp;precision=second" title="2014-08-18T09:52:03+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Added Pearson-VII, changed AutoDiffTestAlg
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/3b6f16be424f2c25563f8e69d4e1a930c37a8174" title="3b6f16be424f2c25563f8e69d4e1a930c37a8174">3b6f16be424f2c25563f8e69d4e1a930c37a8174</a>
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-18T09%3A52%3A38%2B01%3A00&amp;precision=second" title="2014-08-18T09:52:38+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9782/PearsonVII_y_J_d.nxs.html"><em>PearsonVII_y_J_d.nxs</em></a><a href="../raw-attachment/ticket/9782/PearsonVII_y_J_d.nxs" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-32">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:32" class="cnum">
      <a href="9782.html#comment:32">comment:32</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-08-18T10%3A11%3A19%2B01%3A00&amp;precision=second" title="2014-08-18T10:11:19+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
In the last commit I added the Pearson-VII function (as defined here <a class="ext-link" href="http://pd.chem.ucl.ac.uk/pdnn/peaks/pvii.htm"><span class="icon">​</span>http://pd.chem.ucl.ac.uk/pdnn/peaks/pvii.htm</a>), which has 4 parameters, definitely requires the use of pow and has fairly complex derivatives.
</p>
<p>
With the attachment data, you can do:
</p>
<pre class="wiki">Load(Filename='PearsonVII_y_J_053.nxs', OutputWorkspace='WorkspaceData', LoaderName='LoadNexusProcessed', LoaderVersion=1)
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="HandCoded",DerivativeType="handcoded", GaussianParameters="0.665 200.0 0.0007 2.0")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="Numerical",DerivativeType="num", GaussianParameters="0.665 200.0 0.0007 2.0")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="AutoDiff",DerivativeType="adept", GaussianParameters="0.665 200.0 0.0007 2.0")
</pre><p>
The derivatives are not as precise as the ones for Gaussian and Lorentzian, not even the hand-coded ones. I guess it has something to do with the implementation of the mathematical functions that are used and in the end, also floating point accuracy.
</p>
<p>
This is a summary of the performance (on my Ubuntu machine). It's always Hand-coded : Numerical : Adept.
</p>
<p>
<strong>Gaussian</strong>
</p>
<ul><li>Function: 1 : 1 : 1.3446
</li><li>Derivatives: 1 : 2.8005 : 1.9767
</li><li>Fit (iterations): 6 : 4 : 6
</li></ul><p>
<strong>Lorentzian</strong>
</p>
<ul><li>Function: 1 : 1 : 3.3559
</li><li>Derivatives: 1 : 1.9318 : 5.2510
</li><li>Fit (iterations): 7 : 6 : 7
</li></ul><p>
<strong>Pearson-VII</strong>
</p>
<ul><li>Function: 1 : 1 : 1.0908
</li><li>Derivatives: 1 : 2.2272 : 1.0737
</li><li>Fit (iterations): 6 : 7 : 6
</li></ul><p>
Based on these findings I think it's really worthwhile to include this feature into Mantid.
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-31T15%3A43%3A32Z&amp;precision=second" title="2014-10-31T15:43:32Z in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/9782/Gaussian_y_J_d.nxs.html"><em>Gaussian_y_J_d.nxs</em></a><a href="../raw-attachment/ticket/9782/Gaussian_y_J_d.nxs" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-33">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:33" class="cnum">
      <a href="9782.html#comment:33">comment:33</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-31T15%3A49%3A40Z&amp;precision=second" title="2014-10-31T15:49:40Z in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Local checkpoint Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/ad174be582f79906256262969171d0e2e56dc67b" title="ad174be582f79906256262969171d0e2e56dc67b">ad174be582f79906256262969171d0e2e56dc67b</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-34">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:34" class="cnum">
      <a href="9782.html#comment:34">comment:34</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-31T15%3A49%3A40Z&amp;precision=second" title="2014-10-31T15:49:40Z in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
Refs <a class="inprogress ticket" href="9782.html" title="enhancement: Add function that uses automatic differentiation to calculate derivatives (inprogress)">#9782</a>. Some cleanup and comments in AutoDiffTestAlg
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/7f7318465d5a5097e684865e56b580e510f459b3" title="7f7318465d5a5097e684865e56b580e510f459b3">7f7318465d5a5097e684865e56b580e510f459b3</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-35">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:35" class="cnum">
      <a href="9782.html#comment:35">comment:35</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-31T16%3A26%3A28Z&amp;precision=second" title="2014-10-31T16:26:28Z in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
    <div class="comment searchable">
      
      <p>
The main adept integration is in Mantid::API::IFunctionAutoDiff. Because of the way parameters for automatic differentiation work they can not be used as usual. There are examples how to implement concrete functions in Mantid::CurveFitting (GaussianAutoDiff, Lorentzians, Pearsons).
</p>
<p>
In Mantid::CurveFitting there is a test algorithm, AutoDiffTestAlg, which can be invoked by this script:
</p>
<pre class="wiki">Load(Filename='/home/mwedel/Data/TestData/AutoDiff/Gaussian_y_J_d.nxs', OutputWorkspace='WorkspaceData', LoaderName='LoadNexusProcessed', LoaderVersion=1)
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="G_HandCoded", FunctionName="Gaussian",DerivativeType="analytical", FunctionParameters="0.665 200.0 0.0007")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="G_Numerical", FunctionName="Gaussian",DerivativeType="num", FunctionParameters="0.665 200.0 0.0007")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="G_AutoDiff", FunctionName="Gaussian",DerivativeType="adept", FunctionParameters="0.665 200.0 0.0007")

Load(Filename='/home/mwedel/Data/TestData/AutoDiff/Lorentzian_y_J_d.nxs', OutputWorkspace='WorkspaceData', LoaderName='LoadNexusProcessed', LoaderVersion=1)
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="L_HandCoded", FunctionName="Lorentzian",DerivativeType="analytical", FunctionParameters="0.665 200.0 0.0007")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="L_Numerical", FunctionName="Lorentzian",DerivativeType="num", FunctionParameters="0.665 200.0 0.0007")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="L_AutoDiff", FunctionName="Lorentzian",DerivativeType="adept", FunctionParameters="0.665 200.0 0.0007")

Load(Filename='/home/mwedel/Data/TestData/AutoDiff/PearsonVII_y_J_d.nxs', OutputWorkspace='WorkspaceData', LoaderName='LoadNexusProcessed', LoaderVersion=1)
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="P_HandCoded", FunctionName="Pearson",DerivativeType="analytical", FunctionParameters="0.665 200.0 0.0007 2.0")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="P_Numerical", FunctionName="Pearson",DerivativeType="num", FunctionParameters="0.665 200.0 0.0007 2.0")
AutoDiffTestAlg(InputWorkspace='WorkspaceData', OutputWorkspace="P_AutoDiff", FunctionName="Pearson",DerivativeType="adept", FunctionParameters="0.665 200.0 0.0007 2.0")
</pre><p>
It records timing information and generates output with accuracy information for the partial derivatives. To use it you need to download the attached data files.
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-31T16%3A28%3A03Z&amp;precision=second" title="2014-10-31T16:28:03Z in Timeline">6 years</a> ago
                      by Michael Wedel
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?cversion=0&amp;cnum_hist=35#comment:35">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9782?action=comment-diff&amp;cnum=35&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-36">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:36" class="cnum">
      <a href="9782.html#comment:36">comment:36</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-12-05T12%3A14%3A43Z&amp;precision=second" title="2014-12-05T12:14:43Z in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>Release 3.3</em> to <em>Release 3.4</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Unfortunately I have to postpone this one to Release 3.4
</p>

    </div>

              </div>
              <div class="change" id="trac-change-37">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:37" class="cnum">
      <a href="9782.html#comment:37">comment:37</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-03-10T16%3A32%3A08Z&amp;precision=second" title="2015-03-10T16:32:08Z in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>9991</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-38">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:38" class="cnum">
      <a href="9782.html#comment:38">comment:38</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-03-10T16%3A33%3A16Z&amp;precision=second" title="2015-03-10T16:33:16Z in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>Release 3.4</em> to <em>Release 3.5</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-39">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:39" class="cnum">
      <a href="9782.html#comment:39">comment:39</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-04-01T06%3A50%3A22%2B01%3A00&amp;precision=second" title="2015-04-01T06:50:22+01:00 in Timeline">6 years</a> ago by Michael Wedel
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>9992</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-40">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:40" class="cnum">
      <a href="9782.html#comment:40">comment:40</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A32%3A29%2B01%3A00&amp;precision=second" title="2015-06-04T03:32:29+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10624"><span class="icon">​</span>10624</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9782?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9782?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9782?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>