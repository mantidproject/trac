<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #8645 (Transmission run normalisation for multidetector mode ReflectometryReductionOne)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="8644.html" title="Ticket #8644" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8645?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8645?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/8645?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="8646.html" title="Ticket #8646" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 8645, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="8644.html" title="Ticket #8644">Previous Ticket</a></span></li><li><span><a class="next" href="8646.html" title="Ticket #8646">Next Ticket</a> &rarr;</span></li><li class="last"><a href="../depgraph/8645.html">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="8645.html">Ticket #8645</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2013-12-20T11%3A38%3A05Z&amp;precision=second" title="2013-12-20T11:38:05Z in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A45%3A19%2B01%3A00&amp;precision=second" title="2015-06-04T02:45:19+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Transmission run normalisation for multidetector mode ReflectometryReductionOne</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Owen+Arnold">Owen Arnold</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Owen+Arnold">Owen Arnold</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.1.html">Release 3.1</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Reflectometry">Reflectometry</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span><a class="closed ticket" href="8656.html" title="Use ProcessWorkspaceIndexes algorithm">#8656</a></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Keith Brown
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Changes to be made to ReflectometryReductionOne and ReflectometryReductionOneAuto
</p>
<ul><li>Make RegionOfDirectBeam optional for the multidetector mode.
</li><li>Make the algorithm normalise by the transmssion workspace if it has been provided.
</li></ul>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="8645.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-02T11%3A25%3A37Z&amp;precision=second" title="2014-01-02T11:25:37Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>8656</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="8645.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-02T11%3A27%3A18Z&amp;precision=second" title="2014-01-02T11:27:18Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
    <div class="comment searchable">
      
      <p>
Tester: This has been fixed as part of <a class="closed ticket" href="8656.html" title="enhancement: Use ProcessWorkspaceIndexes algorithm (closed: fixed)">#8656</a>. The following script verifies this by using the output of the reduction workflow as the transmission run in a second run of the workflow. As expected, the output workspace should consist entirely of NAN and 1 Y-values.
</p>
<div class="code"><pre>
<span class="k">class</span> <span class="nc">ReflectometryISIS</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_workspace_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">"POLREF4699"</span>
      
    <span class="k">def</span> <span class="nf">runTest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        workspace_name <span class="o">=</span> <span class="bp">self</span><span class="o">.</span>get_workspace_name<span class="p">()</span>
        workspace_nexus_file <span class="o">=</span> workspace_name <span class="o">+</span> <span class="s">".nxs"</span>
        
        PIX<span class="o">=</span><span class="mf">1.1E-3</span> <span class="c">#m</span>
        
        Load<span class="p">(</span>Filename<span class="o">=</span>workspace_nexus_file<span class="p">,</span>OutputWorkspace<span class="o">=</span>workspace_name<span class="p">)</span>
        X<span class="o">=</span>mtd<span class="p">[</span>workspace_name<span class="p">]</span>
        
        <span class="c"># Run once to get a lambda workspace which we will use as a transmission run.</span>
        results <span class="o">=</span> ReflectometryReductionOneAuto<span class="p">(</span>InputWorkspace<span class="o">=</span>X<span class="p">[</span><span class="mi">0</span><span class="p">],</span> ThetaIn<span class="o">=</span><span class="mf">0.4903</span><span class="p">,</span> I0MonitorIndex<span class="o">=</span><span class="mi">2</span><span class="p">,</span> AnalysisMode<span class="o">=</span><span class="s">'MultiDetectorAnalysis'</span><span class="p">,</span>CorrectDetectorPositions<span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                                        ProcessingInstructions<span class="o">=</span><span class="s">'3:245'</span><span class="p">,</span> OutputWorkspaceWavelength<span class="o">=</span><span class="s">'reduced_lam'</span><span class="p">,</span> WavelengthMin<span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> WavelengthMax<span class="o">=</span><span class="mf">14.5</span><span class="p">,</span>
                                                                        MonitorBackgroundWavelengthMin<span class="o">=</span><span class="mi">13</span><span class="p">,</span> MonitorBackgroundWavelengthMax<span class="o">=</span><span class="mf">14.5</span><span class="p">,</span> MonitorIntegrationWavelengthMin<span class="o">=</span><span class="mi">4</span><span class="p">,</span> MonitorIntegrationWavelengthMax<span class="o">=</span><span class="mi">10</span>
                                                                        <span class="p">)</span>
        
        
        reduced_lam <span class="o">=</span> mtd<span class="p">[</span><span class="s">'reduced_lam'</span><span class="p">]</span>
        
        <span class="c"># Now do the same thing, but use the previous result as the first transmission run.</span>
        results <span class="o">=</span> ReflectometryReductionOneAuto<span class="p">(</span>InputWorkspace<span class="o">=</span>X<span class="p">[</span><span class="mi">0</span><span class="p">],</span> ThetaIn<span class="o">=</span><span class="mf">0.4903</span><span class="p">,</span> I0MonitorIndex<span class="o">=</span><span class="mi">2</span><span class="p">,</span> AnalysisMode<span class="o">=</span><span class="s">'MultiDetectorAnalysis'</span><span class="p">,</span>CorrectDetectorPositions<span class="o">=</span><span class="bp">False</span><span class="p">,</span> FirstTransmissionRun<span class="o">=</span>reduced_lam<span class="p">,</span>
                                                                        ProcessingInstructions<span class="o">=</span><span class="s">'3:245'</span><span class="p">,</span> OutputWorkspaceWavelength<span class="o">=</span><span class="s">'reduced_lam'</span><span class="p">,</span> WavelengthMin<span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> WavelengthMax<span class="o">=</span><span class="mf">14.5</span><span class="p">,</span>
                                                                        MonitorBackgroundWavelengthMin<span class="o">=</span><span class="mi">13</span><span class="p">,</span> MonitorBackgroundWavelengthMax<span class="o">=</span><span class="mf">14.5</span><span class="p">,</span> MonitorIntegrationWavelengthMin<span class="o">=</span><span class="mi">4</span><span class="p">,</span> MonitorIntegrationWavelengthMax<span class="o">=</span><span class="mi">10</span>
                                                                        <span class="p">)</span>
        
        
     
        <span class="c"># Plot the slice. The workspace Y-values should all eithier be NAN or 1.00</span>
        plotSlice<span class="p">(</span><span class="s">'reduced_lam'</span><span class="p">,</span>colorscalelog<span class="o">=</span><span class="bp">True</span><span class="p">,</span> colormax<span class="o">=</span><span class="mf">1e9</span><span class="p">,</span> colormin<span class="o">=</span><span class="mf">1e1</span><span class="p">)</span>
        
test <span class="o">=</span> ReflectometryISIS<span class="p">()</span>
test<span class="o">.</span>runTest<span class="p">()</span>
</pre></div><p>
Provided <a class="closed ticket" href="8656.html" title="enhancement: Use ProcessWorkspaceIndexes algorithm (closed: fixed)">#8656</a> has passed testing, this ticket is complete. No code changes made here, so no need to follow the git testing macros, you just need to verify that the python script above is doing the right thing according to the instructions.
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-02T11%3A29%3A43Z&amp;precision=second" title="2014-01-02T11:29:43Z in Timeline">7 years</a> ago
                      by Owen Arnold
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8645?cversion=0&amp;cnum_hist=2#comment:2">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/8645?action=comment-diff&amp;cnum=2&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="8645.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-06T09%3A35%3A21Z&amp;precision=second" title="2014-01-06T09:35:21Z in Timeline">7 years</a> ago by Owen Arnold
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="8645.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-08T14%3A23%3A25Z&amp;precision=second" title="2014-01-08T14:23:25Z in Timeline">7 years</a> ago by Keith Brown
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Keith Brown</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="8645.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-01-08T14%3A57%3A23Z&amp;precision=second" title="2014-01-08T14:57:23Z in Timeline">7 years</a> ago by Keith Brown
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
After replacing the NaN values with a plot-able value the workspace passed
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="8645.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T02%3A45%3A19%2B01%3A00&amp;precision=second" title="2015-06-04T02:45:19+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/9489"><span class="icon">​</span>9489</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/mantid/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8645?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8645?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/8645?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>