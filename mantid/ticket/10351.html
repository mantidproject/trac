<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #10351 (Enable Second white beam in ISIS reduction)
     – Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="10350.html" title="Ticket #10350" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10351?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10351?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/10351?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="10352.html" title="Ticket #10352" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 10351, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="10350.html" title="Ticket #10350">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="10352.html" title="Ticket #10352">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="10351.html">Ticket #10351</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-13T13%3A39%3A09%2B01%3A00&amp;precision=second" title="2014-10-13T13:39:09+01:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A55%3A01%2B01%3A00&amp;precision=second" title="2015-06-04T03:55:01+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Enable Second white beam in ISIS reduction</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Alex+Buts">Alex Buts</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Alex+Buts">Alex Buts</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=blocker">blocker</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.3.html">Release 3.3</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Direct+Inelastic">Direct Inelastic</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              devashibhai.adroja@…
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
              Federico M Pouzols
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
User needs it to process his data from recent cycle
</p>

    </div>
  </div>
</div>
          
    <div id="attachments">
        <h2 class="foldable">Attachments</h2>
        <div>
          <dl class="attachments">
              <dt>
    <a href="../attachment/ticket/10351/Vanadium.png.html" title="View attachment">Vanadium.png</a><a href="../raw-attachment/ticket/10351/Vanadium.png" class="trac-rawlink" title="Download">​</a>
       (<span title="15181 bytes">14.8 KB</span>) -
      added by <em>Alex Buts</em> <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-15T17%3A54%3A40%2B01%3A00&amp;precision=second" title="2014-10-15T17:54:40+01:00 in Timeline">6 years</a> ago.
  </dt>
          </dl>
          
        </div>
    </div>

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="10351.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-14T08%3A33%3A04%2B01%3A00&amp;precision=second" title="2014-10-14T08:33:04+01:00 in Timeline">6 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="10351.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-15T13%3A16%3A14%2B01%3A00&amp;precision=second" title="2014-10-15T13:16:14+01:00 in Timeline">6 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="10351.html" title="Enable Second white beam in ISIS reduction (closed: fixed)">#10351</a> This should do it
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/d2d639c41a71a85b62b4655e1eb504265e7a34ab" title="d2d639c41a71a85b62b4655e1eb504265e7a34ab">d2d639c41a71a85b62b4655e1eb504265e7a34ab</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="10351.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-15T13%3A53%3A37%2B01%3A00&amp;precision=second" title="2014-10-15T13:53:37+01:00 in Timeline">6 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
REFS <a class="closed ticket" href="10351.html" title="Enable Second white beam in ISIS reduction (closed: fixed)">#10351</a> a bit more needs to change
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/7450a0f59198821516d50c343eca702c0a019d87" title="7450a0f59198821516d50c343eca702c0a019d87">7450a0f59198821516d50c343eca702c0a019d87</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="10351.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-15T17%3A50%3A52%2B01%3A00&amp;precision=second" title="2014-10-15T17:50:52+01:00 in Timeline">6 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Changes to the dgreduce are trivial and tested providing white beam vanadium run number corresponding to the new vanadium number. (Script provided below)  Instrument scientist should be an ultimate judge of the changes correctness. 
</p>
<p>
If you want to look at the results, here it is: The picture illustrates new (smaller mass) vanadium reduced as sample using old white-beam and new white-beam as the base for normalization integral. (It also divided by 10 -- Mslice feature)
</p>
<p>
the "Straight line" should me at 41 mb/sr but is lower by the ratio of white beam vanadium masses. (32/7.8) To account for changes one has to multiply the target workspace by the ratio of the masses
</p>
<p>
After consultation with instrument scientist I have not put this ratio into general reduction but placed it into particular user script below.
</p>
<p>
Due to specific nature of the changes and very narrow range of their usage I suggest just merge the changes into master if all system test completed successfully. 
</p>
<pre class="wiki">"""
sample Direct inelastic reduction for MERLIN performed in absolute units
"""
from qtiGenie import *
#from PySlice2 import *

# Calculates

inst='MER'
iliad_setup(inst)

# where to save results (usually specified in Mantid, data search directories)
config['defaultsave.directory']=r'd:\Data\Mantid_Testing\14_10_02'
save_dir = config.getString('defaultsave.directory')

print "Data will be saved into: ",save_dir
# map mask and cal file, again the values from Mantid, data search directories can be modified here
config.appendDataSearchDir(r'c:\Users\wkc26243\Documents\work\InstrumentFiles\merlin')
# data (raw or nxs) run files -- values from data search directories can be modified here
config.appendDataSearchDir(r'd:\Data\Mantid_Testing\14_10_02')
#load vanadium file   
whitebeamfile="14338" #old white beam vanadium with sample data
if not('wb_wksp' in mtd):
    wb_wksp=LoadRaw(Filename=whitebeamfile,LoadLogFiles="0")
MonoVanWB="wb_wksp"


# Mandatory positional parameters
ei=60
rebin_params=[-50, 0.2, 58]
MonoVanRun=[23635]  #white beam vanadium run for this is 23012

if not('monovan_wksp' in mtd):
    monovan_wksp,monovan_wksp_monitors=Load(Filename=str(MonoVanRun[0]),LoadLogFiles="0",LoadMonitors='1')
else:
    monovan_wksp = mtd['monovan_wksp'];
    
#RenameWorkspace(InputWorkspace="monovan_wksp_Monitors",OutputWorkspace="monovan_wksp_monitors")


#params['monovan_mapfile']='rings_125.map'
#   Other positional  parameters
mapfile='rings_125' # ring map file is used for powder.  if absent, idf file value is used instead
# key-coded parameters
params={}
params['vanadium-mass']=7.85 #32.62   #   7.85
params['monovan_integr_range']=[-50,50]
params['norm_method']='current'
params['det_cal_file']='det_corr_125.dat'  #det_cal_file must be specified if the reduction sends out put to a workspace
params['sample_mass']=3.51 # 32.62 #14.25 # CeRuSi3 3.56   #CePdSi3
params['sample_rmm']= 330.7925# 325.4450 # CeRuSi3 #330.750  #CePdSi3
params['monovan_mapfile']= 'rings_125.map'  #'ringTo1Ring212.map' This is only for Mono van absolute normalization on Rings## good

params['hardmaskOnly']='Bjorn_mask.msk'

runs=[14693]  # this is old sample run

############## normal reduction####################
#

for runfile in runs:
    save_file=inst+str(runfile)+'_abs.nxspe'
    LoadRaw(Filename=str(runfile),OutputWorkspace="run_wksp",LoadLogFiles="0",LoadMonitors='Separate')

    
    w1=iliad("wb_wksp","run_wksp",ei,rebin_params,mapfile,monovan_wksp,23012,**params)
    # one has to  multiply by old vanadium to new to vanadium mass ratio to compensate for different white in beam vanadium mass-es
    w1*=(32.62/7.85)
    

    SaveNXSPE('w1',save_file)
print "All done"


</pre>
    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-15T17%3A52%3A36%2B01%3A00&amp;precision=second" title="2014-10-15T17:52:36+01:00 in Timeline">6 years</a> ago
                      by Alex Buts
                    (<a href="https://trac.mantidproject.org/mantid/ticket/10351?cversion=0&amp;cnum_hist=4#comment:4">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/10351?action=comment-diff&amp;cnum=4&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change">
                <h3 class="change">
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-15T17%3A54%3A40%2B01%3A00&amp;precision=second" title="2014-10-15T17:54:40+01:00 in Timeline">6 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Attachment</strong>
        <a href="../attachment/ticket/10351/Vanadium.png.html"><em>Vanadium.png</em></a><a href="../raw-attachment/ticket/10351/Vanadium.png" title="Download" class="trac-rawlink">​</a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="10351.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-22T14%3A50%3A28%2B01%3A00&amp;precision=second" title="2014-10-22T14:50:28+01:00 in Timeline">6 years</a> ago by Federico M Pouzols
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>verifying</em>
    </li><li>
      <strong>Tester</strong>
        set to <em>Federico M Pouzols</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="10351.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-22T17%3A41%3A35%2B01%3A00&amp;precision=second" title="2014-10-22T17:41:35+01:00 in Timeline">6 years</a> ago by Federico M Pouzols
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verifying</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
It passed all the system tests successfully...
</p>
<pre class="wiki">100% tests passed, 0 tests failed out of 218 (33 skipped)
All tests passed? True
</pre><p>
The new/changed code looks sensible and clear. It adds a new option
and is apparently fully backwards compatible so it should not
interfere with with other users' work.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="10351.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-10-22T17%3A42%3A02%2B01%3A00&amp;precision=second" title="2014-10-22T17:42:02+01:00 in Timeline">6 years</a> ago by Federico Montesino Pouzols
                </h3>
                
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/feature/10351_secondWhite'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/f892eab565a4340e4fbbff7858c4303490e8f4d2"><span class="icon">​</span>f892eab565a4340e4fbbff7858c4303490e8f4d2</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="10351.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A55%3A01%2B01%3A00&amp;precision=second" title="2015-06-04T03:55:01+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/11193"><span class="icon">​</span>11193</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10351?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10351?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/10351?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>