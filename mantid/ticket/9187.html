<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      #9187 (Mari problem with GeitEi at high incident energy)
     â€“ Mantid Project
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="9186.html" title="Ticket #9186" />
        <link rel="last" href="11888.html" title="Ticket #11888" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9187?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9187?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="https://trac.mantidproject.org/mantid/ticket/9187?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="9188.html" title="Ticket #9188" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search Mantid Project" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="a82fe30e7bef2e30fd2838e9";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/mantid/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 9187, escape_newlines: 0}
        $("#comment").autoPreview("/mantid/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/mantid/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://www.mantidproject.org/"><img src="../chrome/site/mantid_logo_with_name.png" alt="Mantid Logo" width="250" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="https://trac.mantidproject.org/mantid/login">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li class="last"><a href="../about.html">About Trac</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Wiki</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li class="last"><a href="../search.html">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="9186.html" title="Ticket #9186">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="9188.html" title="Ticket #9188">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="9187.html">Ticket #9187</a>
          <span class="status">(closed: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T10%3A41%3A56Z&amp;precision=second" title="2014-03-14T10:41:56Z in Timeline">7 years</a> ago</p>
    <p>Last modified <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A07%3A49%2B01%3A00&amp;precision=second" title="2015-06-04T03:07:49+01:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Mari problem with GeitEi at high incident energy</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;reporter=Nick+Draper">Nick Draper</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;owner=Alex+Buts">Alex Buts</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;priority=critical">critical</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="../milestone/Release&#32;3.2.html">Release 3.2</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="https://trac.mantidproject.org/mantid/query?status=!closed&amp;component=Direct+Inelastic">Direct Inelastic</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby"><span></span></td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking"><span></span></td>
        <th id="h_tester">
          Tester:
        </th>
        <td headers="h_tester">
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
From Jon Taylor
</p>
<pre class="wiki">We found a bug in get ei when running mari at high incident energy.

We have to fix the ei, but in so doing the factor in time of flight is generated incorrectly as -0 musec rather than a real time.

I've attached two scripts the one with the bug and the fixed one
thanks
jon
######################################################################
#Python Script Generated by GeneratePythonScript Algorithm
######################################################################
LoadMask(Instrument='MAR',InputFile=r'/home/mari/Desktop/MantidUserScripts/direct_inelastic/MARI/MaskFiles/mari_mask2014.msk',OutputWorkspace='hard_mask_ws')
LoadRaw(Filename=r'/home/mari/data/mar18622.raw',OutputWorkspace='wb_wksp',LoadLogFiles='0')
LoadRaw(Filename=r'/home/mari/data/mar00000.raw',OutputWorkspace='run_wksp',LoadLogFiles='0')
LoadDetectorInfo(Workspace='run_wksp',DataFilename=r'/home/mari/data/mar18622.raw',RelocateDets='1')
AddSampleLog(Workspace='run_wksp',LogName='calibrated',LogText='MAR18622.raw')
GetEi(InputWorkspace='run_wksp',Monitor1Spec='2',Monitor2Spec='3',EnergyEstimate='1771',FixEi='1')
ScaleX(InputWorkspace='run_wksp',OutputWorkspace='_wksp.spe',Factor='-0',Operation='Add',InstrumentParameter='DelayTime',Combine='1')
MoveInstrumentComponent(Workspace='_wksp.spe',ComponentName='Moderator',Z='-1.4419999999999999',RelativePosition='0')
ConvertToDistribution(Workspace='_wksp.spe')
CalculateFlatBackground(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',StartX='18000',EndX='19500',Mode='Mean')
ConvertFromDistribution(Workspace='_wksp.spe')
NormaliseByCurrent(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe')
AddSampleLog(Workspace='_wksp.spe',LogName='DirectInelasticReductionNormalisedBy',LogText='current')
ConvertUnits(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',Target='DeltaE',EMode='Direct')
Rebin(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',Params='-200,3,900',PreserveEvents='0')
DetectorEfficiencyCor(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe')
CorrectKiKf(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe')
Rebin(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',Params='-200,3,900')
MaskDetectors(Workspace='_wksp.spe',MaskedWorkspace='hard_mask_ws')
GroupDetectors(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',MapFile=r'/home/mari/Desktop/MantidUserScripts/direct_inelastic/MARI/MapFiles/mari_res2013.map',Behaviour='Average')
ConvertToDistribution(Workspace='_wksp.spe')
LoadDetectorInfo(Workspace='wb_wksp',DataFilename=r'/home/mari/data/mar18622.raw',RelocateDets='1')
AddSampleLog(Workspace='wb_wksp',LogName='calibrated',LogText='MAR18622.raw')
CloneWorkspace(InputWorkspace='wb_wksp',OutputWorkspace='_wksp.spe-white')
NormaliseByCurrent(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white')
AddSampleLog(Workspace='_wksp.spe-white',LogName='DirectInelasticReductionNormalisedBy',LogText='current')
ConvertUnits(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white',Target='Energy')
Rebin(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white',Params='20,160,100')
MaskDetectors(Workspace='_wksp.spe-white',MaskedWorkspace='hard_mask_ws')
GroupDetectors(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white',MapFile=r'/home/mari/Desktop/MantidUserScripts/direct_inelastic/MARI/MapFiles/mari_res2013.map',Behaviour='Average')
CreateSingleValuedWorkspace(OutputWorkspace='__tmp_binary_operation_double',DataValue='1000')
Multiply(LHSWorkspace='_wksp.spe-white',RHSWorkspace='__tmp_binary_operation_double',OutputWorkspace='_wksp.spe-white')
Divide(LHSWorkspace='_wksp.spe',RHSWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe')
CreateSingleValuedWorkspace(OutputWorkspace='__tmp_binary_operation_double',DataValue='181820000')
Multiply(LHSWorkspace='_wksp.spe',RHSWorkspace='__tmp_binary_operation_double',OutputWorkspace='_wksp.spe')
RenameWorkspace(InputWorkspace='_wksp.spe',OutputWorkspace='w1')
RenameWorkspace(InputWorkspace='w1',OutputWorkspace='mar0')


now for the corrected version

######################################################################
#Python Script Generated by GeneratePythonScript Algorithm
######################################################################
LoadMask(Instrument='MAR',InputFile=r'/home/mari/Desktop/MantidUserScripts/direct_inelastic/MARI/MaskFiles/mari_mask2014.msk',OutputWorkspace='hard_mask_ws')
LoadRaw(Filename=r'/home/mari/data/mar18622.raw',OutputWorkspace='wb_wksp',LoadLogFiles='0')
LoadRaw(Filename=r'/home/mari/data/mar00000.raw',OutputWorkspace='run_wksp',LoadLogFiles='0')
LoadDetectorInfo(Workspace='run_wksp',DataFilename=r'/home/mari/data/mar18622.raw',RelocateDets='1')
AddSampleLog(Workspace='run_wksp',LogName='calibrated',LogText='MAR18622.raw')
GetEi(InputWorkspace='run_wksp',Monitor1Spec='2',Monitor2Spec='3',EnergyEstimate='1771',FixEi=True)
ScaleX(InputWorkspace='run_wksp',OutputWorkspace='_wksp.spe',Factor='-559.0271718578523',Operation='Add',InstrumentParameter='DelayTime',Combine='1')
MoveInstrumentComponent(Workspace='_wksp.spe',ComponentName='Moderator',Z='-1.4419999999999999',RelativePosition='0')
ConvertToDistribution(Workspace='_wksp.spe')
#CalculateFlatBackground(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',StartX='17249.972828142149',EndX='18749.972828142149',Mode='Mean')
ConvertFromDistribution(Workspace='_wksp.spe')
NormaliseByCurrent(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe')
AddSampleLog(Workspace='_wksp.spe',LogName='DirectInelasticReductionNormalisedBy',LogText='current')
ConvertUnits(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',Target='DeltaE',EMode='Direct')
Rebin(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',Params='-200,3,1700',PreserveEvents='0')
DetectorEfficiencyCor(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe')
CorrectKiKf(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe')
Rebin(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',Params='-200,3,1700')
MaskDetectors(Workspace='_wksp.spe',MaskedWorkspace='hard_mask_ws')
GroupDetectors(InputWorkspace='_wksp.spe',OutputWorkspace='_wksp.spe',MapFile=r'/home/mari/Desktop/MantidUserScripts/direct_inelastic/MARI/MapFiles/mari_res2013.map',Behaviour='Average')
ConvertToDistribution(Workspace='_wksp.spe')
LoadDetectorInfo(Workspace='wb_wksp',DataFilename=r'/home/mari/data/mar18622.raw',RelocateDets='1')
AddSampleLog(Workspace='wb_wksp',LogName='calibrated',LogText='MAR18622.raw')
CloneWorkspace(InputWorkspace='wb_wksp',OutputWorkspace='_wksp.spe-white')
NormaliseByCurrent(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white')
AddSampleLog(Workspace='_wksp.spe-white',LogName='DirectInelasticReductionNormalisedBy',LogText='current')
ConvertUnits(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white',Target='Energy')
Rebin(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white',Params='20,160,100')
MaskDetectors(Workspace='_wksp.spe-white',MaskedWorkspace='hard_mask_ws')
GroupDetectors(InputWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe-white',MapFile=r'/home/mari/Desktop/MantidUserScripts/direct_inelastic/MARI/MapFiles/mari_res2013.map',Behaviour='Average')
CreateSingleValuedWorkspace(OutputWorkspace='__tmp_binary_operation_double',DataValue='1000')
Multiply(LHSWorkspace='_wksp.spe-white',RHSWorkspace='__tmp_binary_operation_double',OutputWorkspace='_wksp.spe-white')
Divide(LHSWorkspace='_wksp.spe',RHSWorkspace='_wksp.spe-white',OutputWorkspace='_wksp.spe')
CreateSingleValuedWorkspace(OutputWorkspace='__tmp_binary_operation_double',DataValue='181820000')
Multiply(LHSWorkspace='_wksp.spe',RHSWorkspace='__tmp_binary_operation_double',OutputWorkspace='_wksp.spe')
RenameWorkspace(InputWorkspace='_wksp.spe',OutputWorkspace='w1')
RenameWorkspace(InputWorkspace='w1',OutputWorkspace='w1')


</pre>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="9187.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T10%3A42%3A05Z&amp;precision=second" title="2014-03-14T10:42:05Z in Timeline">7 years</a> ago by Nick Draper
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="9187.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T10%3A42%3A50Z&amp;precision=second" title="2014-03-14T10:42:50Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>inprogress</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="9187.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T19%3A02%3A55Z&amp;precision=second" title="2014-03-14T19:02:55Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> Added Property which defines the search range.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/e65e71bfbd7597c78b7893c24de442a3a38a0f01" title="e65e71bfbd7597c78b7893c24de442a3a38a0f01">e65e71bfbd7597c78b7893c24de442a3a38a0f01</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="9187.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T19%3A02%3A56Z&amp;precision=second" title="2014-03-14T19:02:56Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> modified calculatePeakWidthAtHalfHeight to work with
</p>
<p>
high background. This should fix the problem, though background can generate some stabilizing effects sometimes -- this can change results in other places.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/57be0a827338ab54fbf69dad028666e0dc5ad6f7" title="57be0a827338ab54fbf69dad028666e0dc5ad6f7">57be0a827338ab54fbf69dad028666e0dc5ad6f7</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="9187.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T19%3A29%3A31Z&amp;precision=second" title="2014-03-14T19:29:31Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> Modified algorithm to return guess time together
</p>
<p>
with guess energy. This would allow reduction to work properly for Ei specified manually.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/d897ea43b49811aac08b8f1a52d08ab634cca9d8" title="d897ea43b49811aac08b8f1a52d08ab634cca9d8">d897ea43b49811aac08b8f1a52d08ab634cca9d8</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="9187.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T19%3A29%3A31Z&amp;precision=second" title="2014-03-14T19:29:31Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> Added parameter to IDF parameters for instruments
</p>
<p>
which can work in high energy mode. This parameter allows to specify ei-search-range as input to DGreduction.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/4d05e46c5ba2026c749c06a1aa610d482ec77789" title="4d05e46c5ba2026c749c06a1aa610d482ec77789">4d05e46c5ba2026c749c06a1aa610d482ec77789</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="9187.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T19%3A50%3A12Z&amp;precision=second" title="2014-03-14T19:50:12Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> Fixing unit test
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/20bd356e0cb1ed134ff2e10f9e66f5a7f4d5044d" title="20bd356e0cb1ed134ff2e10f9e66f5a7f4d5044d">20bd356e0cb1ed134ff2e10f9e66f5a7f4d5044d</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="9187.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-14T20%3A01%3A36Z&amp;precision=second" title="2014-03-14T20:01:36Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> Fixing another unit test/GetEiTest.h
</p>
<p>
This one relates to changes in behavior -- if Ei is given, monitor peak returns guess time. -- This would allow reduction to work for Ei given
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/cbe7ca944932404cbfd55807dd446c2cf18c9083" title="cbe7ca944932404cbfd55807dd446c2cf18c9083">cbe7ca944932404cbfd55807dd446c2cf18c9083</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="9187.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T09%3A35%3A33Z&amp;precision=second" title="2014-03-17T09:35:33Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> Changed info to warning
</p>
<p>
when peak has not been found within the specified range and guess energy is fixed.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/93720a45c5b2121d337e57719458d5513da8efa1" title="93720a45c5b2121d337e57719458d5513da8efa1">93720a45c5b2121d337e57719458d5513da8efa1</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="9187.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T10%3A24%3A29Z&amp;precision=second" title="2014-03-17T10:24:29Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>inprogress</em> to <em>verify</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
To test this ticket one need couple of high energy run files. I put them at <a class="ext-link" href="ftp://ftp.nd.rl.ac.uk/scratch/abuts/"><span class="icon">â€‹</span>ftp://ftp.nd.rl.ac.uk/scratch/abuts/</a>. Map and mask files for MARI are present in the system tests folder. 
</p>
<p>
Both scripts below should fail before the ticket is applied but after merging, two solutions are available:
</p>
<p>
1) This script should run and produce history similar to the one deemed right in the ticket description. 
</p>
<pre class="wiki">      import dgreduce 
      # The tests rely on MARI_Parameters.xml file valind on 31 July 2013
      dgreduce.setup("MAR") 

      args={};
      args['hard_mask_file'] = 'mar11015.msk'
      args['det_cal_file']= 18622 #"11060"
      args['fix_ei']= True 

      outWS=dgreduce.arb_units(18622,19227,1771,[-200,3,1700],'mari_res.map',None,**args)

</pre><p>
2) This script should run and find ei peak from the initial energy guess.
</p>
<pre class="wiki">      import dgreduce 
      # The tests rely on MARI_Parameters.xml file valind on 31 July 2013
      dgreduce.setup("MAR") 

      args={};
      args['hard_mask_file'] = 'mar11015.msk'
      args['det_cal_file']= 18622 #"11060"
      args['ei_mon_peak_search_range']= 0.05

      outWS=dgreduce.arb_units(18622,19227,1771,[-200,3,1700],'mari_res.map',None,**args)

</pre>
    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T10%3A33%3A26Z&amp;precision=second" title="2014-03-17T10:33:26Z in Timeline">7 years</a> ago
                      by Alex Buts
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9187?cversion=0&amp;cnum_hist=10#comment:10">previous</a>)
                    (<a href="https://trac.mantidproject.org/mantid/ticket/9187?action=comment-diff&amp;cnum=10&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="9187.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-17T19%3A03%3A18Z&amp;precision=second" title="2014-03-17T19:03:18Z in Timeline">7 years</a> ago by Alex Buts
                </h3>
                
    <div class="comment searchable">
      
      <p>
refs <a class="closed ticket" href="9187.html" title="enhancement: Mari problem with GeitEi at high incident energy (closed: fixed)">#9187</a> Spelling error.
</p>
<p>
Changeset: <a class="changeset" href="https://github.com/mantidproject/mantid/commit/ca7bee037b2f68c7f9b1819618b56db7d7abb892" title="ca7bee037b2f68c7f9b1819618b56db7d7abb892">ca7bee037b2f68c7f9b1819618b56db7d7abb892</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="9187.html#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2014-03-20T09%3A42%3A54Z&amp;precision=second" title="2014-03-20T09:42:54Z in Timeline">7 years</a> ago by Martyn Gigg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>verify</em> to <em>closed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Merge remote-tracking branch 'origin/bugfix/9187_getEIatHighE'
</p>
<p>
Full changeset: <a class="ext-link" href="https://github.com/mantidproject/mantid/commit/1bc69422f3e988b14bdad4d0c17a8f000f4bf90b"><span class="icon">â€‹</span>1bc69422f3e988b14bdad4d0c17a8f000f4bf90b</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="9187.html#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="https://trac.mantidproject.org/mantid/timeline?from=2015-06-04T03%3A07%3A49%2B01%3A00&amp;precision=second" title="2015-06-04T03:07:49+01:00 in Timeline">5 years</a> ago by Stuart Campbell
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket has been transferred to github issue <a class="ext-link" href="http://github.com/mantidproject/mantid/issues/10030"><span class="icon">â€‹</span>10030</a>
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9187?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9187?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="https://trac.mantidproject.org/mantid/ticket/9187?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.5</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>