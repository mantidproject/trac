# determine where to save
import os
savedir = os.path.abspath(os.path.curdir)

LoadEventNexus(Filename="PG3_4866_event.nxs",
               OutputWorkspace="PG3_4866",
               Precount=True)
FilterBadPulses(InputWorkspace="PG3_4866",
                OutputWorkspace="PG3_4866")
RemovePromptPulse(InputWorkspace="PG3_4866",
                  OutputWorkspace="PG3_4866",
                  Width=50)
CompressEvents(InputWorkspace="PG3_4866",
               OutputWorkspace="PG3_4866",
               Tolerance=0.01)
SortEvents(InputWorkspace="PG3_4866")
CropWorkspace(InputWorkspace="PG3_4866",
              OutputWorkspace="PG3_4866",
              XMax=16666.669999999998)
LoadCalFile(InputWorkspace="PG3_4866",
            CalFilename="PG3_FERNS_d4832_2011_08_24.cal",
            WorkspaceName="PG3")
MaskDetectors(Workspace="PG3_4866",
              MaskedWorkspace="PG3_mask")
AlignDetectors(InputWorkspace="PG3_4866",
               OutputWorkspace="PG3_4866",
               OffsetsWorkspace="PG3_offsets")
ConvertUnits(InputWorkspace="PG3_4866",
             OutputWorkspace="PG3_4866",
             Target="TOF")
UnwrapSNS(InputWorkspace="PG3_4866",
          OutputWorkspace="PG3_4866",
          LRef=62)
RemoveLowResTOF(InputWorkspace="PG3_4866",
                OutputWorkspace="PG3_4866",
                ReferenceDIFC=1500)
ConvertUnits(InputWorkspace="PG3_4866",
             OutputWorkspace="PG3_4866",
             Target="dSpacing")
Rebin(InputWorkspace="PG3_4866",
      OutputWorkspace="PG3_4866",
      Params=(0.1,-0.0004,2.2))
SortEvents(InputWorkspace="PG3_4866")
DiffractionFocussing(InputWorkspace="PG3_4866",
                     OutputWorkspace="PG3_4866",
                     GroupingWorkspace="PG3_group")
EditInstrumentGeometry(Workspace="PG3_4866",
                       PrimaryFlightPath=60,
                       SpectrumIDs=[1],
                       L2=[3.2208],
                       Polar=[90.8074],
                       Azimuthal=[0])
ConvertUnits(InputWorkspace="PG3_4866",
             OutputWorkspace="PG3_4866",
             Target="TOF")
Rebin(InputWorkspace="PG3_4866",
      OutputWorkspace="PG3_4866",
      Params=[-0.0004])
ConvertUnits(InputWorkspace="PG3_4866",
             OutputWorkspace="PG3_4866",
             Target="dSpacing")


FindPeaks(InputWorkspace = "PG3_4866",
	FWHM = 8,
	Tolerance = 4,
	PeakPositions = "0.5044,0.5191,0.5350,0.5526,0.5936,0.6178,0.6453,0.6768,0.7134,0.7566,0.8089,0.8737,0.9571,1.0701,1.2356,1.5133,2.1401",
	PeakFunctions = "Gaussian",
	BackgroundFunction = "Quadratic",
	HighBackground = True,
	PeakPositionTolerance = 0.05,
	PeakList = "FoundPeakTable",
	RawPeakParameters = True)
